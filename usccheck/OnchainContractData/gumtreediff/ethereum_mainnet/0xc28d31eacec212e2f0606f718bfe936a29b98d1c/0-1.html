<html lang="en"><head><meta charset="utf8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>GumTree</title><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><style type="text/css">/*
 * This file is part of GumTree.
 *
 * GumTree is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * GumTree is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with GumTree.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Copyright 2011-2015 Jean-Rémy Falleri <jr.falleri@gmail.com>
 * Copyright 2011-2015 Floréal Morandat <florealm@gmail.com>
 */

.add {
	border: 1px solid black;
	background-color: MediumSeaGreen;
}

.del {
	border: 1px solid black;
	background-color: IndianRed;
}

.mv {
	border: 1px solid black;
	background-color: Plum;
}

.upd {
	border: 1px solid black;
	background-color: DarkOrange;
	font-weight: bold;
}

.cupd {
	font-weight: normal;
	color: DimGray;
}

.selected {
	background-color: Gold;
}

.marker {
	margin: 0;
	padding: 0;
}

div {
	margin: 0px;
	padding: 0px;
}

.pre-scrollable {
	margin: 0px;
	padding: 0px;
	font-size: 10pt;
	color: black;
	max-height: 90vh;
	background-color: white;
	border: 1px solid black;
	font-family: "Hack, Inconsolata", "Consolas", "Liberation Sans Regular", "DejaVu Sans Mono", monospace;
}

.tooltip-inner {
    max-width: none;
}
</style><script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script><script type="text/javascript">/*
 * This file is part of GumTree.
 *
 * GumTree is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * GumTree is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with GumTree.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Copyright 2011-2015 Jean-Rémy Falleri <jr.falleri@gmail.com>
 * Copyright 2011-2015 Floréal Morandat <florealm@gmail.com>
 */

$(function(){
    let popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
    let popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
      return new bootstrap.Popover(popoverTriggerEl)
    })

    $("body").keypress(function (event) {
        switch (event.which) {
            case 116:
                $('html, body').animate({scrollTop: 0}, 100);
                break;
            case 98:
                $("html, body").animate({ scrollTop: $(document).height() }, 100);
                break;
            case 113:
                window.location = "/quit";
                break;
            case 108:
                window.location = "/list";
                break;
        }
    });
});
</script><script type="text/javascript">/*
 * This file is part of GumTree.
 *
 * GumTree is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * GumTree is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with GumTree.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Copyright 2011-2015 Jean-Rémy Falleri <jr.falleri@gmail.com>
 * Copyright 2011-2015 Floréal Morandat <florealm@gmail.com>
 */

currentMapping = 0;

if (typeof String.prototype.startsWith != 'function') {
  String.prototype.startsWith = function (str){
    return this.slice(0, str.length) == str;
  };
}

function getMappedElement(eltId) {
	if (eltId.startsWith("move-src")) {
		return eltId.replace("src","dst");  	 	
  	}
  	else {
  		return eltId.replace("dst","src");
  	}
}

function nextMapping() {
	if (currentMapping == 0) {
		currentMapping = 1;
		return "#mapping-" + currentMapping.toString();
	} else {
		currentMapping++;
		
		if ($("#mapping-" + currentMapping.toString()).length > 0) {
			return "#mapping-" + currentMapping.toString();
		} else {
			currentMapping = 1;
			return "#mapping-" + currentMapping.toString();		
		}		
	}
}

function isSrc(eltId) {
	return eltId.startsWith("move-src");
}

$(function() {
    $("body").keypress(function (event) {
        switch(event.which) {
            case 110:
                const mapping = $(nextMapping());
                const pre = mapping.closest("pre");
                pre.animate({scrollTop: pre.scrollTop() + mapping.position().top - 200}, 100);
                break;
        }
    });

    // highlight
    $("span.mv.token, span.token.upd").click(function(event) {
        if ($(this).hasClass("selected")) {
            $("span.mv.token, span.token.upd").removeClass("selected");
        } else {
            $("span.mv.token, span.token.upd").removeClass("selected");
            const refElt = $("#" + getMappedElement($(this).attr("id")));
            $(this).addClass("selected");
            refElt.addClass("selected");
            const pre = refElt.closest("pre");
            console.log(pre);
            pre.animate({scrollTop: pre.scrollTop() + refElt.position().top - 200}, 100);
        }
        event.stopPropagation();
    });
    
    $("span.add.token, span.token.del").click(function(event) {
        $("span.mv.token, span.token.upd").removeClass("selected");
        event.stopPropagation();
    });

    // tooltip
    $("span.token").hover(
    	function (event) {
    		$(this).tooltip('show');
    		event.stopPropagation();
    	},
    	function (event) {
    		$(this).tooltip('hide');
    		event.stopPropagation();
    	}
    );
});
</script></head><body><div class="container-fluid"><div class="row"><div class="col"><div class="btn-toolbar justify-content-end"><div class="btn-group mr-2"><button class="btn btn-primary btn-sm" id="legend" data-bs-toggle="popover" data-bs-placement="bottom" data-bs-html="true" data-bs-content="<span class='del'>&nbsp;&nbsp;</span> deleted<br><span class='add'>&nbsp;&nbsp;</span> added<br><span class='mv'>&nbsp;&nbsp;</span> moved<br><span class='upd';>&nbsp;&nbsp;</span> updated<br>">Legend</button><button class="btn btn-primary btn-sm" id="shortcuts" data-bs-toggle="popover" data-bs-placement="bottom" data-bs-html="true" data-bs-content="<b>q</b> quit<br><b>l</b> list<br><b>n</b> next<br><b>t</b> top<br><b>b</b> bottom">Shortcuts</button></div><div class="btn-group"><a href="/list" class="btn btn-default btn-sm btn-primary">Back</a><a href="/quit" class="btn btn-default btn-sm btn-danger">Quit</a></div></div></div></div><div class="row"><div class="col-6"><h5>0x1a62e0a5fe67761274735b609b3b5685880bcf1f.etherscan.io-ERC721Bridge.sol</h5><pre class="pre-scrollable"><span class="marker" id="mapping-1"></span><span class="token upd" id="move-src-1" data-title="source_file/comment"><span class="cupd">// </span>D<span class="cupd">e</span>p<span class="cupd">en</span><span class="cupd">d</span><span class="cupd">e</span>ncy<span class="cupd"> </span><span class="cupd">f</span>ile:<span class="cupd"> contracts/</span><span class="cupd">i</span>nt<span class="cupd">e</span>rfaces/IAuthority<span class="cupd">.sol</span></span>

<span class="marker" id="mapping-2"></span><span class="token upd" id="move-src-2" data-title="source_file/comment"><span class="cupd">//</span><span class="cupd"> </span>p<span class="cupd">ra</span>gm<span class="cupd">a</span> <span class="cupd">s</span><span class="cupd">o</span>l<span class="cupd">i</span>di<span class="cupd">ty</span> ^0.4.24;</span>

<span class="marker" id="mapping-3"></span><span class="token mv" id="move-src-3" data-title="source_file/contract_declaration">contract IAuthority {
    function canCall(
        address src, address dst, bytes4 sig
    ) public view returns (bool);
}</span>

<span class="marker" id="mapping-4"></span><span class="token upd" id="move-src-4" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> </span>De<span class="cupd">p</span>en<span class="cupd">d</span>enc<span class="cupd">y </span>file:<span class="cupd"> </span>contracts/DSAuth.sol</span>

<span class="marker" id="mapping-5"></span><span class="token upd" id="move-src-5" data-title="source_file/comment"><span class="cupd">//</span><span class="cupd"> </span>p<span class="cupd">ra</span>gma <span class="cupd">s</span><span class="cupd">ol</span>idity ^0.4.24;</span>

<span class="marker" id="mapping-6"></span><span class="token upd" id="move-src-6" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> </span>im<span class="cupd">p</span>o<span class="cupd">r</span>t 'contr<span class="cupd">a</span>cts/interf<span class="cupd">a</span>ce<span class="cupd">s</span>/IAuth<span class="cupd">o</span>r<span class="cupd">i</span><span class="cupd">ty</span><span class="cupd">.</span>sol';</span>

contract DSAuthEvents {
    event LogSetAuthority (address indexed authority);
    event LogSetOwner     (address indexed owner);
}

/**
 * @title DSAuth
 * @dev The DSAuth contract is reference implement of https://github.com/dapphub/ds-auth
 * But in the isAuthorized method, the src from address(this) is remove for safty concern.
 */
contract DSAuth is DSAuthEvents {
    IAuthority   public  authority;
    address      public  owner;

    constructor() public {
        owner = msg.sender;
        emit LogSetOwner(msg.sender);
    }

    function setOwner(address owner_)
        public
        auth
    {
        owner = owner_;
        emit LogSetOwner(owner);
    }

    function setAuthority(IAuthority authority_)
        public
        auth
    {
        authority = authority_;
        emit LogSetAuthority(authority);
    }

    modifier auth {
        require(isAuthorized(msg.sender, msg.sig));
        _;
    }

    modifier onlyOwner() {
        require(msg.sender == owner);
        _;
    }

    function isAuthorized(address src, bytes4 sig) internal view returns (bool) {
        if (src == owner) {
            return true;
        } else if (authority == IAuthority(0)) {
            return false;
        } else {
            return authority.canCall(src, this, sig);
        }
    }
}


<span class="marker" id="mapping-7"></span><span class="token mv" id="move-src-7" data-title="source_file/comment"><span class="marker" id="mapping-8"></span><span class="token upd" id="move-src-8" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> </span>De<span class="cupd">p</span>endency<span class="cupd"> </span>f<span class="cupd">i</span>le: co<span class="cupd">nt</span><span class="cupd">r</span><span class="cupd">ac</span>t<span class="cupd">s/</span>PausableDS<span class="cupd">Auth</span><span class="cupd">.sol</span></span></span>

<span class="marker" id="mapping-9"></span><span class="token upd" id="move-src-9" data-title="source_file/comment"><span class="cupd">//</span><span class="cupd"> </span>p<span class="cupd">ra</span>gm<span class="cupd">a</span> <span class="cupd">s</span>o<span class="cupd">l</span>idi<span class="cupd">t</span>y ^0.4.24;</span>

<span class="marker" id="mapping-10"></span><span class="token upd" id="move-src-10" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> </span>im<span class="cupd">p</span>o<span class="cupd">r</span>t<span class="cupd"> </span>"c<span class="cupd">o</span>n<span class="cupd">t</span>racts/DSAuth<span class="cupd">.</span>sol";</span>


/**
 * @title Pausable
 * @dev Base contract which allows children to implement an emergency stop mechanism.
 */
contract PausableDSAuth is DSAuth {
  event Pause();
  event Unpause();

  bool public paused = false;


  /**
   * @dev Modifier to make a function callable only when the contract is not paused.
   */
  modifier whenNotPaused() {
    require(!paused);
    _;
  }

  /**
   * @dev Modifier to make a function callable only when the contract is paused.
   */
  modifier whenPaused() {
    require(paused);
    _;
  }

  /**
   * @dev called by the owner to pause, triggers stopped state
   */
  function pause() public onlyOwner whenNotPaused {
    paused = true;
    emit Pause();
  }

  /**
   * @dev called by the owner to unpause, returns to normal state
   */
  function unpause() public onlyOwner whenPaused {
    paused = false;
    emit Unpause();
  }
}

<span class="marker" id="mapping-11"></span><span class="token mv" id="move-src-11" data-title="source_file/comment"><span class="marker" id="mapping-12"></span><span class="token upd" id="move-src-12" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> </span>De<span class="cupd">p</span>endency file: c<span class="cupd">o</span>nt<span class="cupd">r</span>ac<span class="cupd">t</span>s<span class="cupd">/</span>interfaces/I<span class="cupd">S</span>e<span class="cupd">t</span>tingsRegistry<span class="cupd">.sol</span></span></span>

<span class="marker" id="mapping-13"></span><span class="token upd" id="move-src-13" data-title="source_file/comment"><span class="cupd">//</span><span class="cupd"> </span>p<span class="cupd">ra</span><span class="cupd">g</span>ma <span class="cupd">s</span><span class="cupd">ol</span>idity ^0.4.24;</span>

<span class="marker" id="mapping-14"></span><span class="token mv" id="move-src-14" data-title="source_file/contract_declaration">contract ISettingsRegistry {
    enum SettingsValueTypes { NONE, UINT, STRING, ADDRESS, BYTES, BOOL, INT }

    function uintOf(bytes32 _propertyName) public view returns (uint256);

    function stringOf(bytes32 _propertyName) public view returns (string);

    function addressOf(bytes32 _propertyName) public view returns (address);

    function bytesOf(bytes32 _propertyName) public view returns (bytes);

    function boolOf(bytes32 _propertyName) public view returns (bool);

    function intOf(bytes32 _propertyName) public view returns (int);

    function setUintProperty(bytes32 _propertyName, uint _value) public;

    function setStringProperty(bytes32 _propertyName, string _value) public;

    function setAddressProperty(bytes32 _propertyName, address _value) public;

    function setBytesProperty(bytes32 _propertyName, bytes _value) public;

    function setBoolProperty(bytes32 _propertyName, bool _value) public;

    function setIntProperty(bytes32 _propertyName, int _value) public;

    function getValueTypeOf(bytes32 _propertyName) public view returns (uint /* SettingsValueTypes */ );

    event ChangeProperty(bytes32 indexed _propertyName, uint256 _type);
}</span>

<span class="marker" id="mapping-15"></span><span class="token upd" id="move-src-15" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> </span>De<span class="cupd">p</span>endency file: cont<span class="cupd">ra</span>ct<span class="cupd">s</span>/Sett<span class="cupd">i</span>ngI<span class="cupd">d</span>s.sol</span>

<span class="marker" id="mapping-16"></span><span class="token mv" id="move-src-16" data-title="source_file/comment"><span class="marker" id="mapping-17"></span><span class="token upd" id="move-src-17" data-title="source_file/comment"><span class="cupd">//</span><span class="cupd"> </span>p<span class="cupd">ra</span>gm<span class="cupd">a</span> <span class="cupd">s</span>o<span class="cupd">l</span>idity ^<span class="cupd">0.</span>4.24;</span></span>

/**
    Id definitions for SettingsRegistry.sol
    Can be used in conjunction with the settings registry to get properties
*/
contract SettingIds {
    bytes32 public constant CONTRACT_RING_ERC20_TOKEN = "CONTRACT_RING_ERC20_TOKEN";

    bytes32 public constant CONTRACT_KTON_ERC20_TOKEN = "CONTRACT_KTON_ERC20_TOKEN";

    bytes32 public constant CONTRACT_GOLD_ERC20_TOKEN = "CONTRACT_GOLD_ERC20_TOKEN";

    bytes32 public constant CONTRACT_WOOD_ERC20_TOKEN = "CONTRACT_WOOD_ERC20_TOKEN";

    bytes32 public constant CONTRACT_WATER_ERC20_TOKEN = "CONTRACT_WATER_ERC20_TOKEN";

    bytes32 public constant CONTRACT_FIRE_ERC20_TOKEN = "CONTRACT_FIRE_ERC20_TOKEN";

    bytes32 public constant CONTRACT_SOIL_ERC20_TOKEN = "CONTRACT_SOIL_ERC20_TOKEN";

    bytes32 public constant CONTRACT_OBJECT_OWNERSHIP = "CONTRACT_OBJECT_OWNERSHIP";

    bytes32 public constant CONTRACT_TOKEN_LOCATION = "CONTRACT_TOKEN_LOCATION";

    bytes32 public constant CONTRACT_LAND_BASE = "CONTRACT_LAND_BASE";

    bytes32 public constant CONTRACT_USER_POINTS = "CONTRACT_USER_POINTS";

    bytes32 public constant CONTRACT_INTERSTELLAR_ENCODER = "CONTRACT_INTERSTELLAR_ENCODER";

    bytes32 public constant CONTRACT_DIVIDENDS_POOL = "CONTRACT_DIVIDENDS_POOL";

    bytes32 public constant CONTRACT_TOKEN_USE = "CONTRACT_TOKEN_USE";

    bytes32 public constant CONTRACT_REVENUE_POOL = "CONTRACT_REVENUE_POOL";

    bytes32 public constant CONTRACT_ERC721_BRIDGE = "CONTRACT_ERC721_BRIDGE";

    bytes32 public constant CONTRACT_PET_BASE = "CONTRACT_PET_BASE";

    // Cut owner takes on each auction, measured in basis points (1/100 of a percent).
    // this can be considered as transaction fee.
    // Values 0-10,000 map to 0%-100%
    // set ownerCut to 4%
    // ownerCut = 400;
    bytes32 public constant UINT_AUCTION_CUT = "UINT_AUCTION_CUT";  // Denominator is 10000

    bytes32 public constant UINT_TOKEN_OFFER_CUT = "UINT_TOKEN_OFFER_CUT";  // Denominator is 10000

    // Cut referer takes on each auction, measured in basis points (1/100 of a percent).
    // which cut from transaction fee.
    // Values 0-10,000 map to 0%-100%
    // set refererCut to 4%
    // refererCut = 400;
    bytes32 public constant UINT_REFERER_CUT = "UINT_REFERER_CUT";

    bytes32 public constant CONTRACT_LAND_RESOURCE = "CONTRACT_LAND_RESOURCE";
}

<span class="marker" id="mapping-18"></span><span class="token upd" id="move-src-18" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> </span>De<span class="cupd">p</span>endency file: cont<span class="cupd">ra</span>cts/interf<span class="cupd">a</span>ce<span class="cupd">s</span>/IInterste<span class="cupd">l</span>larEnco<span class="cupd">d</span>erV3.sol</span>

<span class="marker" id="mapping-19"></span><span class="token upd" id="move-src-19" data-title="source_file/comment"><span class="cupd">//</span><span class="cupd"> </span>p<span class="cupd">ra</span>gm<span class="cupd">a</span> <span class="cupd">s</span><span class="cupd">ol</span>idity ^0.4.24;</span>

<span class="marker" id="mapping-20"></span><span class="token mv" id="move-src-20" data-title="source_file/contract_declaration">contract IInterstellarEncoderV3 {
    uint256 constant CLEAR_HIGH =  0x00000000000000000000000000000000ffffffffffffffffffffffffffffffff;

    uint256 public constant MAGIC_NUMBER = 42;    // Interstellar Encoding Magic Number.
    uint256 public constant CHAIN_ID = 1; // Ethereum mainet.
    uint256 public constant CURRENT_LAND = 1; // 1 is Atlantis, 0 is NaN.

    enum ObjectClass { 
        NaN,
        LAND,
        APOSTLE,
        OBJECT_CLASS_COUNT
    }

    function registerNewObjectClass(address _objectContract, uint8 objectClass) public;

    function encodeTokenId(address _tokenAddress, uint8 _objectClass, uint128 _objectIndex) public view returns (uint256 _tokenId);

    function encodeTokenIdForObjectContract(
        address _tokenAddress, address _objectContract, uint128 _objectId) public view returns (uint256 _tokenId);

    function encodeTokenIdForOuterObjectContract(
        address _objectContract, address nftAddress, address _originNftAddress, uint128 _objectId, uint16 _producerId, uint8 _convertType) public view returns (uint256);

    function getContractAddress(uint256 _tokenId) public view returns (address);

    function getObjectId(uint256 _tokenId) public view returns (uint128 _objectId);

    function getObjectClass(uint256 _tokenId) public view returns (uint8);

    function getObjectAddress(uint256 _tokenId) public view returns (address);

    function getProducerId(uint256 _tokenId) public view returns (uint16);

    function getOriginAddress(uint256 _tokenId) public view returns (address);

}</span>

<span class="marker" id="mapping-21"></span><span class="token upd" id="move-src-21" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> </span>De<span class="cupd">p</span>endency file: cont<span class="cupd">ra</span>cts/interf<span class="cupd">a</span>ce<span class="cupd">s</span>/IM<span class="cupd">i</span>n<span class="cupd">t</span>ableERC2<span class="cupd">0.</span>sol</span>

<span class="marker" id="mapping-22"></span><span class="token upd" id="move-src-22" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> </span><span class="cupd">p</span><span class="cupd">r</span>a<span class="cupd">g</span><span class="cupd">m</span><span class="cupd">a</span><span class="cupd"> </span><span class="cupd">s</span><span class="cupd">o</span>l<span class="cupd">i</span>d<span class="cupd">i</span><span class="cupd">t</span><span class="cupd">y </span>^0<span class="cupd">.</span>4.23;</span>

<span class="marker" id="mapping-23"></span><span class="token mv" id="move-src-23" data-title="source_file/contract_declaration">contract IMintableERC20 {

    function mint(address _to, uint256 _value) public;
}</span>

<span class="marker" id="mapping-24"></span><span class="token upd" id="move-src-24" data-title="source_file/comment"><span class="cupd">//</span><span class="cupd"> </span>Dependen<span class="cupd">c</span>y file: c<span class="cupd">ontracts/interfaces/I</span>NFTAdaptor<span class="cupd">.sol</span></span>

<span class="marker" id="mapping-25"></span><span class="token upd" id="move-src-25" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> pragma solidity ^0.4.24;</span></span>


<span class="marker" id="mapping-26"></span><span class="token mv" id="move-src-26" data-title="source_file/contract_declaration">contract INFTAdaptor {
    function toMirrorTokenId(uint256 _originTokenId) public view returns (uint256);

    function toOriginTokenId(uint256 _mirrorTokenId) public view returns (uint256);

    function approveOriginToken(address _bridge, uint256 _originTokenId) public;

    function ownerInOrigin(uint256 _originTokenId) public view returns (address);

    function cacheMirrorTokenId(uint256 _originTokenId, uint256 _mirrorTokenId) public;
}</span>


<span class="marker" id="mapping-27"></span><span class="token upd" id="move-src-27" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> </span>Dependency f<span class="cupd">i</span>le: o<span class="cupd">p</span>enzeppelin-s<span class="cupd">o</span>lidity/cont<span class="cupd">r</span>ac<span class="cupd">t</span>s<span class="cupd">/</span>introspection/<span class="cupd">ERC165.sol</span></span>

<span class="marker" id="mapping-28"></span><span class="token upd" id="move-src-28" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> </span>p<span class="cupd">r</span><span class="cupd">a</span>gm<span class="cupd">a</span><span class="cupd"> </span>s<span class="cupd">o</span><span class="cupd">li</span><span class="cupd">d</span><span class="cupd">i</span><span class="cupd">t</span>y<span class="cupd"> </span>^0<span class="cupd">.</span>4.24;</span>


<span class="marker" id="mapping-29"></span><span class="token upd" id="move-src-29" data-title="source_file/comment"><span class="cupd">/</span>**<span class="cupd"></span>
 * <span class="cupd">@</span><span class="cupd">t</span><span class="cupd">i</span>t<span class="cupd">l</span>e<span class="cupd"> ERC</span>1<span class="cupd">6</span>5
 * <span class="cupd">@</span>dev https://githu<span class="cupd">b</span>.co<span class="cupd">m</span>/e<span class="cupd">th</span>ereum/E<span class="cupd">I</span>Ps/blob/master/EIPS/eip-165.md
 */</span>
<span class="marker" id="mapping-30"></span><span class="token del" data-title="source_file/interface_declaration">interface ERC165 <span class="marker" id="mapping-31"></span><span class="token mv" id="move-src-30" data-title="interface_declaration/contract_body">{

  <span class="marker" id="mapping-32"></span><span class="token upd" id="move-src-31" data-title="contract_body/comment"><span class="cupd">/**
  </span><span class="cupd"> * </span>@noti<span class="cupd">c</span><span class="cupd">e</span> <span class="cupd">Q</span>u<span class="cupd">e</span>r<span class="cupd">y</span><span class="cupd"> if</span> <span class="cupd">a contract implements</span> a<span class="cupd">n interface</span><span class="cupd"></span><span class="cupd">
 </span><span class="cupd">  </span>* @param<span class="cupd"> _interface</span><span class="cupd">I</span>d<span class="cupd"> Th</span><span class="cupd">e </span><span class="cupd">i</span><span class="cupd">n</span><span class="cupd">t</span><span class="cupd">erfa</span>c<span class="cupd">e identif</span>ie<span class="cupd">r</span>,<span class="cupd"> </span>as <span class="cupd">sp</span><span class="cupd">e</span>cified<span class="cupd"> </span><span class="cupd">i</span>n ERC-1<span class="cupd">65
</span><span class="cupd">  </span> * @<span class="cupd">d</span>ev <span class="cupd">I</span><span class="cupd">n</span>ter<span class="cupd">fa</span>ce identi<span class="cupd">f</span><span class="cupd">i</span>c<span class="cupd">a</span>t<span class="cupd">i</span><span class="cupd">o</span><span class="cupd">n </span>is<span class="cupd"> </span><span class="cupd">s</span>pec<span class="cupd">i</span><span class="cupd">f</span><span class="cupd">i</span>ed<span class="cupd"> </span>in ERC-1<span class="cupd">6</span><span class="cupd">5. This functi</span><span class="cupd">o</span><span class="cupd">n</span>
 <span class="cupd">  *</span> <span class="cupd">uses less tha</span>n<span class="cupd"> 30,000 gas.</span><span class="cupd">
</span>   */</span>
  function supportsInterface(bytes4 <span class="marker" id="mapping-33"></span><span class="token upd" id="move-src-32" data-title="parameter/identifier">_<span class="cupd">interfaceId</span></span>)
    external
    view
    returns (bool);
}</span></span>


<span class="marker" id="mapping-34"></span><span class="token upd" id="move-src-33" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> </span>De<span class="cupd">p</span>endency<span class="cupd"> </span>file: openzeppelin-<span class="cupd">solidity</span>/contracts/token/ERC7<span class="cupd">2</span>1/ERC721Basic.sol</span>

<span class="marker" id="mapping-35"></span><span class="token upd" id="move-src-34" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> </span>pr<span class="cupd">a</span>gm<span class="cupd">a</span><span class="cupd"> s</span>ol<span class="cupd">i</span>dity<span class="cupd"> </span>^0<span class="cupd">.</span>4.24;</span>

<span class="marker" id="mapping-36"></span><span class="token upd" id="move-src-35" data-title="source_file/comment"><span class="cupd">//</span><span class="cupd"> </span>import "openzeppelin-solidity/<span class="cupd">contracts/int</span><span class="cupd">r</span>o<span class="cupd">s</span>pection<span class="cupd">/</span><span class="cupd">ERC</span><span class="cupd">1</span>65<span class="cupd">.sol</span>";</span>


<span class="marker" id="mapping-37"></span><span class="token upd" id="move-src-36" data-title="source_file/comment"><span class="cupd">/*</span>*<span class="cupd"></span>
 * @title ERC721 Non-Fu<span class="cupd">n</span>gible Token S<span class="cupd">t</span>andar<span class="cupd">d</span> b<span class="cupd">a</span><span class="cupd">s</span>ic<span class="cupd"> </span>i<span class="cupd">n</span>terfac<span class="cupd">e</span>
 * @dev see https://gith<span class="cupd">u</span>b.com/ethereum/EIPs/blob/master/EIPS/eip<span class="cupd">-</span>721.<span class="cupd">m</span>d<span class="cupd">
</span> */</span>
<span class="marker" id="mapping-38"></span><span class="token mv" id="move-src-37" data-title="source_file/contract_declaration">contract <span class="marker" id="mapping-39"></span><span class="token upd" id="move-src-38" data-title="contract_declaration/identifier"><span class="cupd">ERC721</span>Basic</span> is <span class="marker" id="mapping-40"></span><span class="token upd" id="move-src-39" data-title="user_defined_type/identifier"><span class="cupd">ERC165</span></span> {

  bytes4 internal constant InterfaceId_ERC721 = 0x80ac58cd;
  /*
   * 0x80ac58cd ===
   *   bytes4(keccak256('balanceOf(address)')) ^
   *   bytes4(keccak256('ownerOf(uint256)')) ^
   *   bytes4(keccak256('approve(address,uint256)')) ^
   *   bytes4(keccak256('getApproved(uint256)')) ^
   *   bytes4(keccak256('setApprovalForAll(address,bool)')) ^
   *   bytes4(keccak256('isApprovedForAll(address,address)')) ^
   *   bytes4(keccak256('transferFrom(address,address,uint256)')) ^
   *   bytes4(keccak256('safeTransferFrom(address,address,uint256)')) ^
   *   bytes4(keccak256('safeTransferFrom(address,address,uint256,bytes)'))
   */

  bytes4 internal constant InterfaceId_ERC721Exists = 0x4f558e79;
  /*
   * 0x4f558e79 ===
   *   bytes4(keccak256('exists(uint256)'))
   */

  bytes4 internal constant InterfaceId_ERC721Enumerable = 0x780e9d63;
  /**
   * 0x780e9d63 ===
   *   bytes4(keccak256('totalSupply()')) ^
   *   bytes4(keccak256('tokenOfOwnerByIndex(address,uint256)')) ^
   *   bytes4(keccak256('tokenByIndex(uint256)'))
   */

  bytes4 internal constant InterfaceId_ERC721Metadata = 0x5b5e139f;
  /**
   * 0x5b5e139f ===
   *   bytes4(keccak256('name()')) ^
   *   bytes4(keccak256('symbol()')) ^
   *   bytes4(keccak256('tokenURI(uint256)'))
   */

  event Transfer(
    address indexed _from,
    address indexed _to,
    uint256 indexed _tokenId
  );
  event Approval(
    address indexed _owner,
    address indexed _approved,
    uint256 indexed _tokenId
  );
  event ApprovalForAll(
    address indexed _owner,
    address indexed _operator,
    bool _approved
  );

  function balanceOf(address _owner) public view returns (uint256 _balance);
  function ownerOf(uint256 _tokenId) public view returns (address _owner);
  function exists(uint256 _tokenId) public view returns (bool _exists);

  function approve(address _to, uint256 _tokenId) public;
  function getApproved(uint256 _tokenId)
    public view returns (address _operator);

  function setApprovalForAll(address _operator, bool _approved) public;
  function isApprovedForAll(address _owner, address _operator)
    public view returns (bool);

  function transferFrom(address _from, address _to, uint256 _tokenId) public;
  function safeTransferFrom(address _from, address _to, uint256 _tokenId)
    public;

  function safeTransferFrom(
    address _from,
    address _to,
    uint256 _tokenId,
    bytes _data
  )
    public;
}</span>


<span class="marker" id="mapping-41"></span><span class="token upd" id="move-src-40" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> </span>Dependency f<span class="cupd">i</span>le: o<span class="cupd">p</span>enzeppelin-s<span class="cupd">o</span>lidity/cont<span class="cupd">r</span>ac<span class="cupd">t</span>s<span class="cupd">/</span>token/<span class="cupd">ERC</span>72<span class="cupd">1</span>/ERC721<span class="cupd">.sol</span></span>

<span class="marker" id="mapping-42"></span><span class="token upd" id="move-src-41" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> </span>p<span class="cupd">r</span><span class="cupd">a</span>gm<span class="cupd">a</span><span class="cupd"> </span><span class="cupd">s</span><span class="cupd">o</span><span class="cupd">l</span><span class="cupd">i</span><span class="cupd">d</span>ity ^0.4.24;</span>

<span class="marker" id="mapping-43"></span><span class="token upd" id="move-src-42" data-title="source_file/comment"><span class="cupd">//</span><span class="cupd"> </span>import "openzeppelin-solidity/<span class="cupd">contracts/</span><span class="cupd">t</span>ok<span class="cupd">e</span>n<span class="cupd">/</span><span class="cupd">ERC721</span>/E<span class="cupd">R</span>C721Bas<span class="cupd">i</span>c<span class="cupd">.sol</span>";</span>


<span class="marker" id="mapping-44"></span><span class="token upd" id="move-src-43" data-title="source_file/comment"><span class="cupd">/*</span>*<span class="cupd"></span>
 * @title ERC-721 Non-Fungible Token Stand<span class="cupd">a</span>rd, optio<span class="cupd">n</span>al en<span class="cupd">u</span>me<span class="cupd">r</span>atio<span class="cupd">n</span> exte<span class="cupd">n</span><span class="cupd">s</span>ion
 *<span class="cupd"> </span>@dev See https:/<span class="cupd">/g</span>ith<span class="cupd">u</span>b.com/ethereum/EIPs/blob/master/EIPS/eip<span class="cupd">-</span>721.<span class="cupd">m</span>d<span class="cupd">
</span> */</span>
<span class="marker" id="mapping-45"></span><span class="token del" data-title="source_file/contract_declaration">contract ERC721Enumerable is <span class="marker" id="mapping-46"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">ERC721Basic</span> <span class="marker" id="mapping-47"></span><span class="token del" data-title="contract_declaration/contract_body">{
  <span class="marker" id="mapping-48"></span><span class="token mv" id="move-src-44" data-title="contract_body/function_definition">function <span class="marker" id="mapping-49"></span><span class="token upd" id="move-src-45" data-title="function_definition/identifier"><span class="cupd">to</span>talSupply</span>() public <span class="marker" id="mapping-50"></span><span class="token del" data-title="function_definition/state_mutability">view</span> returns (uint256);</span>
  <span class="marker" id="mapping-51"></span><span class="token del" data-title="contract_body/function_definition">function tokenOfOwnerByIndex(
    <span class="marker" id="mapping-52"></span><span class="token mv" id="move-src-46" data-title="function_definition/parameter">address <span class="marker" id="mapping-53"></span><span class="token upd" id="move-src-47" data-title="parameter/identifier"><span class="cupd">_o</span>wn<span class="cupd">er</span></span></span>,
    <span class="marker" id="mapping-54"></span><span class="token mv" id="move-src-48" data-title="function_definition/parameter">uint256 <span class="marker" id="mapping-55"></span><span class="token upd" id="move-src-49" data-title="parameter/identifier">_<span class="cupd">i</span>ndex</span></span>
  )
    <span class="marker" id="mapping-56"></span><span class="token mv" id="move-src-50" data-title="function_definition/visibility">public</span>
    <span class="marker" id="mapping-57"></span><span class="token mv" id="move-src-51" data-title="function_definition/state_mutability">view</span>
    <span class="marker" id="mapping-58"></span><span class="token del" data-title="function_definition/return_type_definition">returns (uint256 _tokenId)</span>;</span>

  <span class="marker" id="mapping-59"></span><span class="token mv" id="move-src-52" data-title="contract_body/function_definition">function <span class="marker" id="mapping-60"></span><span class="token upd" id="move-src-53" data-title="function_definition/identifier">toke<span class="cupd">n</span>ByIndex</span>(<span class="marker" id="mapping-61"></span><span class="token mv" id="move-src-54" data-title="function_definition/parameter">uint256 <span class="marker" id="mapping-62"></span><span class="token upd" id="move-src-55" data-title="parameter/identifier">_index</span></span>) <span class="marker" id="mapping-63"></span><span class="token mv" id="move-src-56" data-title="function_definition/visibility">public</span> view returns (uint256);</span>
}</span></span>


<span class="marker" id="mapping-64"></span><span class="token upd" id="move-src-57" data-title="source_file/comment"><span class="cupd">/**
 * @title ER</span>C<span class="cupd">-721</span> <span class="cupd">N</span>on-Fungible T<span class="cupd">oken</span> Stand<span class="cupd">a</span>rd<span class="cupd">,</span> op<span class="cupd">t</span>i<span class="cupd">o</span>nal <span class="cupd">m</span>e<span class="cupd">t</span>adata<span class="cupd"> </span>extensio<span class="cupd">n
 * @de</span>v<span class="cupd"> </span><span class="cupd">Se</span><span class="cupd">e</span><span class="cupd"> </span><span class="cupd">h</span>t<span class="cupd">t</span>ps://<span class="cupd">g</span>i<span class="cupd">t</span>hub<span class="cupd">.</span>com<span class="cupd">/</span>e<span class="cupd">t</span><span class="cupd">h</span><span class="cupd">e</span>reum/E<span class="cupd">I</span>Ps/<span class="cupd">b</span>lo<span class="cupd">b</span><span class="cupd">/m</span><span class="cupd">a</span>s<span class="cupd">t</span>er/EIPS/eip-7<span class="cupd">2</span>1.<span class="cupd">md
</span> */</span>
<span class="marker" id="mapping-65"></span><span class="token del" data-title="source_file/contract_declaration">contract ERC721Metadata is <span class="marker" id="mapping-66"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">ERC721Basic</span> <span class="marker" id="mapping-67"></span><span class="token del" data-title="contract_declaration/contract_body">{
  <span class="marker" id="mapping-68"></span><span class="token del" data-title="contract_body/function_definition">function name() <span class="marker" id="mapping-69"></span><span class="token mv" id="move-src-58" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-70"></span><span class="token del" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-71"></span><span class="token del" data-title="function_definition/return_type_definition">returns (string _name)</span>;</span>
  <span class="marker" id="mapping-72"></span><span class="token del" data-title="contract_body/function_definition">function symbol() <span class="marker" id="mapping-73"></span><span class="token mv" id="move-src-59" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-74"></span><span class="token del" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-75"></span><span class="token del" data-title="function_definition/return_type_definition">returns (string _symbol)</span>;</span>
  <span class="marker" id="mapping-76"></span><span class="token del" data-title="contract_body/function_definition">function tokenURI(<span class="marker" id="mapping-77"></span><span class="token mv" id="move-src-60" data-title="function_definition/parameter">uint256 _tokenId</span>) <span class="marker" id="mapping-78"></span><span class="token mv" id="move-src-61" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-79"></span><span class="token mv" id="move-src-62" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-80"></span><span class="token del" data-title="function_definition/return_type_definition">returns (<span class="marker" id="mapping-81"></span><span class="token del" data-title="return_type_definition/parameter"><span class="marker" id="mapping-82"></span><span class="token mv" id="move-src-63" data-title="parameter/type_name">string</span></span>)</span>;</span>
}</span></span>


<span class="marker" id="mapping-83"></span><span class="token upd" id="move-src-64" data-title="source_file/comment"><span class="cupd">/</span>**<span class="cupd"></span>
 * @title ERC-721 <span class="cupd">No</span>n-Fungible Token <span class="cupd">S</span>tand<span class="cupd">a</span>rd, full implemen<span class="cupd">t</span><span class="cupd">a</span><span class="cupd">t</span>i<span class="cupd">o</span>n i<span class="cupd">nterfac</span>e
 * @dev See ht<span class="cupd">t</span>p<span class="cupd">s</span>://<span class="cupd">g</span>ithub.co<span class="cupd">m</span><span class="cupd">/</span>e<span class="cupd">t</span><span class="cupd">h</span>ereu<span class="cupd">m</span>/EIPs/<span class="cupd">b</span>lob/ma<span class="cupd">st</span>er/EIPS/eip-721.md
 */</span>
<span class="marker" id="mapping-84"></span><span class="token del" data-title="source_file/contract_declaration">contract ERC721 is ERC721Basic, ERC721Enumerable, ERC721Metadata {
}</span>


<span class="marker" id="mapping-85"></span><span class="token upd" id="move-src-65" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> </span>Root file: cont<span class="cupd">ra</span>ct<span class="cupd">s</span>/ERC721Br<span class="cupd">id</span>ge.sol</span>

<span class="marker" id="mapping-86"></span><span class="token mv" id="move-src-66" data-title="source_file/pragma_directive">pragma solidity<span class="marker" id="mapping-87"></span><span class="token del" data-title="solidity_pragma_token/solidity_version_comparison_operator"> ^</span>0.4.23;</span>

<span class="marker" id="mapping-88"></span><span class="token upd" id="move-src-67" data-title="source_file/comment"><span class="cupd">//</span><span class="cupd"> </span>import "<span class="cupd">contracts/</span>P<span class="cupd">a</span>u<span class="cupd">s</span><span class="cupd">able</span>DSAuth<span class="cupd">.sol</span>";</span>
<span class="marker" id="mapping-89"></span><span class="token upd" id="move-src-68" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> </span>im<span class="cupd">p</span>o<span class="cupd">r</span>t "contr<span class="cupd">a</span>cts/interf<span class="cupd">a</span>ce<span class="cupd">s</span>/ISett<span class="cupd">i</span>ngsReg<span class="cupd">i</span>s<span class="cupd">t</span>r<span class="cupd">y</span><span class="cupd">.</span>sol";</span>
<span class="marker" id="mapping-90"></span><span class="token upd" id="move-src-69" data-title="source_file/comment"><span class="cupd">//</span><span class="cupd"> </span>import "<span class="cupd">contracts/</span>Sett<span class="cupd">in</span>g<span class="cupd">I</span><span class="cupd">d</span>s<span class="cupd">.sol</span>";</span>
<span class="marker" id="mapping-91"></span><span class="token upd" id="move-src-70" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> </span>im<span class="cupd">p</span>o<span class="cupd">r</span>t "contr<span class="cupd">a</span>cts/interf<span class="cupd">a</span>ce<span class="cupd">s</span>/IInterste<span class="cupd">l</span>larEnco<span class="cupd">d</span>erV3<span class="cupd">.</span>sol";</span>
<span class="marker" id="mapping-92"></span><span class="token upd" id="move-src-71" data-title="source_file/comment"><span class="cupd">//</span><span class="cupd"> </span>import "<span class="cupd">contracts/interfaces/I</span>Min<span class="cupd">t</span><span class="cupd">a</span>bl<span class="cupd">e</span>ERC20<span class="cupd">.sol</span>";</span>
<span class="marker" id="mapping-93"></span><span class="token upd" id="move-src-72" data-title="source_file/comment"><span class="cupd">/</span>/<span class="cupd"> </span>im<span class="cupd">p</span>o<span class="cupd">r</span>t<span class="cupd"> </span>"c<span class="cupd">o</span>ntracts/<span class="cupd">i</span>nterfaces/INFTA<span class="cupd">d</span>ap<span class="cupd">t</span>or<span class="cupd">.</span>sol";</span>
<span class="marker" id="mapping-94"></span><span class="token upd" id="move-src-73" data-title="source_file/comment"><span class="cupd">//</span><span class="cupd"> </span>imp<span class="cupd">o</span><span class="cupd">r</span><span class="cupd">t</span> "openzeppelin-<span class="cupd">s</span>ol<span class="cupd">i</span>dity/co<span class="cupd">nt</span><span class="cupd">r</span><span class="cupd">ac</span>t<span class="cupd">s/</span><span class="cupd">t</span>oke<span class="cupd">n</span>/E<span class="cupd">R</span>C721/ERC721<span class="cupd">.sol</span>";</span>


/*
 * naming convention:
 * originTokenId - token outside evolutionLand
 * mirrorTokenId - mirror token
 */
contract <span class="marker" id="mapping-95"></span><span class="token upd" id="move-src-74" data-title="contract_declaration/identifier"><span class="cupd">ERC721Bridge</span></span> is SettingIds, PausableDSAuth {

    /*
     *  Storage
    */
    bool private singletonLock = false;

    ISettingsRegistry public registry;


    // originNFTContract =&gt; its adator
    // for instance, CryptoKitties =&gt; CryptoKittiesAdaptor
    // this need to be registered by owner
    mapping(address =&gt; address) public originNFT2Adaptor;

    // tokenId_inside =&gt; tokenId_outside
    mapping(uint256 =&gt; uint256) public mirrorId2OriginId;

    /*
     *  Event
     */
    <span class="marker" id="mapping-96"></span><span class="token del" data-title="contract_body/event_definition">event BridgeIn(<span class="marker" id="mapping-97"></span><span class="token del" data-title="event_definition/event_paramater">uint256 originTokenId</span>, <span class="marker" id="mapping-98"></span><span class="token del" data-title="event_definition/event_paramater">uint256 mirrorTokenId</span>, <span class="marker" id="mapping-99"></span><span class="token mv" id="move-src-75" data-title="event_definition/event_paramater">address originContract</span>, <span class="marker" id="mapping-100"></span><span class="token mv" id="move-src-76" data-title="event_definition/event_paramater">address <span class="marker" id="mapping-101"></span><span class="token upd" id="move-src-77" data-title="event_paramater/identifier"><span class="cupd">a</span>dap<span class="cupd">tor</span>Address</span></span>, <span class="marker" id="mapping-102"></span><span class="token del" data-title="event_definition/event_paramater">address owner</span>);</span>

    <span class="marker" id="mapping-103"></span><span class="token mv" id="move-src-78" data-title="contract_body/event_definition">event <span class="marker" id="mapping-104"></span><span class="token upd" id="move-src-79" data-title="event_definition/identifier"><span class="cupd">Swap</span>In</span>(<span class="marker" id="mapping-105"></span><span class="token mv" id="move-src-80" data-title="event_definition/event_paramater">uint256 originTokenId</span>, <span class="marker" id="mapping-106"></span><span class="token mv" id="move-src-81" data-title="event_definition/event_paramater">uint256 mirrorTokenId</span>, address owner);</span>
    <span class="marker" id="mapping-107"></span><span class="token mv" id="move-src-82" data-title="contract_body/event_definition">event <span class="marker" id="mapping-108"></span><span class="token upd" id="move-src-83" data-title="event_definition/identifier"><span class="cupd">Swap</span>Out</span>(<span class="marker" id="mapping-109"></span><span class="token mv" id="move-src-84" data-title="event_definition/event_paramater">uint256 originTokenId</span>, <span class="marker" id="mapping-110"></span><span class="token mv" id="move-src-85" data-title="event_definition/event_paramater">uint256 mirrorTokenId</span>, address owner);</span>


    <span class="marker" id="mapping-111"></span><span class="token upd" id="move-src-86" data-title="contract_body/comment"><span class="cupd">/</span>*<span class="cupd"></span><span class="cupd">
</span><span class="cupd"> </span><span class="cupd"> </span><span class="cupd"> </span> <span class="cupd">*</span><span class="cupd"> </span> <span class="cupd">M</span>o<span class="cupd">d</span>i<span class="cupd">f</span><span class="cupd">i</span><span class="cupd">e</span><span class="cupd">r</span><span class="cupd">s</span>
    */</span>
    <span class="marker" id="mapping-112"></span><span class="token del" data-title="contract_body/modifier_definition">modifier singletonLockCall() <span class="marker" id="mapping-113"></span><span class="token del" data-title="modifier_definition/function_body">{
        <span class="marker" id="mapping-114"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-115"></span><span class="token del" data-title="expression_statement/call_expression">require(<span class="marker" id="mapping-116"></span><span class="token del" data-title="call_expression/call_argument">!singletonLock</span>, <span class="marker" id="mapping-117"></span><span class="token mv" id="move-src-87" data-title="call_expression/call_argument">"Only can call once"</span>)</span>;</span>
        <span class="marker" id="mapping-118"></span><span class="token del" data-title="function_body/expression_statement">_;</span>
        <span class="marker" id="mapping-119"></span><span class="token del" data-title="function_body/expression_statement">singletonLock = true;</span>
    }</span></span>

    <span class="marker" id="mapping-120"></span><span class="token del" data-title="contract_body/function_definition">function initializeContract(<span class="marker" id="mapping-121"></span><span class="token del" data-title="function_definition/parameter">ISettingsRegistry _registry</span>) <span class="marker" id="mapping-122"></span><span class="token mv" id="move-src-88" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-123"></span><span class="token del" data-title="function_definition/modifier_invocation">singletonLockCall</span> <span class="marker" id="mapping-124"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-125"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-126"></span><span class="token del" data-title="expression_statement/assignment_expression">owner = <span class="marker" id="mapping-127"></span><span class="token mv" id="move-src-89" data-title="assignment_expression/member_expression">msg.sender</span></span>;</span>
        <span class="marker" id="mapping-128"></span><span class="token del" data-title="function_body/emit_statement">emit LogSetOwner(msg.sender);</span>
        <span class="marker" id="mapping-129"></span><span class="token del" data-title="function_body/expression_statement">registry = _registry;</span>
    }</span></span>

    function registerAdaptor(address _originNftAddress, address _erc721Adaptor) public whenNotPaused onlyOwner {
        originNFT2Adaptor[_originNftAddress] = _erc721Adaptor;
    }

    <span class="marker" id="mapping-130"></span><span class="token mv" id="move-src-90" data-title="contract_body/comment"><span class="marker" id="mapping-131"></span><span class="token upd" id="move-src-91" data-title="contract_body/comment"><span class="cupd">// </span>use<span class="cupd">d</span><span class="cupd"> </span>by<span class="cupd"> </span><span class="cupd">P</span><span class="cupd">et</span>Base</span></span>
    <span class="marker" id="mapping-132"></span><span class="token del" data-title="contract_body/function_definition">function bridgeInAuth(<span class="marker" id="mapping-133"></span><span class="token del" data-title="function_definition/parameter">address _originNftAddress</span>, <span class="marker" id="mapping-134"></span><span class="token mv" id="move-src-92" data-title="function_definition/parameter">uint256 _originTokenId</span>, <span class="marker" id="mapping-135"></span><span class="token mv" id="move-src-93" data-title="function_definition/parameter">address <span class="marker" id="mapping-136"></span><span class="token upd" id="move-src-94" data-title="parameter/identifier"><span class="cupd">_</span>owner</span></span>) <span class="marker" id="mapping-137"></span><span class="token mv" id="move-src-95" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-138"></span><span class="token del" data-title="function_definition/modifier_invocation">auth</span> <span class="marker" id="mapping-139"></span><span class="token del" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-140"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-141"></span><span class="token del" data-title="function_body/return_statement">return <span class="marker" id="mapping-142"></span><span class="token del" data-title="return_statement/call_expression">_bridgeIn(<span class="marker" id="mapping-143"></span><span class="token mv" id="move-src-96" data-title="call_expression/call_argument">_originNftAddress</span>, <span class="marker" id="mapping-144"></span><span class="token mv" id="move-src-97" data-title="call_expression/call_argument">_originTokenId</span>, <span class="marker" id="mapping-145"></span><span class="token mv" id="move-src-98" data-title="call_expression/call_argument">_owner</span>)</span>;</span>
    }</span></span>


    <span class="marker" id="mapping-146"></span><span class="token mv" id="move-src-99" data-title="contract_body/comment"><span class="marker" id="mapping-147"></span><span class="token upd" id="move-src-100" data-title="contract_body/comment"><span class="cupd">// </span>gener<span class="cupd">a</span>te<span class="cupd"> </span>new<span class="cupd"> </span>mirr<span class="cupd">or</span><span class="cupd"> </span>t<span class="cupd">o</span><span class="cupd">k</span><span class="cupd">e</span>n without origin token frozen</span></span>
    <span class="marker" id="mapping-148"></span><span class="token del" data-title="contract_body/function_definition">function bridgeIn(<span class="marker" id="mapping-149"></span><span class="token del" data-title="function_definition/parameter">address _originNftAddress</span>, <span class="marker" id="mapping-150"></span><span class="token del" data-title="function_definition/parameter">uint256 _originTokenId</span>) <span class="marker" id="mapping-151"></span><span class="token mv" id="move-src-101" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-152"></span><span class="token del" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-153"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-154"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-155"></span><span class="token del" data-title="expression_statement/call_expression">_bridgeIn(<span class="marker" id="mapping-156"></span><span class="token mv" id="move-src-102" data-title="call_expression/call_argument">_originNftAddress</span>, <span class="marker" id="mapping-157"></span><span class="token mv" id="move-src-103" data-title="call_expression/call_argument">_originTokenId</span>, <span class="marker" id="mapping-158"></span><span class="token mv" id="move-src-104" data-title="call_expression/call_argument">msg.sender</span>)</span>;</span>
    }</span></span>

    <span class="marker" id="mapping-159"></span><span class="token mv" id="move-src-105" data-title="contract_body/function_definition">function <span class="marker" id="mapping-160"></span><span class="token upd" id="move-src-106" data-title="function_definition/identifier">_bridge<span class="cupd">In</span></span>(address _originNftAddress, uint256 _originTokenId<span class="marker" id="mapping-161"></span><span class="token del" data-title="function_definition/,">,</span> <span class="marker" id="mapping-162"></span><span class="token mv" id="move-src-107" data-title="function_definition/parameter">address <span class="marker" id="mapping-163"></span><span class="token del" data-title="parameter/identifier">_owner</span></span>) <span class="marker" id="mapping-164"></span><span class="token mv" id="move-src-108" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-165"></span><span class="token del" data-title="function_definition/return_type_definition">returns (uint256)</span> {
        address adaptor = originNFT2Adaptor[_originNftAddress];
        require(adaptor != address(0), "Not registered!");

        <span class="marker" id="mapping-166"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-167"></span><span class="token del" data-title="expression_statement/call_expression">require(<span class="marker" id="mapping-168"></span><span class="token del" data-title="call_expression/call_argument"><span class="marker" id="mapping-169"></span><span class="token del" data-title="call_argument/binary_expression"><span class="marker" id="mapping-170"></span><span class="token mv" id="move-src-109" data-title="binary_expression/call_expression">INFTAdaptor(adaptor).<span class="marker" id="mapping-171"></span><span class="token upd" id="move-src-110" data-title="member_expression/identifier"><span class="cupd">o</span>w<span class="cupd">n</span>er<span class="cupd">I</span><span class="cupd">n</span>Origin</span>(_originTokenId)</span> == _owner</span></span>, <span class="marker" id="mapping-172"></span><span class="token mv" id="move-src-111" data-title="call_expression/call_argument">"Invalid owner!"</span>)</span>;</span>

        uint256 mirrorTokenId = INFTAdaptor(adaptor).toMirrorTokenId(_originTokenId);

        <span class="marker" id="mapping-173"></span><span class="token del" data-title="function_body/comment">// if it is the first time to bridge in</span>
        <span class="marker" id="mapping-174"></span><span class="token del" data-title="function_body/if_statement">if (<span class="marker" id="mapping-175"></span><span class="token mv" id="move-src-112" data-title="if_statement/unary_expression">!isBridged(mirrorTokenId)</span>) <span class="marker" id="mapping-176"></span><span class="token mv" id="move-src-113" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-177"></span><span class="token mv" id="move-src-114" data-title="block_statement/comment"><span class="marker" id="mapping-178"></span><span class="token upd" id="move-src-115" data-title="block_statement/comment"><span class="cupd">// </span>k<span class="cupd">e</span><span class="cupd">e</span>p <span class="cupd">n</span><span class="cupd">e</span>w<span class="cupd"> mirror</span> <span class="cupd">o</span>bj<span class="cupd">e</span>ct<span class="cupd"> </span><span class="cupd">i</span><span class="cupd">n</span> <span class="cupd">t</span>hi<span class="cupd">s</span><span class="cupd"> </span>c<span class="cupd">o</span>ntract</span></span>
            <span class="marker" id="mapping-179"></span><span class="token del" data-title="block_statement/comment">// before the owner has transferred his/her outerObject into this contract</span>
            <span class="marker" id="mapping-180"></span><span class="token del" data-title="block_statement/comment">// mirror object can not be transferred</span>
            <span class="marker" id="mapping-181"></span><span class="token mv" id="move-src-116" data-title="block_statement/variable_declaration_statement">address objectOwnership = registry.addressOf(SettingIds.CONTRACT_OBJECT_OWNERSHIP);</span>
            IMintableERC20(objectOwnership).mint(<span class="marker" id="mapping-182"></span><span class="token mv" id="move-src-117" data-title="call_expression/call_argument">address(this)</span>, mirrorTokenId);

            <span class="marker" id="mapping-183"></span><span class="token del" data-title="block_statement/comment">// link objects_in and objects_out</span>
            <span class="marker" id="mapping-184"></span><span class="token mv" id="move-src-118" data-title="block_statement/expression_statement">INFTAdaptor(adaptor).cacheMirrorTokenId(_originTokenId, mirrorTokenId);</span>
            <span class="marker" id="mapping-185"></span><span class="token mv" id="move-src-119" data-title="block_statement/expression_statement">mirrorId2OriginId[mirrorTokenId] = _originTokenId;</span>

            <span class="marker" id="mapping-186"></span><span class="token mv" id="move-src-120" data-title="block_statement/emit_statement">emit <span class="marker" id="mapping-187"></span><span class="token upd" id="move-src-121" data-title="emit_statement/identifier">Bridge<span class="cupd">In</span></span>(<span class="marker" id="mapping-188"></span><span class="token mv" id="move-src-122" data-title="emit_statement/call_argument">_originTokenId</span>, <span class="marker" id="mapping-189"></span><span class="token mv" id="move-src-123" data-title="emit_statement/call_argument">mirrorTokenId</span>, <span class="marker" id="mapping-190"></span><span class="token mv" id="move-src-124" data-title="emit_statement/call_argument">_originNftAddress</span>, <span class="marker" id="mapping-191"></span><span class="token del" data-title="emit_statement/call_argument">adaptor</span><span class="marker" id="mapping-192"></span><span class="token del" data-title="emit_statement/,">,</span> _owner);</span>
        }</span></span>

        <span class="marker" id="mapping-193"></span><span class="token del" data-title="function_body/return_statement">return mirrorTokenId;</span>
    }</span>

    <span class="marker" id="mapping-194"></span><span class="token del" data-title="contract_body/comment">// freeze origin token to free mirror token</span>
    <span class="marker" id="mapping-195"></span><span class="token mv" id="move-src-125" data-title="contract_body/function_definition">function <span class="marker" id="mapping-196"></span><span class="token upd" id="move-src-126" data-title="function_definition/identifier"><span class="cupd">swapIn</span></span>(address _originNftAddress, uint256 _originTokenId) public {
        <span class="marker" id="mapping-197"></span><span class="token del" data-title="call_expression/identifier">require</span>(<span class="marker" id="mapping-198"></span><span class="token del" data-title="call_expression/call_argument"><span class="marker" id="mapping-199"></span><span class="token del" data-title="call_argument/binary_expression"><span class="marker" id="mapping-200"></span><span class="token del" data-title="binary_expression/call_expression">ERC721(_originNftAddress).ownerOf(_originTokenId)</span> == <span class="marker" id="mapping-201"></span><span class="token mv" id="move-src-127" data-title="binary_expression/member_expression">msg.sender</span></span></span>, <span class="marker" id="mapping-202"></span><span class="token mv" id="move-src-128" data-title="call_expression/call_argument">"Invalid owner!"</span>);

        address adaptor = originNFT2Adaptor[_originNftAddress];
        require(adaptor != address(0), "Not registered!");

        <span class="marker" id="mapping-203"></span><span class="token del" data-title="function_body/comment">// all specific originTokens are kept in bridge</span>
        <span class="marker" id="mapping-204"></span><span class="token mv" id="move-src-129" data-title="function_body/expression_statement"><span class="marker" id="mapping-205"></span><span class="token upd" id="move-src-130" data-title="call_expression/identifier"><span class="cupd">ERC721</span></span>(_originNftAddress).transferFrom(<span class="marker" id="mapping-206"></span><span class="token del" data-title="call_expression/call_argument">msg.sender</span>, address(this), _originTokenId);</span>

        <span class="marker" id="mapping-207"></span><span class="token mv" id="move-src-131" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-208"></span><span class="token del" data-title="primitive_type/uint256">uint256</span> <span class="marker" id="mapping-209"></span><span class="token upd" id="move-src-132" data-title="variable_declaration/identifier">mi<span class="cupd">r</span>rorTokenId</span> = <span class="marker" id="mapping-210"></span><span class="token del" data-title="variable_declaration_statement/call_expression">INFTAdaptor(adaptor).toMirrorTokenId(_originTokenId)</span>;</span>
        address objectOwnership = registry.addressOf(SettingIds.CONTRACT_OBJECT_OWNERSHIP);
        <span class="marker" id="mapping-211"></span><span class="token mv" id="move-src-133" data-title="function_body/expression_statement"><span class="marker" id="mapping-212"></span><span class="token upd" id="move-src-134" data-title="call_expression/identifier"><span class="cupd">ERC</span>721</span>(objectOwnership).<span class="marker" id="mapping-213"></span><span class="token upd" id="move-src-135" data-title="member_expression/identifier">t<span class="cupd">r</span>ansferFrom</span>(<span class="marker" id="mapping-214"></span><span class="token mv" id="move-src-136" data-title="call_expression/call_argument">address(this)</span><span class="marker" id="mapping-215"></span><span class="token mv" id="move-src-137" data-title="call_expression/,">,</span> msg.sender<span class="marker" id="mapping-216"></span><span class="token del" data-title="call_expression/,">,</span> <span class="marker" id="mapping-217"></span><span class="token mv" id="move-src-138" data-title="call_expression/call_argument">mirrorTokenId</span>);</span>

        <span class="marker" id="mapping-218"></span><span class="token mv" id="move-src-139" data-title="function_body/emit_statement">emit <span class="marker" id="mapping-219"></span><span class="token upd" id="move-src-140" data-title="emit_statement/identifier"><span class="cupd">Swap</span>In</span>(<span class="marker" id="mapping-220"></span><span class="token upd" id="move-src-141" data-title="call_argument/identifier">_origi<span class="cupd">n</span>T<span class="cupd">o</span>kenId</span>, <span class="marker" id="mapping-221"></span><span class="token mv" id="move-src-142" data-title="emit_statement/call_argument">mirrorTokenId</span>, msg.sender);</span>
    }</span>

    <span class="marker" id="mapping-222"></span><span class="token del" data-title="contract_body/function_definition">function bridgeAndSwapIn(<span class="marker" id="mapping-223"></span><span class="token del" data-title="function_definition/parameter">address _originNftAddress</span>, <span class="marker" id="mapping-224"></span><span class="token del" data-title="function_definition/parameter">uint256 _originTokenId</span>) <span class="marker" id="mapping-225"></span><span class="token mv" id="move-src-143" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-226"></span><span class="token del" data-title="function_definition/function_body">{
        bridgeIn(_originNftAddress, _originTokenId);
        swapIn(_originNftAddress, _originTokenId);
    }</span></span>

    function <span class="marker" id="mapping-227"></span><span class="token upd" id="move-src-144" data-title="function_definition/identifier"><span class="cupd">swapOut</span></span>(uint256 _mirrorTokenId) public  {
        IInterstellarEncoderV3 interstellarEncoder = IInterstellarEncoderV3(registry.addressOf(SettingIds.CONTRACT_INTERSTELLAR_ENCODER));
        <span class="marker" id="mapping-228"></span><span class="token mv" id="move-src-145" data-title="function_body/variable_declaration_statement">address nftContract = interstellarEncoder.<span class="marker" id="mapping-229"></span><span class="token upd" id="move-src-146" data-title="member_expression/identifier"><span class="cupd">get</span>Co<span class="cupd">n</span>tract<span class="cupd">Address</span></span>(<span class="marker" id="mapping-230"></span><span class="token mv" id="move-src-147" data-title="call_expression/call_argument">_mirrorTokenId</span>);</span>
        require(nftContract != address(0), "No such NFT contract");
        address adaptor = originNFT2Adaptor[nftContract];
        require(adaptor != address(0), "not registered!");
        require(ownerOfMirror(_mirrorTokenId) == msg.sender, "you have no right to swap it out!");

        <span class="marker" id="mapping-231"></span><span class="token del" data-title="function_body/comment">// TODO: if it is needed to check its current status</span>
        uint256 originTokenId = mirrorId2OriginId[_mirrorTokenId];
        address objectOwnership = registry.addressOf(SettingIds.CONTRACT_OBJECT_OWNERSHIP);
        <span class="marker" id="mapping-232"></span><span class="token upd" id="move-src-148" data-title="call_expression/identifier"><span class="cupd">ERC</span>721</span>(objectOwnership).<span class="marker" id="mapping-233"></span><span class="token upd" id="move-src-149" data-title="member_expression/identifier">t<span class="cupd">r</span>ansferFrom</span>(<span class="marker" id="mapping-234"></span><span class="token del" data-title="call_expression/call_argument">msg.sender</span>, <span class="marker" id="mapping-235"></span><span class="token mv" id="move-src-150" data-title="call_expression/call_argument">address(this)</span><span class="marker" id="mapping-236"></span><span class="token del" data-title="call_expression/,">,</span> <span class="marker" id="mapping-237"></span><span class="token mv" id="move-src-151" data-title="call_expression/call_argument">_mirrorTokenId</span>);
        <span class="marker" id="mapping-238"></span><span class="token mv" id="move-src-152" data-title="function_body/expression_statement"><span class="marker" id="mapping-239"></span><span class="token upd" id="move-src-153" data-title="call_expression/identifier"><span class="cupd">ERC</span>721</span>(nftContract).<span class="marker" id="mapping-240"></span><span class="token upd" id="move-src-154" data-title="member_expression/identifier">t<span class="cupd">ransferFrom</span></span>(address(this), msg.sender, originTokenId);</span>

        <span class="marker" id="mapping-241"></span><span class="token mv" id="move-src-155" data-title="function_body/emit_statement">emit SwapOut(<span class="marker" id="mapping-242"></span><span class="token mv" id="move-src-156" data-title="emit_statement/call_argument">originTokenId</span>, <span class="marker" id="mapping-243"></span><span class="token mv" id="move-src-157" data-title="emit_statement/call_argument">_mirrorTokenId</span>, msg.sender);</span>
    }

    <span class="marker" id="mapping-244"></span><span class="token mv" id="move-src-158" data-title="contract_body/function_definition">function <span class="marker" id="mapping-245"></span><span class="token upd" id="move-src-159" data-title="function_definition/identifier">appr<span class="cupd">o</span>v<span class="cupd">e</span>Or<span class="cupd">i</span>ginToken</span>(address <span class="marker" id="mapping-246"></span><span class="token del" data-title="parameter/identifier">_originNFT</span>, address <span class="marker" id="mapping-247"></span><span class="token del" data-title="parameter/identifier">_approved</span>, <span class="marker" id="mapping-248"></span><span class="token del" data-title="function_definition/parameter">uint256 _originTokenId</span>) public <span class="marker" id="mapping-249"></span><span class="token del" data-title="function_definition/modifier_invocation">auth</span> {
        <span class="marker" id="mapping-250"></span><span class="token del" data-title="function_body/expression_statement">ERC721(_originNFT).approve(_approved, _originTokenId);</span>
    }</span>

    function ownerOf(uint256 _mirrorTokenId) public view returns (address) {
        return ownerOfMirror(_mirrorTokenId);
    }

    // return human owner of the token
    function mirrorOfOrigin(address _originNFT, uint256 _originTokenId) public view returns (uint256) {
        INFTAdaptor adapter = INFTAdaptor(originNFT2Adaptor[_originNFT]);

        return adapter.toMirrorTokenId(_originTokenId);
    }

    // return human owner of the token
    function ownerOfMirror(uint256 _mirrorTokenId) public view returns (address) {
        address objectOwnership = registry.addressOf(SettingIds.CONTRACT_OBJECT_OWNERSHIP);
        address owner = <span class="marker" id="mapping-251"></span><span class="token upd" id="move-src-160" data-title="call_expression/identifier"><span class="cupd">ERC721</span></span>(objectOwnership).ownerOf(<span class="marker" id="mapping-252"></span><span class="token mv" id="move-src-161" data-title="call_expression/call_argument">_mirrorTokenId</span>);
        if(owner != address(this)) {
            return owner;
        } else {
            uint originTokenId = mirrorId2OriginId[_mirrorTokenId];
            return INFTAdaptor(originNFT2Adaptor[originOwnershipAddress(_mirrorTokenId)]).ownerInOrigin(originTokenId);
        }
    }

    function originOwnershipAddress(uint256 _mirrorTokenId) public view returns (address) {
        IInterstellarEncoderV3 interstellarEncoder = IInterstellarEncoderV3(registry.addressOf(SettingIds.CONTRACT_INTERSTELLAR_ENCODER));

        return interstellarEncoder.getOriginAddress(_mirrorTokenId);
    }

    function isBridged(uint256 _mirrorTokenId) public view returns (bool) {
        return (mirrorId2OriginId[_mirrorTokenId] != 0);
    }
}</pre></div><div class="col-6"><h5>0x81989cd57271565dbffe9807e917afc098b30c9a.etherscan.io-ERC721BridgeV2.sol</h5><pre class="pre-scrollable"><span class="marker" id="mapping-253"></span><span class="token upd" id="move-dst-1" data-title="source_file/comment"><span class="cupd">// </span>h<span class="cupd">e</span>vm: flatt<span class="cupd">en</span>e<span class="cupd">d</span> sourc<span class="cupd">e</span>s<span class="cupd"> </span>o<span class="cupd">f</span><span class="cupd"> contracts/</span>ERC721Br<span class="cupd">i</span>dg<span class="cupd">e</span>V2<span class="cupd">.sol</span></span>

<span class="marker" id="mapping-254"></span><span class="token mv" id="move-dst-66" data-title="source_file/pragma_directive">pragma solidity<span class="marker" id="mapping-255"></span><span class="token add" data-title="solidity_pragma_token/solidity_version_comparison_operator"> &gt;=</span>0.4.23<span class="marker" id="mapping-256"></span><span class="token add" data-title="solidity_pragma_token/solidity_version_comparison_operator"> &lt;</span><span class="marker" id="mapping-257"></span><span class="token add" data-title="solidity_pragma_token/solidity_version">0.5.0</span><span class="marker" id="mapping-258"></span><span class="token add" data-title="solidity_pragma_token/solidity_version_comparison_operator"> &gt;=</span><span class="marker" id="mapping-259"></span><span class="token add" data-title="solidity_pragma_token/solidity_version">0.4.24</span><span class="marker" id="mapping-260"></span><span class="token add" data-title="solidity_pragma_token/solidity_version_comparison_operator"> &lt;</span><span class="marker" id="mapping-261"></span><span class="token add" data-title="solidity_pragma_token/solidity_version">0.5.0</span>;</span>

<span class="marker" id="mapping-262"></span><span class="token upd" id="move-dst-2" data-title="source_file/comment"><span class="cupd">//</span>////<span class="cupd"> </span>cont<span class="cupd">ra</span>cts/interf<span class="cupd">a</span>ce<span class="cupd">s</span>/IAuth<span class="cupd">o</span>r<span class="cupd">i</span><span class="cupd">ty</span>.sol</span>
<span class="marker" id="mapping-263"></span><span class="token upd" id="move-dst-4" data-title="source_file/comment"><span class="cupd">/</span>*<span class="cupd"> </span><span class="cupd">p</span>ragma soli<span class="cupd">d</span>it<span class="cupd">y </span>^0.4.24;<span class="cupd"> </span>*/</span>

<span class="marker" id="mapping-264"></span><span class="token mv" id="move-dst-3" data-title="source_file/contract_declaration">contract IAuthority {
    function canCall(
        address src, address dst, bytes4 sig
    ) public view returns (bool);
}</span>

<span class="marker" id="mapping-265"></span><span class="token upd" id="move-dst-5" data-title="source_file/comment"><span class="cupd">//</span>////<span class="cupd"> </span>cont<span class="cupd">ra</span>ct<span class="cupd">s</span>/DSAuth.s<span class="cupd">ol</span></span>
<span class="marker" id="mapping-266"></span><span class="token upd" id="move-dst-6" data-title="source_file/comment"><span class="cupd">/</span>*<span class="cupd"> </span><span class="cupd">p</span><span class="cupd">r</span><span class="cupd">a</span>gm<span class="cupd">a</span> <span class="cupd">s</span><span class="cupd">o</span>l<span class="cupd">i</span>di<span class="cupd">ty</span> ^0<span class="cupd">.</span>4.24; */</span>

<span class="marker" id="mapping-267"></span><span class="token mv" id="move-dst-8" data-title="source_file/comment"><span class="marker" id="mapping-268"></span><span class="token upd" id="move-dst-8" data-title="source_file/comment"><span class="cupd">/</span>*<span class="cupd"> </span>im<span class="cupd">p</span>ort<span class="cupd"> </span>'./<span class="cupd">i</span><span class="cupd">nt</span>e<span class="cupd">r</span>f<span class="cupd">ac</span>e<span class="cupd">s/</span>I<span class="cupd">Auth</span>ority<span class="cupd">.sol</span>'; */</span></span>

contract DSAuthEvents {
    event LogSetAuthority (address indexed authority);
    event LogSetOwner     (address indexed owner);
}

/**
 * @title DSAuth
 * @dev The DSAuth contract is reference implement of https://github.com/dapphub/ds-auth
 * But in the isAuthorized method, the src from address(this) is remove for safty concern.
 */
contract DSAuth is DSAuthEvents {
    IAuthority   public  authority;
    address      public  owner;

    constructor() public {
        owner = msg.sender;
        emit LogSetOwner(msg.sender);
    }

    function setOwner(address owner_)
        public
        auth
    {
        owner = owner_;
        emit LogSetOwner(owner);
    }

    function setAuthority(IAuthority authority_)
        public
        auth
    {
        authority = authority_;
        emit LogSetAuthority(authority);
    }

    modifier auth {
        require(isAuthorized(msg.sender, msg.sig)<span class="marker" id="mapping-269"></span><span class="token add" data-title="call_expression/,">,</span> <span class="marker" id="mapping-270"></span><span class="token mv" id="move-dst-87" data-title="call_expression/call_argument">"ds-auth-unauthorized"</span>);
        _;
    }

    modifier onlyOwner() {
        require(msg.sender == owner);
        _;
    }

    function isAuthorized(address src, bytes4 sig) internal view returns (bool) {
        if (src == owner) {
            return true;
        } else if (authority == IAuthority(0)) {
            return false;
        } else {
            return authority.canCall(src, this, sig);
        }
    }
}

<span class="marker" id="mapping-271"></span><span class="token upd" id="move-dst-9" data-title="source_file/comment"><span class="cupd">//</span>////<span class="cupd"> </span>cont<span class="cupd">ra</span>cts/P<span class="cupd">a</span>u<span class="cupd">s</span>ab<span class="cupd">l</span>eDSAu<span class="cupd">t</span>h.sol</span>
<span class="marker" id="mapping-272"></span><span class="token upd" id="move-dst-10" data-title="source_file/comment"><span class="cupd">/</span>*<span class="cupd"> </span><span class="cupd">p</span><span class="cupd">r</span>agma<span class="cupd"> </span>s<span class="cupd">o</span>lidi<span class="cupd">t</span>y ^0<span class="cupd">.</span>4.24; */</span>

<span class="marker" id="mapping-273"></span><span class="token mv" id="move-dst-12" data-title="source_file/comment"><span class="marker" id="mapping-274"></span><span class="token upd" id="move-dst-12" data-title="source_file/comment"><span class="cupd">/</span>*<span class="cupd"> </span>im<span class="cupd">p</span><span class="cupd">o</span><span class="cupd">r</span><span class="cupd">t</span> ".<span class="cupd">/</span>D<span class="cupd">S</span>Au<span class="cupd">t</span>h<span class="cupd">.sol</span>"; */</span></span>


/**
 * @title Pausable
 * @dev Base contract which allows children to implement an emergency stop mechanism.
 */
contract PausableDSAuth is DSAuth {
  event Pause();
  event Unpause();

  bool public paused = false;


  /**
   * @dev Modifier to make a function callable only when the contract is not paused.
   */
  modifier whenNotPaused() {
    require(!paused);
    _;
  }

  /**
   * @dev Modifier to make a function callable only when the contract is paused.
   */
  modifier whenPaused() {
    require(paused);
    _;
  }

  /**
   * @dev called by the owner to pause, triggers stopped state
   */
  function pause() public onlyOwner whenNotPaused {
    paused = true;
    emit Pause();
  }

  /**
   * @dev called by the owner to unpause, returns to normal state
   */
  function unpause() public onlyOwner whenPaused {
    paused = false;
    emit Unpause();
  }
}

<span class="marker" id="mapping-275"></span><span class="token upd" id="move-dst-13" data-title="source_file/comment"><span class="cupd">//</span>////<span class="cupd"> </span>cont<span class="cupd">ra</span>cts/Settin<span class="cupd">g</span>Id<span class="cupd">s</span>.s<span class="cupd">ol</span></span>
<span class="marker" id="mapping-276"></span><span class="token upd" id="move-dst-15" data-title="source_file/comment"><span class="cupd">/</span>*<span class="cupd"> </span><span class="cupd">p</span><span class="cupd">ra</span>gma <span class="cupd">s</span>ol<span class="cupd">i</span><span class="cupd">d</span>ity ^0.4.24; */</span>

/**
    Id definitions for SettingsRegistry.sol
    Can be used in conjunction with the settings registry to get properties
*/
contract SettingIds {
    <span class="marker" id="mapping-277"></span><span class="token add" data-title="contract_body/comment">// 0x434f4e54524143545f52494e475f45524332305f544f4b454e00000000000000</span>
    bytes32 public constant CONTRACT_RING_ERC20_TOKEN = "CONTRACT_RING_ERC20_TOKEN";

    <span class="marker" id="mapping-278"></span><span class="token add" data-title="contract_body/comment">// 0x434f4e54524143545f4b544f4e5f45524332305f544f4b454e00000000000000</span>
    bytes32 public constant CONTRACT_KTON_ERC20_TOKEN = "CONTRACT_KTON_ERC20_TOKEN";

    <span class="marker" id="mapping-279"></span><span class="token add" data-title="contract_body/comment">// 0x434f4e54524143545f474f4c445f45524332305f544f4b454e00000000000000</span>
    bytes32 public constant CONTRACT_GOLD_ERC20_TOKEN = "CONTRACT_GOLD_ERC20_TOKEN";

    <span class="marker" id="mapping-280"></span><span class="token add" data-title="contract_body/comment">// 0x434f4e54524143545f574f4f445f45524332305f544f4b454e00000000000000</span>
    bytes32 public constant CONTRACT_WOOD_ERC20_TOKEN = "CONTRACT_WOOD_ERC20_TOKEN";

    <span class="marker" id="mapping-281"></span><span class="token add" data-title="contract_body/comment">// 0x434f4e54524143545f57415445525f45524332305f544f4b454e000000000000</span>
    bytes32 public constant CONTRACT_WATER_ERC20_TOKEN = "CONTRACT_WATER_ERC20_TOKEN";

    <span class="marker" id="mapping-282"></span><span class="token add" data-title="contract_body/comment">// 0x434f4e54524143545f464952455f45524332305f544f4b454e00000000000000</span>
    bytes32 public constant CONTRACT_FIRE_ERC20_TOKEN = "CONTRACT_FIRE_ERC20_TOKEN";

    <span class="marker" id="mapping-283"></span><span class="token add" data-title="contract_body/comment">// 0x434f4e54524143545f534f494c5f45524332305f544f4b454e00000000000000</span>
    bytes32 public constant CONTRACT_SOIL_ERC20_TOKEN = "CONTRACT_SOIL_ERC20_TOKEN";

    <span class="marker" id="mapping-284"></span><span class="token add" data-title="contract_body/comment">// 0x434f4e54524143545f4f424a4543545f4f574e45525348495000000000000000</span>
    bytes32 public constant CONTRACT_OBJECT_OWNERSHIP = "CONTRACT_OBJECT_OWNERSHIP";

    <span class="marker" id="mapping-285"></span><span class="token add" data-title="contract_body/comment">// 0x434f4e54524143545f544f4b454e5f4c4f434154494f4e000000000000000000</span>
    bytes32 public constant CONTRACT_TOKEN_LOCATION = "CONTRACT_TOKEN_LOCATION";

    <span class="marker" id="mapping-286"></span><span class="token add" data-title="contract_body/comment">// 0x434f4e54524143545f4c414e445f424153450000000000000000000000000000</span>
    bytes32 public constant CONTRACT_LAND_BASE = "CONTRACT_LAND_BASE";

    <span class="marker" id="mapping-287"></span><span class="token add" data-title="contract_body/comment">// 0x434f4e54524143545f555345525f504f494e5453000000000000000000000000</span>
    bytes32 public constant CONTRACT_USER_POINTS = "CONTRACT_USER_POINTS";

    <span class="marker" id="mapping-288"></span><span class="token add" data-title="contract_body/comment">// 0x434f4e54524143545f494e5445525354454c4c41525f454e434f444552000000</span>
    bytes32 public constant CONTRACT_INTERSTELLAR_ENCODER = "CONTRACT_INTERSTELLAR_ENCODER";

    <span class="marker" id="mapping-289"></span><span class="token add" data-title="contract_body/comment">// 0x434f4e54524143545f4449564944454e44535f504f4f4c000000000000000000</span>
    bytes32 public constant CONTRACT_DIVIDENDS_POOL = "CONTRACT_DIVIDENDS_POOL";

    <span class="marker" id="mapping-290"></span><span class="token add" data-title="contract_body/comment">// 0x434f4e54524143545f544f4b454e5f5553450000000000000000000000000000</span>
    bytes32 public constant CONTRACT_TOKEN_USE = "CONTRACT_TOKEN_USE";

    <span class="marker" id="mapping-291"></span><span class="token add" data-title="contract_body/comment">// 0x434f4e54524143545f524556454e55455f504f4f4c0000000000000000000000</span>
    bytes32 public constant CONTRACT_REVENUE_POOL = "CONTRACT_REVENUE_POOL";

    <span class="marker" id="mapping-292"></span><span class="token add" data-title="contract_body/comment">// 0x434f4e54524143545f4252494447455f504f4f4c000000000000000000000000</span>
    <span class="marker" id="mapping-293"></span><span class="token add" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-294"></span><span class="token add" data-title="state_variable_declaration/type_name">bytes32</span> <span class="marker" id="mapping-295"></span><span class="token mv" id="move-dst-143" data-title="state_variable_declaration/visibility">public</span> constant CONTRACT_BRIDGE_POOL = <span class="marker" id="mapping-296"></span><span class="token add" data-title="state_variable_declaration/string_literal">"CONTRACT_BRIDGE_POOL"</span>;</span>

    <span class="marker" id="mapping-297"></span><span class="token add" data-title="contract_body/comment">// 0x434f4e54524143545f4552433732315f42524944474500000000000000000000</span>
    bytes32 public constant CONTRACT_ERC721_BRIDGE = "CONTRACT_ERC721_BRIDGE";

    <span class="marker" id="mapping-298"></span><span class="token add" data-title="contract_body/comment">// 0x434f4e54524143545f5045545f42415345000000000000000000000000000000</span>
    bytes32 public constant CONTRACT_PET_BASE = "CONTRACT_PET_BASE";

    // Cut owner takes on each auction, measured in basis points (1/100 of a percent).
    // this can be considered as transaction fee.
    // Values 0-10,000 map to 0%-100%
    // set ownerCut to 4%
    // ownerCut = 400;
    <span class="marker" id="mapping-299"></span><span class="token add" data-title="contract_body/comment">// 0x55494e545f41554354494f4e5f43555400000000000000000000000000000000</span>
    bytes32 public constant UINT_AUCTION_CUT = "UINT_AUCTION_CUT";  // Denominator is 10000

    <span class="marker" id="mapping-300"></span><span class="token add" data-title="contract_body/comment">// 0x55494e545f544f4b454e5f4f464645525f435554000000000000000000000000</span>
    bytes32 public constant UINT_TOKEN_OFFER_CUT = "UINT_TOKEN_OFFER_CUT";  // Denominator is 10000

    // Cut referer takes on each auction, measured in basis points (1/100 of a percent).
    // which cut from transaction fee.
    // Values 0-10,000 map to 0%-100%
    // set refererCut to 4%
    // refererCut = 400;
    <span class="marker" id="mapping-301"></span><span class="token add" data-title="contract_body/comment">// 0x55494e545f524546455245525f43555400000000000000000000000000000000</span>
    bytes32 public constant UINT_REFERER_CUT = "UINT_REFERER_CUT";

    <span class="marker" id="mapping-302"></span><span class="token add" data-title="contract_body/comment">// 0x55494e545f4252494447455f4645450000000000000000000000000000000000</span>
    <span class="marker" id="mapping-303"></span><span class="token add" data-title="contract_body/state_variable_declaration">bytes32 public constant UINT_BRIDGE_FEE = "UINT_BRIDGE_FEE";</span>

    <span class="marker" id="mapping-304"></span><span class="token add" data-title="contract_body/comment">// 0x434f4e54524143545f4c414e445f5245534f5552434500000000000000000000</span>
    bytes32 public constant CONTRACT_LAND_RESOURCE = "CONTRACT_LAND_RESOURCE";
}

<span class="marker" id="mapping-305"></span><span class="token mv" id="move-dst-17" data-title="source_file/comment"><span class="marker" id="mapping-306"></span><span class="token upd" id="move-dst-17" data-title="source_file/comment"><span class="cupd">//</span>////<span class="cupd"> </span>cont<span class="cupd">ra</span>cts/interf<span class="cupd">a</span>ce<span class="cupd">s</span>/IBurnab<span class="cupd">l</span>eERC2<span class="cupd">0.</span>sol</span></span>
<span class="marker" id="mapping-307"></span><span class="token upd" id="move-dst-18" data-title="source_file/comment"><span class="cupd">/</span>*<span class="cupd"> </span><span class="cupd">p</span><span class="cupd">ra</span>gm<span class="cupd">a</span> <span class="cupd">s</span>o<span class="cupd">l</span>i<span class="cupd">d</span>ity ^0.4.23; */</span>

<span class="marker" id="mapping-308"></span><span class="token add" data-title="source_file/contract_declaration">contract IBurnableERC20 <span class="marker" id="mapping-309"></span><span class="token add" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-310"></span><span class="token add" data-title="contract_body/function_definition">function burn(<span class="marker" id="mapping-311"></span><span class="token add" data-title="function_definition/parameter">address _from</span>, <span class="marker" id="mapping-312"></span><span class="token add" data-title="function_definition/parameter">uint _value</span>) <span class="marker" id="mapping-313"></span><span class="token mv" id="move-dst-50" data-title="function_definition/visibility">public</span>;</span>
}</span></span>

<span class="marker" id="mapping-314"></span><span class="token upd" id="move-dst-19" data-title="source_file/comment"><span class="cupd">//</span>////<span class="cupd"> </span>cont<span class="cupd">ra</span>cts/interf<span class="cupd">a</span>ce<span class="cupd">s</span>/IERC165.s<span class="cupd">ol</span></span>

<span class="marker" id="mapping-315"></span><span class="token upd" id="move-dst-21" data-title="source_file/comment"><span class="cupd">/</span>*<span class="cupd"> </span><span class="cupd">p</span><span class="cupd">ra</span>gm<span class="cupd">a</span> <span class="cupd">s</span>ol<span class="cupd">i</span>di<span class="cupd">t</span>y ^<span class="cupd">0.</span>4.24; */</span>

<span class="marker" id="mapping-316"></span><span class="token upd" id="move-dst-22" data-title="source_file/comment"><span class="cupd">/</span>**<span class="cupd"></span>
 * @dev Interface of the ERC165 standard, as defined in the
 * h<span class="cupd">t</span>tps://eips.et<span class="cupd">h</span>ereum.<span class="cupd">o</span>rg/EIPS/eip-165[EIP].
 *
<span class="cupd"> </span>* Implemente<span class="cupd">r</span>s<span class="cupd"> </span>can decl<span class="cupd">a</span>re <span class="cupd">s</span>upport of contr<span class="cupd">a</span>ct interfaces<span class="cupd">,</span> which <span class="cupd">c</span>an then be
 * quer<span class="cupd">ie</span>d by others ({ERC165Chec<span class="cupd">k</span>er}).
 *
 * For an implementation, see {ERC165}.
 */</span>
<span class="marker" id="mapping-317"></span><span class="token add" data-title="source_file/contract_declaration">contract IERC165 <span class="marker" id="mapping-318"></span><span class="token mv" id="move-dst-30" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-319"></span><span class="token upd" id="move-dst-31" data-title="contract_body/comment"><span class="cupd">/**
  </span>  <span class="cupd"> * </span>@<span class="cupd">d</span>e<span class="cupd">v</span> Re<span class="cupd">t</span><span class="cupd">u</span>rn<span class="cupd">s</span> true<span class="cupd"> if</span> thi<span class="cupd">s contract implements</span> th<span class="cupd">e interface</span> define<span class="cupd">d</span> b<span class="cupd">y</span>
   <span class="cupd">  </span>*<span class="cupd"> `interface</span>Id<span class="cupd">`</span>. See<span class="cupd"> th</span>e correspo<span class="cupd">nd</span>ing
     <span class="cupd">*</span> https<span class="cupd">:</span>//eips.e<span class="cupd">t</span>hereum.org/EIPS/eip-165#how-in<span class="cupd">terf</span>aces-a<span class="cupd">re-identi</span>fied[<span class="cupd">E</span><span class="cupd">I</span><span class="cupd">P </span>s<span class="cupd">e</span>c<span class="cupd">t</span>i<span class="cupd">o</span><span class="cupd">n]
</span> <span class="cupd">  </span>  <span class="cupd">*</span> <span class="cupd">t</span>o<span class="cupd"> </span>learn<span class="cupd"> m</span><span class="cupd">o</span>re <span class="cupd">a</span>bo<span class="cupd">u</span>t<span class="cupd"> </span>how th<span class="cupd">e</span>s<span class="cupd">e </span>id<span class="cupd">s</span> <span class="cupd">a</span>r<span class="cupd">e</span> cr<span class="cupd">e</span>a<span class="cupd">t</span><span class="cupd">e</span><span class="cupd">d</span>.
     *
 <span class="cupd">    * This fun</span>ctio<span class="cupd">n</span> cal<span class="cupd">l</span><span class="cupd"> mu</span><span class="cupd">st use less t</span>h<span class="cupd">an 30 000 ga</span>s.<span class="cupd">
</span>     */</span>
    function supportsInterface(bytes4 <span class="marker" id="mapping-320"></span><span class="token upd" id="move-dst-32" data-title="parameter/identifier"><span class="cupd">interfaceId</span></span>) external view returns (bool);
}</span></span>

<span class="marker" id="mapping-321"></span><span class="token upd" id="move-dst-24" data-title="source_file/comment"><span class="cupd">//</span>////<span class="cupd"> </span><span class="cupd">c</span><span class="cupd">ontracts/interfaces/I</span>ERC1155<span class="cupd">.sol</span></span>

<span class="marker" id="mapping-322"></span><span class="token upd" id="move-dst-25" data-title="source_file/comment"><span class="cupd">/</span>*<span class="cupd"> pragma solidity ^0.4.24;</span> */</span>

<span class="marker" id="mapping-323"></span><span class="token upd" id="move-dst-27" data-title="source_file/comment"><span class="cupd">/</span>*<span class="cupd"> </span><span class="cupd">i</span>m<span class="cupd">p</span><span class="cupd">o</span><span class="cupd">r</span><span class="cupd">t</span> ".<span class="cupd">/</span>I<span class="cupd">ERC165.sol</span>"; */</span>

<span class="marker" id="mapping-324"></span><span class="token upd" id="move-dst-28" data-title="source_file/comment"><span class="cupd">/</span>**<span class="cupd"></span>
 * @dev Requ<span class="cupd">i</span>red inter<span class="cupd">f</span>ace of<span class="cupd"> </span>a<span class="cupd">n</span> ERC1155 <span class="cupd">c</span>om<span class="cupd">pl</span>iant contract, as<span class="cupd"> </span>de<span class="cupd">f</span>ined in<span class="cupd"> </span>th<span class="cupd">e</span>
 * https://ei<span class="cupd">p</span>s.ethereum.org/EIPS/eip-1155[EIP].
 *
 * _Available since v3.1._
 */</span>
<span class="marker" id="mapping-325"></span><span class="token add" data-title="source_file/contract_declaration">contract IERC1155 is <span class="marker" id="mapping-326"></span><span class="token add" data-title="contract_declaration/inheritance_specifier">IERC165</span> <span class="marker" id="mapping-327"></span><span class="token add" data-title="contract_declaration/contract_body">{
    /**
     * @dev Emitted when `value` tokens of token type `id` are transferred from `from` to `to` by `operator`.
     */
    <span class="marker" id="mapping-328"></span><span class="token add" data-title="contract_body/event_definition">event TransferSingle(address indexed operator, address indexed from, address indexed to, uint256 id, uint256 value);</span>

    /**
     * @dev Equivalent to multiple {TransferSingle} events, where `operator`, `from` and `to` are the same for all
     * transfers.
     */
    <span class="marker" id="mapping-329"></span><span class="token add" data-title="contract_body/event_definition">event TransferBatch(address indexed operator, address indexed from, address indexed to, uint256[] ids, uint256[] values);</span>

    /**
     * @dev Emitted when `account` grants or revokes permission to `operator` to transfer their tokens, according to
     * `approved`.
     */
    <span class="marker" id="mapping-330"></span><span class="token add" data-title="contract_body/event_definition">event ApprovalForAll(<span class="marker" id="mapping-331"></span><span class="token add" data-title="event_definition/event_paramater">address indexed account</span>, <span class="marker" id="mapping-332"></span><span class="token mv" id="move-dst-76" data-title="event_definition/event_paramater">address <span class="marker" id="mapping-333"></span><span class="token add" data-title="event_paramater/indexed">indexed</span> <span class="marker" id="mapping-334"></span><span class="token upd" id="move-dst-77" data-title="event_paramater/identifier">oper<span class="cupd">a</span><span class="cupd">tor</span></span></span>, <span class="marker" id="mapping-335"></span><span class="token add" data-title="event_definition/event_paramater">bool approved</span>);</span>

    /**
     * @dev Emitted when the URI for token type `id` changes to `value`, if it is a non-programmatic URI.
     *
     * If an {URI} event was emitted for `id`, the standard
     * https://eips.ethereum.org/EIPS/eip-1155#metadata-extensions[guarantees] that `value` will equal the value
     * returned by {IERC1155MetadataURI-uri}.
     */
    <span class="marker" id="mapping-336"></span><span class="token add" data-title="contract_body/event_definition">event URI(<span class="marker" id="mapping-337"></span><span class="token add" data-title="event_definition/event_paramater"><span class="marker" id="mapping-338"></span><span class="token mv" id="move-dst-63" data-title="event_paramater/type_name">string</span> value</span>, <span class="marker" id="mapping-339"></span><span class="token add" data-title="event_definition/event_paramater">uint256 indexed id</span>);</span>

    /**
     * @dev Returns the amount of tokens of token type `id` owned by `account`.
     *
     * Requirements:
     *
     * - `account` cannot be the zero address.
     */
    <span class="marker" id="mapping-340"></span><span class="token mv" id="move-dst-52" data-title="contract_body/function_definition">function <span class="marker" id="mapping-341"></span><span class="token upd" id="move-dst-53" data-title="function_definition/identifier">bala<span class="cupd">n</span>ceOf</span>(<span class="marker" id="mapping-342"></span><span class="token add" data-title="function_definition/parameter">address account</span><span class="marker" id="mapping-343"></span><span class="token add" data-title="function_definition/,">,</span> <span class="marker" id="mapping-344"></span><span class="token add" data-title="function_definition/parameter">uint256 id</span>) <span class="marker" id="mapping-345"></span><span class="token add" data-title="function_definition/visibility">external</span> view returns (uint256);</span>

    /**
     * @dev xref:ROOT:erc1155.adoc#batch-operations[Batched] version of {balanceOf}.
     *
     * Requirements:
     *
     * - `accounts` and `ids` must have the same length.
     */
    <span class="marker" id="mapping-346"></span><span class="token add" data-title="contract_body/function_definition">function balanceOfBatch(<span class="marker" id="mapping-347"></span><span class="token add" data-title="function_definition/parameter">address[] accounts</span>, <span class="marker" id="mapping-348"></span><span class="token add" data-title="function_definition/parameter">uint256[] ids</span>) <span class="marker" id="mapping-349"></span><span class="token add" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-350"></span><span class="token mv" id="move-dst-51" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-351"></span><span class="token add" data-title="function_definition/return_type_definition">returns (uint256[] memory)</span>;</span>

    /**
     * @dev Grants or revokes permission to `operator` to transfer the caller's tokens, according to `approved`,
     *
     * Emits an {ApprovalForAll} event.
     *
     * Requirements:
     *
     * - `operator` cannot be the caller.
     */
    <span class="marker" id="mapping-352"></span><span class="token add" data-title="contract_body/function_definition">function setApprovalForAll(address operator, bool approved) external;</span>

    /**
     * @dev Returns true if `operator` is approved to transfer ``account``'s tokens.
     *
     * See {setApprovalForAll}.
     */
    <span class="marker" id="mapping-353"></span><span class="token add" data-title="contract_body/function_definition">function isApprovedForAll(<span class="marker" id="mapping-354"></span><span class="token add" data-title="function_definition/parameter">address account</span>, <span class="marker" id="mapping-355"></span><span class="token add" data-title="function_definition/parameter">address operator</span>) <span class="marker" id="mapping-356"></span><span class="token add" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-357"></span><span class="token mv" id="move-dst-62" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-358"></span><span class="token add" data-title="function_definition/return_type_definition">returns (bool)</span>;</span>

    /**
     * @dev Transfers `amount` tokens of token type `id` from `from` to `to`.
     *
     * Emits a {TransferSingle} event.
     *
     * Requirements:
     *
     * - `to` cannot be the zero address.
     * - If the caller is not `from`, it must be have been approved to spend ``from``'s tokens via {setApprovalForAll}.
     * - `from` must have a balance of tokens of type `id` of at least `amount`.
     * - If `to` refers to a smart contract, it must implement {IERC1155Receiver-onERC1155Received} and return the
     * acceptance magic value.
     */
    <span class="marker" id="mapping-359"></span><span class="token add" data-title="contract_body/function_definition">function safeTransferFrom(address from, address to, uint256 id, uint256 amount, bytes data) external;</span>

    /**
     * @dev xref:ROOT:erc1155.adoc#batch-operations[Batched] version of {safeTransferFrom}.
     *
     * Emits a {TransferBatch} event.
     *
     * Requirements:
     *
     * - `ids` and `amounts` must have the same length.
     * - If `to` refers to a smart contract, it must implement {IERC1155Receiver-onERC1155BatchReceived} and return the
     * acceptance magic value.
     */
    <span class="marker" id="mapping-360"></span><span class="token add" data-title="contract_body/function_definition">function safeBatchTransferFrom(address from, address to, uint256[] ids, uint256[] amounts, bytes data) external;</span>
}</span></span>

<span class="marker" id="mapping-361"></span><span class="token upd" id="move-dst-29" data-title="source_file/comment"><span class="cupd">/</span>/////<span class="cupd"> </span>con<span class="cupd">t</span>racts/<span class="cupd">i</span>n<span class="cupd">t</span><span class="cupd">e</span>rfaces/I<span class="cupd">ERC1</span>1<span class="cupd">5</span>5R<span class="cupd">e</span><span class="cupd">c</span><span class="cupd">e</span>iv<span class="cupd">er</span>.<span class="cupd">s</span>ol</span>

<span class="marker" id="mapping-362"></span><span class="token upd" id="move-dst-33" data-title="source_file/comment"><span class="cupd">/</span>*<span class="cupd"> </span><span class="cupd">p</span>ragma<span class="cupd"> </span><span class="cupd">solidity</span> ^0.4.<span class="cupd">2</span>4; */</span>

<span class="marker" id="mapping-363"></span><span class="token upd" id="move-dst-34" data-title="source_file/comment"><span class="cupd">/</span>**<span class="cupd"></span>
 * _A<span class="cupd">v</span>ai<span class="cupd">l</span>abl<span class="cupd">e </span><span class="cupd">s</span>inc<span class="cupd">e</span> v<span class="cupd">3</span>.1._
 */</span>
<span class="marker" id="mapping-364"></span><span class="token add" data-title="source_file/contract_declaration">contract IERC1155Receiver <span class="marker" id="mapping-365"></span><span class="token add" data-title="contract_declaration/contract_body">{

    <span class="marker" id="mapping-366"></span><span class="token add" data-title="contract_body/state_variable_declaration">bytes4 internal constant ERC1155_RECEIVED_VALUE = 0xf23a6e61;</span>
    <span class="marker" id="mapping-367"></span><span class="token add" data-title="contract_body/state_variable_declaration">bytes4 internal constant ERC1155_BATCH_RECEIVED_VALUE = 0xbc197c81;</span>

    /**
        @dev Handles the receipt of a single ERC1155 token type. This function is
        called at the end of a `safeTransferFrom` after the balance has been updated.
        To accept the transfer, this must return
        `bytes4(keccak256("onERC1155Received(address,address,uint256,uint256,bytes)"))`
        (i.e. 0xf23a6e61, or its own function selector).
        @param operator The address which initiated the transfer (i.e. msg.sender)
        @param from The address which previously owned the token
        @param id The ID of the token being transferred
        @param value The amount of tokens being transferred
        @param data Additional data with no specified format
        @return `bytes4(keccak256("onERC1155Received(address,address,uint256,uint256,bytes)"))` if transfer is allowed
    */
    <span class="marker" id="mapping-368"></span><span class="token add" data-title="contract_body/function_definition">function onERC1155Received(
        <span class="marker" id="mapping-369"></span><span class="token add" data-title="function_definition/parameter">address operator</span>,
        <span class="marker" id="mapping-370"></span><span class="token add" data-title="function_definition/parameter">address from</span>,
        <span class="marker" id="mapping-371"></span><span class="token mv" id="move-dst-48" data-title="function_definition/parameter">uint256 <span class="marker" id="mapping-372"></span><span class="token upd" id="move-dst-49" data-title="parameter/identifier"><span class="cupd">i</span>d</span></span>,
        <span class="marker" id="mapping-373"></span><span class="token mv" id="move-dst-54" data-title="function_definition/parameter">uint256 <span class="marker" id="mapping-374"></span><span class="token upd" id="move-dst-55" data-title="parameter/identifier">value</span></span>,
        <span class="marker" id="mapping-375"></span><span class="token add" data-title="function_definition/parameter">bytes data</span>
    )
        <span class="marker" id="mapping-376"></span><span class="token mv" id="move-dst-59" data-title="function_definition/visibility">external</span>
        <span class="marker" id="mapping-377"></span><span class="token add" data-title="function_definition/return_type_definition">returns(bytes4)</span>;</span>

    /**
        @dev Handles the receipt of a multiple ERC1155 token types. This function
        is called at the end of a `safeBatchTransferFrom` after the balances have
        been updated. To accept the transfer(s), this must return
        `bytes4(keccak256("onERC1155BatchReceived(address,address,uint256[],uint256[],bytes)"))`
        (i.e. 0xbc197c81, or its own function selector).
        @param operator The address which initiated the batch transfer (i.e. msg.sender)
        @param from The address which previously owned the token
        @param ids An array containing ids of each token being transferred (order and length must match values array)
        @param values An array containing amounts of each token being transferred (order and length must match ids array)
        @param data Additional data with no specified format
        @return `bytes4(keccak256("onERC1155BatchReceived(address,address,uint256[],uint256[],bytes)"))` if transfer is allowed
    */
    <span class="marker" id="mapping-378"></span><span class="token add" data-title="contract_body/function_definition">function onERC1155BatchReceived(
        <span class="marker" id="mapping-379"></span><span class="token add" data-title="function_definition/parameter">address operator</span>,
        <span class="marker" id="mapping-380"></span><span class="token add" data-title="function_definition/parameter">address from</span>,
        <span class="marker" id="mapping-381"></span><span class="token add" data-title="function_definition/parameter">uint256[] ids</span>,
        <span class="marker" id="mapping-382"></span><span class="token add" data-title="function_definition/parameter">uint256[] values</span>,
        <span class="marker" id="mapping-383"></span><span class="token add" data-title="function_definition/parameter">bytes data</span>
    )
        <span class="marker" id="mapping-384"></span><span class="token mv" id="move-dst-58" data-title="function_definition/visibility">external</span>
        <span class="marker" id="mapping-385"></span><span class="token add" data-title="function_definition/return_type_definition">returns(bytes4)</span>;</span>
}</span></span>

<span class="marker" id="mapping-386"></span><span class="token upd" id="move-dst-35" data-title="source_file/comment"><span class="cupd">//</span>////<span class="cupd"> </span><span class="cupd">contracts/int</span>e<span class="cupd">r</span>face<span class="cupd">s</span><span class="cupd">/</span>I<span class="cupd">ERC</span>72<span class="cupd">1</span><span class="cupd">.sol</span></span>
<span class="marker" id="mapping-387"></span><span class="token upd" id="move-dst-36" data-title="source_file/comment"><span class="cupd">/*</span><span class="cupd"> </span>pra<span class="cupd">g</span>m<span class="cupd">a</span><span class="cupd"> </span><span class="cupd">s</span>ol<span class="cupd">i</span>d<span class="cupd">i</span><span class="cupd">t</span>y<span class="cupd"> </span>^0<span class="cupd">.</span>4.<span class="cupd">2</span>4;<span class="cupd"> </span><span class="cupd">*/</span></span>

<span class="marker" id="mapping-388"></span><span class="token upd" id="move-dst-40" data-title="source_file/comment"><span class="cupd">/</span>*<span class="cupd"> </span><span class="cupd">i</span>m<span class="cupd">p</span><span class="cupd">o</span><span class="cupd">r</span><span class="cupd">t</span> ".<span class="cupd">/</span>I<span class="cupd">ERC</span><span class="cupd">1</span>65<span class="cupd">.sol</span>"; */</span>

<span class="marker" id="mapping-389"></span><span class="token upd" id="move-dst-41" data-title="source_file/comment"><span class="cupd">/</span>**<span class="cupd"></span>
 * @title IERC721 Non-Fungible Token Stand<span class="cupd">a</span>rd <span class="cupd">b</span>asic inter<span class="cupd">f</span>ac<span class="cupd">e</span>
 * @de<span class="cupd">v</span> see https://github<span class="cupd">.</span>com/ethereum/EIPs<span class="cupd">/</span>blob/master/EIPS<span class="cupd">/</span>eip-721<span class="cupd">.</span>md
 */</span>
<span class="marker" id="mapping-390"></span><span class="token mv" id="move-dst-37" data-title="source_file/contract_declaration">contract <span class="marker" id="mapping-391"></span><span class="token upd" id="move-dst-38" data-title="contract_declaration/identifier">I<span class="cupd">ERC721</span></span> is <span class="marker" id="mapping-392"></span><span class="token upd" id="move-dst-39" data-title="user_defined_type/identifier">I<span class="cupd">ERC165</span></span> {

  bytes4 internal constant InterfaceId_ERC721 = 0x80ac58cd;
  /*
   * 0x80ac58cd ===
   *   bytes4(keccak256('balanceOf(address)')) ^
   *   bytes4(keccak256('ownerOf(uint256)')) ^
   *   bytes4(keccak256('approve(address,uint256)')) ^
   *   bytes4(keccak256('getApproved(uint256)')) ^
   *   bytes4(keccak256('setApprovalForAll(address,bool)')) ^
   *   bytes4(keccak256('isApprovedForAll(address,address)')) ^
   *   bytes4(keccak256('transferFrom(address,address,uint256)')) ^
   *   bytes4(keccak256('safeTransferFrom(address,address,uint256)')) ^
   *   bytes4(keccak256('safeTransferFrom(address,address,uint256,bytes)'))
   */

  bytes4 internal constant InterfaceId_ERC721Exists = 0x4f558e79;
  /*
   * 0x4f558e79 ===
   *   bytes4(keccak256('exists(uint256)'))
   */

  bytes4 internal constant InterfaceId_ERC721Enumerable = 0x780e9d63;
  /**
   * 0x780e9d63 ===
   *   bytes4(keccak256('totalSupply()')) ^
   *   bytes4(keccak256('tokenOfOwnerByIndex(address,uint256)')) ^
   *   bytes4(keccak256('tokenByIndex(uint256)'))
   */

  bytes4 internal constant InterfaceId_ERC721Metadata = 0x5b5e139f;
  /**
   * 0x5b5e139f ===
   *   bytes4(keccak256('name()')) ^
   *   bytes4(keccak256('symbol()')) ^
   *   bytes4(keccak256('tokenURI(uint256)'))
   */

  event Transfer(
    address indexed _from,
    address indexed _to,
    uint256 indexed _tokenId
  );
  event Approval(
    address indexed _owner,
    address indexed _approved,
    uint256 indexed _tokenId
  );
  event ApprovalForAll(
    address indexed _owner,
    address indexed _operator,
    bool _approved
  );

  function balanceOf(address _owner) public view returns (uint256 _balance);
  function ownerOf(uint256 _tokenId) public view returns (address _owner);
  function exists(uint256 _tokenId) public view returns (bool _exists);

  function approve(address _to, uint256 _tokenId) public;
  function getApproved(uint256 _tokenId)
    public view returns (address _operator);

  function setApprovalForAll(address _operator, bool _approved) public;
  function isApprovedForAll(address _owner, address _operator)
    public view returns (bool);

  function transferFrom(address _from, address _to, uint256 _tokenId) public;
  function safeTransferFrom(address _from, address _to, uint256 _tokenId)
    public;

  function safeTransferFrom(
    address _from,
    address _to,
    uint256 _tokenId,
    bytes _data
  )
    public;
}</span>

<span class="marker" id="mapping-393"></span><span class="token upd" id="move-dst-42" data-title="source_file/comment"><span class="cupd">//</span>////<span class="cupd"> </span><span class="cupd">contracts/</span>in<span class="cupd">t</span><span class="cupd">e</span>rfaces<span class="cupd">/</span>I<span class="cupd">ERC721</span><span class="cupd">R</span>ece<span class="cupd">i</span>ver<span class="cupd">.sol</span></span>
<span class="marker" id="mapping-394"></span><span class="token upd" id="move-dst-43" data-title="source_file/comment"><span class="cupd">/*</span><span class="cupd"> </span>p<span class="cupd">r</span><span class="cupd">a</span>g<span class="cupd">m</span><span class="cupd">a</span><span class="cupd"> </span><span class="cupd">s</span>ol<span class="cupd">i</span><span class="cupd">d</span><span class="cupd">it</span>y ^0<span class="cupd">.</span>4.<span class="cupd">2</span>4;<span class="cupd"> </span><span class="cupd">*/</span></span>


<span class="marker" id="mapping-395"></span><span class="token upd" id="move-dst-57" data-title="source_file/comment"><span class="cupd">/**
 * @title ER</span><span class="cupd">C721</span> <span class="cupd">t</span><span class="cupd">oken</span><span class="cupd"> </span>receive<span class="cupd">r</span><span class="cupd"> </span><span class="cupd">i</span>n<span class="cupd">t</span>er<span class="cupd">f</span>a<span class="cupd">c</span><span class="cupd">e
 * @de</span>v I<span class="cupd">n</span>terf<span class="cupd">ac</span>e for any contract<span class="cupd"> </span>t<span class="cupd">h</span>at w<span class="cupd">a</span><span class="cupd">n</span>t<span class="cupd">s</span> to<span class="cupd"> </span>su<span class="cupd">p</span>p<span class="cupd">o</span>rt s<span class="cupd">a</span>f<span class="cupd">e</span>Tran<span class="cupd">s</span>f<span class="cupd">e</span>rs
 *<span class="cupd"> </span><span class="cupd">f</span>rom ERC7<span class="cupd">21</span> a<span class="cupd">s</span>set c<span class="cupd">o</span>ntra<span class="cupd">c</span><span class="cupd">ts.</span>
 */</span>
<span class="marker" id="mapping-396"></span><span class="token add" data-title="source_file/contract_declaration">contract IERC721Receiver <span class="marker" id="mapping-397"></span><span class="token add" data-title="contract_declaration/contract_body">{
  /**
   * @dev Magic value to be returned upon successful reception of an NFT
   *  Equals to `bytes4(keccak256("onERC721Received(address,address,uint256,bytes)"))`,
   *  which can be also obtained as `ERC721Receiver(0).onERC721Received.selector`
   */
  <span class="marker" id="mapping-398"></span><span class="token add" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-399"></span><span class="token add" data-title="state_variable_declaration/type_name">bytes4</span> <span class="marker" id="mapping-400"></span><span class="token mv" id="move-dst-108" data-title="state_variable_declaration/visibility">internal</span> constant ERC721_RECEIVED = 0x150b7a02;</span>

  /**
   * @notice Handle the receipt of an NFT
   * @dev The ERC721 smart contract calls this function on the recipient
   * after a `safetransfer`. This function MAY throw to revert and reject the
   * transfer. Return of other than the magic value MUST result in the
   * transaction being reverted.
   * Note: the contract address is always the message sender.
   * @param _operator The address which called `safeTransferFrom` function
   * @param _from The address which previously owned the token
   * @param _tokenId The NFT identifier which is being transferred
   * @param _data Additional data with no specified format
   * @return `bytes4(keccak256("onERC721Received(address,address,uint256,bytes)"))`
   */
  <span class="marker" id="mapping-401"></span><span class="token add" data-title="contract_body/function_definition">function onERC721Received(
    <span class="marker" id="mapping-402"></span><span class="token mv" id="move-dst-46" data-title="function_definition/parameter">address <span class="marker" id="mapping-403"></span><span class="token upd" id="move-dst-47" data-title="parameter/identifier"><span class="cupd">_o</span>p<span class="cupd">er</span>ator</span></span>,
    <span class="marker" id="mapping-404"></span><span class="token mv" id="move-dst-93" data-title="function_definition/parameter">address <span class="marker" id="mapping-405"></span><span class="token upd" id="move-dst-94" data-title="parameter/identifier"><span class="cupd">_</span>from</span></span>,
    <span class="marker" id="mapping-406"></span><span class="token mv" id="move-dst-60" data-title="function_definition/parameter">uint256 _tokenId</span>,
    <span class="marker" id="mapping-407"></span><span class="token add" data-title="function_definition/parameter">bytes _data</span>
  )
    <span class="marker" id="mapping-408"></span><span class="token mv" id="move-dst-61" data-title="function_definition/visibility">public</span>
    <span class="marker" id="mapping-409"></span><span class="token add" data-title="function_definition/return_type_definition">returns(bytes4)</span>;</span>
}</span></span>

<span class="marker" id="mapping-410"></span><span class="token upd" id="move-dst-64" data-title="source_file/comment"><span class="cupd">/</span>/////<span class="cupd"> </span>c<span class="cupd">on</span><span class="cupd">t</span><span class="cupd">r</span><span class="cupd">a</span>c<span class="cupd">t</span>s/<span class="cupd">i</span><span class="cupd">n</span><span class="cupd">terface</span><span class="cupd">s</span><span class="cupd">/</span>IIn<span class="cupd">t</span><span class="cupd">e</span>rs<span class="cupd">t</span><span class="cupd">e</span>lla<span class="cupd">r</span><span class="cupd">E</span>nc<span class="cupd">o</span>d<span class="cupd">er</span>V3.sol</span>
<span class="marker" id="mapping-411"></span><span class="token upd" id="move-dst-65" data-title="source_file/comment"><span class="cupd">/</span>*<span class="cupd"> </span>p<span class="cupd">ra</span>gma <span class="cupd">s</span>ol<span class="cupd">id</span>ity ^0.4.24; */</span>

<span class="marker" id="mapping-412"></span><span class="token mv" id="move-dst-20" data-title="source_file/contract_declaration">contract IInterstellarEncoderV3 {
    uint256 constant CLEAR_HIGH =  0x00000000000000000000000000000000ffffffffffffffffffffffffffffffff;

    uint256 public constant MAGIC_NUMBER = 42;    // Interstellar Encoding Magic Number.
    uint256 public constant CHAIN_ID = 1; // Ethereum mainet.
    uint256 public constant CURRENT_LAND = 1; // 1 is Atlantis, 0 is NaN.

    enum ObjectClass { 
        NaN,
        LAND,
        APOSTLE,
        OBJECT_CLASS_COUNT
    }

    function registerNewObjectClass(address _objectContract, uint8 objectClass) public;

    function encodeTokenId(address _tokenAddress, uint8 _objectClass, uint128 _objectIndex) public view returns (uint256 _tokenId);

    function encodeTokenIdForObjectContract(
        address _tokenAddress, address _objectContract, uint128 _objectId) public view returns (uint256 _tokenId);

    function encodeTokenIdForOuterObjectContract(
        address _objectContract, address nftAddress, address _originNftAddress, uint128 _objectId, uint16 _producerId, uint8 _convertType) public view returns (uint256);

    function getContractAddress(uint256 _tokenId) public view returns (address);

    function getObjectId(uint256 _tokenId) public view returns (uint128 _objectId);

    function getObjectClass(uint256 _tokenId) public view returns (uint8);

    function getObjectAddress(uint256 _tokenId) public view returns (address);

    function getProducerId(uint256 _tokenId) public view returns (uint16);

    function getOriginAddress(uint256 _tokenId) public view returns (address);

}</span>

<span class="marker" id="mapping-413"></span><span class="token upd" id="move-dst-67" data-title="source_file/comment"><span class="cupd">//</span>////<span class="cupd"> </span><span class="cupd">contracts/</span>interf<span class="cupd">a</span>ce<span class="cupd">s</span>/IMint<span class="cupd">able</span>ERC20<span class="cupd">.sol</span></span>
<span class="marker" id="mapping-414"></span><span class="token upd" id="move-dst-68" data-title="source_file/comment"><span class="cupd">/</span>*<span class="cupd"> </span><span class="cupd">p</span><span class="cupd">r</span><span class="cupd">a</span>gm<span class="cupd">a</span> <span class="cupd">s</span>ol<span class="cupd">i</span>d<span class="cupd">i</span><span class="cupd">t</span><span class="cupd">y</span> ^0<span class="cupd">.</span>4.23; */</span>

<span class="marker" id="mapping-415"></span><span class="token mv" id="move-dst-23" data-title="source_file/contract_declaration">contract IMintableERC20 {

    function mint(address _to, uint256 _value) public;
}</span>

<span class="marker" id="mapping-416"></span><span class="token upd" id="move-dst-69" data-title="source_file/comment"><span class="cupd">//</span>////<span class="cupd"> </span><span class="cupd">contracts/</span><span class="cupd">in</span>terfaces/<span class="cupd">I</span>NFTA<span class="cupd">d</span>aptor<span class="cupd">.sol</span></span>
<span class="marker" id="mapping-417"></span><span class="token upd" id="move-dst-70" data-title="source_file/comment"><span class="cupd">/</span>*<span class="cupd"> </span><span class="cupd">p</span><span class="cupd">r</span><span class="cupd">a</span>gm<span class="cupd">a</span> <span class="cupd">s</span>o<span class="cupd">l</span>i<span class="cupd">d</span>ity ^0<span class="cupd">.</span>4.24; */</span>


<span class="marker" id="mapping-418"></span><span class="token mv" id="move-dst-26" data-title="source_file/contract_declaration">contract INFTAdaptor {
    function toMirrorTokenId(uint256 _originTokenId) public view returns (uint256);

    <span class="marker" id="mapping-419"></span><span class="token mv" id="move-dst-44" data-title="contract_body/function_definition">function <span class="marker" id="mapping-420"></span><span class="token upd" id="move-dst-45" data-title="function_definition/identifier"><span class="cupd">to</span>MirrorTokenIdAndIncrease</span>(<span class="marker" id="mapping-421"></span><span class="token mv" id="move-dst-92" data-title="function_definition/parameter">uint256 _originTokenId</span>) public returns (uint256);</span>

    function toOriginTokenId(uint256 _mirrorTokenId) public view returns (uint256);

    function approveOriginToken(address _bridge, uint256 _originTokenId) public;

    function ownerInOrigin(uint256 _originTokenId) public view returns (address);

    function cacheMirrorTokenId(uint256 _originTokenId, uint256 _mirrorTokenId) public;
}</span>

<span class="marker" id="mapping-422"></span><span class="token upd" id="move-dst-71" data-title="source_file/comment"><span class="cupd">//</span>////<span class="cupd"> </span><span class="cupd">contracts/interfaces/I</span>Pe<span class="cupd">t</span>B<span class="cupd">a</span>s<span class="cupd">e</span><span class="cupd">.sol</span></span>
<span class="marker" id="mapping-423"></span><span class="token upd" id="move-dst-72" data-title="source_file/comment"><span class="cupd">/</span>*<span class="cupd"> </span><span class="cupd">p</span><span class="cupd">r</span>agma<span class="cupd"> </span>s<span class="cupd">o</span>l<span class="cupd">i</span><span class="cupd">d</span>i<span class="cupd">t</span>y ^0<span class="cupd">.</span>4.24; */</span>

<span class="marker" id="mapping-424"></span><span class="token add" data-title="source_file/contract_declaration">contract IPetBase <span class="marker" id="mapping-425"></span><span class="token add" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-426"></span><span class="token add" data-title="contract_body/function_definition">function pet2TiedStatus(<span class="marker" id="mapping-427"></span><span class="token add" data-title="function_definition/parameter">uint256 _mirrorTokenId</span>) <span class="marker" id="mapping-428"></span><span class="token mv" id="move-dst-56" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-429"></span><span class="token add" data-title="function_definition/return_type_definition">returns (uint256, uint256)</span>;</span>
}</span></span>

<span class="marker" id="mapping-430"></span><span class="token upd" id="move-dst-73" data-title="source_file/comment"><span class="cupd">//</span>////<span class="cupd"> </span>c<span class="cupd">o</span>nt<span class="cupd">r</span>ac<span class="cupd">t</span><span class="cupd">s</span>/<span class="cupd">i</span><span class="cupd">nt</span>e<span class="cupd">r</span>f<span class="cupd">ac</span>e<span class="cupd">s/</span>ISe<span class="cupd">t</span>ti<span class="cupd">n</span>gs<span class="cupd">R</span>egistry<span class="cupd">.sol</span></span>
<span class="marker" id="mapping-431"></span><span class="token add" data-title="source_file/comment">/* pragma solidity ^0.4.24; */</span>

<span class="marker" id="mapping-432"></span><span class="token mv" id="move-dst-14" data-title="source_file/contract_declaration">contract ISettingsRegistry {
    enum SettingsValueTypes { NONE, UINT, STRING, ADDRESS, BYTES, BOOL, INT }

    function uintOf(bytes32 _propertyName) public view returns (uint256);

    function stringOf(bytes32 _propertyName) public view returns (string);

    function addressOf(bytes32 _propertyName) public view returns (address);

    function bytesOf(bytes32 _propertyName) public view returns (bytes);

    function boolOf(bytes32 _propertyName) public view returns (bool);

    function intOf(bytes32 _propertyName) public view returns (int);

    function setUintProperty(bytes32 _propertyName, uint _value) public;

    function setStringProperty(bytes32 _propertyName, string _value) public;

    function setAddressProperty(bytes32 _propertyName, address _value) public;

    function setBytesProperty(bytes32 _propertyName, bytes _value) public;

    function setBoolProperty(bytes32 _propertyName, bool _value) public;

    function setIntProperty(bytes32 _propertyName, int _value) public;

    function getValueTypeOf(bytes32 _propertyName) public view returns (uint /* SettingsValueTypes */ );

    event ChangeProperty(bytes32 indexed _propertyName, uint256 _type);
}</span>

<span class="marker" id="mapping-433"></span><span class="token add" data-title="source_file/comment">////// contracts/ERC721BridgeV2.sol</span>
<span class="marker" id="mapping-434"></span><span class="token add" data-title="source_file/comment">/* pragma solidity ^0.4.24; */</span>

<span class="marker" id="mapping-435"></span><span class="token add" data-title="source_file/comment">/* import "./PausableDSAuth.sol"; */</span>
<span class="marker" id="mapping-436"></span><span class="token add" data-title="source_file/comment">/* import "./interfaces/ISettingsRegistry.sol"; */</span>
<span class="marker" id="mapping-437"></span><span class="token add" data-title="source_file/comment">/* import "./SettingIds.sol"; */</span>
<span class="marker" id="mapping-438"></span><span class="token add" data-title="source_file/comment">/* import "./interfaces/IInterstellarEncoderV3.sol"; */</span>
<span class="marker" id="mapping-439"></span><span class="token add" data-title="source_file/comment">/* import "./interfaces/IMintableERC20.sol"; */</span>
<span class="marker" id="mapping-440"></span><span class="token add" data-title="source_file/comment">/* import "./interfaces/IBurnableERC20.sol"; */</span>
<span class="marker" id="mapping-441"></span><span class="token add" data-title="source_file/comment">/* import "./interfaces/INFTAdaptor.sol"; */</span>
<span class="marker" id="mapping-442"></span><span class="token add" data-title="source_file/comment">/* import "./interfaces/IERC1155.sol"; */</span>
<span class="marker" id="mapping-443"></span><span class="token add" data-title="source_file/comment">/* import "./interfaces/IERC1155Receiver.sol"; */</span>
<span class="marker" id="mapping-444"></span><span class="token add" data-title="source_file/comment">/* import "./interfaces/IERC721.sol"; */</span>
<span class="marker" id="mapping-445"></span><span class="token add" data-title="source_file/comment">/* import "./interfaces/IERC721Receiver.sol"; */</span>
<span class="marker" id="mapping-446"></span><span class="token add" data-title="source_file/comment">/* import "./interfaces/IPetBase.sol"; */</span>


/*
 * naming convention:
 * originTokenId - token outside evolutionLand
 * mirrorTokenId - mirror token
 */
contract <span class="marker" id="mapping-447"></span><span class="token upd" id="move-dst-74" data-title="contract_declaration/identifier"><span class="cupd">ERC721Bridge</span>V2</span> is SettingIds, PausableDSAuth<span class="marker" id="mapping-448"></span><span class="token add" data-title="contract_declaration/,">,</span> <span class="marker" id="mapping-449"></span><span class="token add" data-title="contract_declaration/inheritance_specifier">IERC721Receiver</span><span class="marker" id="mapping-450"></span><span class="token add" data-title="contract_declaration/,">,</span> <span class="marker" id="mapping-451"></span><span class="token add" data-title="contract_declaration/inheritance_specifier">IERC1155Receiver</span> {

    /*
     *  Storage
    */
    bool private singletonLock = false;

    ISettingsRegistry public registry;


    // originNFTContract =&gt; its adator
    // for instance, CryptoKitties =&gt; CryptoKittiesAdaptor
    // this need to be registered by owner
    mapping(address =&gt; address) public originNFT2Adaptor;

    // tokenId_inside =&gt; tokenId_outside
    mapping(uint256 =&gt; uint256) public mirrorId2OriginId;

    <span class="marker" id="mapping-452"></span><span class="token add" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-453"></span><span class="token add" data-title="state_variable_declaration/type_name">mapping(uint256 =&gt; uint256)</span> <span class="marker" id="mapping-454"></span><span class="token mv" id="move-dst-101" data-title="state_variable_declaration/visibility">public</span> mirrorId2OriginId1155;</span>

    /*
     *  Event
     */
    <span class="marker" id="mapping-455"></span><span class="token upd" id="move-dst-86" data-title="contract_body/comment"><span class="cupd">/</span>/<span class="cupd"> </span>event<span class="cupd"> </span>BridgeIn(uint256<span class="cupd"> </span>originTokenId,<span class="cupd"> </span>uint256<span class="cupd"> </span>mirrorTokenId,<span class="cupd"> </span>address<span class="cupd"> </span><span class="cupd">o</span>r<span class="cupd">i</span>g<span class="cupd">i</span>nContract, addr<span class="cupd">e</span>ss adapto<span class="cupd">r</span>Addre<span class="cupd">s</span>s,<span class="cupd"> </span>address owner);</span>

    <span class="marker" id="mapping-456"></span><span class="token mv" id="move-dst-82" data-title="contract_body/event_definition">event <span class="marker" id="mapping-457"></span><span class="token upd" id="move-dst-83" data-title="event_definition/identifier"><span class="cupd">Swap</span>In</span>(<span class="marker" id="mapping-458"></span><span class="token mv" id="move-dst-75" data-title="event_definition/event_paramater">address originContract</span>, <span class="marker" id="mapping-459"></span><span class="token mv" id="move-dst-84" data-title="event_definition/event_paramater">uint256 originTokenId</span>, <span class="marker" id="mapping-460"></span><span class="token mv" id="move-dst-85" data-title="event_definition/event_paramater">uint256 mirrorTokenId</span><span class="marker" id="mapping-461"></span><span class="token add" data-title="event_definition/,">,</span> address owner);</span>
    <span class="marker" id="mapping-462"></span><span class="token mv" id="move-dst-78" data-title="contract_body/event_definition">event <span class="marker" id="mapping-463"></span><span class="token upd" id="move-dst-79" data-title="event_definition/identifier"><span class="cupd">Swap</span>Out</span>(<span class="marker" id="mapping-464"></span><span class="token add" data-title="event_definition/event_paramater">address originContract</span>, <span class="marker" id="mapping-465"></span><span class="token mv" id="move-dst-80" data-title="event_definition/event_paramater">uint256 originTokenId</span>, <span class="marker" id="mapping-466"></span><span class="token mv" id="move-dst-81" data-title="event_definition/event_paramater">uint256 mirrorTokenId</span><span class="marker" id="mapping-467"></span><span class="token add" data-title="event_definition/,">,</span> address owner);</span>

    function registerAdaptor(address _originNftAddress, address _erc721Adaptor) public whenNotPaused onlyOwner {
        originNFT2Adaptor[_originNftAddress] = _erc721Adaptor;
    }

    function <span class="marker" id="mapping-468"></span><span class="token upd" id="move-dst-144" data-title="function_definition/identifier"><span class="cupd">swapOut</span>721</span>(uint256 _mirrorTokenId) public  {
        IInterstellarEncoderV3 interstellarEncoder = IInterstellarEncoderV3(registry.addressOf(SettingIds.CONTRACT_INTERSTELLAR_ENCODER));
        <span class="marker" id="mapping-469"></span><span class="token add" data-title="function_body/variable_declaration_statement">address nftContract = interstellarEncoder.getOriginAddress(_mirrorTokenId);</span>
        require(nftContract != address(0), "No such NFT contract");
        address adaptor = originNFT2Adaptor[nftContract];
        require(adaptor != address(0), "not registered!");
        require(ownerOfMirror(_mirrorTokenId) == msg.sender, "you have no right to swap it out!");

        <span class="marker" id="mapping-470"></span><span class="token add" data-title="function_body/variable_declaration_statement">address petBase = registry.addressOf(SettingIds.CONTRACT_PET_BASE);</span>
        <span class="marker" id="mapping-471"></span><span class="token add" data-title="function_body/variable_declaration_statement">(uint256 apostleTokenId,) = IPetBase(petBase).pet2TiedStatus(_mirrorTokenId);</span>
        <span class="marker" id="mapping-472"></span><span class="token add" data-title="function_body/expression_statement">require(apostleTokenId == 0, "Pet has been tied.");</span>
        uint256 originTokenId = mirrorId2OriginId[_mirrorTokenId];
        address objectOwnership = registry.addressOf(SettingIds.CONTRACT_OBJECT_OWNERSHIP);
        <span class="marker" id="mapping-473"></span><span class="token add" data-title="function_body/variable_declaration_statement">address owner = IERC721(objectOwnership).ownerOf(_mirrorTokenId);</span>
        <span class="marker" id="mapping-474"></span><span class="token add" data-title="function_body/if_statement">if (<span class="marker" id="mapping-475"></span><span class="token add" data-title="if_statement/binary_expression">owner != address(this)</span>) <span class="marker" id="mapping-476"></span><span class="token add" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-477"></span><span class="token add" data-title="block_statement/expression_statement"><span class="marker" id="mapping-478"></span><span class="token add" data-title="expression_statement/call_expression"><span class="marker" id="mapping-479"></span><span class="token add" data-title="call_expression/member_expression">IERC721(nftContract).approve</span>(<span class="marker" id="mapping-480"></span><span class="token mv" id="move-dst-150" data-title="call_expression/call_argument">address(this)</span>, <span class="marker" id="mapping-481"></span><span class="token add" data-title="call_expression/call_argument">originTokenId</span>)</span>;</span> // kitty must approve first 
            <span class="marker" id="mapping-482"></span><span class="token add" data-title="block_statement/expression_statement"><span class="marker" id="mapping-483"></span><span class="token add" data-title="expression_statement/call_expression"><span class="marker" id="mapping-484"></span><span class="token add" data-title="call_expression/member_expression">IERC721(nftContract).transferFrom</span>(<span class="marker" id="mapping-485"></span><span class="token mv" id="move-dst-117" data-title="call_expression/call_argument">address(this)</span>, <span class="marker" id="mapping-486"></span><span class="token mv" id="move-dst-104" data-title="call_expression/call_argument">msg.sender</span>, <span class="marker" id="mapping-487"></span><span class="token add" data-title="call_expression/call_argument">originTokenId</span>)</span>;</span>
        }</span></span>
        <span class="marker" id="mapping-488"></span><span class="token upd" id="move-dst-148" data-title="call_expression/identifier">IBurnable<span class="cupd">ERC</span>20</span>(objectOwnership).<span class="marker" id="mapping-489"></span><span class="token upd" id="move-dst-149" data-title="member_expression/identifier">bu<span class="cupd">r</span>n</span>(<span class="marker" id="mapping-490"></span><span class="token add" data-title="call_expression/call_argument">owner</span>, <span class="marker" id="mapping-491"></span><span class="token add" data-title="call_expression/call_argument">_mirrorTokenId</span>);
        <span class="marker" id="mapping-492"></span><span class="token add" data-title="function_body/expression_statement">delete mirrorId2OriginId[_mirrorTokenId];</span>
        <span class="marker" id="mapping-493"></span><span class="token mv" id="move-dst-139" data-title="function_body/emit_statement">emit <span class="marker" id="mapping-494"></span><span class="token upd" id="move-dst-140" data-title="emit_statement/identifier"><span class="cupd">Swap</span>Out</span>(<span class="marker" id="mapping-495"></span><span class="token upd" id="move-dst-141" data-title="call_argument/identifier"><span class="cupd">n</span>ftC<span class="cupd">o</span>ntract</span>, <span class="marker" id="mapping-496"></span><span class="token add" data-title="emit_statement/call_argument">originTokenId</span>, <span class="marker" id="mapping-497"></span><span class="token add" data-title="emit_statement/call_argument">_mirrorTokenId</span><span class="marker" id="mapping-498"></span><span class="token add" data-title="emit_statement/,">,</span> msg.sender);</span>
    }

	<span class="marker" id="mapping-499"></span><span class="token mv" id="move-dst-91" data-title="contract_body/comment"><span class="marker" id="mapping-500"></span><span class="token upd" id="move-dst-91" data-title="contract_body/comment"><span class="cupd">// </span>V2 a<span class="cupd">d</span>d<span class="cupd"> </span>-<span class="cupd"> </span>Support <span class="cupd">P</span>olkaP<span class="cupd">et</span></span></span>
    <span class="marker" id="mapping-501"></span><span class="token add" data-title="contract_body/function_definition">function swapOut1155(<span class="marker" id="mapping-502"></span><span class="token add" data-title="function_definition/parameter">uint256 _mirrorTokenId</span>) <span class="marker" id="mapping-503"></span><span class="token mv" id="move-dst-88" data-title="function_definition/visibility">public</span>  <span class="marker" id="mapping-504"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-505"></span><span class="token add" data-title="function_body/variable_declaration_statement">IInterstellarEncoderV3 interstellarEncoder = IInterstellarEncoderV3(registry.addressOf(SettingIds.CONTRACT_INTERSTELLAR_ENCODER));</span>
        <span class="marker" id="mapping-506"></span><span class="token mv" id="move-dst-145" data-title="function_body/variable_declaration_statement">address nftContract = interstellarEncoder.<span class="marker" id="mapping-507"></span><span class="token upd" id="move-dst-146" data-title="member_expression/identifier"><span class="cupd">get</span>Origi<span class="cupd">n</span><span class="cupd">Address</span></span>(<span class="marker" id="mapping-508"></span><span class="token mv" id="move-dst-161" data-title="call_expression/call_argument">_mirrorTokenId</span>);</span>
        <span class="marker" id="mapping-509"></span><span class="token add" data-title="function_body/expression_statement">require(nftContract != address(0), "No such NFT contract");</span>
        <span class="marker" id="mapping-510"></span><span class="token add" data-title="function_body/variable_declaration_statement">address adaptor = originNFT2Adaptor[nftContract];</span>
        <span class="marker" id="mapping-511"></span><span class="token add" data-title="function_body/expression_statement">require(adaptor != address(0), "not registered!");</span>
        <span class="marker" id="mapping-512"></span><span class="token add" data-title="function_body/variable_declaration_statement">address objectOwnership = registry.addressOf(SettingIds.CONTRACT_OBJECT_OWNERSHIP);</span>
        <span class="marker" id="mapping-513"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-514"></span><span class="token add" data-title="expression_statement/call_expression">require(<span class="marker" id="mapping-515"></span><span class="token add" data-title="call_expression/call_argument"><span class="marker" id="mapping-516"></span><span class="token add" data-title="call_argument/binary_expression"><span class="marker" id="mapping-517"></span><span class="token add" data-title="binary_expression/call_expression">IERC721(objectOwnership).ownerOf(_mirrorTokenId)</span> == <span class="marker" id="mapping-518"></span><span class="token mv" id="move-dst-127" data-title="binary_expression/member_expression">msg.sender</span></span></span>, <span class="marker" id="mapping-519"></span><span class="token mv" id="move-dst-111" data-title="call_expression/call_argument">"you have no right to swap it out!"</span>)</span>;</span>

        <span class="marker" id="mapping-520"></span><span class="token add" data-title="function_body/variable_declaration_statement">address petBase = registry.addressOf(SettingIds.CONTRACT_PET_BASE);</span>
        <span class="marker" id="mapping-521"></span><span class="token add" data-title="function_body/variable_declaration_statement">(uint256 apostleTokenId,) = IPetBase(petBase).pet2TiedStatus(_mirrorTokenId);</span>
        <span class="marker" id="mapping-522"></span><span class="token add" data-title="function_body/expression_statement">require(apostleTokenId == 0, "Pet has been tied.");</span>
        <span class="marker" id="mapping-523"></span><span class="token add" data-title="function_body/variable_declaration_statement">uint256 originTokenId = mirrorId2OriginId1155[_mirrorTokenId];</span>
        <span class="marker" id="mapping-524"></span><span class="token mv" id="move-dst-133" data-title="function_body/expression_statement"><span class="marker" id="mapping-525"></span><span class="token upd" id="move-dst-134" data-title="call_expression/identifier">IBurnable<span class="cupd">ERC</span>20</span>(objectOwnership).<span class="marker" id="mapping-526"></span><span class="token upd" id="move-dst-135" data-title="member_expression/identifier">bu<span class="cupd">r</span>n</span>(msg.sender<span class="marker" id="mapping-527"></span><span class="token mv" id="move-dst-137" data-title="call_expression/,">,</span> <span class="marker" id="mapping-528"></span><span class="token mv" id="move-dst-151" data-title="call_expression/call_argument">_mirrorTokenId</span>);</span>
        <span class="marker" id="mapping-529"></span><span class="token mv" id="move-dst-152" data-title="function_body/expression_statement"><span class="marker" id="mapping-530"></span><span class="token upd" id="move-dst-153" data-title="call_expression/identifier">I<span class="cupd">ERC</span>1155</span>(nftContract).<span class="marker" id="mapping-531"></span><span class="token upd" id="move-dst-154" data-title="member_expression/identifier">safeT<span class="cupd">ransferFrom</span></span>(address(this), msg.sender, originTokenId<span class="marker" id="mapping-532"></span><span class="token add" data-title="call_expression/,">,</span> <span class="marker" id="mapping-533"></span><span class="token add" data-title="call_expression/call_argument">1</span><span class="marker" id="mapping-534"></span><span class="token add" data-title="call_expression/,">,</span> <span class="marker" id="mapping-535"></span><span class="token add" data-title="call_expression/call_argument">""</span>);</span>
        <span class="marker" id="mapping-536"></span><span class="token add" data-title="function_body/expression_statement">delete mirrorId2OriginId1155[_mirrorTokenId];</span>
        <span class="marker" id="mapping-537"></span><span class="token mv" id="move-dst-155" data-title="function_body/emit_statement">emit SwapOut(<span class="marker" id="mapping-538"></span><span class="token add" data-title="emit_statement/call_argument">nftContract</span>, <span class="marker" id="mapping-539"></span><span class="token mv" id="move-dst-156" data-title="emit_statement/call_argument">originTokenId</span>, <span class="marker" id="mapping-540"></span><span class="token mv" id="move-dst-157" data-title="emit_statement/call_argument">_mirrorTokenId</span><span class="marker" id="mapping-541"></span><span class="token add" data-title="emit_statement/,">,</span> msg.sender);</span>
    }</span></span>

    function ownerOf(uint256 _mirrorTokenId) public view returns (address) {
        return ownerOfMirror(_mirrorTokenId);
    }

    // return human owner of the token
    function mirrorOfOrigin(address _originNFT, uint256 _originTokenId) public view returns (uint256) {
        INFTAdaptor adapter = INFTAdaptor(originNFT2Adaptor[_originNFT]);

        return adapter.toMirrorTokenId(_originTokenId);
    }

    // return human owner of the token
    function ownerOfMirror(uint256 _mirrorTokenId) public view returns (address) {
        address objectOwnership = registry.addressOf(SettingIds.CONTRACT_OBJECT_OWNERSHIP);
        address owner = <span class="marker" id="mapping-542"></span><span class="token upd" id="move-dst-160" data-title="call_expression/identifier">I<span class="cupd">ERC721</span></span>(objectOwnership).ownerOf(<span class="marker" id="mapping-543"></span><span class="token mv" id="move-dst-147" data-title="call_expression/call_argument">_mirrorTokenId</span>);
        if(owner != address(this)) {
            return owner;
        } else {
            uint originTokenId = mirrorId2OriginId[_mirrorTokenId];
            return INFTAdaptor(originNFT2Adaptor[originOwnershipAddress(_mirrorTokenId)]).ownerInOrigin(originTokenId);
        }
    }

    function originOwnershipAddress(uint256 _mirrorTokenId) public view returns (address) {
        IInterstellarEncoderV3 interstellarEncoder = IInterstellarEncoderV3(registry.addressOf(SettingIds.CONTRACT_INTERSTELLAR_ENCODER));

        return interstellarEncoder.getOriginAddress(_mirrorTokenId);
    }

    function isBridged(uint256 _mirrorTokenId) public view returns (bool) {
        return (mirrorId2OriginId[_mirrorTokenId] != 0);
    }

    <span class="marker" id="mapping-544"></span><span class="token mv" id="move-dst-100" data-title="contract_body/comment"><span class="marker" id="mapping-545"></span><span class="token upd" id="move-dst-100" data-title="contract_body/comment"><span class="cupd">// </span>V2 <span class="cupd">a</span>dd<span class="cupd"> </span>-<span class="cupd"> </span>Supp<span class="cupd">or</span>t<span class="cupd"> </span>P<span class="cupd">o</span>l<span class="cupd">k</span>aP<span class="cupd">e</span>t</span></span>
    <span class="marker" id="mapping-546"></span><span class="token mv" id="move-dst-125" data-title="contract_body/function_definition">function <span class="marker" id="mapping-547"></span><span class="token upd" id="move-dst-126" data-title="function_definition/identifier"><span class="cupd">swapIn</span>1155</span>(address _originNftAddress, uint256 _originTokenId<span class="marker" id="mapping-548"></span><span class="token add" data-title="function_definition/,">,</span> <span class="marker" id="mapping-549"></span><span class="token add" data-title="function_definition/parameter">uint256 _value</span>) public <span class="marker" id="mapping-550"></span><span class="token add" data-title="function_definition/modifier_invocation">whenNotPaused()</span> {
        <span class="marker" id="mapping-551"></span><span class="token mv" id="move-dst-131" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-552"></span><span class="token add" data-title="primitive_type/address">address</span> <span class="marker" id="mapping-553"></span><span class="token upd" id="move-dst-132" data-title="variable_declaration/identifier">_f<span class="cupd">r</span>om</span> = <span class="marker" id="mapping-554"></span><span class="token mv" id="move-dst-89" data-title="variable_declaration_statement/member_expression">msg.sender</span>;</span>
        <span class="marker" id="mapping-555"></span><span class="token add" data-title="call_expression/member_expression"><span class="marker" id="mapping-556"></span><span class="token add" data-title="member_expression/call_expression">IERC1155(<span class="marker" id="mapping-557"></span><span class="token mv" id="move-dst-102" data-title="call_expression/call_argument">_originNftAddress</span>)</span>.safeTransferFrom</span>(<span class="marker" id="mapping-558"></span><span class="token add" data-title="call_expression/call_argument">_from</span>, <span class="marker" id="mapping-559"></span><span class="token mv" id="move-dst-136" data-title="call_expression/call_argument">address(this)</span><span class="marker" id="mapping-560"></span><span class="token add" data-title="call_expression/,">,</span> <span class="marker" id="mapping-561"></span><span class="token mv" id="move-dst-103" data-title="call_expression/call_argument">_originTokenId</span><span class="marker" id="mapping-562"></span><span class="token add" data-title="call_expression/,">,</span> <span class="marker" id="mapping-563"></span><span class="token add" data-title="call_expression/call_argument">_value</span><span class="marker" id="mapping-564"></span><span class="token add" data-title="call_expression/,">,</span> <span class="marker" id="mapping-565"></span><span class="token add" data-title="call_expression/call_argument">""</span>);
        address adaptor = originNFT2Adaptor[_originNftAddress];
        require(adaptor != address(0), "Not registered!");
        address objectOwnership = registry.addressOf(SettingIds.CONTRACT_OBJECT_OWNERSHIP);
        <span class="marker" id="mapping-566"></span><span class="token add" data-title="function_body/for_statement">for (<span class="marker" id="mapping-567"></span><span class="token add" data-title="for_statement/variable_declaration_statement">uint256 i = 0;</span> <span class="marker" id="mapping-568"></span><span class="token add" data-title="for_statement/expression_statement">i &lt; _value;</span> <span class="marker" id="mapping-569"></span><span class="token add" data-title="for_statement/update_expression">i++</span>) <span class="marker" id="mapping-570"></span><span class="token mv" id="move-dst-113" data-title="for_statement/block_statement">{
            <span class="marker" id="mapping-571"></span><span class="token add" data-title="block_statement/variable_declaration_statement"><span class="marker" id="mapping-572"></span><span class="token add" data-title="variable_declaration_statement/variable_declaration">uint256 mirrorTokenId</span> = <span class="marker" id="mapping-573"></span><span class="token mv" id="move-dst-109" data-title="variable_declaration_statement/call_expression">INFTAdaptor(adaptor).<span class="marker" id="mapping-574"></span><span class="token upd" id="move-dst-110" data-title="member_expression/identifier">t<span class="cupd">o</span>MirrorToke<span class="cupd">n</span><span class="cupd">I</span>dA<span class="cupd">n</span>dIncrease</span>(_originTokenId)</span>;</span>
            IMintableERC20(objectOwnership).mint(<span class="marker" id="mapping-575"></span><span class="token add" data-title="call_expression/call_argument">_from</span>, mirrorTokenId);
            <span class="marker" id="mapping-576"></span><span class="token add" data-title="block_statement/expression_statement">mirrorId2OriginId1155[mirrorTokenId] = _originTokenId;</span>
            <span class="marker" id="mapping-577"></span><span class="token mv" id="move-dst-115" data-title="block_statement/comment"><span class="marker" id="mapping-578"></span><span class="token upd" id="move-dst-115" data-title="block_statement/comment"><span class="cupd">// </span><span class="cupd">e</span>mit Bridg<span class="cupd">e</span>I<span class="cupd">n</span>(_originTok<span class="cupd">e</span>nId,<span class="cupd"> mirror</span>T<span class="cupd">o</span>k<span class="cupd">e</span>nId,<span class="cupd"> </span>_or<span class="cupd">i</span>gi<span class="cupd">n</span>Nf<span class="cupd">t</span>Addre<span class="cupd">s</span>s,<span class="cupd"> </span>adapt<span class="cupd">o</span>r, _from);</span></span>
            <span class="marker" id="mapping-579"></span><span class="token add" data-title="block_statement/emit_statement">emit SwapIn(<span class="marker" id="mapping-580"></span><span class="token mv" id="move-dst-96" data-title="emit_statement/call_argument">_originNftAddress</span>, <span class="marker" id="mapping-581"></span><span class="token mv" id="move-dst-97" data-title="emit_statement/call_argument">_originTokenId</span>, <span class="marker" id="mapping-582"></span><span class="token mv" id="move-dst-142" data-title="emit_statement/call_argument">mirrorTokenId</span>, <span class="marker" id="mapping-583"></span><span class="token add" data-title="emit_statement/call_argument">_from</span>);</span>
        }</span></span>
    }</span>

    <span class="marker" id="mapping-584"></span><span class="token mv" id="move-dst-105" data-title="contract_body/function_definition">function <span class="marker" id="mapping-585"></span><span class="token upd" id="move-dst-106" data-title="function_definition/identifier">swap<span class="cupd">In</span>721</span>(address _originNftAddress, uint256 _originTokenId) <span class="marker" id="mapping-586"></span><span class="token mv" id="move-dst-95" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-587"></span><span class="token add" data-title="function_definition/modifier_invocation">whenNotPaused()</span> {
        <span class="marker" id="mapping-588"></span><span class="token add" data-title="function_body/variable_declaration_statement">address _owner = msg.sender;</span>
        <span class="marker" id="mapping-589"></span><span class="token mv" id="move-dst-129" data-title="function_body/expression_statement"><span class="marker" id="mapping-590"></span><span class="token upd" id="move-dst-130" data-title="call_expression/identifier">I<span class="cupd">ERC721</span></span>(_originNftAddress).transferFrom(<span class="marker" id="mapping-591"></span><span class="token mv" id="move-dst-98" data-title="call_expression/call_argument">_owner</span>, address(this), _originTokenId);</span>
        address adaptor = originNFT2Adaptor[_originNftAddress];
        require(adaptor != address(0), "Not registered!");
        uint256 mirrorTokenId = INFTAdaptor(adaptor).toMirrorTokenId(_originTokenId);
        <span class="marker" id="mapping-592"></span><span class="token mv" id="move-dst-116" data-title="function_body/variable_declaration_statement">address objectOwnership = registry.addressOf(SettingIds.CONTRACT_OBJECT_OWNERSHIP);</span>
        <span class="marker" id="mapping-593"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-594"></span><span class="token add" data-title="expression_statement/call_expression">require(<span class="marker" id="mapping-595"></span><span class="token add" data-title="call_expression/call_argument"><span class="marker" id="mapping-596"></span><span class="token mv" id="move-dst-112" data-title="call_argument/unary_expression">!isBridged(mirrorTokenId)</span></span>, <span class="marker" id="mapping-597"></span><span class="token mv" id="move-dst-128" data-title="call_expression/call_argument">"Already swap in"</span>)</span>;</span>
        <span class="marker" id="mapping-598"></span><span class="token mv" id="move-dst-118" data-title="function_body/expression_statement">INFTAdaptor(adaptor).cacheMirrorTokenId(_originTokenId, mirrorTokenId);</span>
        <span class="marker" id="mapping-599"></span><span class="token mv" id="move-dst-119" data-title="function_body/expression_statement">mirrorId2OriginId[mirrorTokenId] = _originTokenId;</span>
        <span class="marker" id="mapping-600"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-601"></span><span class="token add" data-title="expression_statement/call_expression"><span class="marker" id="mapping-602"></span><span class="token add" data-title="call_expression/member_expression">IMintableERC20(objectOwnership).mint</span>(<span class="marker" id="mapping-603"></span><span class="token add" data-title="call_expression/call_argument">_owner</span>, <span class="marker" id="mapping-604"></span><span class="token mv" id="move-dst-138" data-title="call_expression/call_argument">mirrorTokenId</span>)</span>;</span>
        <span class="marker" id="mapping-605"></span><span class="token mv" id="move-dst-120" data-title="function_body/emit_statement">emit <span class="marker" id="mapping-606"></span><span class="token upd" id="move-dst-121" data-title="emit_statement/identifier">Swap<span class="cupd">In</span></span>(<span class="marker" id="mapping-607"></span><span class="token mv" id="move-dst-124" data-title="emit_statement/call_argument">_originNftAddress</span>, <span class="marker" id="mapping-608"></span><span class="token mv" id="move-dst-122" data-title="emit_statement/call_argument">_originTokenId</span>, <span class="marker" id="mapping-609"></span><span class="token mv" id="move-dst-123" data-title="emit_statement/call_argument">mirrorTokenId</span>, _owner);</span>
    }</span>

    <span class="marker" id="mapping-610"></span><span class="token mv" id="move-dst-158" data-title="contract_body/function_definition">function <span class="marker" id="mapping-611"></span><span class="token upd" id="move-dst-159" data-title="function_definition/identifier"><span class="cupd">o</span>nERC721R<span class="cupd">e</span>ce<span class="cupd">i</span>ved</span>(
      address <span class="marker" id="mapping-612"></span><span class="token add" data-title="function_definition/comment">/*_operator*/</span>,
      address <span class="marker" id="mapping-613"></span><span class="token add" data-title="function_definition/comment">/*_from*/</span>,
      <span class="marker" id="mapping-614"></span><span class="token add" data-title="function_definition/parameter">uint256</span> <span class="marker" id="mapping-615"></span><span class="token add" data-title="function_definition/comment">/*_tokenId*/</span><span class="marker" id="mapping-616"></span><span class="token add" data-title="function_definition/,">,</span>
      <span class="marker" id="mapping-617"></span><span class="token add" data-title="function_definition/parameter">bytes</span> <span class="marker" id="mapping-618"></span><span class="token add" data-title="function_definition/comment">/*_data*/</span>
    )
      public 
      <span class="marker" id="mapping-619"></span><span class="token add" data-title="function_definition/return_type_definition">returns(bytes4)</span> 
    {
        <span class="marker" id="mapping-620"></span><span class="token add" data-title="function_body/return_statement">return ERC721_RECEIVED;</span>
    }</span>

    <span class="marker" id="mapping-621"></span><span class="token add" data-title="contract_body/function_definition">function onERC1155Received(
      <span class="marker" id="mapping-622"></span><span class="token add" data-title="function_definition/parameter">address</span> /*operator*/,
      <span class="marker" id="mapping-623"></span><span class="token mv" id="move-dst-107" data-title="function_definition/parameter">address</span> /*from*/,
      <span class="marker" id="mapping-624"></span><span class="token add" data-title="function_definition/parameter">uint256</span> /*id*/,
      <span class="marker" id="mapping-625"></span><span class="token add" data-title="function_definition/parameter">uint256</span> /*value*/,
      <span class="marker" id="mapping-626"></span><span class="token add" data-title="function_definition/parameter">bytes</span> /*data*/
    )
      <span class="marker" id="mapping-627"></span><span class="token add" data-title="function_definition/visibility">external</span>
      <span class="marker" id="mapping-628"></span><span class="token add" data-title="function_definition/return_type_definition">returns(bytes4)</span>
    <span class="marker" id="mapping-629"></span><span class="token add" data-title="function_definition/function_body">{
        return ERC1155_RECEIVED_VALUE; 
    }</span></span>

    <span class="marker" id="mapping-630"></span><span class="token add" data-title="contract_body/function_definition">function onERC1155BatchReceived(
      address /*operator*/,
      address /*from*/,
      uint256[] /*ids*/,
      uint256[] /*values*/,
      bytes /*data*/
    )
      external
      returns(bytes4)
    {
        return ERC1155_BATCH_RECEIVED_VALUE;	
    }</span>
}</pre></div></div></div></body></html>