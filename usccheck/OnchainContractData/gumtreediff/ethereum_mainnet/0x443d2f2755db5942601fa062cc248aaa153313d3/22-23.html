<html lang="en"><head><meta charset="utf8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>GumTree</title><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><style type="text/css">/*
 * This file is part of GumTree.
 *
 * GumTree is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * GumTree is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with GumTree.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Copyright 2011-2015 Jean-Rémy Falleri <jr.falleri@gmail.com>
 * Copyright 2011-2015 Floréal Morandat <florealm@gmail.com>
 */

.add {
	border: 1px solid black;
	background-color: MediumSeaGreen;
}

.del {
	border: 1px solid black;
	background-color: IndianRed;
}

.mv {
	border: 1px solid black;
	background-color: Plum;
}

.upd {
	border: 1px solid black;
	background-color: DarkOrange;
	font-weight: bold;
}

.cupd {
	font-weight: normal;
	color: DimGray;
}

.selected {
	background-color: Gold;
}

.marker {
	margin: 0;
	padding: 0;
}

div {
	margin: 0px;
	padding: 0px;
}

.pre-scrollable {
	margin: 0px;
	padding: 0px;
	font-size: 10pt;
	color: black;
	max-height: 90vh;
	background-color: white;
	border: 1px solid black;
	font-family: "Hack, Inconsolata", "Consolas", "Liberation Sans Regular", "DejaVu Sans Mono", monospace;
}

.tooltip-inner {
    max-width: none;
}
</style><script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script><script type="text/javascript">/*
 * This file is part of GumTree.
 *
 * GumTree is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * GumTree is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with GumTree.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Copyright 2011-2015 Jean-Rémy Falleri <jr.falleri@gmail.com>
 * Copyright 2011-2015 Floréal Morandat <florealm@gmail.com>
 */

$(function(){
    let popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
    let popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
      return new bootstrap.Popover(popoverTriggerEl)
    })

    $("body").keypress(function (event) {
        switch (event.which) {
            case 116:
                $('html, body').animate({scrollTop: 0}, 100);
                break;
            case 98:
                $("html, body").animate({ scrollTop: $(document).height() }, 100);
                break;
            case 113:
                window.location = "/quit";
                break;
            case 108:
                window.location = "/list";
                break;
        }
    });
});
</script><script type="text/javascript">/*
 * This file is part of GumTree.
 *
 * GumTree is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * GumTree is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with GumTree.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Copyright 2011-2015 Jean-Rémy Falleri <jr.falleri@gmail.com>
 * Copyright 2011-2015 Floréal Morandat <florealm@gmail.com>
 */

currentMapping = 0;

if (typeof String.prototype.startsWith != 'function') {
  String.prototype.startsWith = function (str){
    return this.slice(0, str.length) == str;
  };
}

function getMappedElement(eltId) {
	if (eltId.startsWith("move-src")) {
		return eltId.replace("src","dst");  	 	
  	}
  	else {
  		return eltId.replace("dst","src");
  	}
}

function nextMapping() {
	if (currentMapping == 0) {
		currentMapping = 1;
		return "#mapping-" + currentMapping.toString();
	} else {
		currentMapping++;
		
		if ($("#mapping-" + currentMapping.toString()).length > 0) {
			return "#mapping-" + currentMapping.toString();
		} else {
			currentMapping = 1;
			return "#mapping-" + currentMapping.toString();		
		}		
	}
}

function isSrc(eltId) {
	return eltId.startsWith("move-src");
}

$(function() {
    $("body").keypress(function (event) {
        switch(event.which) {
            case 110:
                const mapping = $(nextMapping());
                const pre = mapping.closest("pre");
                pre.animate({scrollTop: pre.scrollTop() + mapping.position().top - 200}, 100);
                break;
        }
    });

    // highlight
    $("span.mv.token, span.token.upd").click(function(event) {
        if ($(this).hasClass("selected")) {
            $("span.mv.token, span.token.upd").removeClass("selected");
        } else {
            $("span.mv.token, span.token.upd").removeClass("selected");
            const refElt = $("#" + getMappedElement($(this).attr("id")));
            $(this).addClass("selected");
            refElt.addClass("selected");
            const pre = refElt.closest("pre");
            console.log(pre);
            pre.animate({scrollTop: pre.scrollTop() + refElt.position().top - 200}, 100);
        }
        event.stopPropagation();
    });
    
    $("span.add.token, span.token.del").click(function(event) {
        $("span.mv.token, span.token.upd").removeClass("selected");
        event.stopPropagation();
    });

    // tooltip
    $("span.token").hover(
    	function (event) {
    		$(this).tooltip('show');
    		event.stopPropagation();
    	},
    	function (event) {
    		$(this).tooltip('hide');
    		event.stopPropagation();
    	}
    );
});
</script></head><body><div class="container-fluid"><div class="row"><div class="col"><div class="btn-toolbar justify-content-end"><div class="btn-group mr-2"><button class="btn btn-primary btn-sm" id="legend" data-bs-toggle="popover" data-bs-placement="bottom" data-bs-html="true" data-bs-content="<span class='del'>&nbsp;&nbsp;</span> deleted<br><span class='add'>&nbsp;&nbsp;</span> added<br><span class='mv'>&nbsp;&nbsp;</span> moved<br><span class='upd';>&nbsp;&nbsp;</span> updated<br>">Legend</button><button class="btn btn-primary btn-sm" id="shortcuts" data-bs-toggle="popover" data-bs-placement="bottom" data-bs-html="true" data-bs-content="<b>q</b> quit<br><b>l</b> list<br><b>n</b> next<br><b>t</b> top<br><b>b</b> bottom">Shortcuts</button></div><div class="btn-group"><a href="/list" class="btn btn-default btn-sm btn-primary">Back</a><a href="/quit" class="btn btn-default btn-sm btn-danger">Quit</a></div></div></div></div><div class="row"><div class="col-6"><h5>flat.sol</h5><pre class="pre-scrollable">pragma solidity ^0.5.17;
pragma experimental ABIEncoderV2;

/**
 * @dev Wrappers over Solidity's arithmetic operations with added overflow
 * checks.
 *
 * Arithmetic operations in Solidity wrap on overflow. This can easily result
 * in bugs, because programmers usually assume that an overflow raises an
 * error, which is the standard behavior in high level programming languages.
 * `SafeMath` restores this intuition by reverting the transaction when an
 * operation overflows.
 *
 * Using this library instead of the unchecked operations eliminates an entire
 * class of bugs, so it's recommended to use it always.
 */
library SafeMath {
    /**
     * @dev Returns the addition of two unsigned integers, reverting on
     * overflow.
     *
     * Counterpart to Solidity's `+` operator.
     *
     * Requirements:
     * - Addition cannot overflow.
     */
    function add(uint256 a, uint256 b) internal pure returns (uint256) {
        uint256 c = a + b;
        require(c &gt;= a, "SafeMath: addition overflow");

        return c;
    }

    /**
     * @dev Returns the subtraction of two unsigned integers, reverting on
     * overflow (when the result is negative).
     *
     * Counterpart to Solidity's `-` operator.
     *
     * Requirements:
     * - Subtraction cannot overflow.
     */
    function sub(uint256 a, uint256 b) internal pure returns (uint256) {
        return sub(a, b, "SafeMath: subtraction overflow");
    }

    /**
     * @dev Returns the subtraction of two unsigned integers, reverting with custom message on
     * overflow (when the result is negative).
     *
     * Counterpart to Solidity's `-` operator.
     *
     * Requirements:
     * - Subtraction cannot overflow.
     *
     * _Available since v2.4.0._
     */
    function sub(uint256 a, uint256 b, string memory errorMessage) internal pure returns (uint256) {
        require(b &lt;= a, errorMessage);
        uint256 c = a - b;

        return c;
    }

    /**
     * @dev Returns the multiplication of two unsigned integers, reverting on
     * overflow.
     *
     * Counterpart to Solidity's `*` operator.
     *
     * Requirements:
     * - Multiplication cannot overflow.
     */
    function mul(uint256 a, uint256 b) internal pure returns (uint256) {
        // Gas optimization: this is cheaper than requiring 'a' not being zero, but the
        // benefit is lost if 'b' is also tested.
        // See: https://github.com/OpenZeppelin/openzeppelin-contracts/pull/522
        if (a == 0) {
            return 0;
        }

        uint256 c = a * b;
        require(c / a == b, "SafeMath: multiplication overflow");

        return c;
    }

    /**
     * @dev Returns the integer division of two unsigned integers. Reverts on
     * division by zero. The result is rounded towards zero.
     *
     * Counterpart to Solidity's `/` operator. Note: this function uses a
     * `revert` opcode (which leaves remaining gas untouched) while Solidity
     * uses an invalid opcode to revert (consuming all remaining gas).
     *
     * Requirements:
     * - The divisor cannot be zero.
     */
    function div(uint256 a, uint256 b) internal pure returns (uint256) {
        return div(a, b, "SafeMath: division by zero");
    }

    /**
     * @dev Returns the integer division of two unsigned integers. Reverts with custom message on
     * division by zero. The result is rounded towards zero.
     *
     * Counterpart to Solidity's `/` operator. Note: this function uses a
     * `revert` opcode (which leaves remaining gas untouched) while Solidity
     * uses an invalid opcode to revert (consuming all remaining gas).
     *
     * Requirements:
     * - The divisor cannot be zero.
     *
     * _Available since v2.4.0._
     */
    function div(uint256 a, uint256 b, string memory errorMessage) internal pure returns (uint256) {
        // Solidity only automatically asserts when dividing by 0
        require(b &gt; 0, errorMessage);
        uint256 c = a / b;
        // assert(a == b * c + a % b); // There is no case in which this doesn't hold

        return c;
    }

    /**
     * @dev Returns the remainder of dividing two unsigned integers. (unsigned integer modulo),
     * Reverts when dividing by zero.
     *
     * Counterpart to Solidity's `%` operator. This function uses a `revert`
     * opcode (which leaves remaining gas untouched) while Solidity uses an
     * invalid opcode to revert (consuming all remaining gas).
     *
     * Requirements:
     * - The divisor cannot be zero.
     */
    function mod(uint256 a, uint256 b) internal pure returns (uint256) {
        return mod(a, b, "SafeMath: modulo by zero");
    }

    /**
     * @dev Returns the remainder of dividing two unsigned integers. (unsigned integer modulo),
     * Reverts with custom message when dividing by zero.
     *
     * Counterpart to Solidity's `%` operator. This function uses a `revert`
     * opcode (which leaves remaining gas untouched) while Solidity uses an
     * invalid opcode to revert (consuming all remaining gas).
     *
     * Requirements:
     * - The divisor cannot be zero.
     *
     * _Available since v2.4.0._
     */
    function mod(uint256 a, uint256 b, string memory errorMessage) internal pure returns (uint256) {
        require(b != 0, errorMessage);
        return a % b;
    }
}


<span class="marker" id="mapping-1"></span><span class="token mv" id="move-src-1" data-title="source_file/comment">/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/</span>


<span class="marker" id="mapping-2"></span><span class="token mv" id="move-src-2" data-title="source_file/contract_declaration">contract IDAO {
    function epoch() external view returns (uint256);

    event TokenSplitSnapshot(uint256 totalBonded, uint256 totalStake);

    /* Regulator */
    event SupplyIncrease(uint256 indexed epoch, uint256 price, uint256 newRedeemable, uint256 lessDebt, uint256 newBonded);
    event SupplyDecrease(uint256 indexed epoch, uint256 price, uint256 newDebt);
    event SupplyNeutral(uint256 indexed epoch);

    /* Stabilizer */
    event StabilityReward(uint256 indexed epoch, uint256 rate, uint256 amount);

    /* Bonding */
    event Deposit(address indexed account, uint256 value);
    event Withdraw(address indexed account, uint256 value);
    event Bond(address indexed account, uint256 start, uint256 value, uint256 valueUnderlying);
    event Unbond(address indexed account, uint256 start, uint256 value, uint256 valueUnderlying);

    /* Market */
    event CouponExpiration(uint256 indexed epoch, uint256 couponsExpired, uint256 lessRedeemable, uint256 lessDebt, uint256 newBonded);
    event CouponPurchase(address indexed account, uint256 indexed epoch, uint256 dollarAmount, uint256 couponAmount);
    event CouponRedemption(address indexed account, uint256 indexed epoch, uint256 amount, uint256 couponAmount);
    event CouponTransfer(address indexed from, address indexed to, uint256 indexed epoch, uint256 value);
    event CouponApproval(address indexed owner, address indexed spender, uint256 value);
}</span>



interface IUniswapV2Pair {
    event Approval(address indexed owner, address indexed spender, uint value);
    event Transfer(address indexed from, address indexed to, uint value);

    function name() external pure returns (string memory);
    function symbol() external pure returns (string memory);
    function decimals() external pure returns (uint8);
    function totalSupply() external view returns (uint);
    function balanceOf(address owner) external view returns (uint);
    function allowance(address owner, address spender) external view returns (uint);

    function approve(address spender, uint value) external returns (bool);
    function transfer(address to, uint value) external returns (bool);
    function transferFrom(address from, address to, uint value) external returns (bool);

    function DOMAIN_SEPARATOR() external view returns (bytes32);
    function PERMIT_TYPEHASH() external pure returns (bytes32);
    function nonces(address owner) external view returns (uint);

    function permit(address owner, address spender, uint value, uint deadline, uint8 v, bytes32 r, bytes32 s) external;

    event Mint(address indexed sender, uint amount0, uint amount1);
    event Burn(address indexed sender, uint amount0, uint amount1, address indexed to);
    event Swap(
        address indexed sender,
        uint amount0In,
        uint amount1In,
        uint amount0Out,
        uint amount1Out,
        address indexed to
    );
    event Sync(uint112 reserve0, uint112 reserve1);

    function MINIMUM_LIQUIDITY() external pure returns (uint);
    function factory() external view returns (address);
    function token0() external view returns (address);
    function token1() external view returns (address);
    function getReserves() external view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast);
    function price0CumulativeLast() external view returns (uint);
    function price1CumulativeLast() external view returns (uint);
    function kLast() external view returns (uint);

    function mint(address to) external returns (uint liquidity);
    function burn(address to) external returns (uint amount0, uint amount1);
    function swap(uint amount0Out, uint amount1Out, address to, bytes calldata data) external;
    function skim(address to) external;
    function sync() external;

    function initialize(address, address) external;
}



/**
 * @dev Interface of the ERC20 standard as defined in the EIP. Does not include
 * the optional functions; to access them see {ERC20Detailed}.
 */
interface IERC20 {
    /**
     * @dev Returns the amount of tokens in existence.
     */
    function totalSupply() external view returns (uint256);

    /**
     * @dev Returns the amount of tokens owned by `account`.
     */
    function balanceOf(address account) external view returns (uint256);

    /**
     * @dev Moves `amount` tokens from the caller's account to `recipient`.
     *
     * Returns a boolean value indicating whether the operation succeeded.
     *
     * Emits a {Transfer} event.
     */
    function transfer(address recipient, uint256 amount) external returns (bool);

    /**
     * @dev Returns the remaining number of tokens that `spender` will be
     * allowed to spend on behalf of `owner` through {transferFrom}. This is
     * zero by default.
     *
     * This value changes when {approve} or {transferFrom} are called.
     */
    function allowance(address owner, address spender) external view returns (uint256);

    /**
     * @dev Sets `amount` as the allowance of `spender` over the caller's tokens.
     *
     * Returns a boolean value indicating whether the operation succeeded.
     *
     * IMPORTANT: Beware that changing an allowance with this method brings the risk
     * that someone may use both the old and the new allowance by unfortunate
     * transaction ordering. One possible solution to mitigate this race
     * condition is to first reduce the spender's allowance to 0 and set the
     * desired value afterwards:
     * https://github.com/ethereum/EIPs/issues/20#issuecomment-263524729
     *
     * Emits an {Approval} event.
     */
    function approve(address spender, uint256 amount) external returns (bool);

    /**
     * @dev Moves `amount` tokens from `sender` to `recipient` using the
     * allowance mechanism. `amount` is then deducted from the caller's
     * allowance.
     *
     * Returns a boolean value indicating whether the operation succeeded.
     *
     * Emits a {Transfer} event.
     */
    function transferFrom(address sender, address recipient, uint256 amount) external returns (bool);

    /**
     * @dev Emitted when `value` tokens are moved from one account (`from`) to
     * another (`to`).
     *
     * Note that `value` may be zero.
     */
    event Transfer(address indexed from, address indexed to, uint256 value);

    /**
     * @dev Emitted when the allowance of a `spender` for an `owner` is set by
     * a call to {approve}. `value` is the new allowance.
     */
    event Approval(address indexed owner, address indexed spender, uint256 value);
}


/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/



contract IDollar is IERC20 {
    function burn(uint256 amount) public;
    function burnFrom(address account, uint256 amount) public;
    function mint(address account, uint256 amount) public returns (bool);
}


/*
    Copyright 2019 dYdX Trading Inc.
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/



/**
 * @title Decimal
 * @author dYdX
 *
 * Library that defines a fixed-point number with 18 decimal places.
 */
library Decimal {
    using SafeMath for uint256;

    // ============ Constants ============

    uint256 constant BASE = 10**18;

    // ============ Structs ============


    struct D256 {
        uint256 value;
    }

    // ============ Static Functions ============

    function zero()
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: 0 });
    }

    function one()
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: BASE });
    }

    function from(
        uint256 a
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: a.mul(BASE) });
    }

    function ratio(
        uint256 a,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: getPartial(a, BASE, b) });
    }

    // ============ Self Functions ============

    function add(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.add(b.mul(BASE)) });
    }

    function sub(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.sub(b.mul(BASE)) });
    }

    function sub(
        D256 memory self,
        uint256 b,
        string memory reason
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.sub(b.mul(BASE), reason) });
    }

    function mul(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.mul(b) });
    }

    function div(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.div(b) });
    }

    function pow(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        if (b == 0) {
            return from(1);
        }

        D256 memory temp = D256({ value: self.value });
        for (uint256 i = 1; i &lt; b; i++) {
            temp = mul(temp, self);
        }

        return temp;
    }

    function add(
        D256 memory self,
        D256 memory b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.add(b.value) });
    }

    function sub(
        D256 memory self,
        D256 memory b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.sub(b.value) });
    }

    function sub(
        D256 memory self,
        D256 memory b,
        string memory reason
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.sub(b.value, reason) });
    }

    function mul(
        D256 memory self,
        D256 memory b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: getPartial(self.value, b.value, BASE) });
    }

    function div(
        D256 memory self,
        D256 memory b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: getPartial(self.value, BASE, b.value) });
    }

    function equals(D256 memory self, D256 memory b) internal pure returns (bool) {
        return self.value == b.value;
    }

    function greaterThan(D256 memory self, D256 memory b) internal pure returns (bool) {
        return compareTo(self, b) == 2;
    }

    function lessThan(D256 memory self, D256 memory b) internal pure returns (bool) {
        return compareTo(self, b) == 0;
    }

    function greaterThanOrEqualTo(D256 memory self, D256 memory b) internal pure returns (bool) {
        return compareTo(self, b) &gt; 0;
    }

    function lessThanOrEqualTo(D256 memory self, D256 memory b) internal pure returns (bool) {
        return compareTo(self, b) &lt; 2;
    }

    function isZero(D256 memory self) internal pure returns (bool) {
        return self.value == 0;
    }

    function asUint256(D256 memory self) internal pure returns (uint256) {
        return self.value.div(BASE);
    }

    // ============ Core Methods ============

    function getPartial(
        uint256 target,
        uint256 numerator,
        uint256 denominator
    )
    private
    pure
    returns (uint256)
    {
        return target.mul(numerator).div(denominator);
    }

    function compareTo(
        D256 memory a,
        D256 memory b
    )
    private
    pure
    returns (uint256)
    {
        if (a.value == b.value) {
            return 1;
        }
        return a.value &gt; b.value ? 2 : 0;
    }
}


/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/



contract IOracle {
    function setup() public;
    function capture() public returns (Decimal.D256 memory, bool);
    function pair() external view returns (address);
}


/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/






contract Account {
    enum Status {
        Frozen,
        Fluid,
        Locked
    }

    struct State {
        uint256 staged;
        uint256 balance;
        mapping(uint256 =&gt; uint256) coupons;
        mapping(address =&gt; uint256) couponAllowances;
        uint256 fluidUntil;
        uint256 lockedUntil;
    }
}

contract Epoch {
    struct Global {
        uint256 start;
        uint256 period;
        uint256 current;
    }

    struct Coupons {
        uint256 outstanding;
        uint256 expiration;
        uint256[] expiring;
    }

    struct State {
        uint256 bonded;
        Coupons coupons;
    }
}

contract Candidate {
    enum Vote {
        UNDECIDED,
        APPROVE,
        REJECT
    }

    struct State {
        uint256 start;
        uint256 period;
        uint256 approve;
        uint256 reject;
        mapping(address =&gt; Vote) votes;
        bool initialized;
    }
}

contract Era {
    enum Status {
        EXPANSION,
        CONTRACTION
    }

    struct State {
        Status status;
        uint256 start;
    }
}

contract Storage {
    struct Provider {
        IDollar dollar;
        IOracle oracle;
        address pool;
    }

    struct Balance {
        uint256 supply;
        uint256 bonded;
        uint256 staged;
        uint256 redeemable;
        uint256 debt;
        uint256 coupons;
    }

    struct State {
        Epoch.Global epoch;
        Balance balance;
        Provider provider;

        mapping(address =&gt; Account.State) accounts;
        mapping(uint256 =&gt; Epoch.State) epochs;
        mapping(address =&gt; Candidate.State) candidates;
    }

    struct State16 {
        mapping(address =&gt; mapping(uint256 =&gt; uint256)) couponUnderlyingByAccount;
        uint256 couponUnderlying;
    }

    struct State18 {
        Era.State era;
    }
}

contract State {
    Storage.State _state;

    // EIP-16
    Storage.State16 _state16;

    // EIP-18
    Storage.State18 _state18;
}


/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/



<span class="marker" id="mapping-3"></span><span class="token mv" id="move-src-3" data-title="source_file/library_declaration">library Constants {
    /* Chain */
    uint256 private constant CHAIN_ID = 1; // Mainnet

    /* Oracle */
    address private constant USDC = address(0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48);
    uint256 private constant ORACLE_RESERVE_MINIMUM = 1e10; // 10,000 USDC

    /* Bonding */
    uint256 private constant INITIAL_STAKE_MULTIPLE = 1e6; // 100 ESD -&gt; 100M ESDS

    /* Epoch */
    struct EpochStrategy {
        uint256 offset;
        uint256 start;
        uint256 period;
    }

    <span class="marker" id="mapping-4"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-5"></span><span class="token mv" id="move-src-4" data-title="state_variable_declaration/type_name">uint256</span> <span class="marker" id="mapping-6"></span><span class="token del" data-title="state_variable_declaration/visibility">private</span> constant PREVIOUS_EPOCH_OFFSET = 91;</span>
    <span class="marker" id="mapping-7"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-8"></span><span class="token mv" id="move-src-5" data-title="state_variable_declaration/type_name">uint256</span> <span class="marker" id="mapping-9"></span><span class="token del" data-title="state_variable_declaration/visibility">private</span> constant PREVIOUS_EPOCH_START = 1600905600;</span>
    <span class="marker" id="mapping-10"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-11"></span><span class="token mv" id="move-src-6" data-title="state_variable_declaration/type_name">uint256</span> <span class="marker" id="mapping-12"></span><span class="token del" data-title="state_variable_declaration/visibility">private</span> constant PREVIOUS_EPOCH_PERIOD = 86400;</span>

    <span class="marker" id="mapping-13"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-14"></span><span class="token mv" id="move-src-7" data-title="state_variable_declaration/type_name">uint256</span> <span class="marker" id="mapping-15"></span><span class="token del" data-title="state_variable_declaration/visibility">private</span> constant CURRENT_EPOCH_OFFSET = 106;</span>
    <span class="marker" id="mapping-16"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-17"></span><span class="token mv" id="move-src-8" data-title="state_variable_declaration/type_name">uint256</span> <span class="marker" id="mapping-18"></span><span class="token del" data-title="state_variable_declaration/visibility">private</span> constant CURRENT_EPOCH_START = 1602201600;</span>
    <span class="marker" id="mapping-19"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-20"></span><span class="token mv" id="move-src-9" data-title="state_variable_declaration/type_name">uint256</span> <span class="marker" id="mapping-21"></span><span class="token del" data-title="state_variable_declaration/visibility">private</span> constant CURRENT_EPOCH_PERIOD = 28800;</span>

    <span class="marker" id="mapping-22"></span><span class="token del" data-title="contract_body/comment">/* Governance */</span>
    <span class="marker" id="mapping-23"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-24"></span><span class="token mv" id="move-src-10" data-title="state_variable_declaration/type_name">uint256</span> <span class="marker" id="mapping-25"></span><span class="token del" data-title="state_variable_declaration/visibility">private</span> constant GOVERNANCE_PERIOD = 9;</span> <span class="marker" id="mapping-26"></span><span class="token del" data-title="contract_body/comment">// 9 epochs</span>
    <span class="marker" id="mapping-27"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-28"></span><span class="token mv" id="move-src-11" data-title="state_variable_declaration/type_name">uint256</span> <span class="marker" id="mapping-29"></span><span class="token mv" id="move-src-12" data-title="state_variable_declaration/visibility">private</span> constant GOVERNANCE_EXPIRATION = 2;</span> <span class="marker" id="mapping-30"></span><span class="token del" data-title="contract_body/comment">// 2 + 1 epochs</span>
    <span class="marker" id="mapping-31"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-32"></span><span class="token mv" id="move-src-13" data-title="state_variable_declaration/type_name">uint256</span> <span class="marker" id="mapping-33"></span><span class="token mv" id="move-src-14" data-title="state_variable_declaration/visibility">private</span> constant GOVERNANCE_QUORUM = 20e16;</span> <span class="marker" id="mapping-34"></span><span class="token del" data-title="contract_body/comment">// 20%</span>
    <span class="marker" id="mapping-35"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-36"></span><span class="token mv" id="move-src-15" data-title="state_variable_declaration/type_name">uint256</span> <span class="marker" id="mapping-37"></span><span class="token mv" id="move-src-16" data-title="state_variable_declaration/visibility">private</span> constant GOVERNANCE_PROPOSAL_THRESHOLD = 5e15;</span> <span class="marker" id="mapping-38"></span><span class="token del" data-title="contract_body/comment">// 0.5%</span>
    <span class="marker" id="mapping-39"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-40"></span><span class="token del" data-title="state_variable_declaration/type_name">uint256</span> <span class="marker" id="mapping-41"></span><span class="token mv" id="move-src-17" data-title="state_variable_declaration/visibility">private</span> constant GOVERNANCE_SUPER_MAJORITY = 40e16;</span> <span class="marker" id="mapping-42"></span><span class="token del" data-title="contract_body/comment">// 40%</span>
    <span class="marker" id="mapping-43"></span><span class="token del" data-title="contract_body/state_variable_declaration">uint256 private constant GOVERNANCE_EMERGENCY_DELAY = 6;</span> <span class="marker" id="mapping-44"></span><span class="token del" data-title="contract_body/comment">// 6 epochs</span>

    /* DAO */
    uint256 private constant ADVANCE_INCENTIVE = 2500e18; // 2500 ESD
    <span class="marker" id="mapping-45"></span><span class="token del" data-title="contract_body/state_variable_declaration">uint256 private constant DAO_EXIT_LOCKUP_EPOCHS = 1;</span> <span class="marker" id="mapping-46"></span><span class="token del" data-title="contract_body/comment">// 1 epoch fluid</span>

    /* Pool */
    uint256 private constant POOL_EXIT_LOCKUP_EPOCHS = 5; // 5 epochs fluid

    /* Deployed */
    address private constant DAO_ADDRESS = address(0x443D2f2755DB5942601fa062Cc248aAA153313D3);
    address private constant DOLLAR_ADDRESS = address(0x36F3FD68E7325a35EB768F1AedaAe9EA0689d723);
    address private constant PAIR_ADDRESS = address(0x88ff79eB2Bc5850F27315415da8685282C7610F9);
    address private constant TREASURY_ADDRESS = address(0x460661bd4A5364A3ABCc9cfc4a8cE7038d05Ea22);

    /**
     * Getters
     */

    function getUsdcAddress() internal pure returns (address) {
        return USDC;
    }

    function getOracleReserveMinimum() internal pure returns (uint256) {
        return ORACLE_RESERVE_MINIMUM;
    }

    <span class="marker" id="mapping-47"></span><span class="token del" data-title="contract_body/function_definition">function getPreviousEpochStrategy() <span class="marker" id="mapping-48"></span><span class="token mv" id="move-src-18" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-49"></span><span class="token mv" id="move-src-19" data-title="function_definition/state_mutability">pure</span> <span class="marker" id="mapping-50"></span><span class="token del" data-title="function_definition/return_type_definition">returns (EpochStrategy memory)</span> <span class="marker" id="mapping-51"></span><span class="token del" data-title="function_definition/function_body">{
        return EpochStrategy({
            offset: PREVIOUS_EPOCH_OFFSET,
            start: PREVIOUS_EPOCH_START,
            period: PREVIOUS_EPOCH_PERIOD
        });
    }</span></span>

    <span class="marker" id="mapping-52"></span><span class="token del" data-title="contract_body/function_definition">function getCurrentEpochStrategy() <span class="marker" id="mapping-53"></span><span class="token mv" id="move-src-20" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-54"></span><span class="token mv" id="move-src-21" data-title="function_definition/state_mutability">pure</span> <span class="marker" id="mapping-55"></span><span class="token del" data-title="function_definition/return_type_definition">returns (EpochStrategy memory)</span> <span class="marker" id="mapping-56"></span><span class="token del" data-title="function_definition/function_body">{
        return EpochStrategy({
            offset: CURRENT_EPOCH_OFFSET,
            start: CURRENT_EPOCH_START,
            period: CURRENT_EPOCH_PERIOD
        });
    }</span></span>

    function getInitialStakeMultiple() internal pure returns (uint256) {
        return INITIAL_STAKE_MULTIPLE;
    }

    <span class="marker" id="mapping-57"></span><span class="token mv" id="move-src-22" data-title="contract_body/function_definition">function <span class="marker" id="mapping-58"></span><span class="token upd" id="move-src-23" data-title="function_definition/identifier">ge<span class="cupd">t</span>Gov<span class="cupd">e</span>rn<span class="cupd">a</span>ncePe<span class="cupd">r</span>iod</span>() <span class="marker" id="mapping-59"></span><span class="token mv" id="move-src-24" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-60"></span><span class="token mv" id="move-src-25" data-title="function_definition/state_mutability">pure</span> returns (uint256) {
        return <span class="marker" id="mapping-61"></span><span class="token del" data-title="return_statement/identifier">GOVERNANCE_PERIOD</span>;
    }</span>

    <span class="marker" id="mapping-62"></span><span class="token del" data-title="contract_body/function_definition">function getGovernanceExpiration() <span class="marker" id="mapping-63"></span><span class="token mv" id="move-src-26" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-64"></span><span class="token del" data-title="function_definition/state_mutability">pure</span> <span class="marker" id="mapping-65"></span><span class="token mv" id="move-src-27" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-66"></span><span class="token del" data-title="function_definition/function_body">{
        return GOVERNANCE_EXPIRATION;
    }</span></span>

    <span class="marker" id="mapping-67"></span><span class="token del" data-title="contract_body/function_definition">function getGovernanceQuorum() <span class="marker" id="mapping-68"></span><span class="token mv" id="move-src-28" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-69"></span><span class="token mv" id="move-src-29" data-title="function_definition/state_mutability">pure</span> <span class="marker" id="mapping-70"></span><span class="token del" data-title="function_definition/return_type_definition">returns (Decimal.D256 memory)</span> <span class="marker" id="mapping-71"></span><span class="token del" data-title="function_definition/function_body">{
        return Decimal.D256({value: GOVERNANCE_QUORUM});
    }</span></span>

    <span class="marker" id="mapping-72"></span><span class="token del" data-title="contract_body/function_definition">function getGovernanceProposalThreshold() internal pure returns (Decimal.D256 memory) {
        return Decimal.D256({value: GOVERNANCE_PROPOSAL_THRESHOLD});
    }</span>

    <span class="marker" id="mapping-73"></span><span class="token del" data-title="contract_body/function_definition">function getGovernanceSuperMajority() internal pure returns (Decimal.D256 memory) {
        return Decimal.D256({value: GOVERNANCE_SUPER_MAJORITY});
    }</span>

    <span class="marker" id="mapping-74"></span><span class="token mv" id="move-src-30" data-title="contract_body/function_definition">function <span class="marker" id="mapping-75"></span><span class="token upd" id="move-src-31" data-title="function_definition/identifier">getG<span class="cupd">o</span>ve<span class="cupd">r</span>n<span class="cupd">a</span>nceEmergencyDelay</span>() <span class="marker" id="mapping-76"></span><span class="token del" data-title="visibility/internal">internal</span> <span class="marker" id="mapping-77"></span><span class="token del" data-title="state_mutability/pure">pure</span> returns (uint256) {
        return <span class="marker" id="mapping-78"></span><span class="token del" data-title="return_statement/identifier">GOVERNANCE_EMERGENCY_DELAY</span>;
    }</span>

    function getAdvanceIncentive() internal pure returns (uint256) {
        return ADVANCE_INCENTIVE;
    }

    <span class="marker" id="mapping-79"></span><span class="token mv" id="move-src-32" data-title="contract_body/function_definition">function <span class="marker" id="mapping-80"></span><span class="token upd" id="move-src-33" data-title="function_definition/identifier">g<span class="cupd">e</span>tDAOExitLockupEpochs</span>() <span class="marker" id="mapping-81"></span><span class="token del" data-title="visibility/internal">internal</span> <span class="marker" id="mapping-82"></span><span class="token del" data-title="state_mutability/pure">pure</span> returns (uint256) <span class="marker" id="mapping-83"></span><span class="token del" data-title="function_definition/function_body">{
        return DAO_EXIT_LOCKUP_EPOCHS;
    }</span></span>

    function getPoolExitLockupEpochs() internal pure returns (uint256) {
        return POOL_EXIT_LOCKUP_EPOCHS;
    }

    function getChainId() internal pure returns (uint256) {
        return CHAIN_ID;
    }

    function getDaoAddress() internal pure returns (address) {
        return DAO_ADDRESS;
    }

    function getDollarAddress() internal pure returns (address) {
        return DOLLAR_ADDRESS;
    }

    function getPairAddress() internal pure returns (address) {
        return PAIR_ADDRESS;
    }

    function getTreasuryAddress() internal pure returns (address) {
        return TREASURY_ADDRESS;
    }
}</span>


/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/





<span class="marker" id="mapping-84"></span><span class="token mv" id="move-src-34" data-title="source_file/contract_declaration">contract Getters is State {
    using SafeMath for uint256;
    using Decimal for Decimal.D256;

    bytes32 private constant IMPLEMENTATION_SLOT = 0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc;

    /**
     * ERC20 Interface
     */

    function name() public view returns (string memory) {
        return "Empty Set Dollar Stake";
    }

    function symbol() public view returns (string memory) {
        return "ESDS";
    }

    function decimals() public view returns (uint8) {
        return 18;
    }

    function balanceOf(address account) public view returns (uint256) {
        return _state.accounts[account].balance;
    }

    function totalSupply() public view returns (uint256) {
        return _state.balance.supply;
    }

    function allowance(address owner, address spender) external view returns (uint256) {
        return 0;
    }

    /**
     * Global
     */

    function dollar() public view returns (IDollar) {
        return <span class="marker" id="mapping-85"></span><span class="token del" data-title="return_statement/member_expression">_state.provider.dollar</span>;
    }

    function oracle() public view returns (IOracle) {
        return <span class="marker" id="mapping-86"></span><span class="token del" data-title="return_statement/member_expression">_state.provider.oracle</span>;
    }

    function <span class="marker" id="mapping-87"></span><span class="token upd" id="move-src-35" data-title="function_definition/identifier">pool</span>() public view returns (address) {
        return <span class="marker" id="mapping-88"></span><span class="token del" data-title="return_statement/member_expression">_state.provider.pool</span>;
    }

    function totalBonded() public view returns (uint256) {
        return _state.balance.bonded;
    }

    function totalStaged() public view returns (uint256) {
        return _state.balance.staged;
    }

    function totalCouponUnderlying() public view returns (uint256) {
        return _state16.couponUnderlying;
    }

    function totalNet() public view returns (uint256) {
        return dollar().totalSupply().sub(totalDebt());
    }

    /**
     * Account
     */

    function balanceOfStaged(address account) public view returns (uint256) {
        return _state.accounts[account].staged;
    }

    function balanceOfBonded(address account) public view returns (uint256) {
        uint256 totalSupply = totalSupply();
        if (totalSupply == 0) {
            return 0;
        }
        return totalBonded().mul(balanceOf(account)).div(totalSupply);
    }

    function balanceOfCouponUnderlying(address account, uint256 epoch) public view returns (uint256) {
        return _state16.couponUnderlyingByAccount[account][epoch];
    }

    function statusOf(address account) public view returns (Account.Status) {
        if (_state.accounts[account].lockedUntil &gt; epoch()) {
            return Account.Status.Locked;
        }

        return epoch() &gt;= _state.accounts[account].fluidUntil ? Account.Status.Frozen : Account.Status.Fluid;
    }

    function fluidUntil(address account) public view returns (uint256) {
        return _state.accounts[account].fluidUntil;
    }

    function lockedUntil(address account) public view returns (uint256) {
        return _state.accounts[account].lockedUntil;
    }

    function allowanceCoupons(address owner, address spender) public view returns (uint256) {
        return _state.accounts[owner].couponAllowances[spender];
    }

    /**
     * Epoch
     */

    function epoch() public view returns (uint256) {
        return _state.epoch.current;
    }

    <span class="marker" id="mapping-89"></span><span class="token del" data-title="contract_body/function_definition">function epochTime() <span class="marker" id="mapping-90"></span><span class="token mv" id="move-src-36" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-91"></span><span class="token mv" id="move-src-37" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-92"></span><span class="token mv" id="move-src-38" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-93"></span><span class="token del" data-title="function_definition/function_body">{
        Constants.EpochStrategy memory current = Constants.getCurrentEpochStrategy();
        Constants.EpochStrategy memory previous = Constants.getPreviousEpochStrategy();

        return blockTimestamp() &lt; current.start ?
            epochTimeWithStrategy(previous) :
            epochTimeWithStrategy(current);
    }</span></span>

    function epochTimeWithStrategy(Constants.EpochStrategy memory strategy) private view returns (uint256) {
        return blockTimestamp()
            .sub(strategy.start)
            .div(strategy.period)
            .add(strategy.offset);
    }

    // Overridable for testing
    function blockTimestamp() internal view returns (uint256) {
        return block.timestamp;
    }

    function couponsExpiration(uint256 epoch) public view returns (uint256) {
        return _state.epochs[epoch].coupons.expiration;
    }

    function expiringCoupons(uint256 epoch) public view returns (uint256) {
        return _state.epochs[epoch].coupons.expiring.length;
    }

    function expiringCouponsAtIndex(uint256 epoch, uint256 i) public view returns (uint256) {
        return _state.epochs[epoch].coupons.expiring[i];
    }

    function totalBondedAt(uint256 epoch) public view returns (uint256) {
        return _state.epochs[epoch].bonded;
    }

    /**
     * Governance
     */

    function recordedVote(address account, address candidate) public view returns (Candidate.Vote) {
        return _state.candidates[candidate].votes[account];
    }

    function startFor(address candidate) public view returns (uint256) {
        return _state.candidates[candidate].start;
    }

    function periodFor(address candidate) public view returns (uint256) {
        return _state.candidates[candidate].period;
    }

    function approveFor(address candidate) public view returns (uint256) {
        return _state.candidates[candidate].approve;
    }

    function rejectFor(address candidate) public view returns (uint256) {
        return _state.candidates[candidate].reject;
    }

    function votesFor(address candidate) public view returns (uint256) {
        return approveFor(candidate).add(rejectFor(candidate));
    }

    function isNominated(address candidate) public view returns (bool) {
        return _state.candidates[candidate].start &gt; 0;
    }

    function isInitialized(address candidate) public view returns (bool) {
        return _state.candidates[candidate].initialized;
    }

    function implementation() public view returns (address impl) {
        bytes32 slot = IMPLEMENTATION_SLOT;
        assembly {
            impl := sload(slot)
        }
    }

    /*
     * DEPRECATED
     */
    function totalCoupons() public view returns (uint256) {
        return 0;
    }

    function balanceOfCoupons(address account, uint256 epoch) public view returns (uint256) {
        return 0;
    }

    function outstandingCoupons(uint256 epoch) public view returns (uint256) {
        return 0;
    }

    function bootstrappingAt(uint256 epoch) public view returns (bool) {
        return false;
    }

    function eraStatus() public view returns (Era.Status) {
        return Era.Status.CONTRACTION;
    }

    function eraStart() public view returns (uint256) {
        return 0;
    }

    function couponPremium(uint256 amount) public view returns (uint256) {
        return 0;
    }

    function totalDebt() public view returns (uint256) {
        return 0;
    }

    function totalRedeemable() public view returns (uint256) {
        return 0;
    }
}</span>


/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/





contract Setters is State, Getters {
    using SafeMath for uint256;

    event Transfer(address indexed from, address indexed to, uint256 value);

    /**
     * ERC20 Interface
     */

    function transfer(address recipient, uint256 amount) external returns (bool) {
        return false;
    }

    function approve(address spender, uint256 amount) external returns (bool) {
        return false;
    }

    function transferFrom(address sender, address recipient, uint256 amount) external returns (bool) {
        return false;
    }

    /**
     * Account
     */

    function incrementBalanceOf(address account, uint256 amount) internal {
        _state.accounts[account].balance = _state.accounts[account].balance.add(amount);
        _state.balance.supply = _state.balance.supply.add(amount);

        emit Transfer(address(0), account, amount);
    }

    function decrementBalanceOfStaged(address account, uint256 amount, string memory reason) internal {
        _state.accounts[account].staged = _state.accounts[account].staged.sub(amount, reason);
        _state.balance.staged = _state.balance.staged.sub(amount, reason);
    }

    function incrementBalanceOfCouponUnderlying(address account, uint256 epoch, uint256 amount) internal {
        _state16.couponUnderlyingByAccount[account][epoch] = _state16.couponUnderlyingByAccount[account][epoch].add(amount);
        _state16.couponUnderlying = _state16.couponUnderlying.add(amount);
    }

    function decrementBalanceOfCouponUnderlying(address account, uint256 epoch, uint256 amount, string memory reason) internal {
        _state16.couponUnderlyingByAccount[account][epoch] = _state16.couponUnderlyingByAccount[account][epoch].sub(amount, reason);
        _state16.couponUnderlying = _state16.couponUnderlying.sub(amount, reason);
    }

    function updateAllowanceCoupons(address owner, address spender, uint256 amount) internal {
        _state.accounts[owner].couponAllowances[spender] = amount;
    }

    function decrementAllowanceCoupons(address owner, address spender, uint256 amount, string memory reason) internal {
        _state.accounts[owner].couponAllowances[spender] =
            _state.accounts[owner].couponAllowances[spender].sub(amount, reason);
    }

    <span class="marker" id="mapping-94"></span><span class="token mv" id="move-src-39" data-title="contract_body/comment"><span class="marker" id="mapping-95"></span><span class="token upd" id="move-src-40" data-title="contract_body/comment"><span class="cupd">/**
     * </span>Ep<span class="cupd">o</span>ch<span class="cupd">
</span><span class="cupd"> </span><span class="cupd"> </span><span class="cupd">   </span><span class="cupd">*/</span></span></span>

    <span class="marker" id="mapping-96"></span><span class="token del" data-title="contract_body/function_definition">function incrementEpoch() internal {
        _state.epoch.current = _state.epoch.current.add(1);
    }</span>

    <span class="marker" id="mapping-97"></span><span class="token del" data-title="contract_body/function_definition">function snapshotTotalBonded() internal {
        _state.epochs[epoch()].bonded = totalSupply();
    }</span>

    /**
     * Governance
     */

    <span class="marker" id="mapping-98"></span><span class="token del" data-title="contract_body/function_definition">function createCandidate(<span class="marker" id="mapping-99"></span><span class="token del" data-title="function_definition/parameter">address candidate</span>, <span class="marker" id="mapping-100"></span><span class="token mv" id="move-src-41" data-title="function_definition/parameter">uint256 <span class="marker" id="mapping-101"></span><span class="token upd" id="move-src-42" data-title="parameter/identifier">p<span class="cupd">e</span><span class="cupd">r</span>iod</span></span>) <span class="marker" id="mapping-102"></span><span class="token mv" id="move-src-43" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-103"></span><span class="token del" data-title="function_definition/function_body">{
        _state.candidates[candidate].start = epoch();
        _state.candidates[candidate].period = period;
    }</span></span>

    <span class="marker" id="mapping-104"></span><span class="token del" data-title="contract_body/function_definition">function recordVote(<span class="marker" id="mapping-105"></span><span class="token mv" id="move-src-44" data-title="function_definition/parameter">address account</span>, <span class="marker" id="mapping-106"></span><span class="token del" data-title="function_definition/parameter">address candidate</span>, <span class="marker" id="mapping-107"></span><span class="token del" data-title="function_definition/parameter">Candidate.Vote vote</span>) <span class="marker" id="mapping-108"></span><span class="token mv" id="move-src-45" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-109"></span><span class="token del" data-title="function_definition/function_body">{
        _state.candidates[candidate].votes[account] = vote;
    }</span></span>

    <span class="marker" id="mapping-110"></span><span class="token del" data-title="contract_body/function_definition">function incrementApproveFor(<span class="marker" id="mapping-111"></span><span class="token del" data-title="function_definition/parameter">address candidate</span>, <span class="marker" id="mapping-112"></span><span class="token mv" id="move-src-46" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-113"></span><span class="token mv" id="move-src-47" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-114"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-115"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-116"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-117"></span><span class="token del" data-title="assignment_expression/member_expression">_state.candidates[candidate].approve</span> = <span class="marker" id="mapping-118"></span><span class="token del" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-119"></span><span class="token del" data-title="call_expression/member_expression">_state.candidates[candidate].approve.add</span>(<span class="marker" id="mapping-120"></span><span class="token mv" id="move-src-48" data-title="call_expression/call_argument">amount</span>)</span></span>;</span>
    }</span></span>

    <span class="marker" id="mapping-121"></span><span class="token mv" id="move-src-49" data-title="contract_body/function_definition">function <span class="marker" id="mapping-122"></span><span class="token upd" id="move-src-50" data-title="function_definition/identifier"><span class="cupd">decrement</span>Appr<span class="cupd">o</span>veF<span class="cupd">o</span>r</span>(<span class="marker" id="mapping-123"></span><span class="token del" data-title="function_definition/parameter">address candidate</span><span class="marker" id="mapping-124"></span><span class="token mv" id="move-src-51" data-title="function_definition/,">,</span> uint256 amount<span class="marker" id="mapping-125"></span><span class="token del" data-title="function_definition/,">,</span> string memory reason) internal {
        <span class="marker" id="mapping-126"></span><span class="token del" data-title="member_expression/array_access">_state.candidates[candidate]</span><span class="marker" id="mapping-127"></span><span class="token mv" id="move-src-52" data-title="member_expression/.">.</span><span class="marker" id="mapping-128"></span><span class="token upd" id="move-src-53" data-title="member_expression/identifier"><span class="cupd">a</span>pprove</span> = <span class="marker" id="mapping-129"></span><span class="token del" data-title="member_expression/array_access">_state.candidates[candidate]</span><span class="marker" id="mapping-130"></span><span class="token mv" id="move-src-54" data-title="member_expression/.">.</span><span class="marker" id="mapping-131"></span><span class="token upd" id="move-src-55" data-title="member_expression/identifier"><span class="cupd">a</span>pprove</span>.sub(amount, reason);
    }</span>

    <span class="marker" id="mapping-132"></span><span class="token del" data-title="contract_body/function_definition">function incrementRejectFor(<span class="marker" id="mapping-133"></span><span class="token del" data-title="function_definition/parameter">address candidate</span>, <span class="marker" id="mapping-134"></span><span class="token del" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-135"></span><span class="token mv" id="move-src-56" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-136"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-137"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-138"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-139"></span><span class="token del" data-title="assignment_expression/member_expression">_state.candidates[candidate].reject</span> = <span class="marker" id="mapping-140"></span><span class="token del" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-141"></span><span class="token del" data-title="call_expression/member_expression">_state.candidates[candidate].reject.add</span>(<span class="marker" id="mapping-142"></span><span class="token mv" id="move-src-57" data-title="call_expression/call_argument">amount</span>)</span></span>;</span>
    }</span></span>

    <span class="marker" id="mapping-143"></span><span class="token del" data-title="contract_body/function_definition">function decrementRejectFor(<span class="marker" id="mapping-144"></span><span class="token del" data-title="function_definition/parameter">address candidate</span>, <span class="marker" id="mapping-145"></span><span class="token mv" id="move-src-58" data-title="function_definition/parameter">uint256 amount</span>, <span class="marker" id="mapping-146"></span><span class="token mv" id="move-src-59" data-title="function_definition/parameter">string memory reason</span>) <span class="marker" id="mapping-147"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-148"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-149"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-150"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-151"></span><span class="token del" data-title="assignment_expression/member_expression">_state.candidates[candidate].reject</span> = <span class="marker" id="mapping-152"></span><span class="token del" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-153"></span><span class="token del" data-title="call_expression/member_expression">_state.candidates[candidate].reject.sub</span>(<span class="marker" id="mapping-154"></span><span class="token mv" id="move-src-60" data-title="call_expression/call_argument">amount</span>, <span class="marker" id="mapping-155"></span><span class="token mv" id="move-src-61" data-title="call_expression/call_argument">reason</span>)</span></span>;</span>
    }</span></span>

    <span class="marker" id="mapping-156"></span><span class="token mv" id="move-src-62" data-title="contract_body/function_definition">function <span class="marker" id="mapping-157"></span><span class="token upd" id="move-src-63" data-title="function_definition/identifier">p<span class="cupd">la</span><span class="cupd">ce</span>Lock</span>(<span class="marker" id="mapping-158"></span><span class="token mv" id="move-src-64" data-title="function_definition/parameter">address account</span>, <span class="marker" id="mapping-159"></span><span class="token del" data-title="function_definition/parameter">address candidate</span>) internal {
        <span class="marker" id="mapping-160"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-161"></span><span class="token mv" id="move-src-65" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-162"></span><span class="token upd" id="move-src-66" data-title="variable_declaration/identifier">c<span class="cupd">u</span>rre<span class="cupd">nt</span>Lock</span></span> = <span class="marker" id="mapping-163"></span><span class="token mv" id="move-src-67" data-title="variable_declaration_statement/member_expression">_state.accounts[account].<span class="marker" id="mapping-164"></span><span class="token upd" id="move-src-68" data-title="member_expression/identifier"><span class="cupd">l</span>o<span class="cupd">c</span>kedUntil</span></span>;</span>
        <span class="marker" id="mapping-165"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-166"></span><span class="token mv" id="move-src-69" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-167"></span><span class="token upd" id="move-src-70" data-title="variable_declaration/identifier"><span class="cupd">n</span>ewLock</span></span> = <span class="marker" id="mapping-168"></span><span class="token del" data-title="variable_declaration_statement/call_expression">startFor(candidate).add(periodFor(candidate))</span>;</span>
        <span class="marker" id="mapping-169"></span><span class="token del" data-title="function_body/if_statement">if (<span class="marker" id="mapping-170"></span><span class="token del" data-title="if_statement/binary_expression">newLock &gt; currentLock</span>) <span class="marker" id="mapping-171"></span><span class="token del" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-172"></span><span class="token mv" id="move-src-71" data-title="block_statement/expression_statement">_state.accounts[account].<span class="marker" id="mapping-173"></span><span class="token upd" id="move-src-72" data-title="member_expression/identifier"><span class="cupd">l</span>o<span class="cupd">c</span>kedUntil</span> = <span class="marker" id="mapping-174"></span><span class="token del" data-title="assignment_expression/identifier">newLock</span>;</span>
        }</span></span>
    }</span>

    function initialized(address candidate) internal {
        _state.candidates[candidate].initialized = true;
    }
}


/*
    Copyright 2019 dYdX Trading Inc.

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/


/**
 * @title Require
 * @author dYdX
 *
 * Stringifies parameters to pretty-print revert messages. Costs more gas than regular require()
 */
library Require {

    // ============ Constants ============

    uint256 constant ASCII_ZERO = 48; // '0'
    uint256 constant ASCII_RELATIVE_ZERO = 87; // 'a' - 10
    uint256 constant ASCII_LOWER_EX = 120; // 'x'
    bytes2 constant COLON = 0x3a20; // ': '
    bytes2 constant COMMA = 0x2c20; // ', '
    bytes2 constant LPAREN = 0x203c; // ' &lt;'
    byte constant RPAREN = 0x3e; // '&gt;'
    uint256 constant FOUR_BIT_MASK = 0xf;

    // ============ Library Functions ============

    function that(
        bool must,
        bytes32 file,
        bytes32 reason
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason)
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        uint256 payloadA
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        uint256 payloadA,
        uint256 payloadB
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        COMMA,
                        stringify(payloadB),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        address payloadA
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        address payloadA,
        uint256 payloadB
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        COMMA,
                        stringify(payloadB),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        address payloadA,
        uint256 payloadB,
        uint256 payloadC
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        COMMA,
                        stringify(payloadB),
                        COMMA,
                        stringify(payloadC),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        bytes32 payloadA
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        bytes32 payloadA,
        uint256 payloadB,
        uint256 payloadC
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        COMMA,
                        stringify(payloadB),
                        COMMA,
                        stringify(payloadC),
                        RPAREN
                    )
                )
            );
        }
    }

    // ============ Private Functions ============

    function stringifyTruncated(
        bytes32 input
    )
    private
    pure
    returns (bytes memory)
    {
        // put the input bytes into the result
        bytes memory result = abi.encodePacked(input);

        // determine the length of the input by finding the location of the last non-zero byte
        for (uint256 i = 32; i &gt; 0; ) {
            // reverse-for-loops with unsigned integer
            /* solium-disable-next-line security/no-modify-for-iter-var */
            i--;

            // find the last non-zero byte in order to determine the length
            if (result[i] != 0) {
                uint256 length = i + 1;

                /* solium-disable-next-line security/no-inline-assembly */
                assembly {
                    mstore(result, length) // r.length = length;
                }

                return result;
            }
        }

        // all bytes are zero
        return new bytes(0);
    }

    function stringify(
        uint256 input
    )
    private
    pure
    returns (bytes memory)
    {
        if (input == 0) {
            return "0";
        }

        // get the final string length
        uint256 j = input;
        uint256 length;
        while (j != 0) {
            length++;
            j /= 10;
        }

        // allocate the string
        bytes memory bstr = new bytes(length);

        // populate the string starting with the least-significant character
        j = input;
        for (uint256 i = length; i &gt; 0; ) {
            // reverse-for-loops with unsigned integer
            /* solium-disable-next-line security/no-modify-for-iter-var */
            i--;

            // take last decimal digit
            bstr[i] = byte(uint8(ASCII_ZERO + (j % 10)));

            // remove the last decimal digit
            j /= 10;
        }

        return bstr;
    }

    function stringify(
        address input
    )
    private
    pure
    returns (bytes memory)
    {
        uint256 z = uint256(input);

        // addresses are "0x" followed by 20 bytes of data which take up 2 characters each
        bytes memory result = new bytes(42);

        // populate the result with "0x"
        result[0] = byte(uint8(ASCII_ZERO));
        result[1] = byte(uint8(ASCII_LOWER_EX));

        // for each byte (starting from the lowest byte), populate the result with two characters
        for (uint256 i = 0; i &lt; 20; i++) {
            // each byte takes two characters
            uint256 shift = i * 2;

            // populate the least-significant character
            result[41 - shift] = char(z &amp; FOUR_BIT_MASK);
            z = z &gt;&gt; 4;

            // populate the most-significant character
            result[40 - shift] = char(z &amp; FOUR_BIT_MASK);
            z = z &gt;&gt; 4;
        }

        return result;
    }

    function stringify(
        bytes32 input
    )
    private
    pure
    returns (bytes memory)
    {
        uint256 z = uint256(input);

        // bytes32 are "0x" followed by 32 bytes of data which take up 2 characters each
        bytes memory result = new bytes(66);

        // populate the result with "0x"
        result[0] = byte(uint8(ASCII_ZERO));
        result[1] = byte(uint8(ASCII_LOWER_EX));

        // for each byte (starting from the lowest byte), populate the result with two characters
        for (uint256 i = 0; i &lt; 32; i++) {
            // each byte takes two characters
            uint256 shift = i * 2;

            // populate the least-significant character
            result[65 - shift] = char(z &amp; FOUR_BIT_MASK);
            z = z &gt;&gt; 4;

            // populate the most-significant character
            result[64 - shift] = char(z &amp; FOUR_BIT_MASK);
            z = z &gt;&gt; 4;
        }

        return result;
    }

    function char(
        uint256 input
    )
    private
    pure
    returns (byte)
    {
        // return ASCII digit (0-9)
        if (input &lt; 10) {
            return byte(uint8(input + ASCII_ZERO));
        }

        // return ASCII letter (a-f)
        return byte(uint8(input + ASCII_RELATIVE_ZERO));
    }
}


/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/




contract Permission is Setters {

    bytes32 private constant FILE = "Permission";

    <span class="marker" id="mapping-175"></span><span class="token del" data-title="contract_body/comment">// Can participate in balance-dependant activities</span>
    <span class="marker" id="mapping-176"></span><span class="token mv" id="move-src-73" data-title="contract_body/modifier_definition">modifier <span class="marker" id="mapping-177"></span><span class="token upd" id="move-src-74" data-title="modifier_definition/identifier"><span class="cupd">only</span>F<span class="cupd">r</span><span class="cupd">o</span>zenOrLocked</span>(<span class="marker" id="mapping-178"></span><span class="token mv" id="move-src-75" data-title="modifier_definition/parameter">address account</span>) {
        Require.that(
            <span class="marker" id="mapping-179"></span><span class="token del" data-title="call_argument/member_expression"><span class="marker" id="mapping-180"></span><span class="token del" data-title="member_expression/binary_expression"><span class="marker" id="mapping-181"></span><span class="token del" data-title="binary_expression/call_expression">statusOf(<span class="marker" id="mapping-182"></span><span class="token mv" id="move-src-76" data-title="call_expression/call_argument">account</span>)</span> != <span class="marker" id="mapping-183"></span><span class="token del" data-title="binary_expression/member_expression">Account.Status</span></span>.Fluid</span>,
            FILE,
            "Not frozen or locked"
        );

        _;
    }</span>

    modifier initializer() {
        Require.that(
            !isInitialized(implementation()),
            FILE,
            "Already initialized"
        );

        initialized(implementation());

        _;
    }
}



/**
 * Utility library of inline functions on addresses
 *
 * Source https://raw.githubusercontent.com/OpenZeppelin/openzeppelin-solidity/v2.1.3/contracts/utils/Address.sol
 * This contract is copied here and renamed from the original to avoid clashes in the compiled artifacts
 * when the user imports a zos-lib contract (that transitively causes this contract to be compiled and added to the
 * build/artifacts folder) as well as the vanilla Address implementation from an openzeppelin version.
 */
library OpenZeppelinUpgradesAddress {
    /**
     * Returns whether the target address is a contract
     * @dev This function will return false if invoked during the constructor of a contract,
     * as the code is not actually created until after the constructor finishes.
     * @param account address of the account to check
     * @return whether the target address is a contract
     */
    function isContract(address account) internal view returns (bool) {
        uint256 size;
        // XXX Currently there is no better way to check if there is a contract in an address
        // than to check the size of the code at that address.
        // See https://ethereum.stackexchange.com/a/14016/36603
        // for more details about how this works.
        // TODO Check this again before the Serenity release, because all addresses will be
        // contracts then.
        // solhint-disable-next-line no-inline-assembly
        assembly { size := extcodesize(account) }
        return size &gt; 0;
    }
}


/*
    Copyright 2018-2019 zOS Global Limited
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/




/**
 * Based off of, and designed to interface with, openzeppelin/upgrades package
 */
contract Upgradeable is State {
    /**
     * @dev Storage slot with the address of the current implementation.
     * This is the keccak-256 hash of "eip1967.proxy.implementation" subtracted by 1, and is
     * validated in the constructor.
     */
    bytes32 private constant IMPLEMENTATION_SLOT = 0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc;

    /**
     * @dev Emitted when the implementation is upgraded.
     * @param implementation Address of the new implementation.
     */
    event Upgraded(address indexed implementation);

    function initialize() public;

    /**
     * @dev Upgrades the proxy to a new implementation.
     * @param newImplementation Address of the new implementation.
     */
    function upgradeTo(address newImplementation) internal {
        setImplementation(newImplementation);

        (bool success, bytes memory reason) = newImplementation.delegatecall(abi.encodeWithSignature("initialize()"));
        require(success, string(reason));

        emit Upgraded(newImplementation);
    }

    /**
     * @dev Sets the implementation address of the proxy.
     * @param newImplementation Address of the new implementation.
     */
    function setImplementation(address newImplementation) private {
        require(OpenZeppelinUpgradesAddress.isContract(newImplementation), "Cannot set a proxy implementation to a non-contract address");

        bytes32 slot = IMPLEMENTATION_SLOT;

        assembly {
            sstore(slot, newImplementation)
        }
    }
}


/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/









<span class="marker" id="mapping-184"></span><span class="token mv" id="move-src-77" data-title="source_file/contract_declaration">contract <span class="marker" id="mapping-185"></span><span class="token upd" id="move-src-78" data-title="contract_declaration/identifier">Govern</span> <span class="marker" id="mapping-186"></span><span class="token del" data-title="contract_declaration/is">is</span> <span class="marker" id="mapping-187"></span><span class="token mv" id="move-src-79" data-title="contract_declaration/inheritance_specifier">Setters</span><span class="marker" id="mapping-188"></span><span class="token del" data-title="contract_declaration/,">,</span> <span class="marker" id="mapping-189"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">Permission</span><span class="marker" id="mapping-190"></span><span class="token del" data-title="contract_declaration/,">,</span> <span class="marker" id="mapping-191"></span><span class="token mv" id="move-src-80" data-title="contract_declaration/inheritance_specifier">Upgradeable</span> {
    <span class="marker" id="mapping-192"></span><span class="token del" data-title="contract_body/using_directive">using SafeMath for uint256;</span>
    <span class="marker" id="mapping-193"></span><span class="token del" data-title="contract_body/using_directive">using Decimal for Decimal.D256;</span>

    <span class="marker" id="mapping-194"></span><span class="token del" data-title="contract_body/state_variable_declaration">bytes32 private constant FILE = "Govern";</span>

    <span class="marker" id="mapping-195"></span><span class="token mv" id="move-src-81" data-title="contract_body/event_definition">event Proposal(address indexed candidate, address indexed account, uint256 indexed start, uint256 period);</span>
    <span class="marker" id="mapping-196"></span><span class="token mv" id="move-src-82" data-title="contract_body/event_definition">event Vote(address indexed account, address indexed candidate, Candidate.Vote vote, uint256 bonded);</span>
    <span class="marker" id="mapping-197"></span><span class="token mv" id="move-src-83" data-title="contract_body/event_definition">event Commit(address indexed account, address indexed candidate);</span>

    <span class="marker" id="mapping-198"></span><span class="token del" data-title="contract_body/function_definition">function step() <span class="marker" id="mapping-199"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-200"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-201"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-202"></span><span class="token del" data-title="expression_statement/call_expression"><span class="marker" id="mapping-203"></span><span class="token del" data-title="call_expression/member_expression">Require.that</span>(
            <span class="marker" id="mapping-204"></span><span class="token del" data-title="call_expression/call_argument">epochTime() &gt; epoch()</span>,
            <span class="marker" id="mapping-205"></span><span class="token del" data-title="call_expression/call_argument">FILE</span>,
            <span class="marker" id="mapping-206"></span><span class="token mv" id="move-src-84" data-title="call_expression/call_argument">"Still current epoch"</span>
        )</span>;</span>

        <span class="marker" id="mapping-207"></span><span class="token del" data-title="function_body/expression_statement">snapshotTotalBonded();</span>
        <span class="marker" id="mapping-208"></span><span class="token del" data-title="function_body/expression_statement">incrementEpoch();</span>
    }</span></span>

    <span class="marker" id="mapping-209"></span><span class="token mv" id="move-src-85" data-title="contract_body/function_definition">function <span class="marker" id="mapping-210"></span><span class="token upd" id="move-src-86" data-title="function_definition/identifier">v<span class="cupd">o</span>te</span>(<span class="marker" id="mapping-211"></span><span class="token del" data-title="function_definition/parameter">address candidate</span><span class="marker" id="mapping-212"></span><span class="token del" data-title="function_definition/,">,</span> <span class="marker" id="mapping-213"></span><span class="token del" data-title="function_definition/parameter">Candidate.Vote vote</span>) external <span class="marker" id="mapping-214"></span><span class="token del" data-title="function_definition/modifier_invocation">onlyFrozenOrLocked(msg.sender)</span> {
        <span class="marker" id="mapping-215"></span><span class="token del" data-title="call_expression/member_expression">Require.that</span>(
            <span class="marker" id="mapping-216"></span><span class="token del" data-title="call_argument/binary_expression"><span class="marker" id="mapping-217"></span><span class="token mv" id="move-src-87" data-title="binary_expression/call_expression"><span class="marker" id="mapping-218"></span><span class="token upd" id="move-src-88" data-title="call_expression/identifier">ba<span class="cupd">l</span><span class="cupd">a</span>nceOf</span>(msg.sender)</span> &gt; 0</span>,
            <span class="marker" id="mapping-219"></span><span class="token del" data-title="call_expression/call_argument">FILE</span><span class="marker" id="mapping-220"></span><span class="token del" data-title="call_expression/,">,</span>
            <span class="marker" id="mapping-221"></span><span class="token mv" id="move-src-89" data-title="call_expression/call_argument">"Must have stake"</span>
        );

        <span class="marker" id="mapping-222"></span><span class="token del" data-title="function_body/if_statement">if (<span class="marker" id="mapping-223"></span><span class="token del" data-title="if_statement/unary_expression">!isNominated(candidate)</span>) <span class="marker" id="mapping-224"></span><span class="token del" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-225"></span><span class="token del" data-title="block_statement/expression_statement"><span class="marker" id="mapping-226"></span><span class="token del" data-title="expression_statement/call_expression"><span class="marker" id="mapping-227"></span><span class="token del" data-title="call_expression/member_expression">Require.that</span>(
                <span class="marker" id="mapping-228"></span><span class="token del" data-title="call_expression/call_argument"><span class="marker" id="mapping-229"></span><span class="token del" data-title="call_argument/call_expression">canPropose(<span class="marker" id="mapping-230"></span><span class="token mv" id="move-src-90" data-title="call_expression/call_argument">msg.sender</span>)</span></span>,
                <span class="marker" id="mapping-231"></span><span class="token del" data-title="call_expression/call_argument">FILE</span>,
                <span class="marker" id="mapping-232"></span><span class="token mv" id="move-src-91" data-title="call_expression/call_argument">"Not enough stake to propose"</span>
            )</span>;</span>

            <span class="marker" id="mapping-233"></span><span class="token del" data-title="block_statement/expression_statement">createCandidate(candidate, Constants.getGovernancePeriod());</span>
            <span class="marker" id="mapping-234"></span><span class="token del" data-title="block_statement/emit_statement">emit Proposal(candidate, msg.sender, epoch(), Constants.getGovernancePeriod());</span>
        }</span></span>

        <span class="marker" id="mapping-235"></span><span class="token del" data-title="function_body/expression_statement">Require.that(
            epoch() &lt; startFor(candidate).add(periodFor(candidate)),
            FILE,
            "Ended"
        );</span>

        <span class="marker" id="mapping-236"></span><span class="token mv" id="move-src-92" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-237"></span><span class="token upd" id="move-src-93" data-title="variable_declaration/identifier">bonded</span></span> = <span class="marker" id="mapping-238"></span><span class="token upd" id="move-src-94" data-title="call_expression/identifier"><span class="cupd">b</span>a<span class="cupd">l</span>anceOf</span>(msg.sender);
        <span class="marker" id="mapping-239"></span><span class="token del" data-title="function_body/variable_declaration_statement">Candidate.Vote recordedVote = recordedVote(msg.sender, candidate);</span>
        <span class="marker" id="mapping-240"></span><span class="token del" data-title="function_body/if_statement">if (vote == recordedVote) {
            return;
        }</span>

        <span class="marker" id="mapping-241"></span><span class="token del" data-title="function_body/if_statement">if (recordedVote == Candidate.Vote.REJECT) {
            decrementRejectFor(candidate, bonded, "Govern: Insufficient reject");
        }</span>
        <span class="marker" id="mapping-242"></span><span class="token del" data-title="function_body/if_statement">if (recordedVote == Candidate.Vote.APPROVE) {
            decrementApproveFor(candidate, bonded, "Govern: Insufficient approve");
        }</span>
        <span class="marker" id="mapping-243"></span><span class="token del" data-title="function_body/if_statement">if (vote == Candidate.Vote.REJECT) {
            incrementRejectFor(candidate, bonded);
        }</span>
        <span class="marker" id="mapping-244"></span><span class="token del" data-title="function_body/if_statement">if (vote == Candidate.Vote.APPROVE) {
            incrementApproveFor(candidate, bonded);
        }</span>

        <span class="marker" id="mapping-245"></span><span class="token upd" id="move-src-95" data-title="call_expression/identifier">rec<span class="cupd">o</span><span class="cupd">r</span>dVote</span>(msg.sender<span class="marker" id="mapping-246"></span><span class="token del" data-title="call_expression/,">,</span> <span class="marker" id="mapping-247"></span><span class="token del" data-title="call_expression/call_argument">candidate</span><span class="marker" id="mapping-248"></span><span class="token del" data-title="call_expression/,">,</span> <span class="marker" id="mapping-249"></span><span class="token del" data-title="call_expression/call_argument">vote</span>);
        <span class="marker" id="mapping-250"></span><span class="token mv" id="move-src-96" data-title="function_body/expression_statement"><span class="marker" id="mapping-251"></span><span class="token del" data-title="call_expression/identifier">placeLock</span>(msg.sender, <span class="marker" id="mapping-252"></span><span class="token upd" id="move-src-97" data-title="call_argument/identifier">c<span class="cupd">a</span><span class="cupd">n</span>didate</span>);</span>

        <span class="marker" id="mapping-253"></span><span class="token del" data-title="function_body/emit_statement">emit Vote(msg.sender, candidate, vote, bonded);</span>
    }</span>

    <span class="marker" id="mapping-254"></span><span class="token del" data-title="contract_body/function_definition">function commit(<span class="marker" id="mapping-255"></span><span class="token del" data-title="function_definition/parameter">address candidate</span>) <span class="marker" id="mapping-256"></span><span class="token mv" id="move-src-98" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-257"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-258"></span><span class="token mv" id="move-src-99" data-title="function_body/expression_statement">Require.that(
            <span class="marker" id="mapping-259"></span><span class="token del" data-title="call_argument/call_expression">isNominated(candidate)</span>,
            FILE,
            "Not nominated"
        );</span>

        <span class="marker" id="mapping-260"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-261"></span><span class="token mv" id="move-src-100" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-262"></span><span class="token upd" id="move-src-101" data-title="variable_declaration/identifier"><span class="cupd">e</span>n<span class="cupd">d</span>sAfter</span></span> = <span class="marker" id="mapping-263"></span><span class="token del" data-title="variable_declaration_statement/call_expression">startFor(candidate).add(periodFor(candidate)).sub(1)</span>;</span>

        <span class="marker" id="mapping-264"></span><span class="token del" data-title="function_body/expression_statement">Require.that(
            epoch() &gt; endsAfter,
            FILE,
            "Not ended"
        );</span>

        <span class="marker" id="mapping-265"></span><span class="token del" data-title="function_body/expression_statement">Require.that(
            epoch() &lt;= endsAfter.add(1).add(Constants.getGovernanceExpiration()),
            FILE,
            "Expired"
        );</span>

        <span class="marker" id="mapping-266"></span><span class="token del" data-title="function_body/expression_statement">Require.that(
            Decimal.ratio(votesFor(candidate), totalBondedAt(endsAfter)).greaterThan(Constants.getGovernanceQuorum()),
            FILE,
            "Must have quorom"
        );</span>

        <span class="marker" id="mapping-267"></span><span class="token del" data-title="function_body/expression_statement">Require.that(
            approveFor(candidate) &gt; rejectFor(candidate),
            FILE,
            "Not approved"
        );</span>

        <span class="marker" id="mapping-268"></span><span class="token del" data-title="function_body/expression_statement">upgradeTo(candidate);</span>

        <span class="marker" id="mapping-269"></span><span class="token del" data-title="function_body/emit_statement">emit Commit(msg.sender, candidate);</span>
    }</span></span>

    <span class="marker" id="mapping-270"></span><span class="token del" data-title="contract_body/function_definition">function emergencyCommit(<span class="marker" id="mapping-271"></span><span class="token mv" id="move-src-102" data-title="function_definition/parameter">address candidate</span>) <span class="marker" id="mapping-272"></span><span class="token mv" id="move-src-103" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-273"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-274"></span><span class="token del" data-title="function_body/expression_statement">Require.that(
            isNominated(candidate),
            FILE,
            "Not nominated"
        );</span>

        <span class="marker" id="mapping-275"></span><span class="token del" data-title="function_body/expression_statement">Require.that(
            epochTime() &gt; epoch().add(Constants.getGovernanceEmergencyDelay()),
            FILE,
            "Epoch synced"
        );</span>

        <span class="marker" id="mapping-276"></span><span class="token del" data-title="function_body/expression_statement">Require.that(
            Decimal.ratio(approveFor(candidate), totalSupply()).greaterThan(Constants.getGovernanceSuperMajority()),
            FILE,
            "Must have super majority"
        );</span>

        <span class="marker" id="mapping-277"></span><span class="token del" data-title="function_body/expression_statement">Require.that(
            approveFor(candidate) &gt; rejectFor(candidate),
            FILE,
            "Not approved"
        );</span>

        <span class="marker" id="mapping-278"></span><span class="token mv" id="move-src-104" data-title="function_body/expression_statement">upgradeTo(candidate);</span>

        <span class="marker" id="mapping-279"></span><span class="token mv" id="move-src-105" data-title="function_body/emit_statement">emit Commit(msg.sender, candidate);</span>
    }</span></span>

    <span class="marker" id="mapping-280"></span><span class="token del" data-title="contract_body/function_definition">function canPropose(<span class="marker" id="mapping-281"></span><span class="token mv" id="move-src-106" data-title="function_definition/parameter">address account</span>) <span class="marker" id="mapping-282"></span><span class="token del" data-title="function_definition/visibility">private</span> <span class="marker" id="mapping-283"></span><span class="token mv" id="move-src-107" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-284"></span><span class="token mv" id="move-src-108" data-title="function_definition/return_type_definition">returns (bool)</span> <span class="marker" id="mapping-285"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-286"></span><span class="token del" data-title="function_body/if_statement">if (totalBonded() == 0) {
            return false;
        }</span>

        <span class="marker" id="mapping-287"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-288"></span><span class="token del" data-title="variable_declaration_statement/variable_declaration">Decimal.D256 memory stake</span> = <span class="marker" id="mapping-289"></span><span class="token del" data-title="variable_declaration_statement/call_expression"><span class="marker" id="mapping-290"></span><span class="token del" data-title="call_expression/member_expression">Decimal.ratio</span>(<span class="marker" id="mapping-291"></span><span class="token del" data-title="call_expression/call_argument"><span class="marker" id="mapping-292"></span><span class="token del" data-title="call_argument/call_expression">balanceOf(<span class="marker" id="mapping-293"></span><span class="token mv" id="move-src-109" data-title="call_expression/call_argument">account</span>)</span></span>, <span class="marker" id="mapping-294"></span><span class="token del" data-title="call_expression/call_argument">totalSupply()</span>)</span>;</span>
        <span class="marker" id="mapping-295"></span><span class="token del" data-title="function_body/return_statement">return stake.greaterThan(Constants.getGovernanceProposalThreshold());</span>
    }</span></span>
}</span>


<span class="marker" id="mapping-296"></span><span class="token mv" id="move-src-110" data-title="source_file/comment">/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/</span>







contract Implementation is IDAO, <span class="marker" id="mapping-297"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">State</span>, Permission, <span class="marker" id="mapping-298"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">Govern</span> {
    using SafeMath for uint256;

    <span class="marker" id="mapping-299"></span><span class="token mv" id="move-src-111" data-title="contract_body/event_definition">event Advance(uint256 indexed epoch, uint256 block, uint256 timestamp);</span>
    <span class="marker" id="mapping-300"></span><span class="token mv" id="move-src-112" data-title="contract_body/event_definition">event Incentivization(address indexed account, uint256 amount);</span>
    <span class="marker" id="mapping-301"></span><span class="token mv" id="move-src-113" data-title="contract_body/event_definition">event IncentivizationWithStake(address indexed account, uint256 amount);</span>

    function initialize() initializer public {
        // Reward committer
        incentivize(msg.sender, Constants.getAdvanceIncentive());

        <span class="marker" id="mapping-302"></span><span class="token mv" id="move-src-114" data-title="function_body/comment"><span class="marker" id="mapping-303"></span><span class="token upd" id="move-src-115" data-title="function_body/comment"><span class="cupd">/</span>/<span class="cupd"> </span><span class="cupd">em</span>i<span class="cupd">t</span><span class="cupd"> </span>fi<span class="cupd">na</span><span class="cupd">l</span><span class="cupd"> </span><span class="cupd">r</span><span class="cupd">a</span><span class="cupd">t</span><span class="cupd">i</span>o</span></span>
        <span class="marker" id="mapping-304"></span><span class="token del" data-title="function_body/emit_statement">emit TokenSplitSnapshot(totalBonded(), totalSupply());</span>

        <span class="marker" id="mapping-305"></span><span class="token mv" id="move-src-116" data-title="function_body/comment"><span class="marker" id="mapping-306"></span><span class="token upd" id="move-src-117" data-title="function_body/comment"><span class="cupd">// </span>Bu<span class="cupd">r</span><span class="cupd">n</span><span class="cupd"> </span>bonded</span></span>
        <span class="marker" id="mapping-307"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-308"></span><span class="token del" data-title="expression_statement/call_expression"><span class="marker" id="mapping-309"></span><span class="token mv" id="move-src-118" data-title="call_expression/member_expression">dollar().<span class="marker" id="mapping-310"></span><span class="token upd" id="move-src-119" data-title="member_expression/identifier">bu<span class="cupd">r</span>n</span></span>(<span class="marker" id="mapping-311"></span><span class="token del" data-title="call_expression/call_argument">totalBonded()</span>)</span>;</span>

        // Dev rewards
        incentivizeWithStake(address(0xdaeD3f8E267CF2e5480A379d75BfABad58ab2144), <span class="marker" id="mapping-312"></span><span class="token upd" id="move-src-120" data-title="call_argument/number_literal">2<span class="cupd">000000e18</span></span>);
    }

    <span class="marker" id="mapping-313"></span><span class="token del" data-title="contract_body/function_definition">function advance() <span class="marker" id="mapping-314"></span><span class="token mv" id="move-src-121" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-315"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-316"></span><span class="token del" data-title="function_body/expression_statement">incentivize(msg.sender, Constants.getAdvanceIncentive());</span>

        <span class="marker" id="mapping-317"></span><span class="token del" data-title="function_body/expression_statement">Govern.step();</span>

        <span class="marker" id="mapping-318"></span><span class="token del" data-title="function_body/emit_statement">emit Advance(<span class="marker" id="mapping-319"></span><span class="token del" data-title="emit_statement/call_argument"><span class="marker" id="mapping-320"></span><span class="token mv" id="move-src-122" data-title="call_argument/call_expression">epoch()</span></span>, <span class="marker" id="mapping-321"></span><span class="token del" data-title="emit_statement/call_argument">block.number</span>, <span class="marker" id="mapping-322"></span><span class="token del" data-title="emit_statement/call_argument">block.timestamp</span>);</span>
    }</span></span>

    function incentivize(address account, uint256 amount) private {
        dollar().mint(account, amount);
        emit Incentivization(account, amount);
    }

    function incentivizeWithStake(address account, uint256 amount) private {
        incrementBalanceOf(account, amount);
        emit IncentivizationWithStake(account, amount);
    }

    /*
     * Bonding Functions
     */
    function withdraw(uint256 value) external <span class="marker" id="mapping-323"></span><span class="token del" data-title="function_definition/modifier_invocation">onlyFrozenOrLocked(msg.sender)</span> {
        dollar().transfer(msg.sender, value);
        decrementBalanceOfStaged(msg.sender, value, "Bonding: insufficient staged balance");

        emit Withdraw(msg.sender, value);
    }

    /*
     * Market Functions
    */

    // @notice: logic overview
    // Redeem `amount` of underlying at the given `couponEpoch`
    // Reverts if balance of underlying at `couponEpoch` is less than `amount`
    function redeemCoupons(uint256 couponEpoch, uint256 amount) external {
        require(epoch().sub(couponEpoch) &gt;= 2, "Market: Too early to redeem");
        require(amount != 0, "Market: Amount too low");

        decrementBalanceOfCouponUnderlying(msg.sender, couponEpoch, amount, "Market: Insufficient coupon underlying balance");
        dollar().mint(msg.sender, amount);

        emit CouponRedemption(msg.sender, couponEpoch, amount, 0);
    }

    function approveCoupons(address spender, uint256 amount) external {
        require(spender != address(0), "Market: Coupon approve to the zero address");

        updateAllowanceCoupons(msg.sender, spender, amount);

        emit CouponApproval(msg.sender, spender, amount);
    }

    function transferCoupons(address sender, address recipient, uint256 epoch, uint256 amount) external {
        require(sender != address(0), "Market: Coupon transfer from the zero address");
        require(recipient != address(0), "Market: Coupon transfer to the zero address");

        decrementBalanceOfCouponUnderlying(sender, epoch, amount, "Market: Insufficient coupon underlying balance");
        incrementBalanceOfCouponUnderlying(recipient, epoch, amount);

        if (msg.sender != sender &amp;&amp; allowanceCoupons(sender, msg.sender) != uint256(-1)) {
            decrementAllowanceCoupons(sender, msg.sender, amount, "Market: Insufficient coupon approval");
        }

        emit CouponTransfer(sender, recipient, epoch, amount);
    }
}
</pre></div><div class="col-6"><h5>26.sol</h5><pre class="pre-scrollable">pragma solidity ^0.5.17;
pragma experimental ABIEncoderV2;

/**
 * @dev Wrappers over Solidity's arithmetic operations with added overflow
 * checks.
 *
 * Arithmetic operations in Solidity wrap on overflow. This can easily result
 * in bugs, because programmers usually assume that an overflow raises an
 * error, which is the standard behavior in high level programming languages.
 * `SafeMath` restores this intuition by reverting the transaction when an
 * operation overflows.
 *
 * Using this library instead of the unchecked operations eliminates an entire
 * class of bugs, so it's recommended to use it always.
 */
library SafeMath {
    /**
     * @dev Returns the addition of two unsigned integers, reverting on
     * overflow.
     *
     * Counterpart to Solidity's `+` operator.
     *
     * Requirements:
     * - Addition cannot overflow.
     */
    function add(uint256 a, uint256 b) internal pure returns (uint256) {
        uint256 c = a + b;
        require(c &gt;= a, "SafeMath: addition overflow");

        return c;
    }

    /**
     * @dev Returns the subtraction of two unsigned integers, reverting on
     * overflow (when the result is negative).
     *
     * Counterpart to Solidity's `-` operator.
     *
     * Requirements:
     * - Subtraction cannot overflow.
     */
    function sub(uint256 a, uint256 b) internal pure returns (uint256) {
        return sub(a, b, "SafeMath: subtraction overflow");
    }

    /**
     * @dev Returns the subtraction of two unsigned integers, reverting with custom message on
     * overflow (when the result is negative).
     *
     * Counterpart to Solidity's `-` operator.
     *
     * Requirements:
     * - Subtraction cannot overflow.
     *
     * _Available since v2.4.0._
     */
    function sub(uint256 a, uint256 b, string memory errorMessage) internal pure returns (uint256) {
        require(b &lt;= a, errorMessage);
        uint256 c = a - b;

        return c;
    }

    /**
     * @dev Returns the multiplication of two unsigned integers, reverting on
     * overflow.
     *
     * Counterpart to Solidity's `*` operator.
     *
     * Requirements:
     * - Multiplication cannot overflow.
     */
    function mul(uint256 a, uint256 b) internal pure returns (uint256) {
        // Gas optimization: this is cheaper than requiring 'a' not being zero, but the
        // benefit is lost if 'b' is also tested.
        // See: https://github.com/OpenZeppelin/openzeppelin-contracts/pull/522
        if (a == 0) {
            return 0;
        }

        uint256 c = a * b;
        require(c / a == b, "SafeMath: multiplication overflow");

        return c;
    }

    /**
     * @dev Returns the integer division of two unsigned integers. Reverts on
     * division by zero. The result is rounded towards zero.
     *
     * Counterpart to Solidity's `/` operator. Note: this function uses a
     * `revert` opcode (which leaves remaining gas untouched) while Solidity
     * uses an invalid opcode to revert (consuming all remaining gas).
     *
     * Requirements:
     * - The divisor cannot be zero.
     */
    function div(uint256 a, uint256 b) internal pure returns (uint256) {
        return div(a, b, "SafeMath: division by zero");
    }

    /**
     * @dev Returns the integer division of two unsigned integers. Reverts with custom message on
     * division by zero. The result is rounded towards zero.
     *
     * Counterpart to Solidity's `/` operator. Note: this function uses a
     * `revert` opcode (which leaves remaining gas untouched) while Solidity
     * uses an invalid opcode to revert (consuming all remaining gas).
     *
     * Requirements:
     * - The divisor cannot be zero.
     *
     * _Available since v2.4.0._
     */
    function div(uint256 a, uint256 b, string memory errorMessage) internal pure returns (uint256) {
        // Solidity only automatically asserts when dividing by 0
        require(b &gt; 0, errorMessage);
        uint256 c = a / b;
        // assert(a == b * c + a % b); // There is no case in which this doesn't hold

        return c;
    }

    /**
     * @dev Returns the remainder of dividing two unsigned integers. (unsigned integer modulo),
     * Reverts when dividing by zero.
     *
     * Counterpart to Solidity's `%` operator. This function uses a `revert`
     * opcode (which leaves remaining gas untouched) while Solidity uses an
     * invalid opcode to revert (consuming all remaining gas).
     *
     * Requirements:
     * - The divisor cannot be zero.
     */
    function mod(uint256 a, uint256 b) internal pure returns (uint256) {
        return mod(a, b, "SafeMath: modulo by zero");
    }

    /**
     * @dev Returns the remainder of dividing two unsigned integers. (unsigned integer modulo),
     * Reverts with custom message when dividing by zero.
     *
     * Counterpart to Solidity's `%` operator. This function uses a `revert`
     * opcode (which leaves remaining gas untouched) while Solidity uses an
     * invalid opcode to revert (consuming all remaining gas).
     *
     * Requirements:
     * - The divisor cannot be zero.
     *
     * _Available since v2.4.0._
     */
    function mod(uint256 a, uint256 b, string memory errorMessage) internal pure returns (uint256) {
        require(b != 0, errorMessage);
        return a % b;
    }
}



interface IUniswapV2Pair {
    event Approval(address indexed owner, address indexed spender, uint value);
    event Transfer(address indexed from, address indexed to, uint value);

    function name() external pure returns (string memory);
    function symbol() external pure returns (string memory);
    function decimals() external pure returns (uint8);
    function totalSupply() external view returns (uint);
    function balanceOf(address owner) external view returns (uint);
    function allowance(address owner, address spender) external view returns (uint);

    function approve(address spender, uint value) external returns (bool);
    function transfer(address to, uint value) external returns (bool);
    function transferFrom(address from, address to, uint value) external returns (bool);

    function DOMAIN_SEPARATOR() external view returns (bytes32);
    function PERMIT_TYPEHASH() external pure returns (bytes32);
    function nonces(address owner) external view returns (uint);

    function permit(address owner, address spender, uint value, uint deadline, uint8 v, bytes32 r, bytes32 s) external;

    event Mint(address indexed sender, uint amount0, uint amount1);
    event Burn(address indexed sender, uint amount0, uint amount1, address indexed to);
    event Swap(
        address indexed sender,
        uint amount0In,
        uint amount1In,
        uint amount0Out,
        uint amount1Out,
        address indexed to
    );
    event Sync(uint112 reserve0, uint112 reserve1);

    function MINIMUM_LIQUIDITY() external pure returns (uint);
    function factory() external view returns (address);
    function token0() external view returns (address);
    function token1() external view returns (address);
    function getReserves() external view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast);
    function price0CumulativeLast() external view returns (uint);
    function price1CumulativeLast() external view returns (uint);
    function kLast() external view returns (uint);

    function mint(address to) external returns (uint liquidity);
    function burn(address to) external returns (uint amount0, uint amount1);
    function swap(uint amount0Out, uint amount1Out, address to, bytes calldata data) external;
    function skim(address to) external;
    function sync() external;

    function initialize(address, address) external;
}



/**
 * @dev Interface of the ERC20 standard as defined in the EIP. Does not include
 * the optional functions; to access them see {ERC20Detailed}.
 */
interface IERC20 {
    /**
     * @dev Returns the amount of tokens in existence.
     */
    function totalSupply() external view returns (uint256);

    /**
     * @dev Returns the amount of tokens owned by `account`.
     */
    function balanceOf(address account) external view returns (uint256);

    /**
     * @dev Moves `amount` tokens from the caller's account to `recipient`.
     *
     * Returns a boolean value indicating whether the operation succeeded.
     *
     * Emits a {Transfer} event.
     */
    function transfer(address recipient, uint256 amount) external returns (bool);

    /**
     * @dev Returns the remaining number of tokens that `spender` will be
     * allowed to spend on behalf of `owner` through {transferFrom}. This is
     * zero by default.
     *
     * This value changes when {approve} or {transferFrom} are called.
     */
    function allowance(address owner, address spender) external view returns (uint256);

    /**
     * @dev Sets `amount` as the allowance of `spender` over the caller's tokens.
     *
     * Returns a boolean value indicating whether the operation succeeded.
     *
     * IMPORTANT: Beware that changing an allowance with this method brings the risk
     * that someone may use both the old and the new allowance by unfortunate
     * transaction ordering. One possible solution to mitigate this race
     * condition is to first reduce the spender's allowance to 0 and set the
     * desired value afterwards:
     * https://github.com/ethereum/EIPs/issues/20#issuecomment-263524729
     *
     * Emits an {Approval} event.
     */
    function approve(address spender, uint256 amount) external returns (bool);

    /**
     * @dev Moves `amount` tokens from `sender` to `recipient` using the
     * allowance mechanism. `amount` is then deducted from the caller's
     * allowance.
     *
     * Returns a boolean value indicating whether the operation succeeded.
     *
     * Emits a {Transfer} event.
     */
    function transferFrom(address sender, address recipient, uint256 amount) external returns (bool);

    /**
     * @dev Emitted when `value` tokens are moved from one account (`from`) to
     * another (`to`).
     *
     * Note that `value` may be zero.
     */
    event Transfer(address indexed from, address indexed to, uint256 value);

    /**
     * @dev Emitted when the allowance of a `spender` for an `owner` is set by
     * a call to {approve}. `value` is the new allowance.
     */
    event Approval(address indexed owner, address indexed spender, uint256 value);
}


/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/



contract IDollar is IERC20 {
    function burn(uint256 amount) public;
    function burnFrom(address account, uint256 amount) public;
    function mint(address account, uint256 amount) public returns (bool);
}


/*
    Copyright 2019 dYdX Trading Inc.
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/



/**
 * @title Decimal
 * @author dYdX
 *
 * Library that defines a fixed-point number with 18 decimal places.
 */
library Decimal {
    using SafeMath for uint256;

    // ============ Constants ============

    uint256 constant BASE = 10**18;

    // ============ Structs ============


    struct D256 {
        uint256 value;
    }

    // ============ Static Functions ============

    function zero()
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: 0 });
    }

    function one()
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: BASE });
    }

    function from(
        uint256 a
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: a.mul(BASE) });
    }

    function ratio(
        uint256 a,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: getPartial(a, BASE, b) });
    }

    // ============ Self Functions ============

    function add(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.add(b.mul(BASE)) });
    }

    function sub(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.sub(b.mul(BASE)) });
    }

    function sub(
        D256 memory self,
        uint256 b,
        string memory reason
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.sub(b.mul(BASE), reason) });
    }

    function mul(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.mul(b) });
    }

    function div(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.div(b) });
    }

    function pow(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        if (b == 0) {
            return from(1);
        }

        D256 memory temp = D256({ value: self.value });
        for (uint256 i = 1; i &lt; b; i++) {
            temp = mul(temp, self);
        }

        return temp;
    }

    function add(
        D256 memory self,
        D256 memory b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.add(b.value) });
    }

    function sub(
        D256 memory self,
        D256 memory b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.sub(b.value) });
    }

    function sub(
        D256 memory self,
        D256 memory b,
        string memory reason
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.sub(b.value, reason) });
    }

    function mul(
        D256 memory self,
        D256 memory b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: getPartial(self.value, b.value, BASE) });
    }

    function div(
        D256 memory self,
        D256 memory b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: getPartial(self.value, BASE, b.value) });
    }

    function equals(D256 memory self, D256 memory b) internal pure returns (bool) {
        return self.value == b.value;
    }

    function greaterThan(D256 memory self, D256 memory b) internal pure returns (bool) {
        return compareTo(self, b) == 2;
    }

    function lessThan(D256 memory self, D256 memory b) internal pure returns (bool) {
        return compareTo(self, b) == 0;
    }

    function greaterThanOrEqualTo(D256 memory self, D256 memory b) internal pure returns (bool) {
        return compareTo(self, b) &gt; 0;
    }

    function lessThanOrEqualTo(D256 memory self, D256 memory b) internal pure returns (bool) {
        return compareTo(self, b) &lt; 2;
    }

    function isZero(D256 memory self) internal pure returns (bool) {
        return self.value == 0;
    }

    function asUint256(D256 memory self) internal pure returns (uint256) {
        return self.value.div(BASE);
    }

    // ============ Core Methods ============

    function getPartial(
        uint256 target,
        uint256 numerator,
        uint256 denominator
    )
    private
    pure
    returns (uint256)
    {
        return target.mul(numerator).div(denominator);
    }

    function compareTo(
        D256 memory a,
        D256 memory b
    )
    private
    pure
    returns (uint256)
    {
        if (a.value == b.value) {
            return 1;
        }
        return a.value &gt; b.value ? 2 : 0;
    }
}


/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/



contract IOracle {
    function setup() public;
    function capture() public returns (Decimal.D256 memory, bool);
    function pair() external view returns (address);
}


/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/






contract Account {
    enum Status {
        Frozen,
        Fluid,
        Locked
    }

    struct State {
        uint256 staged;
        uint256 balance;
        mapping(uint256 =&gt; uint256) coupons;
        mapping(address =&gt; uint256) couponAllowances;
        uint256 fluidUntil;
        uint256 lockedUntil;
    }
}

contract Epoch {
    struct Global {
        uint256 start;
        uint256 period;
        uint256 current;
    }

    struct Coupons {
        uint256 outstanding;
        uint256 expiration;
        uint256[] expiring;
    }

    struct State {
        uint256 bonded;
        Coupons coupons;
    }
}

contract Candidate {
    enum Vote {
        UNDECIDED,
        APPROVE,
        REJECT
    }

    struct State {
        uint256 start;
        uint256 period;
        uint256 approve;
        uint256 reject;
        mapping(address =&gt; Vote) votes;
        bool initialized;
    }
}

contract Era {
    enum Status {
        EXPANSION,
        CONTRACTION
    }

    struct State {
        Status status;
        uint256 start;
    }
}

contract Storage {
    struct Provider {
        IDollar dollar;
        IOracle oracle;
        address pool;
    }

    struct Balance {
        uint256 supply;
        uint256 bonded;
        uint256 staged;
        uint256 redeemable;
        uint256 debt;
        uint256 coupons;
    }

    struct State {
        Epoch.Global epoch;
        Balance balance;
        Provider provider;

        mapping(address =&gt; Account.State) accounts;
        mapping(uint256 =&gt; Epoch.State) epochs;
        mapping(address =&gt; Candidate.State) candidates;
    }

    struct State16 {
        mapping(address =&gt; mapping(uint256 =&gt; uint256)) couponUnderlyingByAccount;
        uint256 couponUnderlying;
    }

    struct State18 {
        Era.State era;
    }

    <span class="marker" id="mapping-324"></span><span class="token add" data-title="contract_body/struct_declaration">struct State25 {
        <span class="marker" id="mapping-325"></span><span class="token add" data-title="struct_declaration/struct_member"><span class="marker" id="mapping-326"></span><span class="token mv" id="move-dst-5" data-title="struct_member/type_name">uint256</span> poolTotalRewarded;</span>
        <span class="marker" id="mapping-327"></span><span class="token add" data-title="struct_declaration/struct_member"><span class="marker" id="mapping-328"></span><span class="token mv" id="move-dst-4" data-title="struct_member/type_name">uint256</span> poolDollarWithdrawable;</span>
        <span class="marker" id="mapping-329"></span><span class="token add" data-title="struct_declaration/struct_member">mapping(address =&gt; bool) poolWithdrawn;</span>
        <span class="marker" id="mapping-330"></span><span class="token add" data-title="struct_declaration/struct_member">address owner;</span>
    }</span>
}

contract State {
    Storage.State _state;

    // EIP-16
    Storage.State16 _state16;

    // EIP-18
    Storage.State18 _state18;

    <span class="marker" id="mapping-331"></span><span class="token add" data-title="contract_body/comment">// EIP-25</span>
    <span class="marker" id="mapping-332"></span><span class="token add" data-title="contract_body/state_variable_declaration">Storage.State25 _state25;</span>
}


/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/



<span class="marker" id="mapping-333"></span><span class="token mv" id="move-dst-2" data-title="source_file/contract_declaration">contract IDAO {
    function epoch() external view returns (uint256);

    <span class="marker" id="mapping-334"></span><span class="token mv" id="move-dst-111" data-title="contract_body/event_definition">event Advance(uint256 indexed epoch, uint256 block, uint256 timestamp);</span>
    <span class="marker" id="mapping-335"></span><span class="token mv" id="move-dst-112" data-title="contract_body/event_definition">event Incentivization(address indexed account, uint256 amount);</span>
    <span class="marker" id="mapping-336"></span><span class="token mv" id="move-dst-113" data-title="contract_body/event_definition">event IncentivizationWithStake(address indexed account, uint256 amount);</span>
    <span class="marker" id="mapping-337"></span><span class="token add" data-title="contract_body/event_definition">event OwnerChanged(address indexed previousOwner, address indexed newOwner);</span>

    event TokenSplitSnapshot(uint256 totalBonded, uint256 totalStake);

    /* Regulator */
    event SupplyIncrease(uint256 indexed epoch, uint256 price, uint256 newRedeemable, uint256 lessDebt, uint256 newBonded);
    event SupplyDecrease(uint256 indexed epoch, uint256 price, uint256 newDebt);
    event SupplyNeutral(uint256 indexed epoch);

    /* Stabilizer */
    event StabilityReward(uint256 indexed epoch, uint256 rate, uint256 amount);

    /* Bonding */
    event Deposit(address indexed account, uint256 value);
    event Withdraw(address indexed account, uint256 value);
    event Bond(address indexed account, uint256 start, uint256 value, uint256 valueUnderlying);
    event Unbond(address indexed account, uint256 start, uint256 value, uint256 valueUnderlying);

    /* Market */
    event CouponExpiration(uint256 indexed epoch, uint256 couponsExpired, uint256 lessRedeemable, uint256 lessDebt, uint256 newBonded);
    event CouponPurchase(address indexed account, uint256 indexed epoch, uint256 dollarAmount, uint256 couponAmount);
    event CouponRedemption(address indexed account, uint256 indexed epoch, uint256 amount, uint256 couponAmount);
    event CouponTransfer(address indexed from, address indexed to, uint256 indexed epoch, uint256 value);
    event CouponApproval(address indexed owner, address indexed spender, uint256 value);

    <span class="marker" id="mapping-338"></span><span class="token add" data-title="contract_body/comment">/* Governance */</span>
    <span class="marker" id="mapping-339"></span><span class="token mv" id="move-dst-81" data-title="contract_body/event_definition">event Proposal(address indexed candidate, address indexed account, uint256 indexed start, uint256 period);</span>
    <span class="marker" id="mapping-340"></span><span class="token mv" id="move-dst-82" data-title="contract_body/event_definition">event Vote(address indexed account, address indexed candidate, Candidate.Vote vote, uint256 bonded);</span>
    <span class="marker" id="mapping-341"></span><span class="token mv" id="move-dst-83" data-title="contract_body/event_definition">event Commit(address indexed account, address indexed candidate);</span>
}</span>


/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/



<span class="marker" id="mapping-342"></span><span class="token mv" id="move-dst-77" data-title="source_file/contract_declaration">contract <span class="marker" id="mapping-343"></span><span class="token upd" id="move-dst-78" data-title="contract_declaration/identifier">IPool</span> {
    <span class="marker" id="mapping-344"></span><span class="token add" data-title="contract_body/comment">/*
     * Emergency Functions
     */</span>
    <span class="marker" id="mapping-345"></span><span class="token add" data-title="contract_body/function_definition">function emergencyWithdraw(address token, uint256 value) external;</span>
    <span class="marker" id="mapping-346"></span><span class="token add" data-title="contract_body/function_definition">function emergencyPause() external;</span>

    <span class="marker" id="mapping-347"></span><span class="token add" data-title="contract_body/comment">/*
     * Getters
     */</span>
    <span class="marker" id="mapping-348"></span><span class="token add" data-title="contract_body/function_definition">function totalBonded() public view returns (uint256);</span>
    <span class="marker" id="mapping-349"></span><span class="token add" data-title="contract_body/function_definition">function totalStaged() public view returns (uint256);</span>
    <span class="marker" id="mapping-350"></span><span class="token add" data-title="contract_body/function_definition">function totalClaimable() public view returns (uint256);</span>
    <span class="marker" id="mapping-351"></span><span class="token add" data-title="contract_body/function_definition">function totalRewarded() public view returns (uint256);</span>
    <span class="marker" id="mapping-352"></span><span class="token add" data-title="contract_body/function_definition">function totalPhantom() public view returns (uint256);</span>
    <span class="marker" id="mapping-353"></span><span class="token add" data-title="contract_body/function_definition">function univ2() public view returns (IERC20);</span>

    <span class="marker" id="mapping-354"></span><span class="token add" data-title="contract_body/comment">/**
     * Account
     */</span>
    <span class="marker" id="mapping-355"></span><span class="token add" data-title="contract_body/function_definition">function balanceOfStaged(address account) public view returns (uint256);</span>
    <span class="marker" id="mapping-356"></span><span class="token add" data-title="contract_body/function_definition">function balanceOfClaimable(address account) public view returns (uint256);</span>
    <span class="marker" id="mapping-357"></span><span class="token add" data-title="contract_body/function_definition">function balanceOfBonded(address account) public view returns (uint256);</span>
    <span class="marker" id="mapping-358"></span><span class="token add" data-title="contract_body/function_definition">function balanceOfPhantom(address account) public view returns (uint256);</span>
    <span class="marker" id="mapping-359"></span><span class="token mv" id="move-dst-32" data-title="contract_body/function_definition">function <span class="marker" id="mapping-360"></span><span class="token upd" id="move-dst-33" data-title="function_definition/identifier">balanc<span class="cupd">e</span>OfRewarded</span>(<span class="marker" id="mapping-361"></span><span class="token mv" id="move-dst-64" data-title="function_definition/parameter">address account</span>) <span class="marker" id="mapping-362"></span><span class="token add" data-title="visibility/public">public</span> <span class="marker" id="mapping-363"></span><span class="token add" data-title="state_mutability/view">view</span> returns (uint256);</span>
}</span>


/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/



<span class="marker" id="mapping-364"></span><span class="token mv" id="move-dst-3" data-title="source_file/library_declaration">library Constants {
    /* Chain */
    uint256 private constant CHAIN_ID = 1; // Mainnet

    /* Oracle */
    address private constant USDC = address(0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48);
    uint256 private constant ORACLE_RESERVE_MINIMUM = 1e10; // 10,000 USDC

    /* Bonding */
    uint256 private constant INITIAL_STAKE_MULTIPLE = 1e6; // 100 ESD -&gt; 100M ESDS

    /* Epoch */
    struct EpochStrategy {
        uint256 offset;
        uint256 start;
        uint256 period;
    }

    /* DAO */
    uint256 private constant ADVANCE_INCENTIVE = 2500e18; // 2500 ESD

    /* Pool */
    uint256 private constant POOL_EXIT_LOCKUP_EPOCHS = 5; // 5 epochs fluid

    /* Deployed */
    address private constant DAO_ADDRESS = address(0x443D2f2755DB5942601fa062Cc248aAA153313D3);
    address private constant DOLLAR_ADDRESS = address(0x36F3FD68E7325a35EB768F1AedaAe9EA0689d723);
    address private constant PAIR_ADDRESS = address(0x88ff79eB2Bc5850F27315415da8685282C7610F9);
    address private constant TREASURY_ADDRESS = address(0x460661bd4A5364A3ABCc9cfc4a8cE7038d05Ea22);
    <span class="marker" id="mapping-365"></span><span class="token add" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-366"></span><span class="token add" data-title="state_variable_declaration/type_name">address</span> <span class="marker" id="mapping-367"></span><span class="token mv" id="move-dst-14" data-title="state_variable_declaration/visibility">private</span> constant POOL_ADDRESS = <span class="marker" id="mapping-368"></span><span class="token add" data-title="state_variable_declaration/type_cast_expression">address(0x4082D11E506e3250009A991061ACd2176077C88f)</span>;</span>
    <span class="marker" id="mapping-369"></span><span class="token add" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-370"></span><span class="token add" data-title="state_variable_declaration/type_name">address</span> <span class="marker" id="mapping-371"></span><span class="token mv" id="move-dst-12" data-title="state_variable_declaration/visibility">private</span> constant ORACLE_ADDRESS = <span class="marker" id="mapping-372"></span><span class="token add" data-title="state_variable_declaration/type_cast_expression">address(0xea9f8bb8B5e8BA3D38628f0E18Ee82300eddBa0E)</span>;</span>
    <span class="marker" id="mapping-373"></span><span class="token add" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-374"></span><span class="token add" data-title="state_variable_declaration/type_name">address</span> <span class="marker" id="mapping-375"></span><span class="token mv" id="move-dst-16" data-title="state_variable_declaration/visibility">private</span> constant V2_MIGRATOR_ADDRESS = <span class="marker" id="mapping-376"></span><span class="token add" data-title="state_variable_declaration/type_cast_expression">address(0xC61D12896421613b30D56F85c093CdDa43Ab2CE7)</span>;</span>
    <span class="marker" id="mapping-377"></span><span class="token add" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-378"></span><span class="token add" data-title="state_variable_declaration/type_name">address</span> <span class="marker" id="mapping-379"></span><span class="token mv" id="move-dst-17" data-title="state_variable_declaration/visibility">private</span> constant V2_DAO_ADDRESS = <span class="marker" id="mapping-380"></span><span class="token add" data-title="state_variable_declaration/type_cast_expression">address(0x1bba92F379375387bf8F927058da14D47464cB7A)</span>;</span>

    /**
     * Getters
     */

    function getUsdcAddress() internal pure returns (address) {
        return USDC;
    }

    function getOracleReserveMinimum() internal pure returns (uint256) {
        return ORACLE_RESERVE_MINIMUM;
    }

    function getInitialStakeMultiple() internal pure returns (uint256) {
        return INITIAL_STAKE_MULTIPLE;
    }

    function getAdvanceIncentive() internal pure returns (uint256) {
        return ADVANCE_INCENTIVE;
    }

    function getPoolExitLockupEpochs() internal pure returns (uint256) {
        return POOL_EXIT_LOCKUP_EPOCHS;
    }

    function getChainId() internal pure returns (uint256) {
        return CHAIN_ID;
    }

    function getDaoAddress() internal pure returns (address) {
        return DAO_ADDRESS;
    }

    function getDollarAddress() internal pure returns (address) {
        return DOLLAR_ADDRESS;
    }

    function getPairAddress() internal pure returns (address) {
        return PAIR_ADDRESS;
    }

    function getTreasuryAddress() internal pure returns (address) {
        return TREASURY_ADDRESS;
    }

    <span class="marker" id="mapping-381"></span><span class="token add" data-title="contract_body/function_definition">function getPoolAddress() <span class="marker" id="mapping-382"></span><span class="token mv" id="move-dst-28" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-383"></span><span class="token mv" id="move-dst-29" data-title="function_definition/state_mutability">pure</span> <span class="marker" id="mapping-384"></span><span class="token add" data-title="function_definition/return_type_definition">returns (address)</span> <span class="marker" id="mapping-385"></span><span class="token add" data-title="function_definition/function_body">{
        return POOL_ADDRESS;
    }</span></span>

    <span class="marker" id="mapping-386"></span><span class="token add" data-title="contract_body/function_definition">function getOracleAddress() <span class="marker" id="mapping-387"></span><span class="token mv" id="move-dst-24" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-388"></span><span class="token mv" id="move-dst-25" data-title="function_definition/state_mutability">pure</span> <span class="marker" id="mapping-389"></span><span class="token add" data-title="function_definition/return_type_definition">returns (address)</span> <span class="marker" id="mapping-390"></span><span class="token add" data-title="function_definition/function_body">{
        return ORACLE_ADDRESS;
    }</span></span>

    <span class="marker" id="mapping-391"></span><span class="token add" data-title="contract_body/function_definition">function getV2MigratorAddress() <span class="marker" id="mapping-392"></span><span class="token mv" id="move-dst-20" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-393"></span><span class="token mv" id="move-dst-21" data-title="function_definition/state_mutability">pure</span> <span class="marker" id="mapping-394"></span><span class="token add" data-title="function_definition/return_type_definition">returns (address)</span> <span class="marker" id="mapping-395"></span><span class="token add" data-title="function_definition/function_body">{
        return V2_MIGRATOR_ADDRESS;
    }</span></span>

    <span class="marker" id="mapping-396"></span><span class="token add" data-title="contract_body/function_definition">function getV2DaoAddress() <span class="marker" id="mapping-397"></span><span class="token mv" id="move-dst-18" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-398"></span><span class="token mv" id="move-dst-19" data-title="function_definition/state_mutability">pure</span> <span class="marker" id="mapping-399"></span><span class="token add" data-title="function_definition/return_type_definition">returns (address)</span> <span class="marker" id="mapping-400"></span><span class="token add" data-title="function_definition/function_body">{
        return V2_DAO_ADDRESS;
    }</span></span>
}</span>


<span class="marker" id="mapping-401"></span><span class="token mv" id="move-dst-1" data-title="source_file/comment">/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/</span>






<span class="marker" id="mapping-402"></span><span class="token mv" id="move-dst-34" data-title="source_file/contract_declaration">contract Getters is State {
    using SafeMath for uint256;
    using Decimal for Decimal.D256;

    bytes32 private constant IMPLEMENTATION_SLOT = 0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc;

    /**
     * ERC20 Interface
     */

    function name() public view returns (string memory) {
        return "Empty Set Dollar Stake";
    }

    function symbol() public view returns (string memory) {
        return "ESDS";
    }

    function decimals() public view returns (uint8) {
        return 18;
    }

    function balanceOf(address account) public view returns (uint256) {
        return _state.accounts[account].balance;
    }

    function totalSupply() public view returns (uint256) {
        return _state.balance.supply;
    }

    function allowance(address owner, address spender) external view returns (uint256) {
        return 0;
    }

    /**
     * Global
     */

    function dollar() public view returns (IDollar) {
        return <span class="marker" id="mapping-403"></span><span class="token add" data-title="return_statement/call_expression">IDollar(Constants.getDollarAddress())</span>;
    }

    function oracle() public view returns (IOracle) {
        return <span class="marker" id="mapping-404"></span><span class="token add" data-title="return_statement/call_expression">IOracle(Constants.getOracleAddress())</span>;
    }

    <span class="marker" id="mapping-405"></span><span class="token add" data-title="contract_body/function_definition">function pool() public view returns (IPool) {
        return IPool(Constants.getPoolAddress());
    }</span>

    <span class="marker" id="mapping-406"></span><span class="token add" data-title="contract_body/function_definition">function univ2() public view returns (IERC20) {
        return IERC20(Constants.getPairAddress());
    }</span>

    function <span class="marker" id="mapping-407"></span><span class="token upd" id="move-dst-35" data-title="function_definition/identifier">v2Migrator</span>() public view returns (address) {
        return <span class="marker" id="mapping-408"></span><span class="token add" data-title="return_statement/call_expression">Constants.getV2MigratorAddress()</span>;
    }

    <span class="marker" id="mapping-409"></span><span class="token add" data-title="contract_body/function_definition">function owner() public view returns (address) {
        return _state25.owner;
    }</span>

    function totalBonded() public view returns (uint256) {
        return _state.balance.bonded;
    }

    function totalStaged() public view returns (uint256) {
        return _state.balance.staged;
    }

    function totalCouponUnderlying() public view returns (uint256) {
        return _state16.couponUnderlying;
    }

    function totalNet() public view returns (uint256) {
        return dollar().totalSupply().sub(totalDebt());
    }

    /**
     * Account
     */

    function balanceOfStaged(address account) public view returns (uint256) {
        return _state.accounts[account].staged;
    }

    function balanceOfBonded(address account) public view returns (uint256) {
        uint256 totalSupply = totalSupply();
        if (totalSupply == 0) {
            return 0;
        }
        return totalBonded().mul(balanceOf(account)).div(totalSupply);
    }

    function balanceOfCouponUnderlying(address account, uint256 epoch) public view returns (uint256) {
        return _state16.couponUnderlyingByAccount[account][epoch];
    }

    function statusOf(address account) public view returns (Account.Status) {
        if (_state.accounts[account].lockedUntil &gt; epoch()) {
            return Account.Status.Locked;
        }

        return epoch() &gt;= _state.accounts[account].fluidUntil ? Account.Status.Frozen : Account.Status.Fluid;
    }

    function fluidUntil(address account) public view returns (uint256) {
        return _state.accounts[account].fluidUntil;
    }

    function lockedUntil(address account) public view returns (uint256) {
        return _state.accounts[account].lockedUntil;
    }

    function allowanceCoupons(address owner, address spender) public view returns (uint256) {
        return _state.accounts[owner].couponAllowances[spender];
    }

    /**
     * Epoch
     */

    function epoch() public view returns (uint256) {
        return _state.epoch.current;
    }

    <span class="marker" id="mapping-410"></span><span class="token add" data-title="contract_body/function_definition">function epochTime() <span class="marker" id="mapping-411"></span><span class="token mv" id="move-dst-36" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-412"></span><span class="token mv" id="move-dst-37" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-413"></span><span class="token mv" id="move-dst-38" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-414"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-415"></span><span class="token add" data-title="function_body/return_statement">return <span class="marker" id="mapping-416"></span><span class="token mv" id="move-dst-122" data-title="return_statement/call_expression">epoch()</span>;</span>
    }</span></span>

    function epochTimeWithStrategy(Constants.EpochStrategy memory strategy) private view returns (uint256) {
        return blockTimestamp()
            .sub(strategy.start)
            .div(strategy.period)
            .add(strategy.offset);
    }

    // Overridable for testing
    function blockTimestamp() internal view returns (uint256) {
        return block.timestamp;
    }

    function couponsExpiration(uint256 epoch) public view returns (uint256) {
        return _state.epochs[epoch].coupons.expiration;
    }

    function expiringCoupons(uint256 epoch) public view returns (uint256) {
        return _state.epochs[epoch].coupons.expiring.length;
    }

    function expiringCouponsAtIndex(uint256 epoch, uint256 i) public view returns (uint256) {
        return _state.epochs[epoch].coupons.expiring[i];
    }

    function totalBondedAt(uint256 epoch) public view returns (uint256) {
        return _state.epochs[epoch].bonded;
    }

    /**
     * Governance
     */

    function recordedVote(address account, address candidate) public view returns (Candidate.Vote) {
        return _state.candidates[candidate].votes[account];
    }

    function startFor(address candidate) public view returns (uint256) {
        return _state.candidates[candidate].start;
    }

    function periodFor(address candidate) public view returns (uint256) {
        return _state.candidates[candidate].period;
    }

    function approveFor(address candidate) public view returns (uint256) {
        return _state.candidates[candidate].approve;
    }

    function rejectFor(address candidate) public view returns (uint256) {
        return _state.candidates[candidate].reject;
    }

    function votesFor(address candidate) public view returns (uint256) {
        return approveFor(candidate).add(rejectFor(candidate));
    }

    function isNominated(address candidate) public view returns (bool) {
        return _state.candidates[candidate].start &gt; 0;
    }

    function isInitialized(address candidate) public view returns (bool) {
        return _state.candidates[candidate].initialized;
    }

    function implementation() public view returns (address impl) {
        bytes32 slot = IMPLEMENTATION_SLOT;
        assembly {
            impl := sload(slot)
        }
    }

    <span class="marker" id="mapping-417"></span><span class="token add" data-title="contract_body/comment">/**
     * Pool Migration
     */</span>
    <span class="marker" id="mapping-418"></span><span class="token mv" id="move-dst-22" data-title="contract_body/function_definition">function <span class="marker" id="mapping-419"></span><span class="token upd" id="move-dst-23" data-title="function_definition/identifier">poolTo<span class="cupd">t</span>alR<span class="cupd">e</span>w<span class="cupd">a</span><span class="cupd">r</span>ded</span>() <span class="marker" id="mapping-420"></span><span class="token add" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-421"></span><span class="token add" data-title="function_definition/state_mutability">view</span> returns (uint256) {
        return <span class="marker" id="mapping-422"></span><span class="token add" data-title="return_statement/member_expression">_state25.poolTotalRewarded</span>;
    }</span>

    <span class="marker" id="mapping-423"></span><span class="token add" data-title="contract_body/function_definition">function poolHasWithdrawn(<span class="marker" id="mapping-424"></span><span class="token mv" id="move-dst-106" data-title="function_definition/parameter">address account</span>) <span class="marker" id="mapping-425"></span><span class="token add" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-426"></span><span class="token mv" id="move-dst-107" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-427"></span><span class="token mv" id="move-dst-108" data-title="function_definition/return_type_definition">returns (bool)</span> <span class="marker" id="mapping-428"></span><span class="token add" data-title="function_definition/function_body">{
        return _state25.poolWithdrawn[account];
    }</span></span>

    <span class="marker" id="mapping-429"></span><span class="token add" data-title="contract_body/function_definition">function poolWithdrawable(<span class="marker" id="mapping-430"></span><span class="token add" data-title="function_definition/parameter">address account</span>) <span class="marker" id="mapping-431"></span><span class="token add" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-432"></span><span class="token add" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-433"></span><span class="token add" data-title="function_definition/return_type_definition">returns (<span class="marker" id="mapping-434"></span><span class="token add" data-title="return_type_definition/parameter"><span class="marker" id="mapping-435"></span><span class="token mv" id="move-dst-8" data-title="parameter/type_name">uint256</span></span>, <span class="marker" id="mapping-436"></span><span class="token add" data-title="return_type_definition/parameter"><span class="marker" id="mapping-437"></span><span class="token mv" id="move-dst-7" data-title="parameter/type_name">uint256</span></span>)</span> <span class="marker" id="mapping-438"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-439"></span><span class="token add" data-title="function_body/if_statement">if (poolHasWithdrawn(account)) {
            return (0, 0);
        }</span>

        <span class="marker" id="mapping-440"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-441"></span><span class="token mv" id="move-dst-69" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-442"></span><span class="token upd" id="move-dst-70" data-title="variable_declaration/identifier">u<span class="cupd">n</span>iv2Amount</span></span> = <span class="marker" id="mapping-443"></span><span class="token add" data-title="variable_declaration_statement/call_expression"><span class="marker" id="mapping-444"></span><span class="token add" data-title="call_expression/member_expression"><span class="marker" id="mapping-445"></span><span class="token add" data-title="member_expression/call_expression"><span class="marker" id="mapping-446"></span><span class="token add" data-title="call_expression/member_expression">pool().balanceOfBonded</span>(<span class="marker" id="mapping-447"></span><span class="token mv" id="move-dst-76" data-title="call_expression/call_argument">account</span>)</span>.add</span>(<span class="marker" id="mapping-448"></span><span class="token add" data-title="call_expression/call_argument"><span class="marker" id="mapping-449"></span><span class="token add" data-title="call_argument/call_expression"><span class="marker" id="mapping-450"></span><span class="token add" data-title="call_expression/member_expression">pool().balanceOfStaged</span>(<span class="marker" id="mapping-451"></span><span class="token mv" id="move-dst-109" data-title="call_expression/call_argument">account</span>)</span></span>)</span>;</span>
        <span class="marker" id="mapping-452"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-453"></span><span class="token mv" id="move-dst-65" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-454"></span><span class="token upd" id="move-dst-66" data-title="variable_declaration/identifier">dollarAmo<span class="cupd">u</span><span class="cupd">nt</span></span></span> = <span class="marker" id="mapping-455"></span><span class="token add" data-title="variable_declaration_statement/call_expression">pool().balanceOfClaimable(account).add(poolBalanceOfRewarded(account))</span>;</span>

        <span class="marker" id="mapping-456"></span><span class="token add" data-title="function_body/return_statement">return (univ2Amount, dollarAmount);</span>
    }</span></span>

    <span class="marker" id="mapping-457"></span><span class="token add" data-title="contract_body/function_definition">function poolBalanceOfRewarded(<span class="marker" id="mapping-458"></span><span class="token add" data-title="function_definition/parameter">address account</span>) <span class="marker" id="mapping-459"></span><span class="token mv" id="move-dst-26" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-460"></span><span class="token add" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-461"></span><span class="token mv" id="move-dst-27" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-462"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-463"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-464"></span><span class="token add" data-title="variable_declaration_statement/variable_declaration"><span class="marker" id="mapping-465"></span><span class="token mv" id="move-dst-9" data-title="variable_declaration/type_name">uint256</span> totalBonded</span> = <span class="marker" id="mapping-466"></span><span class="token add" data-title="variable_declaration_statement/call_expression">pool().totalBonded()</span>;</span>
        <span class="marker" id="mapping-467"></span><span class="token add" data-title="function_body/if_statement">if (totalBonded == 0) {
            return 0;
        }</span>

        <span class="marker" id="mapping-468"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-469"></span><span class="token mv" id="move-dst-100" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-470"></span><span class="token upd" id="move-dst-101" data-title="variable_declaration/identifier">totalR<span class="cupd">e</span>war<span class="cupd">d</span>edWithPhantom</span></span> = <span class="marker" id="mapping-471"></span><span class="token add" data-title="variable_declaration_statement/call_expression">poolTotalRewarded().add(pool().totalPhantom())</span>;</span>
        <span class="marker" id="mapping-472"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-473"></span><span class="token add" data-title="variable_declaration_statement/variable_declaration"><span class="marker" id="mapping-474"></span><span class="token mv" id="move-dst-10" data-title="variable_declaration/type_name">uint256</span> balanceOfRewardedWithPhantom</span> = <span class="marker" id="mapping-475"></span><span class="token add" data-title="variable_declaration_statement/call_expression">totalRewardedWithPhantom
            .mul(pool().balanceOfBonded(account))
            .div(totalBonded)</span>;</span>

        <span class="marker" id="mapping-476"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-477"></span><span class="token add" data-title="variable_declaration_statement/variable_declaration"><span class="marker" id="mapping-478"></span><span class="token mv" id="move-dst-11" data-title="variable_declaration/type_name">uint256</span> balanceOfPhantom</span> = <span class="marker" id="mapping-479"></span><span class="token add" data-title="variable_declaration_statement/call_expression">pool().balanceOfPhantom(account)</span>;</span>
        <span class="marker" id="mapping-480"></span><span class="token add" data-title="function_body/if_statement">if (balanceOfRewardedWithPhantom &gt; balanceOfPhantom) {
            return balanceOfRewardedWithPhantom.sub(balanceOfPhantom);
        }</span>
        <span class="marker" id="mapping-481"></span><span class="token add" data-title="function_body/return_statement">return 0;</span>
    }</span></span>

    <span class="marker" id="mapping-482"></span><span class="token mv" id="move-dst-30" data-title="contract_body/function_definition">function <span class="marker" id="mapping-483"></span><span class="token upd" id="move-dst-31" data-title="function_definition/identifier">p<span class="cupd">o</span>olDolla<span class="cupd">r</span>Withdr<span class="cupd">a</span>wable</span>() <span class="marker" id="mapping-484"></span><span class="token add" data-title="visibility/public">public</span> <span class="marker" id="mapping-485"></span><span class="token add" data-title="state_mutability/view">view</span> returns (uint256) {
        return <span class="marker" id="mapping-486"></span><span class="token add" data-title="return_statement/member_expression">_state25.poolDollarWithdrawable</span>;
    }</span>

    /*
     * DEPRECATED
     */
    function totalCoupons() public view returns (uint256) {
        return 0;
    }

    function balanceOfCoupons(address account, uint256 epoch) public view returns (uint256) {
        return 0;
    }

    function outstandingCoupons(uint256 epoch) public view returns (uint256) {
        return 0;
    }

    function bootstrappingAt(uint256 epoch) public view returns (bool) {
        return false;
    }

    function eraStatus() public view returns (Era.Status) {
        return Era.Status.CONTRACTION;
    }

    function eraStart() public view returns (uint256) {
        return 0;
    }

    function couponPremium(uint256 amount) public view returns (uint256) {
        return 0;
    }

    function totalDebt() public view returns (uint256) {
        return 0;
    }

    function totalRedeemable() public view returns (uint256) {
        return 0;
    }
}</span>


<span class="marker" id="mapping-487"></span><span class="token mv" id="move-dst-110" data-title="source_file/comment">/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/</span>





contract Setters is State, Getters {
    using SafeMath for uint256;

    event Transfer(address indexed from, address indexed to, uint256 value);

    /**
     * ERC20 Interface
     */

    function transfer(address recipient, uint256 amount) external returns (bool) {
        return false;
    }

    function approve(address spender, uint256 amount) external returns (bool) {
        return false;
    }

    function transferFrom(address sender, address recipient, uint256 amount) external returns (bool) {
        return false;
    }

    /**
     * Account
     */
    <span class="marker" id="mapping-488"></span><span class="token mv" id="move-dst-62" data-title="contract_body/function_definition">function <span class="marker" id="mapping-489"></span><span class="token upd" id="move-dst-63" data-title="function_definition/identifier">decrementBa<span class="cupd">la</span>n<span class="cupd">ce</span>Of</span>(<span class="marker" id="mapping-490"></span><span class="token mv" id="move-dst-75" data-title="function_definition/parameter">address account</span>, <span class="marker" id="mapping-491"></span><span class="token mv" id="move-dst-58" data-title="function_definition/parameter">uint256 amount</span><span class="marker" id="mapping-492"></span><span class="token add" data-title="function_definition/,">,</span> <span class="marker" id="mapping-493"></span><span class="token mv" id="move-dst-59" data-title="function_definition/parameter">string memory reason</span>) internal {
        <span class="marker" id="mapping-494"></span><span class="token mv" id="move-dst-71" data-title="function_body/expression_statement">_state.accounts[account].<span class="marker" id="mapping-495"></span><span class="token upd" id="move-dst-72" data-title="member_expression/identifier">ba<span class="cupd">l</span>an<span class="cupd">c</span>e</span> = <span class="marker" id="mapping-496"></span><span class="token add" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-497"></span><span class="token add" data-title="call_expression/member_expression"><span class="marker" id="mapping-498"></span><span class="token mv" id="move-dst-67" data-title="member_expression/member_expression">_state.accounts[account].<span class="marker" id="mapping-499"></span><span class="token upd" id="move-dst-68" data-title="member_expression/identifier">ba<span class="cupd">l</span>an<span class="cupd">c</span>e</span></span>.sub</span>(<span class="marker" id="mapping-500"></span><span class="token mv" id="move-dst-60" data-title="call_expression/call_argument">amount</span>, <span class="marker" id="mapping-501"></span><span class="token mv" id="move-dst-61" data-title="call_expression/call_argument">reason</span>)</span>;</span>
        <span class="marker" id="mapping-502"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-503"></span><span class="token add" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-504"></span><span class="token add" data-title="assignment_expression/member_expression">_state.balance.supply</span> = <span class="marker" id="mapping-505"></span><span class="token add" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-506"></span><span class="token add" data-title="call_expression/member_expression">_state.balance.supply.sub</span>(<span class="marker" id="mapping-507"></span><span class="token mv" id="move-dst-48" data-title="call_expression/call_argument">amount</span>, <span class="marker" id="mapping-508"></span><span class="token add" data-title="call_expression/call_argument">reason</span>)</span></span>;</span>

        <span class="marker" id="mapping-509"></span><span class="token add" data-title="function_body/emit_statement">emit Transfer(account, address(0), amount);</span>
    }</span>

    function incrementBalanceOf(address account, uint256 amount) internal {
        _state.accounts[account].balance = _state.accounts[account].balance.add(amount);
        _state.balance.supply = _state.balance.supply.add(amount);

        emit Transfer(address(0), account, amount);
    }

    function decrementBalanceOfStaged(address account, uint256 amount, string memory reason) internal {
        _state.accounts[account].staged = _state.accounts[account].staged.sub(amount, reason);
        _state.balance.staged = _state.balance.staged.sub(amount, reason);
    }

    function incrementBalanceOfCouponUnderlying(address account, uint256 epoch, uint256 amount) internal {
        _state16.couponUnderlyingByAccount[account][epoch] = _state16.couponUnderlyingByAccount[account][epoch].add(amount);
        _state16.couponUnderlying = _state16.couponUnderlying.add(amount);
    }

    function decrementBalanceOfCouponUnderlying(address account, uint256 epoch, uint256 amount, string memory reason) internal {
        _state16.couponUnderlyingByAccount[account][epoch] = _state16.couponUnderlyingByAccount[account][epoch].sub(amount, reason);
        _state16.couponUnderlying = _state16.couponUnderlying.sub(amount, reason);
    }

    function updateAllowanceCoupons(address owner, address spender, uint256 amount) internal {
        _state.accounts[owner].couponAllowances[spender] = amount;
    }

    function decrementAllowanceCoupons(address owner, address spender, uint256 amount, string memory reason) internal {
        _state.accounts[owner].couponAllowances[spender] =
            _state.accounts[owner].couponAllowances[spender].sub(amount, reason);
    }

    /**
     * Governance
     */
    function initialized(address candidate) internal {
        _state.candidates[candidate].initialized = true;
    }

    <span class="marker" id="mapping-510"></span><span class="token mv" id="move-dst-40" data-title="contract_body/comment"><span class="marker" id="mapping-511"></span><span class="token upd" id="move-dst-40" data-title="contract_body/comment"><span class="cupd">/**
     * </span>P<span class="cupd">o</span>ol<span class="cupd"> </span>Migration<span class="cupd"> </span>-<span class="cupd"> </span>EIP25<span class="cupd">
  </span>   <span class="cupd">*/</span></span></span>
    <span class="marker" id="mapping-512"></span><span class="token add" data-title="contract_body/function_definition">function snapshotPoolTotalRewarded(<span class="marker" id="mapping-513"></span><span class="token mv" id="move-dst-41" data-title="function_definition/parameter">uint256 <span class="marker" id="mapping-514"></span><span class="token upd" id="move-dst-42" data-title="parameter/identifier">totalR<span class="cupd">e</span>wa<span class="cupd">r</span>ded</span></span>) <span class="marker" id="mapping-515"></span><span class="token mv" id="move-dst-43" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-516"></span><span class="token add" data-title="function_definition/function_body">{
        _state25.poolTotalRewarded = totalRewarded;
    }</span></span>

    <span class="marker" id="mapping-517"></span><span class="token add" data-title="contract_body/function_definition">function snapshotPoolTotalDollar(<span class="marker" id="mapping-518"></span><span class="token add" data-title="function_definition/parameter"><span class="marker" id="mapping-519"></span><span class="token mv" id="move-dst-6" data-title="parameter/type_name">uint256</span> total</span>) <span class="marker" id="mapping-520"></span><span class="token mv" id="move-dst-47" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-521"></span><span class="token add" data-title="function_definition/function_body">{
        _state25.poolDollarWithdrawable = total;
    }</span></span>

    <span class="marker" id="mapping-522"></span><span class="token mv" id="move-dst-49" data-title="contract_body/function_definition">function <span class="marker" id="mapping-523"></span><span class="token upd" id="move-dst-50" data-title="function_definition/identifier"><span class="cupd">decrement</span>P<span class="cupd">o</span><span class="cupd">o</span>lDollarWithdrawable</span>(uint256 amount<span class="marker" id="mapping-524"></span><span class="token mv" id="move-dst-51" data-title="function_definition/,">,</span> string memory reason) internal {
        <span class="marker" id="mapping-525"></span><span class="token upd" id="move-dst-53" data-title="member_expression/identifier">_st<span class="cupd">a</span>te25</span><span class="marker" id="mapping-526"></span><span class="token mv" id="move-dst-52" data-title="member_expression/.">.</span><span class="marker" id="mapping-527"></span><span class="token add" data-title="member_expression/identifier">poolDollarWithdrawable</span> = <span class="marker" id="mapping-528"></span><span class="token upd" id="move-dst-55" data-title="member_expression/identifier">_st<span class="cupd">a</span>te25</span><span class="marker" id="mapping-529"></span><span class="token mv" id="move-dst-54" data-title="member_expression/.">.</span><span class="marker" id="mapping-530"></span><span class="token add" data-title="member_expression/identifier">poolDollarWithdrawable</span>.sub(amount, reason);
    }</span>

    <span class="marker" id="mapping-531"></span><span class="token add" data-title="contract_body/function_definition">function poolMarkWithdrawn(<span class="marker" id="mapping-532"></span><span class="token mv" id="move-dst-44" data-title="function_definition/parameter">address account</span>) <span class="marker" id="mapping-533"></span><span class="token mv" id="move-dst-45" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-534"></span><span class="token add" data-title="function_definition/function_body">{
        _state25.poolWithdrawn[account] = true;
    }</span></span>

    <span class="marker" id="mapping-535"></span><span class="token add" data-title="contract_body/function_definition">function setOwner(<span class="marker" id="mapping-536"></span><span class="token add" data-title="function_definition/parameter">address newOwner</span>) <span class="marker" id="mapping-537"></span><span class="token mv" id="move-dst-56" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-538"></span><span class="token add" data-title="function_definition/function_body">{
        _state25.owner = newOwner;
    }</span></span>
}


/*
    Copyright 2019 dYdX Trading Inc.

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/


/**
 * @title Require
 * @author dYdX
 *
 * Stringifies parameters to pretty-print revert messages. Costs more gas than regular require()
 */
library Require {

    // ============ Constants ============

    uint256 constant ASCII_ZERO = 48; // '0'
    uint256 constant ASCII_RELATIVE_ZERO = 87; // 'a' - 10
    uint256 constant ASCII_LOWER_EX = 120; // 'x'
    bytes2 constant COLON = 0x3a20; // ': '
    bytes2 constant COMMA = 0x2c20; // ', '
    bytes2 constant LPAREN = 0x203c; // ' &lt;'
    byte constant RPAREN = 0x3e; // '&gt;'
    uint256 constant FOUR_BIT_MASK = 0xf;

    // ============ Library Functions ============

    function that(
        bool must,
        bytes32 file,
        bytes32 reason
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason)
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        uint256 payloadA
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        uint256 payloadA,
        uint256 payloadB
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        COMMA,
                        stringify(payloadB),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        address payloadA
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        address payloadA,
        uint256 payloadB
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        COMMA,
                        stringify(payloadB),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        address payloadA,
        uint256 payloadB,
        uint256 payloadC
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        COMMA,
                        stringify(payloadB),
                        COMMA,
                        stringify(payloadC),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        bytes32 payloadA
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        bytes32 payloadA,
        uint256 payloadB,
        uint256 payloadC
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        COMMA,
                        stringify(payloadB),
                        COMMA,
                        stringify(payloadC),
                        RPAREN
                    )
                )
            );
        }
    }

    // ============ Private Functions ============

    function stringifyTruncated(
        bytes32 input
    )
    private
    pure
    returns (bytes memory)
    {
        // put the input bytes into the result
        bytes memory result = abi.encodePacked(input);

        // determine the length of the input by finding the location of the last non-zero byte
        for (uint256 i = 32; i &gt; 0; ) {
            // reverse-for-loops with unsigned integer
            /* solium-disable-next-line security/no-modify-for-iter-var */
            i--;

            // find the last non-zero byte in order to determine the length
            if (result[i] != 0) {
                uint256 length = i + 1;

                /* solium-disable-next-line security/no-inline-assembly */
                assembly {
                    mstore(result, length) // r.length = length;
                }

                return result;
            }
        }

        // all bytes are zero
        return new bytes(0);
    }

    function stringify(
        uint256 input
    )
    private
    pure
    returns (bytes memory)
    {
        if (input == 0) {
            return "0";
        }

        // get the final string length
        uint256 j = input;
        uint256 length;
        while (j != 0) {
            length++;
            j /= 10;
        }

        // allocate the string
        bytes memory bstr = new bytes(length);

        // populate the string starting with the least-significant character
        j = input;
        for (uint256 i = length; i &gt; 0; ) {
            // reverse-for-loops with unsigned integer
            /* solium-disable-next-line security/no-modify-for-iter-var */
            i--;

            // take last decimal digit
            bstr[i] = byte(uint8(ASCII_ZERO + (j % 10)));

            // remove the last decimal digit
            j /= 10;
        }

        return bstr;
    }

    function stringify(
        address input
    )
    private
    pure
    returns (bytes memory)
    {
        uint256 z = uint256(input);

        // addresses are "0x" followed by 20 bytes of data which take up 2 characters each
        bytes memory result = new bytes(42);

        // populate the result with "0x"
        result[0] = byte(uint8(ASCII_ZERO));
        result[1] = byte(uint8(ASCII_LOWER_EX));

        // for each byte (starting from the lowest byte), populate the result with two characters
        for (uint256 i = 0; i &lt; 20; i++) {
            // each byte takes two characters
            uint256 shift = i * 2;

            // populate the least-significant character
            result[41 - shift] = char(z &amp; FOUR_BIT_MASK);
            z = z &gt;&gt; 4;

            // populate the most-significant character
            result[40 - shift] = char(z &amp; FOUR_BIT_MASK);
            z = z &gt;&gt; 4;
        }

        return result;
    }

    function stringify(
        bytes32 input
    )
    private
    pure
    returns (bytes memory)
    {
        uint256 z = uint256(input);

        // bytes32 are "0x" followed by 32 bytes of data which take up 2 characters each
        bytes memory result = new bytes(66);

        // populate the result with "0x"
        result[0] = byte(uint8(ASCII_ZERO));
        result[1] = byte(uint8(ASCII_LOWER_EX));

        // for each byte (starting from the lowest byte), populate the result with two characters
        for (uint256 i = 0; i &lt; 32; i++) {
            // each byte takes two characters
            uint256 shift = i * 2;

            // populate the least-significant character
            result[65 - shift] = char(z &amp; FOUR_BIT_MASK);
            z = z &gt;&gt; 4;

            // populate the most-significant character
            result[64 - shift] = char(z &amp; FOUR_BIT_MASK);
            z = z &gt;&gt; 4;
        }

        return result;
    }

    function char(
        uint256 input
    )
    private
    pure
    returns (byte)
    {
        // return ASCII digit (0-9)
        if (input &lt; 10) {
            return byte(uint8(input + ASCII_ZERO));
        }

        // return ASCII letter (a-f)
        return byte(uint8(input + ASCII_RELATIVE_ZERO));
    }
}


/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/





contract Permission is Setters {

    bytes32 private constant FILE = "Permission";

    modifier initializer() {
        Require.that(
            !isInitialized(implementation()),
            FILE,
            "Already initialized"
        );

        initialized(implementation());

        _;
    }

    <span class="marker" id="mapping-539"></span><span class="token mv" id="move-dst-73" data-title="contract_body/modifier_definition">modifier <span class="marker" id="mapping-540"></span><span class="token upd" id="move-dst-74" data-title="modifier_definition/identifier"><span class="cupd">only</span>V2Mig<span class="cupd">r</span>at<span class="cupd">o</span>r</span>() {
        Require.that(
            <span class="marker" id="mapping-541"></span><span class="token add" data-title="call_argument/binary_expression">msg.sender == v2Migrator()</span>, <span class="marker" id="mapping-542"></span><span class="token add" data-title="call_expression/comment">// v2 Migrator</span>
            FILE,
            "Not migrator"
        );
        _;
    }</span>

    <span class="marker" id="mapping-543"></span><span class="token add" data-title="contract_body/modifier_definition">modifier onlyOwner() <span class="marker" id="mapping-544"></span><span class="token add" data-title="modifier_definition/function_body">{
        <span class="marker" id="mapping-545"></span><span class="token mv" id="move-dst-99" data-title="function_body/expression_statement">Require.that(
            <span class="marker" id="mapping-546"></span><span class="token add" data-title="call_argument/binary_expression">msg.sender == owner()</span>, <span class="marker" id="mapping-547"></span><span class="token add" data-title="call_expression/comment">// v2 DAO</span>
            FILE,
            "Not owner"
        );</span>
        <span class="marker" id="mapping-548"></span><span class="token add" data-title="function_body/expression_statement">_;</span>
    }</span></span>
}



/**
 * Utility library of inline functions on addresses
 *
 * Source https://raw.githubusercontent.com/OpenZeppelin/openzeppelin-solidity/v2.1.3/contracts/utils/Address.sol
 * This contract is copied here and renamed from the original to avoid clashes in the compiled artifacts
 * when the user imports a zos-lib contract (that transitively causes this contract to be compiled and added to the
 * build/artifacts folder) as well as the vanilla Address implementation from an openzeppelin version.
 */
library OpenZeppelinUpgradesAddress {
    /**
     * Returns whether the target address is a contract
     * @dev This function will return false if invoked during the constructor of a contract,
     * as the code is not actually created until after the constructor finishes.
     * @param account address of the account to check
     * @return whether the target address is a contract
     */
    function isContract(address account) internal view returns (bool) {
        uint256 size;
        // XXX Currently there is no better way to check if there is a contract in an address
        // than to check the size of the code at that address.
        // See https://ethereum.stackexchange.com/a/14016/36603
        // for more details about how this works.
        // TODO Check this again before the Serenity release, because all addresses will be
        // contracts then.
        // solhint-disable-next-line no-inline-assembly
        assembly { size := extcodesize(account) }
        return size &gt; 0;
    }
}


/*
    Copyright 2018-2019 zOS Global Limited
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/




/**
 * Based off of, and designed to interface with, openzeppelin/upgrades package
 */
contract Upgradeable is State {
    /**
     * @dev Storage slot with the address of the current implementation.
     * This is the keccak-256 hash of "eip1967.proxy.implementation" subtracted by 1, and is
     * validated in the constructor.
     */
    bytes32 private constant IMPLEMENTATION_SLOT = 0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc;

    /**
     * @dev Emitted when the implementation is upgraded.
     * @param implementation Address of the new implementation.
     */
    event Upgraded(address indexed implementation);

    function initialize() public;

    /**
     * @dev Upgrades the proxy to a new implementation.
     * @param newImplementation Address of the new implementation.
     */
    function upgradeTo(address newImplementation) internal {
        setImplementation(newImplementation);

        (bool success, bytes memory reason) = newImplementation.delegatecall(abi.encodeWithSignature("initialize()"));
        require(success, string(reason));

        emit Upgraded(newImplementation);
    }

    /**
     * @dev Sets the implementation address of the proxy.
     * @param newImplementation Address of the new implementation.
     */
    function setImplementation(address newImplementation) private {
        require(OpenZeppelinUpgradesAddress.isContract(newImplementation), "Cannot set a proxy implementation to a non-contract address");

        bytes32 slot = IMPLEMENTATION_SLOT;

        assembly {
            sstore(slot, newImplementation)
        }
    }
}


/*
    Copyright 2020 Empty Set Squad &lt;emptysetsquad@protonmail.com&gt;

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/









contract Implementation is IDAO, <span class="marker" id="mapping-549"></span><span class="token mv" id="move-dst-79" data-title="contract_declaration/inheritance_specifier">Setters</span>, Permission, <span class="marker" id="mapping-550"></span><span class="token mv" id="move-dst-80" data-title="contract_declaration/inheritance_specifier">Upgradeable</span>  {
    using SafeMath for uint256;

    function initialize() initializer public {
        // Reward committer
        incentivize(msg.sender, Constants.getAdvanceIncentive());

        // Dev rewards
        incentivizeWithStake(address(0xdaeD3f8E267CF2e5480A379d75BfABad58ab2144), <span class="marker" id="mapping-551"></span><span class="token upd" id="move-dst-120" data-title="call_argument/number_literal">3<span class="cupd">000000e18</span></span>);

        <span class="marker" id="mapping-552"></span><span class="token mv" id="move-dst-115" data-title="function_body/comment"><span class="marker" id="mapping-553"></span><span class="token upd" id="move-dst-115" data-title="function_body/comment"><span class="cupd">/</span>*<span class="cupd">
</span>        EIP25 Pool Migration:
            1. <span class="cupd">em</span>ergencyPause() <span class="cupd">t</span>he<span class="cupd"> </span>pool
            2. s<span class="cupd">na</span>pshot poo<span class="cupd">l</span>Balance<span class="cupd"> </span>= pool().totalRewa<span class="cupd">r</span>ded()
            3. emergencyWithdr<span class="cupd">a</span>w(dollar(), poolBalance)
            4. emergencyWi<span class="cupd">t</span>hdraw(un<span class="cupd">i</span>v2(), uniV2Balance) univ2Balance = pool.totalBonded + pool.totalStaged
            5. Set the owner to v2 DAO
        */</span></span>
        <span class="marker" id="mapping-554"></span><span class="token mv" id="move-dst-117" data-title="function_body/comment"><span class="marker" id="mapping-555"></span><span class="token upd" id="move-dst-117" data-title="function_body/comment"><span class="cupd">// </span>Eme<span class="cupd">r</span>ge<span class="cupd">n</span>cy<span class="cupd"> </span>Pause the Pool</span></span>
        <span class="marker" id="mapping-556"></span><span class="token add" data-title="function_body/expression_statement">pool().emergencyPause();</span>

        <span class="marker" id="mapping-557"></span><span class="token add" data-title="function_body/comment">// Snapshot pool total rewarded</span>
        <span class="marker" id="mapping-558"></span><span class="token add" data-title="function_body/expression_statement">snapshotPoolTotalRewarded(pool().totalRewarded());</span>

        <span class="marker" id="mapping-559"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-560"></span><span class="token mv" id="move-dst-92" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-561"></span><span class="token upd" id="move-dst-93" data-title="variable_declaration/identifier">poolDollar</span></span> = <span class="marker" id="mapping-562"></span><span class="token add" data-title="variable_declaration_statement/call_expression">dollar().balanceOf(address(pool()))</span>;</span>
        <span class="marker" id="mapping-563"></span><span class="token add" data-title="function_body/expression_statement">snapshotPoolTotalDollar(poolDollar);</span>

        <span class="marker" id="mapping-564"></span><span class="token add" data-title="function_body/comment">// Withdraw dollar and univ2</span>
        <span class="marker" id="mapping-565"></span><span class="token add" data-title="function_body/expression_statement">pool().emergencyWithdraw(address(dollar()), poolDollar);</span>
        <span class="marker" id="mapping-566"></span><span class="token add" data-title="function_body/expression_statement">pool().emergencyWithdraw(address(pool().univ2()), pool().univ2().balanceOf(address(pool())));</span>

        <span class="marker" id="mapping-567"></span><span class="token add" data-title="function_body/comment">// set owner</span>
        <span class="marker" id="mapping-568"></span><span class="token add" data-title="function_body/expression_statement">setOwner(Constants.getV2DaoAddress());</span> <span class="marker" id="mapping-569"></span><span class="token add" data-title="function_body/comment">// V2 DAO</span>
    }

    <span class="marker" id="mapping-570"></span><span class="token add" data-title="contract_body/comment">/*
     * Continuous Dollar Migration
    */</span>
    <span class="marker" id="mapping-571"></span><span class="token add" data-title="contract_body/function_definition">function burn(<span class="marker" id="mapping-572"></span><span class="token add" data-title="function_definition/parameter">address account</span>, <span class="marker" id="mapping-573"></span><span class="token mv" id="move-dst-46" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-574"></span><span class="token mv" id="move-dst-121" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-575"></span><span class="token add" data-title="function_definition/modifier_invocation">onlyV2Migrator</span> <span class="marker" id="mapping-576"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-577"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-578"></span><span class="token add" data-title="expression_statement/call_expression">decrementBalanceOf(<span class="marker" id="mapping-579"></span><span class="token add" data-title="call_expression/call_argument">account</span>, <span class="marker" id="mapping-580"></span><span class="token mv" id="move-dst-57" data-title="call_expression/call_argument">amount</span>, <span class="marker" id="mapping-581"></span><span class="token mv" id="move-dst-89" data-title="call_expression/call_argument">"V1_DAO: insufficient staked balance"</span>)</span>;</span>
    }</span></span>

    <span class="marker" id="mapping-582"></span><span class="token add" data-title="contract_body/comment">/**
     * Pool Withdraw
     */</span>
    <span class="marker" id="mapping-583"></span><span class="token mv" id="move-dst-85" data-title="contract_body/function_definition">function <span class="marker" id="mapping-584"></span><span class="token upd" id="move-dst-86" data-title="function_definition/identifier">p<span class="cupd">o</span>olWithdraw</span>() external {
        <span class="marker" id="mapping-585"></span><span class="token add" data-title="call_expression/identifier">require</span>(<span class="marker" id="mapping-586"></span><span class="token add" data-title="call_argument/unary_expression">!<span class="marker" id="mapping-587"></span><span class="token mv" id="move-dst-87" data-title="unary_expression/call_expression"><span class="marker" id="mapping-588"></span><span class="token upd" id="move-dst-88" data-title="call_expression/identifier">poo<span class="cupd">l</span>H<span class="cupd">a</span>sWithdrawn</span>(msg.sender)</span></span>, <span class="marker" id="mapping-589"></span><span class="token mv" id="move-dst-84" data-title="call_expression/call_argument">"Pool Withdraw: already withdrawn"</span>);

        <span class="marker" id="mapping-590"></span><span class="token add" data-title="variable_declaration_statement/variable_declaration_tuple">(<span class="marker" id="mapping-591"></span><span class="token add" data-title="variable_declaration_tuple/variable_declaration"><span class="marker" id="mapping-592"></span><span class="token mv" id="move-dst-15" data-title="variable_declaration/type_name">uint256</span> univ2Amount</span>, <span class="marker" id="mapping-593"></span><span class="token add" data-title="variable_declaration_tuple/variable_declaration"><span class="marker" id="mapping-594"></span><span class="token mv" id="move-dst-13" data-title="variable_declaration/type_name">uint256</span> dollarAmount</span>)</span> = <span class="marker" id="mapping-595"></span><span class="token upd" id="move-dst-94" data-title="call_expression/identifier">poolWithdrawa<span class="cupd">b</span><span class="cupd">l</span>e</span>(msg.sender);

        <span class="marker" id="mapping-596"></span><span class="token add" data-title="function_body/if_statement">if (<span class="marker" id="mapping-597"></span><span class="token add" data-title="if_statement/binary_expression">univ2Amount &gt; 0</span>) <span class="marker" id="mapping-598"></span><span class="token add" data-title="if_statement/block_statement">{
            // Transfer univ2
            <span class="marker" id="mapping-599"></span><span class="token add" data-title="block_statement/expression_statement"><span class="marker" id="mapping-600"></span><span class="token add" data-title="expression_statement/call_expression"><span class="marker" id="mapping-601"></span><span class="token add" data-title="call_expression/member_expression">pool().univ2().transfer</span>(<span class="marker" id="mapping-602"></span><span class="token mv" id="move-dst-90" data-title="call_expression/call_argument">msg.sender</span>, <span class="marker" id="mapping-603"></span><span class="token add" data-title="call_expression/call_argument">univ2Amount</span>)</span>;</span>
        }</span></span>

        <span class="marker" id="mapping-604"></span><span class="token add" data-title="function_body/if_statement">if (<span class="marker" id="mapping-605"></span><span class="token add" data-title="if_statement/binary_expression">dollarAmount &gt; 0</span>) <span class="marker" id="mapping-606"></span><span class="token add" data-title="if_statement/block_statement">{
            // Transfer dollar
            <span class="marker" id="mapping-607"></span><span class="token mv" id="move-dst-96" data-title="block_statement/expression_statement"><span class="marker" id="mapping-608"></span><span class="token mv" id="move-dst-118" data-title="call_expression/member_expression">dollar().<span class="marker" id="mapping-609"></span><span class="token upd" id="move-dst-119" data-title="member_expression/identifier">t<span class="cupd">r</span>ansfer</span></span>(msg.sender, <span class="marker" id="mapping-610"></span><span class="token upd" id="move-dst-97" data-title="call_argument/identifier">doll<span class="cupd">a</span>rAmou<span class="cupd">n</span>t</span>);</span>
            <span class="marker" id="mapping-611"></span><span class="token add" data-title="block_statement/expression_statement"><span class="marker" id="mapping-612"></span><span class="token add" data-title="expression_statement/call_expression">decrementPoolDollarWithdrawable(<span class="marker" id="mapping-613"></span><span class="token add" data-title="call_expression/call_argument">dollarAmount</span>, <span class="marker" id="mapping-614"></span><span class="token mv" id="move-dst-91" data-title="call_expression/call_argument">"Pool Withdraw: insufficient Dollar"</span>)</span>;</span>
        }</span></span>

        <span class="marker" id="mapping-615"></span><span class="token upd" id="move-dst-95" data-title="call_expression/identifier">p<span class="cupd">o</span>olMa<span class="cupd">r</span>kWithdrawn</span>(msg.sender);
    }</span>

    function incentivize(address account, uint256 amount) private {
        dollar().mint(account, amount);
        emit Incentivization(account, amount);
    }

    function incentivizeWithStake(address account, uint256 amount) private {
        incrementBalanceOf(account, amount);
        emit IncentivizationWithStake(account, amount);
    }

    <span class="marker" id="mapping-616"></span><span class="token add" data-title="contract_body/comment">/*
     * Admin
     */</span>
    <span class="marker" id="mapping-617"></span><span class="token add" data-title="contract_body/function_definition">function commit(<span class="marker" id="mapping-618"></span><span class="token mv" id="move-dst-102" data-title="function_definition/parameter">address candidate</span>) <span class="marker" id="mapping-619"></span><span class="token mv" id="move-dst-103" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-620"></span><span class="token add" data-title="function_definition/modifier_invocation">onlyOwner</span> <span class="marker" id="mapping-621"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-622"></span><span class="token mv" id="move-dst-104" data-title="function_body/expression_statement">upgradeTo(candidate);</span>
        <span class="marker" id="mapping-623"></span><span class="token mv" id="move-dst-105" data-title="function_body/emit_statement">emit Commit(msg.sender, candidate);</span>
    }</span></span>

    <span class="marker" id="mapping-624"></span><span class="token add" data-title="contract_body/function_definition">function changeOwner(<span class="marker" id="mapping-625"></span><span class="token add" data-title="function_definition/parameter">address newOwner</span>) <span class="marker" id="mapping-626"></span><span class="token mv" id="move-dst-98" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-627"></span><span class="token add" data-title="function_definition/modifier_invocation">onlyOwner</span> <span class="marker" id="mapping-628"></span><span class="token add" data-title="function_definition/function_body">{
        address prevOwner = owner();
        setOwner(newOwner);
        emit OwnerChanged(prevOwner, newOwner);
    }</span></span>

    /*
     * Bonding Functions
     */
    function withdraw(uint256 value) external {
        dollar().transfer(msg.sender, value);
        decrementBalanceOfStaged(msg.sender, value, "Bonding: insufficient staged balance");

        emit Withdraw(msg.sender, value);
    }

    /*
     * Market Functions
    */

    // @notice: logic overview
    // Redeem `amount` of underlying at the given `couponEpoch`
    // Reverts if balance of underlying at `couponEpoch` is less than `amount`
    function redeemCoupons(uint256 couponEpoch, uint256 amount) external {
        require(epoch().sub(couponEpoch) &gt;= 2, "Market: Too early to redeem");
        require(amount != 0, "Market: Amount too low");

        decrementBalanceOfCouponUnderlying(msg.sender, couponEpoch, amount, "Market: Insufficient coupon underlying balance");
        dollar().mint(msg.sender, amount);

        emit CouponRedemption(msg.sender, couponEpoch, amount, 0);
    }

    function approveCoupons(address spender, uint256 amount) external {
        require(spender != address(0), "Market: Coupon approve to the zero address");

        updateAllowanceCoupons(msg.sender, spender, amount);

        emit CouponApproval(msg.sender, spender, amount);
    }

    function transferCoupons(address sender, address recipient, uint256 epoch, uint256 amount) external {
        require(sender != address(0), "Market: Coupon transfer from the zero address");
        require(recipient != address(0), "Market: Coupon transfer to the zero address");

        decrementBalanceOfCouponUnderlying(sender, epoch, amount, "Market: Insufficient coupon underlying balance");
        incrementBalanceOfCouponUnderlying(recipient, epoch, amount);

        if (msg.sender != sender &amp;&amp; allowanceCoupons(sender, msg.sender) != uint256(-1)) {
            decrementAllowanceCoupons(sender, msg.sender, amount, "Market: Insufficient coupon approval");
        }

        emit CouponTransfer(sender, recipient, epoch, amount);
    }
}
</pre></div></div></div></body></html>