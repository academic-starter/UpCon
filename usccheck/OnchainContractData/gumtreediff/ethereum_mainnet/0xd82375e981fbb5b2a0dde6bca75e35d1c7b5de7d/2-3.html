<html lang="en"><head><meta charset="utf8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>GumTree</title><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><style type="text/css">/*
 * This file is part of GumTree.
 *
 * GumTree is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * GumTree is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with GumTree.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Copyright 2011-2015 Jean-Rémy Falleri <jr.falleri@gmail.com>
 * Copyright 2011-2015 Floréal Morandat <florealm@gmail.com>
 */

.add {
	border: 1px solid black;
	background-color: MediumSeaGreen;
}

.del {
	border: 1px solid black;
	background-color: IndianRed;
}

.mv {
	border: 1px solid black;
	background-color: Plum;
}

.upd {
	border: 1px solid black;
	background-color: DarkOrange;
	font-weight: bold;
}

.cupd {
	font-weight: normal;
	color: DimGray;
}

.selected {
	background-color: Gold;
}

.marker {
	margin: 0;
	padding: 0;
}

div {
	margin: 0px;
	padding: 0px;
}

.pre-scrollable {
	margin: 0px;
	padding: 0px;
	font-size: 10pt;
	color: black;
	max-height: 90vh;
	background-color: white;
	border: 1px solid black;
	font-family: "Hack, Inconsolata", "Consolas", "Liberation Sans Regular", "DejaVu Sans Mono", monospace;
}

.tooltip-inner {
    max-width: none;
}
</style><script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script><script type="text/javascript">/*
 * This file is part of GumTree.
 *
 * GumTree is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * GumTree is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with GumTree.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Copyright 2011-2015 Jean-Rémy Falleri <jr.falleri@gmail.com>
 * Copyright 2011-2015 Floréal Morandat <florealm@gmail.com>
 */

$(function(){
    let popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
    let popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
      return new bootstrap.Popover(popoverTriggerEl)
    })

    $("body").keypress(function (event) {
        switch (event.which) {
            case 116:
                $('html, body').animate({scrollTop: 0}, 100);
                break;
            case 98:
                $("html, body").animate({ scrollTop: $(document).height() }, 100);
                break;
            case 113:
                window.location = "/quit";
                break;
            case 108:
                window.location = "/list";
                break;
        }
    });
});
</script><script type="text/javascript">/*
 * This file is part of GumTree.
 *
 * GumTree is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * GumTree is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with GumTree.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Copyright 2011-2015 Jean-Rémy Falleri <jr.falleri@gmail.com>
 * Copyright 2011-2015 Floréal Morandat <florealm@gmail.com>
 */

currentMapping = 0;

if (typeof String.prototype.startsWith != 'function') {
  String.prototype.startsWith = function (str){
    return this.slice(0, str.length) == str;
  };
}

function getMappedElement(eltId) {
	if (eltId.startsWith("move-src")) {
		return eltId.replace("src","dst");  	 	
  	}
  	else {
  		return eltId.replace("dst","src");
  	}
}

function nextMapping() {
	if (currentMapping == 0) {
		currentMapping = 1;
		return "#mapping-" + currentMapping.toString();
	} else {
		currentMapping++;
		
		if ($("#mapping-" + currentMapping.toString()).length > 0) {
			return "#mapping-" + currentMapping.toString();
		} else {
			currentMapping = 1;
			return "#mapping-" + currentMapping.toString();		
		}		
	}
}

function isSrc(eltId) {
	return eltId.startsWith("move-src");
}

$(function() {
    $("body").keypress(function (event) {
        switch(event.which) {
            case 110:
                const mapping = $(nextMapping());
                const pre = mapping.closest("pre");
                pre.animate({scrollTop: pre.scrollTop() + mapping.position().top - 200}, 100);
                break;
        }
    });

    // highlight
    $("span.mv.token, span.token.upd").click(function(event) {
        if ($(this).hasClass("selected")) {
            $("span.mv.token, span.token.upd").removeClass("selected");
        } else {
            $("span.mv.token, span.token.upd").removeClass("selected");
            const refElt = $("#" + getMappedElement($(this).attr("id")));
            $(this).addClass("selected");
            refElt.addClass("selected");
            const pre = refElt.closest("pre");
            console.log(pre);
            pre.animate({scrollTop: pre.scrollTop() + refElt.position().top - 200}, 100);
        }
        event.stopPropagation();
    });
    
    $("span.add.token, span.token.del").click(function(event) {
        $("span.mv.token, span.token.upd").removeClass("selected");
        event.stopPropagation();
    });

    // tooltip
    $("span.token").hover(
    	function (event) {
    		$(this).tooltip('show');
    		event.stopPropagation();
    	},
    	function (event) {
    		$(this).tooltip('hide');
    		event.stopPropagation();
    	}
    );
});
</script></head><body><div class="container-fluid"><div class="row"><div class="col"><div class="btn-toolbar justify-content-end"><div class="btn-group mr-2"><button class="btn btn-primary btn-sm" id="legend" data-bs-toggle="popover" data-bs-placement="bottom" data-bs-html="true" data-bs-content="<span class='del'>&nbsp;&nbsp;</span> deleted<br><span class='add'>&nbsp;&nbsp;</span> added<br><span class='mv'>&nbsp;&nbsp;</span> moved<br><span class='upd';>&nbsp;&nbsp;</span> updated<br>">Legend</button><button class="btn btn-primary btn-sm" id="shortcuts" data-bs-toggle="popover" data-bs-placement="bottom" data-bs-html="true" data-bs-content="<b>q</b> quit<br><b>l</b> list<br><b>n</b> next<br><b>t</b> top<br><b>b</b> bottom">Shortcuts</button></div><div class="btn-group"><a href="/list" class="btn btn-default btn-sm btn-primary">Back</a><a href="/quit" class="btn btn-default btn-sm btn-danger">Quit</a></div></div></div></div><div class="row"><div class="col-6"><h5>0x223116e025c293a9d659405b9b519bdc0742763f.etherscan.io-Deployer3.sol</h5><pre class="pre-scrollable">// SPDX-License-Identifier: none

pragma solidity ^0.5.17;
pragma experimental ABIEncoderV2;


library SafeMath {
    /**
     * @dev Returns the addition of two unsigned integers, reverting on
     * overflow.
     *
     * Counterpart to Solidity's `+` operator.
     *
     * Requirements:
     * - Addition cannot overflow.
     */
    function add(uint256 a, uint256 b) internal pure returns (uint256) {
        uint256 c = a + b;
        require(c &gt;= a, "SafeMath: addition overflow");

        return c;
    }

    /**
     * @dev Returns the subtraction of two unsigned integers, reverting on
     * overflow (when the result is negative).
     *
     * Counterpart to Solidity's `-` operator.
     *
     * Requirements:
     * - Subtraction cannot overflow.
     */
    function sub(uint256 a, uint256 b) internal pure returns (uint256) {
        return sub(a, b, "SafeMath: subtraction overflow");
    }

    /**
     * @dev Returns the subtraction of two unsigned integers, reverting with custom message on
     * overflow (when the result is negative).
     *
     * Counterpart to Solidity's `-` operator.
     *
     * Requirements:
     * - Subtraction cannot overflow.
     *
     * _Available since v2.4.0._
     */
    function sub(uint256 a, uint256 b, string memory errorMessage) internal pure returns (uint256) {
        require(b &lt;= a, errorMessage);
        uint256 c = a - b;

        return c;
    }

    /**
     * @dev Returns the multiplication of two unsigned integers, reverting on
     * overflow.
     *
     * Counterpart to Solidity's `*` operator.
     *
     * Requirements:
     * - Multiplication cannot overflow.
     */
    function mul(uint256 a, uint256 b) internal pure returns (uint256) {
        // Gas optimization: this is cheaper than requiring 'a' not being zero, but the
        // benefit is lost if 'b' is also tested.
        // See: https://github.com/OpenZeppelin/openzeppelin-contracts/pull/522
        if (a == 0) {
            return 0;
        }

        uint256 c = a * b;
        require(c / a == b, "SafeMath: multiplication overflow");

        return c;
    }

    /**
     * @dev Returns the integer division of two unsigned integers. Reverts on
     * division by zero. The result is rounded towards zero.
     *
     * Counterpart to Solidity's `/` operator. Note: this function uses a
     * `revert` opcode (which leaves remaining gas untouched) while Solidity
     * uses an invalid opcode to revert (consuming all remaining gas).
     *
     * Requirements:
     * - The divisor cannot be zero.
     */
    function div(uint256 a, uint256 b) internal pure returns (uint256) {
        return div(a, b, "SafeMath: division by zero");
    }

    /**
     * @dev Returns the integer division of two unsigned integers. Reverts with custom message on
     * division by zero. The result is rounded towards zero.
     *
     * Counterpart to Solidity's `/` operator. Note: this function uses a
     * `revert` opcode (which leaves remaining gas untouched) while Solidity
     * uses an invalid opcode to revert (consuming all remaining gas).
     *
     * Requirements:
     * - The divisor cannot be zero.
     *
     * _Available since v2.4.0._
     */
    function div(uint256 a, uint256 b, string memory errorMessage) internal pure returns (uint256) {
        // Solidity only automatically asserts when dividing by 0
        require(b &gt; 0, errorMessage);
        uint256 c = a / b;
        // assert(a == b * c + a % b); // There is no case in which this doesn't hold

        return c;
    }

    /**
     * @dev Returns the remainder of dividing two unsigned integers. (unsigned integer modulo),
     * Reverts when dividing by zero.
     *
     * Counterpart to Solidity's `%` operator. This function uses a `revert`
     * opcode (which leaves remaining gas untouched) while Solidity uses an
     * invalid opcode to revert (consuming all remaining gas).
     *
     * Requirements:
     * - The divisor cannot be zero.
     */
    function mod(uint256 a, uint256 b) internal pure returns (uint256) {
        return mod(a, b, "SafeMath: modulo by zero");
    }

    /**
     * @dev Returns the remainder of dividing two unsigned integers. (unsigned integer modulo),
     * Reverts with custom message when dividing by zero.
     *
     * Counterpart to Solidity's `%` operator. This function uses a `revert`
     * opcode (which leaves remaining gas untouched) while Solidity uses an
     * invalid opcode to revert (consuming all remaining gas).
     *
     * Requirements:
     * - The divisor cannot be zero.
     *
     * _Available since v2.4.0._
     */
    function mod(uint256 a, uint256 b, string memory errorMessage) internal pure returns (uint256) {
        require(b != 0, errorMessage);
        return a % b;
    }
}

/*
    Copyright 2019 dYdX Trading Inc.
    Copyright 2020 Dynamic Dollar Devs, based on the works of the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
/**
 * @title Decimal
 * @author dYdX
 *
 * Library that defines a fixed-point number with 18 decimal places.
 */
library Decimal {
    using SafeMath for uint256;

    // ============ Constants ============

    uint256 constant BASE = 10**18;

    // ============ Structs ============


    struct D256 {
        uint256 value;
    }

    // ============ Static Functions ============

    function zero()
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: 0 });
    }

    function one()
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: BASE });
    }

    function from(
        uint256 a
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: a.mul(BASE) });
    }

    function ratio(
        uint256 a,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: getPartial(a, BASE, b) });
    }

    // ============ Self Functions ============

    function add(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.add(b.mul(BASE)) });
    }

    function sub(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.sub(b.mul(BASE)) });
    }

    function sub(
        D256 memory self,
        uint256 b,
        string memory reason
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.sub(b.mul(BASE), reason) });
    }

    function mul(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.mul(b) });
    }

    function div(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.div(b) });
    }

    function pow(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        if (b == 0) {
            return from(1);
        }

        D256 memory temp = D256({ value: self.value });
        for (uint256 i = 1; i &lt; b; i++) {
            temp = mul(temp, self);
        }

        return temp;
    }

    function add(
        D256 memory self,
        D256 memory b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.add(b.value) });
    }

    function sub(
        D256 memory self,
        D256 memory b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.sub(b.value) });
    }

    function sub(
        D256 memory self,
        D256 memory b,
        string memory reason
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.sub(b.value, reason) });
    }

    function mul(
        D256 memory self,
        D256 memory b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: getPartial(self.value, b.value, BASE) });
    }

    function div(
        D256 memory self,
        D256 memory b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: getPartial(self.value, BASE, b.value) });
    }

    function equals(D256 memory self, D256 memory b) internal pure returns (bool) {
        return self.value == b.value;
    }

    function greaterThan(D256 memory self, D256 memory b) internal pure returns (bool) {
        return compareTo(self, b) == 2;
    }

    function lessThan(D256 memory self, D256 memory b) internal pure returns (bool) {
        return compareTo(self, b) == 0;
    }

    function greaterThanOrEqualTo(D256 memory self, D256 memory b) internal pure returns (bool) {
        return compareTo(self, b) &gt; 0;
    }

    function lessThanOrEqualTo(D256 memory self, D256 memory b) internal pure returns (bool) {
        return compareTo(self, b) &lt; 2;
    }

    function isZero(D256 memory self) internal pure returns (bool) {
        return self.value == 0;
    }

    function asUint256(D256 memory self) internal pure returns (uint256) {
        return self.value.div(BASE);
    }

    // ============ Core Methods ============

    function getPartial(
        uint256 target,
        uint256 numerator,
        uint256 denominator
    )
    private
    pure
    returns (uint256)
    {
        return target.mul(numerator).div(denominator);
    }

    function compareTo(
        D256 memory a,
        D256 memory b
    )
    private
    pure
    returns (uint256)
    {
        if (a.value == b.value) {
            return 1;
        }
        return a.value &gt; b.value ? 2 : 0;
    }
}

<span class="marker" id="mapping-1"></span><span class="token mv" id="move-src-1" data-title="source_file/comment"><span class="marker" id="mapping-2"></span><span class="token upd" id="move-src-2" data-title="source_file/comment"><span class="cupd">/*</span><span class="cupd">
 * @dev </span>P<span class="cupd">r</span><span class="cupd">ov</span><span class="cupd">id</span>e<span class="cupd">s </span><span class="cupd">i</span>nf<span class="cupd">o</span><span class="cupd">r</span>m<span class="cupd">ation</span><span class="cupd"> </span>abou<span class="cupd">t</span> t<span class="cupd">h</span>e<span class="cupd"> </span>curr<span class="cupd">e</span>nt<span class="cupd"> </span><span class="cupd">e</span>xecuti<span class="cupd">o</span>n<span class="cupd"> </span>context,<span class="cupd"> </span>in<span class="cupd">c</span>luding t<span class="cupd">he</span><span class="cupd">
 * </span>sender<span class="cupd"> </span>of<span class="cupd"> </span><span class="cupd">th</span><span class="cupd">e</span><span class="cupd"> </span>t<span class="cupd">ra</span>nsac<span class="cupd">tion</span><span class="cupd"> </span>a<span class="cupd">n</span>d<span class="cupd"> </span><span class="cupd">i</span><span class="cupd">t</span>s<span class="cupd"> </span>d<span class="cupd">a</span>ta<span class="cupd">. </span>W<span class="cupd">hi</span>le the<span class="cupd">s</span>e<span class="cupd"> </span><span class="cupd">a</span>re<span class="cupd"> </span>g<span class="cupd">e</span>ner<span class="cupd">a</span><span class="cupd">l</span>l<span class="cupd">y </span>avai<span class="cupd">l</span>able<span class="cupd">
 * </span>v<span class="cupd">i</span>a<span class="cupd"> </span>ms<span class="cupd">g</span>.<span class="cupd">s</span><span class="cupd">e</span>nd<span class="cupd">e</span><span class="cupd">r</span> <span class="cupd">a</span>nd <span class="cupd">m</span><span class="cupd">s</span>g.d<span class="cupd">a</span>t<span class="cupd">a</span>,<span class="cupd"> th</span>ey<span class="cupd"> </span>sh<span class="cupd">o</span>u<span class="cupd">l</span>d n<span class="cupd">o</span>t<span class="cupd"> </span>be <span class="cupd">a</span>cce<span class="cupd">s</span>s<span class="cupd">e</span>d in <span class="cupd">s</span>uch<span class="cupd"> a</span><span class="cupd"> </span>direct<span class="cupd">
</span> <span class="cupd">* </span>mann<span class="cupd">er</span><span class="cupd">, </span>s<span class="cupd">i</span>n<span class="cupd">c</span>e w<span class="cupd">h</span>en<span class="cupd"> </span>deal<span class="cupd">i</span>ng<span class="cupd"> </span>wi<span class="cupd">th</span><span class="cupd"> </span>GSN me<span class="cupd">ta</span>-t<span class="cupd">r</span><span class="cupd">a</span>nsact<span class="cupd">io</span><span class="cupd">n</span>s<span class="cupd"> </span>t<span class="cupd">h</span><span class="cupd">e</span><span class="cupd"> </span><span class="cupd">a</span>ccount send<span class="cupd">ing </span><span class="cupd">an</span>d<span class="cupd">
 * </span>p<span class="cupd">a</span>ying<span class="cupd"> </span>f<span class="cupd">or</span><span class="cupd"> </span>exec<span class="cupd">u</span><span class="cupd">tion </span>ma<span class="cupd">y </span><span class="cupd">n</span>ot<span class="cupd"> </span>be <span class="cupd">the </span><span class="cupd">a</span><span class="cupd">ct</span>ual<span class="cupd"> </span>s<span class="cupd">en</span>der<span class="cupd"> </span>(<span class="cupd">a</span>s<span class="cupd"> </span>far<span class="cupd"> </span>as<span class="cupd"> </span>an a<span class="cupd">p</span>plic<span class="cupd">ation
</span> * is c<span class="cupd">o</span>nc<span class="cupd">er</span>ned)<span class="cupd">.
 *
 * </span>T<span class="cupd">his </span>cont<span class="cupd">ra</span>ct<span class="cupd"> i</span><span class="cupd">s</span><span class="cupd"> o</span>nly<span class="cupd"> </span>r<span class="cupd">e</span>q<span class="cupd">u</span>ir<span class="cupd">e</span><span class="cupd">d </span>f<span class="cupd">o</span><span class="cupd">r</span> <span class="cupd">i</span><span class="cupd">n</span>t<span class="cupd">e</span>r<span class="cupd">m</span>ed<span class="cupd">i</span><span class="cupd">ate</span>,<span class="cupd"> </span>l<span class="cupd">i</span>b<span class="cupd">r</span>ary-lik<span class="cupd">e </span><span class="cupd">c</span><span class="cupd">o</span>n<span class="cupd">t</span><span class="cupd">r</span>a<span class="cupd">c</span><span class="cupd">t</span><span class="cupd">s</span><span class="cupd">.
 */</span></span></span>
<span class="marker" id="mapping-3"></span><span class="token del" data-title="source_file/contract_declaration">contract Context <span class="marker" id="mapping-4"></span><span class="token del" data-title="contract_declaration/contract_body">{
    // Empty internal constructor, to prevent people from mistakenly deploying
    // an instance of this contract, which should be used via inheritance.
    <span class="marker" id="mapping-5"></span><span class="token del" data-title="contract_body/constructor_definition">constructor () internal { }</span>
    // solhint-disable-previous-line no-empty-blocks

    <span class="marker" id="mapping-6"></span><span class="token del" data-title="contract_body/function_definition">function _msgSender() <span class="marker" id="mapping-7"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-8"></span><span class="token del" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-9"></span><span class="token del" data-title="function_definition/return_type_definition">returns (address payable)</span> <span class="marker" id="mapping-10"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-11"></span><span class="token del" data-title="function_body/return_statement">return <span class="marker" id="mapping-12"></span><span class="token mv" id="move-src-3" data-title="return_statement/member_expression">msg.sender</span>;</span>
    }</span></span>

    <span class="marker" id="mapping-13"></span><span class="token del" data-title="contract_body/function_definition">function _msgData() internal view returns (bytes memory) {
        this; // silence state mutability warning without generating bytecode - see https://github.com/ethereum/solidity/issues/2691
        return msg.data;
    }</span>
}</span></span>

<span class="marker" id="mapping-14"></span><span class="token mv" id="move-src-4" data-title="source_file/comment">/**
 * @dev Interface of the ERC20 standard as defined in the EIP. Does not include
 * the optional functions; to access them see {ERC20Detailed}.
 */</span>
<span class="marker" id="mapping-15"></span><span class="token mv" id="move-src-5" data-title="source_file/interface_declaration">interface IERC20 {
    /**
     * @dev Returns the amount of tokens in existence.
     */
    function totalSupply() external view returns (uint256);

    /**
     * @dev Returns the amount of tokens owned by `account`.
     */
    function balanceOf(address account) external view returns (uint256);

    /**
     * @dev Moves `amount` tokens from the caller's account to `recipient`.
     *
     * Returns a boolean value indicating whether the operation succeeded.
     *
     * Emits a {Transfer} event.
     */
    function transfer(address recipient, uint256 amount) external returns (bool);

    /**
     * @dev Returns the remaining number of tokens that `spender` will be
     * allowed to spend on behalf of `owner` through {transferFrom}. This is
     * zero by default.
     *
     * This value changes when {approve} or {transferFrom} are called.
     */
    function allowance(address owner, address spender) external view returns (uint256);

    /**
     * @dev Sets `amount` as the allowance of `spender` over the caller's tokens.
     *
     * Returns a boolean value indicating whether the operation succeeded.
     *
     * IMPORTANT: Beware that changing an allowance with this method brings the risk
     * that someone may use both the old and the new allowance by unfortunate
     * transaction ordering. One possible solution to mitigate this race
     * condition is to first reduce the spender's allowance to 0 and set the
     * desired value afterwards:
     * https://github.com/ethereum/EIPs/issues/20#issuecomment-263524729
     *
     * Emits an {Approval} event.
     */
    function approve(address spender, uint256 amount) external returns (bool);

    /**
     * @dev Moves `amount` tokens from `sender` to `recipient` using the
     * allowance mechanism. `amount` is then deducted from the caller's
     * allowance.
     *
     * Returns a boolean value indicating whether the operation succeeded.
     *
     * Emits a {Transfer} event.
     */
    function transferFrom(address sender, address recipient, uint256 amount) external returns (bool);

    /**
     * @dev Emitted when `value` tokens are moved from one account (`from`) to
     * another (`to`).
     *
     * Note that `value` may be zero.
     */
    event Transfer(address indexed from, address indexed to, uint256 value);

    /**
     * @dev Emitted when the allowance of a `spender` for an `owner` is set by
     * a call to {approve}. `value` is the new allowance.
     */
    event Approval(address indexed owner, address indexed spender, uint256 value);
}</span>

<span class="marker" id="mapping-16"></span><span class="token mv" id="move-src-6" data-title="source_file/comment"><span class="marker" id="mapping-17"></span><span class="token upd" id="move-src-7" data-title="source_file/comment"><span class="cupd">/*</span>*<span class="cupd">
 </span>*<span class="cupd"> </span>@dev<span class="cupd"> </span>Wrappers<span class="cupd"> </span><span class="cupd">o</span>ver Solidit<span class="cupd">y</span>'s a<span class="cupd">ri</span>t<span class="cupd">h</span>me<span class="cupd">t</span>ic<span class="cupd"> </span>ope<span class="cupd">ra</span>t<span class="cupd">i</span>o<span class="cupd">n</span>s<span class="cupd"> </span>with<span class="cupd"> </span>added<span class="cupd"> </span>overflow<span class="cupd">
 </span>*<span class="cupd"> </span><span class="cupd">c</span>h<span class="cupd">e</span>ck<span class="cupd">s</span>.<span class="cupd">
</span><span class="cupd"> </span>*<span class="cupd">
</span> * <span class="cupd">A</span>rit<span class="cupd">h</span>m<span class="cupd">e</span>t<span class="cupd">ic</span><span class="cupd"> </span>op<span class="cupd">er</span>at<span class="cupd">ion</span>s<span class="cupd"> </span><span class="cupd">i</span><span class="cupd">n</span><span class="cupd"> </span>S<span class="cupd">o</span>lidity<span class="cupd"> </span>wr<span class="cupd">a</span>p<span class="cupd"> </span><span class="cupd">o</span>n<span class="cupd"> </span>ov<span class="cupd">e</span>rflow.<span class="cupd"> </span>T<span class="cupd">his </span>can eas<span class="cupd">il</span>y<span class="cupd"> </span>r<span class="cupd">e</span>sul<span class="cupd">t
</span><span class="cupd"> </span>* <span class="cupd">i</span><span class="cupd">n</span><span class="cupd"> </span>bugs,<span class="cupd"> </span>b<span class="cupd">e</span><span class="cupd">c</span>au<span class="cupd">se</span><span class="cupd"> </span>pr<span class="cupd">o</span>gra<span class="cupd">m</span>mers usu<span class="cupd">a</span>ll<span class="cupd">y </span>assume <span class="cupd">t</span>h<span class="cupd">a</span>t<span class="cupd"> a</span>n<span class="cupd"> </span><span class="cupd">o</span>ver<span class="cupd">f</span>low<span class="cupd"> </span>ra<span class="cupd">i</span><span class="cupd">se</span>s<span class="cupd"> a</span>n<span class="cupd">
 </span>*<span class="cupd"> </span>error,<span class="cupd"> </span>which<span class="cupd"> </span>is<span class="cupd"> </span>t<span class="cupd">h</span>e s<span class="cupd">t</span><span class="cupd">a</span>nd<span class="cupd">a</span>rd b<span class="cupd">e</span>havi<span class="cupd">or</span> <span class="cupd">i</span><span class="cupd">n</span><span class="cupd"> </span>high<span class="cupd"> </span><span class="cupd">le</span>vel<span class="cupd"> </span>p<span class="cupd">r</span>og<span class="cupd">r</span><span class="cupd">a</span>mm<span class="cupd">i</span>ng<span class="cupd"> la</span>ngu<span class="cupd">ag</span><span class="cupd">e</span>s.<span class="cupd">
</span><span class="cupd"> </span>*<span class="cupd"> </span>`SafeMa<span class="cupd">t</span>h`<span class="cupd"> </span>re<span class="cupd">s</span><span class="cupd">t</span>o<span class="cupd">re</span>s<span class="cupd"> </span>th<span class="cupd">is</span> <span class="cupd">i</span>n<span class="cupd">t</span><span class="cupd">u</span>itio<span class="cupd">n</span> by r<span class="cupd">e</span>ve<span class="cupd">r</span>ting<span class="cupd"> the </span>tra<span class="cupd">ns</span>ac<span class="cupd">t</span><span class="cupd">i</span><span class="cupd">on </span>when <span class="cupd">an
</span><span class="cupd"> </span>*<span class="cupd"> </span>op<span class="cupd">e</span><span class="cupd">r</span>ation<span class="cupd"> </span>ov<span class="cupd">e</span><span class="cupd">r</span>f<span class="cupd">l</span>ows<span class="cupd">.
 </span>*<span class="cupd">
 </span>*<span class="cupd"> </span>Using<span class="cupd"> th</span>is<span class="cupd"> </span>l<span class="cupd">i</span>brary i<span class="cupd">ns</span>t<span class="cupd">e</span>ad<span class="cupd"> </span><span class="cupd">o</span>f<span class="cupd"> the </span>unch<span class="cupd">ec</span>k<span class="cupd">e</span>d<span class="cupd"> </span><span class="cupd">o</span>p<span class="cupd">er</span>at<span class="cupd">i</span>o<span class="cupd">n</span>s<span class="cupd"> </span><span class="cupd">e</span>li<span class="cupd">mi</span><span class="cupd">n</span>ate<span class="cupd">s an</span><span class="cupd"> </span>entire<span class="cupd">
 </span>*<span class="cupd"> </span>c<span class="cupd">l</span><span class="cupd">a</span><span class="cupd">s</span>s<span class="cupd"> </span>of b<span class="cupd">u</span>gs, so it's recomme<span class="cupd">nde</span>d<span class="cupd"> t</span>o us<span class="cupd">e </span><span class="cupd">i</span>t alway<span class="cupd">s</span><span class="cupd">.
</span> <span class="cupd">*/</span></span></span>

<span class="marker" id="mapping-18"></span><span class="token mv" id="move-src-8" data-title="source_file/comment"><span class="marker" id="mapping-19"></span><span class="token upd" id="move-src-9" data-title="source_file/comment"><span class="cupd">/**
 * @</span>dev Implemen<span class="cupd">t</span>at<span class="cupd">i</span>on of <span class="cupd">t</span>h<span class="cupd">e </span>{IE<span class="cupd">R</span>C20} <span class="cupd">i</span>nte<span class="cupd">r</span>fac<span class="cupd">e</span>.<span class="cupd">
 *
</span> * This implement<span class="cupd">a</span><span class="cupd">t</span>ion is agnostic to t<span class="cupd">h</span>e way t<span class="cupd">o</span>kens a<span class="cupd">r</span>e<span class="cupd"> </span>create<span class="cupd">d</span>.<span class="cupd"> </span>This<span class="cupd"> </span>means<span class="cupd">
 * </span><span class="cupd">t</span>hat a supply mechanism has to be added in a de<span class="cupd">ri</span>ved co<span class="cupd">n</span>tract usin<span class="cupd">g</span> {_m<span class="cupd">i</span>nt}.
 * For a gener<span class="cupd">i</span>c m<span class="cupd">e</span>chani<span class="cupd">s</span>m<span class="cupd"> </span>see {ERC20Mint<span class="cupd">a</span>ble}.
 *
 * TIP: Fo<span class="cupd">r</span> <span class="cupd">a</span> d<span class="cupd">et</span>ail<span class="cupd">e</span>d w<span class="cupd">r</span>iteup <span class="cupd">s</span>ee<span class="cupd"> </span><span class="cupd">o</span>ur<span class="cupd"> </span>guide
 * htt<span class="cupd">p</span>s://fo<span class="cupd">r</span>um.z<span class="cupd">e</span>ppelin.solu<span class="cupd">t</span>ions/<span class="cupd">t</span>/how-to-implement-erc20-suppl<span class="cupd">y-</span>mechanisms/226[How
 * to im<span class="cupd">p</span>lement supply mechanisms].
 *
 * We have followed gene<span class="cupd">r</span>al OpenZeppel<span class="cupd">in</span> guidelines: func<span class="cupd">t</span>ions<span class="cupd"> revert </span>inst<span class="cupd">e</span>ad
 * of returning `fal<span class="cupd">s</span>e` on failure. Thi<span class="cupd">s</span> beh<span class="cupd">a</span>vior is non<span class="cupd">e</span>thele<span class="cupd">s</span>s<span class="cupd"> </span>conventional
 * and does not conflict with the expectations of ER<span class="cupd">C</span>20 applicati<span class="cupd">o</span>n<span class="cupd">s</span>.
 *
 * Addi<span class="cupd">t</span>ionally, an {Approval} event i<span class="cupd">s </span>e<span class="cupd">m</span>itted <span class="cupd">o</span>n calls to {t<span class="cupd">r</span>ansf<span class="cupd">e</span>rFrom}.<span class="cupd">
</span> * This <span class="cupd">a</span>llow<span class="cupd">s </span>applica<span class="cupd">t</span>ions to reconstruct t<span class="cupd">h</span>e <span class="cupd">a</span>llowa<span class="cupd">n</span>ce<span class="cupd"> </span>fo<span class="cupd">r</span> all accounts just
 * by list<span class="cupd">e</span>nin<span class="cupd">g</span> to said events. Other implementations of the EIP may not emit
 * these events, as it isn't req<span class="cupd">u</span>ired by the specification.
 *
 * Fina<span class="cupd">l</span>ly, the non-st<span class="cupd">a</span>nda<span class="cupd">r</span>d<span class="cupd"> </span>{dec<span class="cupd">re</span>aseAllowance} and {increaseAllowance}
 * f<span class="cupd">u</span>nct<span class="cupd">i</span>ons have been added to mitigate the well-known issues a<span class="cupd">r</span>ound s<span class="cupd">e</span>tting<span class="cupd">
 *</span> allowances. See {IERC20-approve}.
 */</span></span>
<span class="marker" id="mapping-20"></span><span class="token mv" id="move-src-10" data-title="source_file/contract_declaration">contract <span class="marker" id="mapping-21"></span><span class="token upd" id="move-src-11" data-title="contract_declaration/identifier">ERC20</span> is <span class="marker" id="mapping-22"></span><span class="token upd" id="move-src-12" data-title="user_defined_type/identifier"><span class="cupd">Co</span>n<span class="cupd">t</span>ext</span>, <span class="marker" id="mapping-23"></span><span class="token upd" id="move-src-13" data-title="user_defined_type/identifier">IERC20</span> {
    using SafeMath for uint256;

    <span class="marker" id="mapping-24"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-25"></span><span class="token del" data-title="state_variable_declaration/type_name">mapping (<span class="marker" id="mapping-26"></span><span class="token del" data-title="type_name/primitive_type">address</span> =&gt; <span class="marker" id="mapping-27"></span><span class="token mv" id="move-src-14" data-title="type_name/type_name">uint256</span>)</span> <span class="marker" id="mapping-28"></span><span class="token del" data-title="state_variable_declaration/visibility">private</span> _balances;</span>

    <span class="marker" id="mapping-29"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-30"></span><span class="token del" data-title="state_variable_declaration/type_name">mapping (<span class="marker" id="mapping-31"></span><span class="token del" data-title="type_name/primitive_type">address</span> =&gt; <span class="marker" id="mapping-32"></span><span class="token del" data-title="type_name/type_name">mapping (<span class="marker" id="mapping-33"></span><span class="token del" data-title="type_name/primitive_type">address</span> =&gt; <span class="marker" id="mapping-34"></span><span class="token mv" id="move-src-15" data-title="type_name/type_name">uint256</span>)</span>)</span> <span class="marker" id="mapping-35"></span><span class="token mv" id="move-src-16" data-title="state_variable_declaration/visibility">private</span> _allowances;</span>

    <span class="marker" id="mapping-36"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-37"></span><span class="token mv" id="move-src-17" data-title="state_variable_declaration/type_name">uint256</span> <span class="marker" id="mapping-38"></span><span class="token mv" id="move-src-18" data-title="state_variable_declaration/visibility">private</span> _totalSupply;</span>

    <span class="marker" id="mapping-39"></span><span class="token del" data-title="contract_body/comment">/**
     * @dev See {IERC20-totalSupply}.
     */</span>
    <span class="marker" id="mapping-40"></span><span class="token del" data-title="contract_body/function_definition">function totalSupply() <span class="marker" id="mapping-41"></span><span class="token del" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-42"></span><span class="token del" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-43"></span><span class="token mv" id="move-src-19" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-44"></span><span class="token del" data-title="function_definition/function_body">{
        return _totalSupply;
    }</span></span>

    <span class="marker" id="mapping-45"></span><span class="token del" data-title="contract_body/comment">/**
     * @dev See {IERC20-balanceOf}.
     */</span>
    <span class="marker" id="mapping-46"></span><span class="token del" data-title="contract_body/function_definition">function balanceOf(address account) public view returns (uint256) {
        return _balances[account];
    }</span>

    <span class="marker" id="mapping-47"></span><span class="token del" data-title="contract_body/comment">/**
     * @dev See {IERC20-transfer}.
     *
     * Requirements:
     *
     * - `recipient` cannot be the zero address.
     * - the caller must have a balance of at least `amount`.
     */</span>
    <span class="marker" id="mapping-48"></span><span class="token del" data-title="contract_body/function_definition">function transfer(<span class="marker" id="mapping-49"></span><span class="token del" data-title="function_definition/parameter">address recipient</span>, <span class="marker" id="mapping-50"></span><span class="token mv" id="move-src-20" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-51"></span><span class="token del" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-52"></span><span class="token del" data-title="function_definition/return_type_definition">returns (bool)</span> <span class="marker" id="mapping-53"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-54"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-55"></span><span class="token del" data-title="expression_statement/call_expression">_transfer(<span class="marker" id="mapping-56"></span><span class="token del" data-title="call_expression/call_argument">_msgSender()</span>, <span class="marker" id="mapping-57"></span><span class="token del" data-title="call_expression/call_argument">recipient</span>, <span class="marker" id="mapping-58"></span><span class="token mv" id="move-src-21" data-title="call_expression/call_argument">amount</span>)</span>;</span>
        <span class="marker" id="mapping-59"></span><span class="token del" data-title="function_body/return_statement">return true;</span>
    }</span></span>

    <span class="marker" id="mapping-60"></span><span class="token del" data-title="contract_body/comment">/**
     * @dev See {IERC20-allowance}.
     */</span>
    <span class="marker" id="mapping-61"></span><span class="token del" data-title="contract_body/function_definition">function allowance(address owner, address spender) public view returns (uint256) {
        return _allowances[owner][spender];
    }</span>

    <span class="marker" id="mapping-62"></span><span class="token del" data-title="contract_body/comment">/**
     * @dev See {IERC20-approve}.
     *
     * Requirements:
     *
     * - `spender` cannot be the zero address.
     */</span>
    <span class="marker" id="mapping-63"></span><span class="token del" data-title="contract_body/function_definition">function approve(<span class="marker" id="mapping-64"></span><span class="token del" data-title="function_definition/parameter">address spender</span>, <span class="marker" id="mapping-65"></span><span class="token del" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-66"></span><span class="token del" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-67"></span><span class="token del" data-title="function_definition/return_type_definition">returns (bool)</span> <span class="marker" id="mapping-68"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-69"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-70"></span><span class="token del" data-title="expression_statement/call_expression">_approve(<span class="marker" id="mapping-71"></span><span class="token del" data-title="call_expression/call_argument">_msgSender()</span>, <span class="marker" id="mapping-72"></span><span class="token del" data-title="call_expression/call_argument">spender</span>, <span class="marker" id="mapping-73"></span><span class="token mv" id="move-src-22" data-title="call_expression/call_argument">amount</span>)</span>;</span>
        <span class="marker" id="mapping-74"></span><span class="token del" data-title="function_body/return_statement">return true;</span>
    }</span></span>

    <span class="marker" id="mapping-75"></span><span class="token del" data-title="contract_body/comment">/**
     * @dev See {IERC20-transferFrom}.
     *
     * Emits an {Approval} event indicating the updated allowance. This is not
     * required by the EIP. See the note at the beginning of {ERC20};
     *
     * Requirements:
     * - `sender` and `recipient` cannot be the zero address.
     * - `sender` must have a balance of at least `amount`.
     * - the caller must have allowance for `sender`'s tokens of at least
     * `amount`.
     */</span>
    <span class="marker" id="mapping-76"></span><span class="token del" data-title="contract_body/function_definition">function transferFrom(<span class="marker" id="mapping-77"></span><span class="token del" data-title="function_definition/parameter">address sender</span>, <span class="marker" id="mapping-78"></span><span class="token del" data-title="function_definition/parameter">address recipient</span>, <span class="marker" id="mapping-79"></span><span class="token del" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-80"></span><span class="token del" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-81"></span><span class="token del" data-title="function_definition/return_type_definition">returns (bool)</span> <span class="marker" id="mapping-82"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-83"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-84"></span><span class="token del" data-title="expression_statement/call_expression">_transfer(<span class="marker" id="mapping-85"></span><span class="token del" data-title="call_expression/call_argument">sender</span>, <span class="marker" id="mapping-86"></span><span class="token del" data-title="call_expression/call_argument">recipient</span>, <span class="marker" id="mapping-87"></span><span class="token mv" id="move-src-23" data-title="call_expression/call_argument">amount</span>)</span>;</span>
        <span class="marker" id="mapping-88"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-89"></span><span class="token del" data-title="expression_statement/call_expression">_approve(<span class="marker" id="mapping-90"></span><span class="token del" data-title="call_expression/call_argument">sender</span>, <span class="marker" id="mapping-91"></span><span class="token del" data-title="call_expression/call_argument">_msgSender()</span>, <span class="marker" id="mapping-92"></span><span class="token del" data-title="call_expression/call_argument"><span class="marker" id="mapping-93"></span><span class="token del" data-title="call_argument/call_expression"><span class="marker" id="mapping-94"></span><span class="token del" data-title="call_expression/member_expression">_allowances[sender][_msgSender()].sub</span>(<span class="marker" id="mapping-95"></span><span class="token del" data-title="call_expression/call_argument">amount</span>, <span class="marker" id="mapping-96"></span><span class="token mv" id="move-src-24" data-title="call_expression/call_argument">"ERC20: transfer amount exceeds allowance"</span>)</span></span>)</span>;</span>
        <span class="marker" id="mapping-97"></span><span class="token del" data-title="function_body/return_statement">return true;</span>
    }</span></span>

    <span class="marker" id="mapping-98"></span><span class="token del" data-title="contract_body/comment">/**
     * @dev Atomically increases the allowance granted to `spender` by the caller.
     *
     * This is an alternative to {approve} that can be used as a mitigation for
     * problems described in {IERC20-approve}.
     *
     * Emits an {Approval} event indicating the updated allowance.
     *
     * Requirements:
     *
     * - `spender` cannot be the zero address.
     */</span>
    <span class="marker" id="mapping-99"></span><span class="token del" data-title="contract_body/function_definition">function increaseAllowance(<span class="marker" id="mapping-100"></span><span class="token del" data-title="function_definition/parameter">address spender</span>, <span class="marker" id="mapping-101"></span><span class="token mv" id="move-src-25" data-title="function_definition/parameter">uint256 <span class="marker" id="mapping-102"></span><span class="token upd" id="move-src-26" data-title="parameter/identifier"><span class="cupd">a</span>ddedVa<span class="cupd">l</span>ue</span></span>) <span class="marker" id="mapping-103"></span><span class="token del" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-104"></span><span class="token del" data-title="function_definition/return_type_definition">returns (bool)</span> <span class="marker" id="mapping-105"></span><span class="token del" data-title="function_definition/function_body">{
        _approve(_msgSender(), spender, _allowances[_msgSender()][spender].add(addedValue));
        return true;
    }</span></span>

    <span class="marker" id="mapping-106"></span><span class="token del" data-title="contract_body/comment">/**
     * @dev Atomically decreases the allowance granted to `spender` by the caller.
     *
     * This is an alternative to {approve} that can be used as a mitigation for
     * problems described in {IERC20-approve}.
     *
     * Emits an {Approval} event indicating the updated allowance.
     *
     * Requirements:
     *
     * - `spender` cannot be the zero address.
     * - `spender` must have allowance for the caller of at least
     * `subtractedValue`.
     */</span>
    <span class="marker" id="mapping-107"></span><span class="token del" data-title="contract_body/function_definition">function decreaseAllowance(<span class="marker" id="mapping-108"></span><span class="token del" data-title="function_definition/parameter">address spender</span>, <span class="marker" id="mapping-109"></span><span class="token mv" id="move-src-27" data-title="function_definition/parameter">uint256 <span class="marker" id="mapping-110"></span><span class="token upd" id="move-src-28" data-title="parameter/identifier">sub<span class="cupd">t</span>rac<span class="cupd">t</span>edV<span class="cupd">al</span>ue</span></span>) <span class="marker" id="mapping-111"></span><span class="token del" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-112"></span><span class="token del" data-title="function_definition/return_type_definition">returns (bool)</span> <span class="marker" id="mapping-113"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-114"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-115"></span><span class="token del" data-title="expression_statement/call_expression">_approve(<span class="marker" id="mapping-116"></span><span class="token del" data-title="call_expression/call_argument">_msgSender()</span>, <span class="marker" id="mapping-117"></span><span class="token del" data-title="call_expression/call_argument">spender</span>, <span class="marker" id="mapping-118"></span><span class="token del" data-title="call_expression/call_argument"><span class="marker" id="mapping-119"></span><span class="token del" data-title="call_argument/call_expression"><span class="marker" id="mapping-120"></span><span class="token del" data-title="call_expression/member_expression">_allowances[_msgSender()][spender].sub</span>(<span class="marker" id="mapping-121"></span><span class="token del" data-title="call_expression/call_argument">subtractedValue</span>, <span class="marker" id="mapping-122"></span><span class="token mv" id="move-src-29" data-title="call_expression/call_argument">"ERC20: decreased allowance below zero"</span>)</span></span>)</span>;</span>
        <span class="marker" id="mapping-123"></span><span class="token del" data-title="function_body/return_statement">return true;</span>
    }</span></span>

    <span class="marker" id="mapping-124"></span><span class="token del" data-title="contract_body/comment">/**
     * @dev Moves tokens `amount` from `sender` to `recipient`.
     *
     * This is internal function is equivalent to {transfer}, and can be used to
     * e.g. implement automatic token fees, slashing mechanisms, etc.
     *
     * Emits a {Transfer} event.
     *
     * Requirements:
     *
     * - `sender` cannot be the zero address.
     * - `recipient` cannot be the zero address.
     * - `sender` must have a balance of at least `amount`.
     */</span>
    <span class="marker" id="mapping-125"></span><span class="token mv" id="move-src-30" data-title="contract_body/function_definition">function <span class="marker" id="mapping-126"></span><span class="token upd" id="move-src-31" data-title="function_definition/identifier">_<span class="cupd">transfer</span></span>(address sender, address recipient, uint256 amount) <span class="marker" id="mapping-127"></span><span class="token del" data-title="function_definition/visibility">internal</span> {
        require(sender != address(0), "ERC20: transfer from the zero address");
        require(recipient != address(0), "ERC20: transfer to the zero address");

        <span class="marker" id="mapping-128"></span><span class="token mv" id="move-src-32" data-title="function_body/expression_statement"><span class="marker" id="mapping-129"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-130"></span><span class="token del" data-title="assignment_expression/array_access">_balances[sender]</span> = <span class="marker" id="mapping-131"></span><span class="token mv" id="move-src-33" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-132"></span><span class="token del" data-title="call_expression/member_expression">_balances[sender].sub</span>(<span class="marker" id="mapping-133"></span><span class="token mv" id="move-src-34" data-title="call_expression/call_argument"><span class="marker" id="mapping-134"></span><span class="token upd" id="move-src-35" data-title="call_argument/identifier">am<span class="cupd">ou</span>nt</span></span>, "ERC20: transfer amount exceeds balance")</span></span>;</span>
        <span class="marker" id="mapping-135"></span><span class="token del" data-title="function_body/expression_statement">_balances[recipient] = _balances[recipient].add(amount);</span>
        emit <span class="marker" id="mapping-136"></span><span class="token upd" id="move-src-36" data-title="emit_statement/identifier"><span class="cupd">Transfer</span></span>(sender, recipient, amount);
    }</span>

    <span class="marker" id="mapping-137"></span><span class="token del" data-title="contract_body/comment">/** @dev Creates `amount` tokens and assigns them to `account`, increasing
     * the total supply.
     *
     * Emits a {Transfer} event with `from` set to the zero address.
     *
     * Requirements
     *
     * - `to` cannot be the zero address.
     */</span>
    <span class="marker" id="mapping-138"></span><span class="token del" data-title="contract_body/function_definition">function _mint(<span class="marker" id="mapping-139"></span><span class="token del" data-title="function_definition/parameter">address account</span>, <span class="marker" id="mapping-140"></span><span class="token del" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-141"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-142"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-143"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-144"></span><span class="token del" data-title="expression_statement/call_expression">require(<span class="marker" id="mapping-145"></span><span class="token del" data-title="call_expression/call_argument">account != address(0)</span>, <span class="marker" id="mapping-146"></span><span class="token mv" id="move-src-37" data-title="call_expression/call_argument">"ERC20: mint to the zero address"</span>)</span>;</span>

        <span class="marker" id="mapping-147"></span><span class="token del" data-title="function_body/expression_statement">_totalSupply = _totalSupply.add(amount);</span>
        <span class="marker" id="mapping-148"></span><span class="token del" data-title="function_body/expression_statement">_balances[account] = _balances[account].add(amount);</span>
        <span class="marker" id="mapping-149"></span><span class="token del" data-title="function_body/emit_statement">emit Transfer(<span class="marker" id="mapping-150"></span><span class="token del" data-title="emit_statement/call_argument">address(0)</span>, <span class="marker" id="mapping-151"></span><span class="token del" data-title="emit_statement/call_argument">account</span>, <span class="marker" id="mapping-152"></span><span class="token mv" id="move-src-38" data-title="emit_statement/call_argument">amount</span>);</span>
    }</span></span>

    <span class="marker" id="mapping-153"></span><span class="token del" data-title="contract_body/comment">/**
     * @dev Destroys `amount` tokens from `account`, reducing the
     * total supply.
     *
     * Emits a {Transfer} event with `to` set to the zero address.
     *
     * Requirements
     *
     * - `account` cannot be the zero address.
     * - `account` must have at least `amount` tokens.
     */</span>
    <span class="marker" id="mapping-154"></span><span class="token del" data-title="contract_body/function_definition">function _burn(<span class="marker" id="mapping-155"></span><span class="token del" data-title="function_definition/parameter">address account</span>, <span class="marker" id="mapping-156"></span><span class="token del" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-157"></span><span class="token mv" id="move-src-39" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-158"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-159"></span><span class="token mv" id="move-src-40" data-title="function_body/expression_statement"><span class="marker" id="mapping-160"></span><span class="token upd" id="move-src-41" data-title="call_expression/identifier"><span class="cupd">re</span>quire</span>(<span class="marker" id="mapping-161"></span><span class="token mv" id="move-src-42" data-title="call_expression/call_argument"><span class="marker" id="mapping-162"></span><span class="token del" data-title="call_argument/binary_expression">account != address(0)</span></span>, "ERC20: burn from the zero address");</span>

        <span class="marker" id="mapping-163"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-164"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-165"></span><span class="token del" data-title="assignment_expression/array_access">_balances[account]</span> = <span class="marker" id="mapping-166"></span><span class="token del" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-167"></span><span class="token del" data-title="call_expression/member_expression">_balances[account].sub</span>(<span class="marker" id="mapping-168"></span><span class="token del" data-title="call_expression/call_argument">amount</span>, <span class="marker" id="mapping-169"></span><span class="token mv" id="move-src-43" data-title="call_expression/call_argument">"ERC20: burn amount exceeds balance"</span>)</span></span>;</span>
        <span class="marker" id="mapping-170"></span><span class="token del" data-title="function_body/expression_statement">_totalSupply = _totalSupply.sub(amount);</span>
        <span class="marker" id="mapping-171"></span><span class="token del" data-title="function_body/emit_statement">emit Transfer(account, address(0), amount);</span>
    }</span></span>

    <span class="marker" id="mapping-172"></span><span class="token del" data-title="contract_body/comment">/**
     * @dev Sets `amount` as the allowance of `spender` over the `owner`s tokens.
     *
     * This is internal function is equivalent to `approve`, and can be used to
     * e.g. set automatic allowances for certain subsystems, etc.
     *
     * Emits an {Approval} event.
     *
     * Requirements:
     *
     * - `owner` cannot be the zero address.
     * - `spender` cannot be the zero address.
     */</span>
    function <span class="marker" id="mapping-173"></span><span class="token upd" id="move-src-44" data-title="function_definition/identifier">_<span class="cupd">approve</span></span>(<span class="marker" id="mapping-174"></span><span class="token del" data-title="function_definition/parameter">address owner</span><span class="marker" id="mapping-175"></span><span class="token mv" id="move-src-45" data-title="function_definition/,">,</span> address spender<span class="marker" id="mapping-176"></span><span class="token del" data-title="function_definition/,">,</span> uint256 amount) <span class="marker" id="mapping-177"></span><span class="token del" data-title="function_definition/visibility">internal</span> {
        <span class="marker" id="mapping-178"></span><span class="token mv" id="move-src-46" data-title="function_body/expression_statement"><span class="marker" id="mapping-179"></span><span class="token upd" id="move-src-47" data-title="call_expression/identifier"><span class="cupd">re</span>quire</span>(<span class="marker" id="mapping-180"></span><span class="token del" data-title="call_expression/call_argument">owner != address(0)</span>, "ERC20: approve from the zero address");</span>
        require(spender != address(0), "ERC20: approve to the zero address");

        <span class="marker" id="mapping-181"></span><span class="token del" data-title="expression_statement/assignment_expression">_allowances[owner][spender] = amount</span>;
        emit <span class="marker" id="mapping-182"></span><span class="token upd" id="move-src-48" data-title="emit_statement/identifier"><span class="cupd">Approval</span></span>(<span class="marker" id="mapping-183"></span><span class="token del" data-title="emit_statement/call_argument">owner</span>, spender, <span class="marker" id="mapping-184"></span><span class="token del" data-title="emit_statement/call_argument">amount</span>);
    }

    <span class="marker" id="mapping-185"></span><span class="token del" data-title="contract_body/comment">/**
     * @dev Destroys `amount` tokens from `account`.`amount` is then deducted
     * from the caller's allowance.
     *
     * See {_burn} and {_approve}.
     */</span>
    <span class="marker" id="mapping-186"></span><span class="token del" data-title="contract_body/function_definition">function _burnFrom(<span class="marker" id="mapping-187"></span><span class="token del" data-title="function_definition/parameter">address account</span>, <span class="marker" id="mapping-188"></span><span class="token del" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-189"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-190"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-191"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-192"></span><span class="token del" data-title="expression_statement/call_expression">_burn(<span class="marker" id="mapping-193"></span><span class="token del" data-title="call_expression/call_argument">account</span>, <span class="marker" id="mapping-194"></span><span class="token mv" id="move-src-49" data-title="call_expression/call_argument">amount</span>)</span>;</span>
        <span class="marker" id="mapping-195"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-196"></span><span class="token del" data-title="expression_statement/call_expression">_approve(<span class="marker" id="mapping-197"></span><span class="token del" data-title="call_expression/call_argument">account</span>, <span class="marker" id="mapping-198"></span><span class="token del" data-title="call_expression/call_argument">_msgSender()</span>, <span class="marker" id="mapping-199"></span><span class="token del" data-title="call_expression/call_argument"><span class="marker" id="mapping-200"></span><span class="token del" data-title="call_argument/call_expression"><span class="marker" id="mapping-201"></span><span class="token del" data-title="call_expression/member_expression">_allowances[account][_msgSender()].sub</span>(<span class="marker" id="mapping-202"></span><span class="token del" data-title="call_expression/call_argument">amount</span>, <span class="marker" id="mapping-203"></span><span class="token mv" id="move-src-50" data-title="call_expression/call_argument">"ERC20: burn amount exceeds allowance"</span>)</span></span>)</span>;</span>
    }</span></span>
}</span>

<span class="marker" id="mapping-204"></span><span class="token del" data-title="source_file/comment">/**
 * @dev Extension of {ERC20} that allows token holders to destroy both their own
 * tokens and those that they have an allowance for, in a way that can be
 * recognized off-chain (via event analysis).
 */</span>
<span class="marker" id="mapping-205"></span><span class="token del" data-title="source_file/contract_declaration">contract ERC20Burnable is <span class="marker" id="mapping-206"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">Context</span>, <span class="marker" id="mapping-207"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">ERC20</span> <span class="marker" id="mapping-208"></span><span class="token del" data-title="contract_declaration/contract_body">{
    /**
     * @dev Destroys `amount` tokens from the caller.
     *
     * See {ERC20-_burn}.
     */
    <span class="marker" id="mapping-209"></span><span class="token del" data-title="contract_body/function_definition">function burn(<span class="marker" id="mapping-210"></span><span class="token mv" id="move-src-51" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-211"></span><span class="token del" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-212"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-213"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-214"></span><span class="token del" data-title="expression_statement/call_expression">_burn(<span class="marker" id="mapping-215"></span><span class="token del" data-title="call_expression/call_argument">_msgSender()</span>, <span class="marker" id="mapping-216"></span><span class="token mv" id="move-src-52" data-title="call_expression/call_argument">amount</span>)</span>;</span>
    }</span></span>

    /**
     * @dev See {ERC20-_burnFrom}.
     */
    <span class="marker" id="mapping-217"></span><span class="token mv" id="move-src-53" data-title="contract_body/function_definition">function <span class="marker" id="mapping-218"></span><span class="token upd" id="move-src-54" data-title="function_definition/identifier">b<span class="cupd">u</span>rnFrom</span>(<span class="marker" id="mapping-219"></span><span class="token del" data-title="function_definition/parameter">address account</span>, <span class="marker" id="mapping-220"></span><span class="token mv" id="move-src-55" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-221"></span><span class="token del" data-title="function_definition/visibility">public</span> {
        <span class="marker" id="mapping-222"></span><span class="token del" data-title="call_expression/identifier">_burnFrom</span>(account, amount);
    }</span>
}</span></span>

<span class="marker" id="mapping-223"></span><span class="token del" data-title="source_file/comment">/**
 * @title Roles
 * @dev Library for managing addresses assigned to a Role.
 */</span>
<span class="marker" id="mapping-224"></span><span class="token del" data-title="source_file/library_declaration">library Roles <span class="marker" id="mapping-225"></span><span class="token del" data-title="library_declaration/contract_body">{
    <span class="marker" id="mapping-226"></span><span class="token del" data-title="contract_body/struct_declaration">struct Role {
        mapping (address =&gt; bool) bearer;
    }</span>

    /**
     * @dev Give an account access to this role.
     */
    <span class="marker" id="mapping-227"></span><span class="token del" data-title="contract_body/function_definition">function add(Role storage role, address account) internal {
        require(!has(role, account), "Roles: account already has role");
        role.bearer[account] = true;
    }</span>

    /**
     * @dev Remove an account's access to this role.
     */
    <span class="marker" id="mapping-228"></span><span class="token del" data-title="contract_body/function_definition">function remove(<span class="marker" id="mapping-229"></span><span class="token del" data-title="function_definition/parameter">Role storage role</span>, <span class="marker" id="mapping-230"></span><span class="token del" data-title="function_definition/parameter">address account</span>) <span class="marker" id="mapping-231"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-232"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-233"></span><span class="token mv" id="move-src-56" data-title="function_body/expression_statement"><span class="marker" id="mapping-234"></span><span class="token upd" id="move-src-57" data-title="call_expression/identifier"><span class="cupd">re</span>qui<span class="cupd">r</span>e</span>(<span class="marker" id="mapping-235"></span><span class="token del" data-title="call_expression/call_argument"><span class="marker" id="mapping-236"></span><span class="token del" data-title="call_argument/call_expression">has(<span class="marker" id="mapping-237"></span><span class="token del" data-title="call_expression/call_argument">role</span>, <span class="marker" id="mapping-238"></span><span class="token mv" id="move-src-58" data-title="call_expression/call_argument">account</span>)</span></span>, "Roles: account does not have role");</span>
        <span class="marker" id="mapping-239"></span><span class="token del" data-title="function_body/expression_statement">role.bearer[account] = false;</span>
    }</span></span>

    /**
     * @dev Check if an account has this role.
     * @return bool
     */
    <span class="marker" id="mapping-240"></span><span class="token del" data-title="contract_body/function_definition">function has(Role storage role, address account) internal view returns (bool) {
        require(account != address(0), "Roles: account is the zero address");
        return role.bearer[account];
    }</span>
}</span></span>

<span class="marker" id="mapping-241"></span><span class="token del" data-title="source_file/contract_declaration">contract MinterRole is <span class="marker" id="mapping-242"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">Context</span> <span class="marker" id="mapping-243"></span><span class="token del" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-244"></span><span class="token del" data-title="contract_body/using_directive">using Roles for Roles.Role;</span>

    <span class="marker" id="mapping-245"></span><span class="token mv" id="move-src-59" data-title="contract_body/event_definition">event <span class="marker" id="mapping-246"></span><span class="token upd" id="move-src-60" data-title="event_definition/identifier">Mi<span class="cupd">n</span>t<span class="cupd">e</span>rA<span class="cupd">d</span>ded</span>(address indexed account);</span>
    <span class="marker" id="mapping-247"></span><span class="token del" data-title="contract_body/event_definition">event MinterRemoved(<span class="marker" id="mapping-248"></span><span class="token mv" id="move-src-61" data-title="event_definition/event_paramater">address indexed account</span>);</span>

    <span class="marker" id="mapping-249"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-250"></span><span class="token del" data-title="state_variable_declaration/type_name">Roles.Role</span> <span class="marker" id="mapping-251"></span><span class="token mv" id="move-src-62" data-title="state_variable_declaration/visibility">private</span> _minters;</span>

    <span class="marker" id="mapping-252"></span><span class="token del" data-title="contract_body/constructor_definition">constructor () internal {
        _addMinter(_msgSender());
    }</span>

    <span class="marker" id="mapping-253"></span><span class="token del" data-title="contract_body/modifier_definition">modifier onlyMinter() <span class="marker" id="mapping-254"></span><span class="token del" data-title="modifier_definition/function_body">{
        <span class="marker" id="mapping-255"></span><span class="token mv" id="move-src-63" data-title="function_body/expression_statement"><span class="marker" id="mapping-256"></span><span class="token upd" id="move-src-64" data-title="call_expression/identifier"><span class="cupd">re</span>quire</span>(<span class="marker" id="mapping-257"></span><span class="token del" data-title="call_expression/call_argument">isMinter(_msgSender())</span>, "MinterRole: caller does not have the Minter role");</span>
        <span class="marker" id="mapping-258"></span><span class="token del" data-title="function_body/expression_statement">_;</span>
    }</span></span>

    <span class="marker" id="mapping-259"></span><span class="token del" data-title="contract_body/function_definition">function isMinter(address account) public view returns (bool) {
        return _minters.has(account);
    }</span>

    <span class="marker" id="mapping-260"></span><span class="token del" data-title="contract_body/function_definition">function addMinter(<span class="marker" id="mapping-261"></span><span class="token del" data-title="function_definition/parameter">address account</span>) <span class="marker" id="mapping-262"></span><span class="token del" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-263"></span><span class="token del" data-title="function_definition/modifier_invocation">onlyMinter</span> <span class="marker" id="mapping-264"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-265"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-266"></span><span class="token del" data-title="expression_statement/call_expression">_addMinter(<span class="marker" id="mapping-267"></span><span class="token mv" id="move-src-65" data-title="call_expression/call_argument">account</span>)</span>;</span>
    }</span></span>

    <span class="marker" id="mapping-268"></span><span class="token del" data-title="contract_body/function_definition">function renounceMinter() public {
        _removeMinter(_msgSender());
    }</span>

    <span class="marker" id="mapping-269"></span><span class="token del" data-title="contract_body/function_definition">function _addMinter(<span class="marker" id="mapping-270"></span><span class="token del" data-title="function_definition/parameter">address account</span>) <span class="marker" id="mapping-271"></span><span class="token mv" id="move-src-66" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-272"></span><span class="token del" data-title="function_definition/function_body">{
        _minters.add(account);
        emit MinterAdded(account);
    }</span></span>

    <span class="marker" id="mapping-273"></span><span class="token del" data-title="contract_body/function_definition">function _removeMinter(address account) internal {
        _minters.remove(account);
        emit MinterRemoved(account);
    }</span>
}</span></span>

<span class="marker" id="mapping-274"></span><span class="token del" data-title="source_file/comment">/**
 * @dev Contract module which provides a basic access control mechanism, where
 * there is an account (an owner) that can be granted exclusive access to
 * specific functions.
 *
 * This module is used through inheritance. It will make available the modifier
 * `onlyOwner`, which can be applied to your functions to restrict their use to
 * the owner.
 */</span>
<span class="marker" id="mapping-275"></span><span class="token del" data-title="source_file/contract_declaration">contract Ownable is <span class="marker" id="mapping-276"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">Context</span> <span class="marker" id="mapping-277"></span><span class="token del" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-278"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-279"></span><span class="token mv" id="move-src-67" data-title="state_variable_declaration/type_name">address</span> <span class="marker" id="mapping-280"></span><span class="token del" data-title="state_variable_declaration/visibility">private</span> _owner;</span>

    <span class="marker" id="mapping-281"></span><span class="token mv" id="move-src-68" data-title="contract_body/event_definition">event <span class="marker" id="mapping-282"></span><span class="token upd" id="move-src-69" data-title="event_definition/identifier">Ow<span class="cupd">n</span>ership<span class="cupd">Transfer</span>red</span>(address indexed <span class="marker" id="mapping-283"></span><span class="token upd" id="move-src-70" data-title="event_paramater/identifier">p<span class="cupd">r</span>eviousOwner</span>, address indexed <span class="marker" id="mapping-284"></span><span class="token upd" id="move-src-71" data-title="event_paramater/identifier">newOwner</span>);</span>

    /**
     * @dev Initializes the contract setting the deployer as the initial owner.
     */
    <span class="marker" id="mapping-285"></span><span class="token del" data-title="contract_body/constructor_definition">constructor () internal {
        address msgSender = _msgSender();
        _owner = msgSender;
        emit OwnershipTransferred(address(0), msgSender);
    }</span>

    /**
     * @dev Returns the address of the current owner.
     */
    <span class="marker" id="mapping-286"></span><span class="token del" data-title="contract_body/function_definition">function owner() public view returns (address) {
        return _owner;
    }</span>

    /**
     * @dev Throws if called by any account other than the owner.
     */
    <span class="marker" id="mapping-287"></span><span class="token del" data-title="contract_body/modifier_definition">modifier onlyOwner() {
        require(isOwner(), "Ownable: caller is not the owner");
        _;
    }</span>

    /**
     * @dev Returns true if the caller is the current owner.
     */
    <span class="marker" id="mapping-288"></span><span class="token del" data-title="contract_body/function_definition">function isOwner() public view returns (bool) {
        return _msgSender() == _owner;
    }</span>

    /**
     * @dev Leaves the contract without owner. It will not be possible to call
     * `onlyOwner` functions anymore. Can only be called by the current owner.
     *
     * NOTE: Renouncing ownership will leave the contract without an owner,
     * thereby removing any functionality that is only available to the owner.
     */
    <span class="marker" id="mapping-289"></span><span class="token del" data-title="contract_body/function_definition">function renounceOwnership() public onlyOwner {
        emit OwnershipTransferred(_owner, address(0));
        _owner = address(0);
    }</span>

    /**
     * @dev Transfers ownership of the contract to a new account (`newOwner`).
     * Can only be called by the current owner.
     */
    <span class="marker" id="mapping-290"></span><span class="token del" data-title="contract_body/function_definition">function transferOwnership(address newOwner) public onlyOwner {
        _transferOwnership(newOwner);
    }</span>

    /**
     * @dev Transfers ownership of the contract to a new account (`newOwner`).
     */
    <span class="marker" id="mapping-291"></span><span class="token mv" id="move-src-72" data-title="contract_body/function_definition">function <span class="marker" id="mapping-292"></span><span class="token upd" id="move-src-73" data-title="function_definition/identifier">_t<span class="cupd">r</span><span class="cupd">a</span>n<span class="cupd">s</span>f<span class="cupd">e</span>rOwnership</span>(<span class="marker" id="mapping-293"></span><span class="token del" data-title="function_definition/parameter">address newOwner</span>) internal {
        <span class="marker" id="mapping-294"></span><span class="token upd" id="move-src-74" data-title="call_expression/identifier">r<span class="cupd">e</span>qui<span class="cupd">re</span></span>(<span class="marker" id="mapping-295"></span><span class="token del" data-title="call_expression/call_argument">newOwner != address(0)</span>, "Ownable: new owner is the zero address");
        <span class="marker" id="mapping-296"></span><span class="token del" data-title="function_body/emit_statement">emit OwnershipTransferred(_owner, newOwner);</span>
        <span class="marker" id="mapping-297"></span><span class="token del" data-title="function_body/expression_statement">_owner = newOwner;</span>
    }</span>
}</span></span>

<span class="marker" id="mapping-298"></span><span class="token del" data-title="source_file/contract_declaration">contract Reflect is <span class="marker" id="mapping-299"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">ERC20</span>, <span class="marker" id="mapping-300"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">Ownable</span> <span class="marker" id="mapping-301"></span><span class="token del" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-302"></span><span class="token mv" id="move-src-75" data-title="contract_body/using_directive">using Decimal for Decimal.D256;</span>

    <span class="marker" id="mapping-303"></span><span class="token del" data-title="contract_body/state_variable_declaration">Decimal.D256 internal totalSupplyStandard;</span>
    <span class="marker" id="mapping-304"></span><span class="token del" data-title="contract_body/state_variable_declaration">Decimal.D256 internal totalSupplyExcluded;</span>

    <span class="marker" id="mapping-305"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-306"></span><span class="token del" data-title="state_variable_declaration/type_name">Decimal.D256</span> <span class="marker" id="mapping-307"></span><span class="token mv" id="move-src-76" data-title="state_variable_declaration/visibility">internal</span> ratio = <span class="marker" id="mapping-308"></span><span class="token mv" id="move-src-77" data-title="state_variable_declaration/call_expression">Decimal.one()</span>;</span>

    <span class="marker" id="mapping-309"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-310"></span><span class="token mv" id="move-src-78" data-title="state_variable_declaration/type_name">uint256</span> <span class="marker" id="mapping-311"></span><span class="token mv" id="move-src-79" data-title="state_variable_declaration/visibility">private</span> reflectionError;</span>

    <span class="marker" id="mapping-312"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-313"></span><span class="token mv" id="move-src-80" data-title="state_variable_declaration/type_name">uint256</span> <span class="marker" id="mapping-314"></span><span class="token mv" id="move-src-81" data-title="state_variable_declaration/visibility">private</span> adjustmentIndex;</span>

    <span class="marker" id="mapping-315"></span><span class="token del" data-title="contract_body/state_variable_declaration">mapping(address =&gt; Decimal.D256) internal balances;</span>
    <span class="marker" id="mapping-316"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-317"></span><span class="token del" data-title="state_variable_declaration/type_name">mapping(<span class="marker" id="mapping-318"></span><span class="token del" data-title="type_name/primitive_type">address</span> =&gt; <span class="marker" id="mapping-319"></span><span class="token mv" id="move-src-82" data-title="type_name/type_name">uint256</span>)</span> <span class="marker" id="mapping-320"></span><span class="token mv" id="move-src-83" data-title="state_variable_declaration/visibility">internal</span> lastAdjustment;</span>
    <span class="marker" id="mapping-321"></span><span class="token del" data-title="contract_body/state_variable_declaration">mapping(address =&gt; bool) public exclusions;</span>


    <span class="marker" id="mapping-322"></span><span class="token del" data-title="contract_body/function_definition">function totalSupply() <span class="marker" id="mapping-323"></span><span class="token del" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-324"></span><span class="token del" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-325"></span><span class="token mv" id="move-src-84" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-326"></span><span class="token del" data-title="function_definition/function_body">{
        return totalSupplyExcluded.add(totalSupplyStandard).asUint256();
    }</span></span>

    <span class="marker" id="mapping-327"></span><span class="token del" data-title="contract_body/function_definition">function balanceOf(<span class="marker" id="mapping-328"></span><span class="token mv" id="move-src-85" data-title="function_definition/parameter">address account</span>) <span class="marker" id="mapping-329"></span><span class="token mv" id="move-src-86" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-330"></span><span class="token mv" id="move-src-87" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-331"></span><span class="token mv" id="move-src-88" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-332"></span><span class="token del" data-title="function_definition/function_body">{
        if (exclusions[account])
            return balances[account].asUint256();

        if (lastAdjustment[account] != adjustmentIndex)
            return ratio.mul(balances[account].mul(2 * adjustmentIndex.sub(lastAdjustment[account]))).asUint256();

        return ratio.mul(balances[account]).asUint256();
    }</span></span>

    <span class="marker" id="mapping-333"></span><span class="token del" data-title="contract_body/function_definition">function excludeAccount(<span class="marker" id="mapping-334"></span><span class="token del" data-title="function_definition/parameter">address account</span>) <span class="marker" id="mapping-335"></span><span class="token mv" id="move-src-89" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-336"></span><span class="token del" data-title="function_definition/modifier_invocation">onlyOwner</span> <span class="marker" id="mapping-337"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-338"></span><span class="token del" data-title="function_body/if_statement">if (<span class="marker" id="mapping-339"></span><span class="token del" data-title="if_statement/array_access">exclusions[account]</span>)
            <span class="marker" id="mapping-340"></span><span class="token mv" id="move-src-90" data-title="if_statement/return_statement">return;</span></span>

        <span class="marker" id="mapping-341"></span><span class="token del" data-title="function_body/expression_statement">exclusions[account] = true;</span>

        <span class="marker" id="mapping-342"></span><span class="token del" data-title="function_body/expression_statement">balances[account] = ratio.mul(balances[account]);</span>
        <span class="marker" id="mapping-343"></span><span class="token del" data-title="function_body/expression_statement">totalSupplyStandard = totalSupplyStandard.sub(balances[account]);</span>
        <span class="marker" id="mapping-344"></span><span class="token del" data-title="function_body/expression_statement">totalSupplyExcluded = totalSupplyExcluded.add(balances[account]);</span>
    }</span></span>

    <span class="marker" id="mapping-345"></span><span class="token del" data-title="contract_body/function_definition">function includeAccount(<span class="marker" id="mapping-346"></span><span class="token del" data-title="function_definition/parameter">address account</span>) <span class="marker" id="mapping-347"></span><span class="token mv" id="move-src-91" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-348"></span><span class="token del" data-title="function_definition/modifier_invocation">onlyOwner</span> <span class="marker" id="mapping-349"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-350"></span><span class="token del" data-title="function_body/if_statement">if (<span class="marker" id="mapping-351"></span><span class="token del" data-title="if_statement/array_access">!exclusions[account]</span>)
            <span class="marker" id="mapping-352"></span><span class="token mv" id="move-src-92" data-title="if_statement/return_statement">return;</span></span>

        <span class="marker" id="mapping-353"></span><span class="token del" data-title="function_body/expression_statement">exclusions[account] = false;</span>

        <span class="marker" id="mapping-354"></span><span class="token del" data-title="function_body/expression_statement">totalSupplyExcluded = totalSupplyExcluded.sub(balances[account]);</span>
        <span class="marker" id="mapping-355"></span><span class="token del" data-title="function_body/expression_statement">totalSupplyStandard = totalSupplyStandard.add(balances[account]);</span>
        <span class="marker" id="mapping-356"></span><span class="token del" data-title="function_body/expression_statement">balances[account] = balances[account].div(ratio);</span>

        <span class="marker" id="mapping-357"></span><span class="token del" data-title="function_body/expression_statement">lastAdjustment[account] = adjustmentIndex;</span>
    }</span></span>

    <span class="marker" id="mapping-358"></span><span class="token del" data-title="contract_body/function_definition">function _adjustBalance(<span class="marker" id="mapping-359"></span><span class="token del" data-title="function_definition/parameter">address account</span>) <span class="marker" id="mapping-360"></span><span class="token mv" id="move-src-93" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-361"></span><span class="token del" data-title="function_definition/function_body">{
        if (lastAdjustment[account] != adjustmentIndex) {
            balances[account] = balances[account].mul(2 * adjustmentIndex.sub(lastAdjustment[account]));
            lastAdjustment[account] = adjustmentIndex;
        }
    }</span></span>

    <span class="marker" id="mapping-362"></span><span class="token del" data-title="contract_body/function_definition">function _mint(<span class="marker" id="mapping-363"></span><span class="token mv" id="move-src-94" data-title="function_definition/parameter">address account</span>, <span class="marker" id="mapping-364"></span><span class="token mv" id="move-src-95" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-365"></span><span class="token mv" id="move-src-96" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-366"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-367"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-368"></span><span class="token mv" id="move-src-97" data-title="variable_declaration_statement/variable_declaration">uint256 realMintValue</span>;</span>
        <span class="marker" id="mapping-369"></span><span class="token del" data-title="function_body/if_statement">if (<span class="marker" id="mapping-370"></span><span class="token del" data-title="if_statement/array_access">exclusions[account]</span>) <span class="marker" id="mapping-371"></span><span class="token del" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-372"></span><span class="token del" data-title="block_statement/expression_statement">realMintValue = amount;</span>
            <span class="marker" id="mapping-373"></span><span class="token del" data-title="block_statement/expression_statement"><span class="marker" id="mapping-374"></span><span class="token del" data-title="expression_statement/assignment_expression">totalSupplyExcluded = <span class="marker" id="mapping-375"></span><span class="token del" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-376"></span><span class="token del" data-title="call_expression/member_expression">totalSupplyExcluded.add</span>(<span class="marker" id="mapping-377"></span><span class="token mv" id="move-src-98" data-title="call_expression/call_argument">amount</span>)</span></span>;</span>
            <span class="marker" id="mapping-378"></span><span class="token del" data-title="block_statement/expression_statement"><span class="marker" id="mapping-379"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-380"></span><span class="token del" data-title="assignment_expression/array_access">balances[account]</span> = <span class="marker" id="mapping-381"></span><span class="token del" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-382"></span><span class="token del" data-title="call_expression/member_expression">balances[account].add</span>(<span class="marker" id="mapping-383"></span><span class="token mv" id="move-src-99" data-title="call_expression/call_argument">amount</span>)</span></span>;</span>
        }</span>
        else <span class="marker" id="mapping-384"></span><span class="token del" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-385"></span><span class="token del" data-title="block_statement/expression_statement">_adjustBalance(account);</span>
            <span class="marker" id="mapping-386"></span><span class="token mv" id="move-src-100" data-title="block_statement/variable_declaration_statement">Decimal.D256 memory <span class="marker" id="mapping-387"></span><span class="token upd" id="move-src-101" data-title="variable_declaration/identifier"><span class="cupd">v</span>alueToMint</span> = <span class="marker" id="mapping-388"></span><span class="token mv" id="move-src-102" data-title="variable_declaration_statement/call_expression">Decimal.from(<span class="marker" id="mapping-389"></span><span class="token mv" id="move-src-103" data-title="call_expression/call_argument">amount</span>).<span class="marker" id="mapping-390"></span><span class="token upd" id="move-src-104" data-title="member_expression/identifier">div</span>(<span class="marker" id="mapping-391"></span><span class="token del" data-title="call_argument/identifier">ratio</span>)</span>;</span>
            <span class="marker" id="mapping-392"></span><span class="token del" data-title="block_statement/expression_statement">realMintValue = valueToMint.mul(ratio).asUint256();</span>
            <span class="marker" id="mapping-393"></span><span class="token del" data-title="block_statement/expression_statement"><span class="marker" id="mapping-394"></span><span class="token del" data-title="expression_statement/assignment_expression">totalSupplyStandard = <span class="marker" id="mapping-395"></span><span class="token del" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-396"></span><span class="token del" data-title="call_expression/member_expression">totalSupplyStandard.add</span>(<span class="marker" id="mapping-397"></span><span class="token mv" id="move-src-105" data-title="call_expression/call_argument">realMintValue</span>)</span></span>;</span>
            <span class="marker" id="mapping-398"></span><span class="token del" data-title="block_statement/expression_statement">balances[account] = balances[account].add(valueToMint);</span>
        }</span></span>

        <span class="marker" id="mapping-399"></span><span class="token del" data-title="function_body/emit_statement">emit Transfer(address(0), account, realMintValue);</span>
    }</span></span>

    <span class="marker" id="mapping-400"></span><span class="token del" data-title="contract_body/function_definition">function _burn(<span class="marker" id="mapping-401"></span><span class="token del" data-title="function_definition/parameter">address account</span>, <span class="marker" id="mapping-402"></span><span class="token mv" id="move-src-106" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-403"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-404"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-405"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-406"></span><span class="token mv" id="move-src-107" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-407"></span><span class="token upd" id="move-src-108" data-title="variable_declaration/identifier">rea<span class="cupd">l</span>B<span class="cupd">u</span>rnValue</span></span>;</span>
        <span class="marker" id="mapping-408"></span><span class="token del" data-title="function_body/if_statement">if (<span class="marker" id="mapping-409"></span><span class="token del" data-title="if_statement/array_access">exclusions[account]</span>) <span class="marker" id="mapping-410"></span><span class="token mv" id="move-src-109" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-411"></span><span class="token del" data-title="block_statement/expression_statement">realBurnValue = amount;</span>
            <span class="marker" id="mapping-412"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-413"></span><span class="token del" data-title="assignment_expression/array_access">balances[account]</span> = <span class="marker" id="mapping-414"></span><span class="token mv" id="move-src-110" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-415"></span><span class="token del" data-title="call_expression/member_expression">balances[account].sub</span>(<span class="marker" id="mapping-416"></span><span class="token mv" id="move-src-111" data-title="call_expression/call_argument">amount</span>, "Dollar: Insufficient token balance")</span></span>;
            <span class="marker" id="mapping-417"></span><span class="token del" data-title="block_statement/expression_statement"><span class="marker" id="mapping-418"></span><span class="token del" data-title="expression_statement/assignment_expression">totalSupplyExcluded = <span class="marker" id="mapping-419"></span><span class="token del" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-420"></span><span class="token del" data-title="call_expression/member_expression">totalSupplyExcluded.sub</span>(<span class="marker" id="mapping-421"></span><span class="token mv" id="move-src-112" data-title="call_expression/call_argument">amount</span>)</span></span>;</span>
        }</span> else <span class="marker" id="mapping-422"></span><span class="token del" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-423"></span><span class="token del" data-title="block_statement/expression_statement">_adjustBalance(account);</span>
            <span class="marker" id="mapping-424"></span><span class="token mv" id="move-src-113" data-title="block_statement/variable_declaration_statement">Decimal.D256 memory <span class="marker" id="mapping-425"></span><span class="token upd" id="move-src-114" data-title="variable_declaration/identifier">valu<span class="cupd">e</span>ToB<span class="cupd">u</span>rn</span> = <span class="marker" id="mapping-426"></span><span class="token mv" id="move-src-115" data-title="variable_declaration_statement/call_expression">Decimal.from(<span class="marker" id="mapping-427"></span><span class="token mv" id="move-src-116" data-title="call_expression/call_argument">amount</span>).<span class="marker" id="mapping-428"></span><span class="token upd" id="move-src-117" data-title="member_expression/identifier">div</span>(<span class="marker" id="mapping-429"></span><span class="token del" data-title="call_argument/identifier">ratio</span>)</span>;</span>
            <span class="marker" id="mapping-430"></span><span class="token del" data-title="block_statement/expression_statement">realBurnValue = valueToBurn.mul(ratio).asUint256();</span>
            <span class="marker" id="mapping-431"></span><span class="token mv" id="move-src-118" data-title="block_statement/expression_statement"><span class="marker" id="mapping-432"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-433"></span><span class="token del" data-title="assignment_expression/array_access">balances[account]</span> = <span class="marker" id="mapping-434"></span><span class="token mv" id="move-src-119" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-435"></span><span class="token del" data-title="call_expression/member_expression">balances[account].sub</span>(<span class="marker" id="mapping-436"></span><span class="token del" data-title="call_argument/identifier">valueToBurn</span>, "Dollar: Insufficient token balance")</span></span>;</span>
            <span class="marker" id="mapping-437"></span><span class="token del" data-title="block_statement/expression_statement">totalSupplyStandard = totalSupplyStandard.sub(realBurnValue);</span>
        }</span></span>

        <span class="marker" id="mapping-438"></span><span class="token del" data-title="function_body/emit_statement">emit Transfer(account, address(0), realBurnValue);</span>
    }</span></span>

    <span class="marker" id="mapping-439"></span><span class="token del" data-title="contract_body/function_definition">function _transfer(<span class="marker" id="mapping-440"></span><span class="token del" data-title="function_definition/parameter">address sender</span>, <span class="marker" id="mapping-441"></span><span class="token del" data-title="function_definition/parameter">address recipient</span>, <span class="marker" id="mapping-442"></span><span class="token mv" id="move-src-120" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-443"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-444"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-445"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-446"></span><span class="token mv" id="move-src-121" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-447"></span><span class="token upd" id="move-src-122" data-title="variable_declaration/identifier">fin<span class="cupd">a</span>lTransfer<span class="cupd">Amount</span></span></span>;</span>

        <span class="marker" id="mapping-448"></span><span class="token del" data-title="function_body/if_statement">if (exclusions[sender] &amp;&amp; exclusions[recipient]) 
            finalTransferAmount = _transferBothExcluded(sender, recipient, amount);
        
        else if (exclusions[sender])
            finalTransferAmount = _transferFromExcluded(sender, recipient, amount);

        else if (exclusions[recipient]) 
            finalTransferAmount = _transferToExcluded(sender, recipient, amount);
        
        else 
            finalTransferAmount = _transferStandard(sender, recipient, amount);</span>

        <span class="marker" id="mapping-449"></span><span class="token del" data-title="function_body/emit_statement">emit Transfer(sender, recipient, finalTransferAmount);</span>
    }</span></span>

    <span class="marker" id="mapping-450"></span><span class="token del" data-title="contract_body/function_definition">function _transferBothExcluded(<span class="marker" id="mapping-451"></span><span class="token del" data-title="function_definition/parameter">address sender</span>, <span class="marker" id="mapping-452"></span><span class="token del" data-title="function_definition/parameter">address recipient</span>, <span class="marker" id="mapping-453"></span><span class="token mv" id="move-src-123" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-454"></span><span class="token mv" id="move-src-124" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-455"></span><span class="token del" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-456"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-457"></span><span class="token mv" id="move-src-125" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-458"></span><span class="token del" data-title="variable_declaration_statement/variable_declaration_tuple">(
            <span class="marker" id="mapping-459"></span><span class="token mv" id="move-src-126" data-title="variable_declaration_tuple/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-460"></span><span class="token upd" id="move-src-127" data-title="variable_declaration/identifier"><span class="cupd">e</span>x<span class="cupd">t</span>ern<span class="cupd">a</span>lAmount</span></span>,, 
            <span class="marker" id="mapping-461"></span><span class="token mv" id="move-src-128" data-title="variable_declaration_tuple/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-462"></span><span class="token upd" id="move-src-129" data-title="variable_declaration/identifier"><span class="cupd">e</span>x<span class="cupd">t</span>ern<span class="cupd">a</span>lAm<span class="cupd">o</span>untAfterTax</span></span>,, 
            <span class="marker" id="mapping-463"></span><span class="token mv" id="move-src-130" data-title="variable_declaration_tuple/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-464"></span><span class="token upd" id="move-src-131" data-title="variable_declaration/identifier"><span class="cupd">ta</span>x</span></span>
        )</span> = <span class="marker" id="mapping-465"></span><span class="token del" data-title="call_expression/identifier">_getTransferValues</span>(<span class="marker" id="mapping-466"></span><span class="token mv" id="move-src-132" data-title="call_expression/call_argument">amount</span>);</span>

        <span class="marker" id="mapping-467"></span><span class="token mv" id="move-src-133" data-title="function_body/expression_statement"><span class="marker" id="mapping-468"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-469"></span><span class="token del" data-title="assignment_expression/array_access">balances[sender]</span> = <span class="marker" id="mapping-470"></span><span class="token mv" id="move-src-134" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-471"></span><span class="token del" data-title="call_expression/member_expression">balances[sender].sub</span>(<span class="marker" id="mapping-472"></span><span class="token del" data-title="call_expression/call_argument">externalAmount</span>, "Dollar: Insufficient token balance")</span></span>;</span>
        <span class="marker" id="mapping-473"></span><span class="token del" data-title="function_body/expression_statement">balances[recipient] = balances[recipient].add(externalAmountAfterTax);</span>

        <span class="marker" id="mapping-474"></span><span class="token del" data-title="function_body/expression_statement">totalSupplyExcluded = totalSupplyExcluded.sub(tax);</span>
        <span class="marker" id="mapping-475"></span><span class="token del" data-title="function_body/expression_statement">totalSupplyStandard = totalSupplyStandard.add(tax);</span>

        <span class="marker" id="mapping-476"></span><span class="token del" data-title="function_body/expression_statement">_reflect(tax);</span>
        
        <span class="marker" id="mapping-477"></span><span class="token del" data-title="function_body/return_statement">return externalAmountAfterTax.asUint256();</span>
    }</span></span>

    <span class="marker" id="mapping-478"></span><span class="token del" data-title="contract_body/function_definition">function _transferFromExcluded(<span class="marker" id="mapping-479"></span><span class="token del" data-title="function_definition/parameter">address sender</span>, <span class="marker" id="mapping-480"></span><span class="token del" data-title="function_definition/parameter">address recipient</span>, <span class="marker" id="mapping-481"></span><span class="token mv" id="move-src-135" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-482"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-483"></span><span class="token del" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-484"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-485"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-486"></span><span class="token del" data-title="expression_statement/call_expression">_adjustBalance(<span class="marker" id="mapping-487"></span><span class="token mv" id="move-src-136" data-title="call_expression/call_argument">recipient</span>)</span>;</span>

        <span class="marker" id="mapping-488"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-489"></span><span class="token del" data-title="variable_declaration_statement/variable_declaration_tuple">(
            <span class="marker" id="mapping-490"></span><span class="token mv" id="move-src-137" data-title="variable_declaration_tuple/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-491"></span><span class="token upd" id="move-src-138" data-title="variable_declaration/identifier"><span class="cupd">e</span>x<span class="cupd">t</span><span class="cupd">er</span>nalAm<span class="cupd">oun</span>t</span></span>,, 
            <span class="marker" id="mapping-492"></span><span class="token mv" id="move-src-139" data-title="variable_declaration_tuple/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-493"></span><span class="token upd" id="move-src-140" data-title="variable_declaration/identifier"><span class="cupd">e</span>xt<span class="cupd">e</span>r<span class="cupd">nal</span>AmountAfterTax</span></span>, 
            <span class="marker" id="mapping-494"></span><span class="token mv" id="move-src-141" data-title="variable_declaration_tuple/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-495"></span><span class="token upd" id="move-src-142" data-title="variable_declaration/identifier">i<span class="cupd">n</span>t<span class="cupd">e</span>rnalA<span class="cupd">m</span>ountAfterTax</span></span>,
            <span class="marker" id="mapping-496"></span><span class="token del" data-title="variable_declaration_tuple/variable_declaration">Decimal.D256 memory tax</span>
        )</span> = <span class="marker" id="mapping-497"></span><span class="token del" data-title="variable_declaration_statement/call_expression">_getTransferValues(<span class="marker" id="mapping-498"></span><span class="token mv" id="move-src-143" data-title="call_expression/call_argument">amount</span>)</span>;</span>

        <span class="marker" id="mapping-499"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-500"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-501"></span><span class="token del" data-title="assignment_expression/array_access">balances[sender]</span> = <span class="marker" id="mapping-502"></span><span class="token del" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-503"></span><span class="token del" data-title="call_expression/member_expression">balances[sender].sub</span>(<span class="marker" id="mapping-504"></span><span class="token del" data-title="call_expression/call_argument">externalAmount</span>, <span class="marker" id="mapping-505"></span><span class="token mv" id="move-src-144" data-title="call_expression/call_argument">"Dollar: Insufficient token balance"</span>)</span></span>;</span>
        <span class="marker" id="mapping-506"></span><span class="token del" data-title="function_body/expression_statement">balances[recipient] = balances[recipient].add(internalAmountAfterTax);</span>

        <span class="marker" id="mapping-507"></span><span class="token del" data-title="function_body/expression_statement">totalSupplyExcluded = totalSupplyExcluded.sub(externalAmount);</span>
        <span class="marker" id="mapping-508"></span><span class="token del" data-title="function_body/expression_statement">totalSupplyStandard = totalSupplyStandard.add(externalAmount);</span>

        <span class="marker" id="mapping-509"></span><span class="token del" data-title="function_body/expression_statement">_reflect(tax);</span>

        <span class="marker" id="mapping-510"></span><span class="token del" data-title="function_body/return_statement">return externalAmountAfterTax.asUint256();</span>
    }</span></span>

    <span class="marker" id="mapping-511"></span><span class="token del" data-title="contract_body/function_definition">function _transferToExcluded(<span class="marker" id="mapping-512"></span><span class="token del" data-title="function_definition/parameter">address sender</span>, <span class="marker" id="mapping-513"></span><span class="token del" data-title="function_definition/parameter">address recipient</span>, <span class="marker" id="mapping-514"></span><span class="token mv" id="move-src-145" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-515"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-516"></span><span class="token del" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-517"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-518"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-519"></span><span class="token del" data-title="expression_statement/call_expression">_adjustBalance(<span class="marker" id="mapping-520"></span><span class="token mv" id="move-src-146" data-title="call_expression/call_argument">sender</span>)</span>;</span>

        <span class="marker" id="mapping-521"></span><span class="token mv" id="move-src-147" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-522"></span><span class="token del" data-title="variable_declaration_statement/variable_declaration_tuple">(, 
            <span class="marker" id="mapping-523"></span><span class="token mv" id="move-src-148" data-title="variable_declaration_tuple/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-524"></span><span class="token upd" id="move-src-149" data-title="variable_declaration/identifier">int<span class="cupd">e</span>rna<span class="cupd">l</span>Amount</span></span>, 
            <span class="marker" id="mapping-525"></span><span class="token mv" id="move-src-150" data-title="variable_declaration_tuple/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-526"></span><span class="token upd" id="move-src-151" data-title="variable_declaration/identifier">ex<span class="cupd">t</span>ern<span class="cupd">a</span>lAmountAfterTax</span></span>,,
            <span class="marker" id="mapping-527"></span><span class="token del" data-title="variable_declaration_tuple/variable_declaration">Decimal.D256 memory tax</span>
        )</span> = <span class="marker" id="mapping-528"></span><span class="token upd" id="move-src-152" data-title="call_expression/identifier">_getTransferValues</span>(<span class="marker" id="mapping-529"></span><span class="token mv" id="move-src-153" data-title="call_expression/call_argument">amount</span>);</span>

        <span class="marker" id="mapping-530"></span><span class="token mv" id="move-src-154" data-title="function_body/expression_statement"><span class="marker" id="mapping-531"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-532"></span><span class="token del" data-title="assignment_expression/array_access">balances[sender]</span> = <span class="marker" id="mapping-533"></span><span class="token mv" id="move-src-155" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-534"></span><span class="token del" data-title="call_expression/member_expression">balances[sender].sub</span>(<span class="marker" id="mapping-535"></span><span class="token del" data-title="call_argument/identifier">internalAmount</span>, "Dollar: Insufficient token balance")</span></span>;</span>
        <span class="marker" id="mapping-536"></span><span class="token del" data-title="function_body/expression_statement">balances[recipient] = balances[recipient].add(externalAmountAfterTax);</span>

        <span class="marker" id="mapping-537"></span><span class="token del" data-title="function_body/expression_statement">totalSupplyStandard = totalSupplyStandard.sub(externalAmountAfterTax);</span>
        <span class="marker" id="mapping-538"></span><span class="token del" data-title="function_body/expression_statement">totalSupplyExcluded = totalSupplyExcluded.add(externalAmountAfterTax);</span>

        <span class="marker" id="mapping-539"></span><span class="token del" data-title="function_body/expression_statement">_reflect(tax);</span>

        <span class="marker" id="mapping-540"></span><span class="token del" data-title="function_body/return_statement">return externalAmountAfterTax.asUint256();</span>
    }</span></span>

    <span class="marker" id="mapping-541"></span><span class="token del" data-title="contract_body/function_definition">function _transferStandard(<span class="marker" id="mapping-542"></span><span class="token del" data-title="function_definition/parameter">address sender</span>, <span class="marker" id="mapping-543"></span><span class="token del" data-title="function_definition/parameter">address recipient</span>, <span class="marker" id="mapping-544"></span><span class="token mv" id="move-src-156" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-545"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-546"></span><span class="token del" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-547"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-548"></span><span class="token del" data-title="function_body/expression_statement">_adjustBalance(sender);</span>
        <span class="marker" id="mapping-549"></span><span class="token del" data-title="function_body/expression_statement">_adjustBalance(recipient);</span>

        <span class="marker" id="mapping-550"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-551"></span><span class="token del" data-title="variable_declaration_statement/variable_declaration_tuple">(, 
            <span class="marker" id="mapping-552"></span><span class="token mv" id="move-src-157" data-title="variable_declaration_tuple/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-553"></span><span class="token upd" id="move-src-158" data-title="variable_declaration/identifier">int<span class="cupd">e</span>rnalA<span class="cupd">m</span>o<span class="cupd">u</span>nt</span></span>, 
            <span class="marker" id="mapping-554"></span><span class="token mv" id="move-src-159" data-title="variable_declaration_tuple/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-555"></span><span class="token upd" id="move-src-160" data-title="variable_declaration/identifier"><span class="cupd">e</span>x<span class="cupd">t</span><span class="cupd">e</span>rna<span class="cupd">l</span>Amoun<span class="cupd">t</span>AfterTax</span></span>, 
            <span class="marker" id="mapping-556"></span><span class="token del" data-title="variable_declaration_tuple/variable_declaration">Decimal.D256 memory internalAmountAfterTax</span>,
            <span class="marker" id="mapping-557"></span><span class="token del" data-title="variable_declaration_tuple/variable_declaration">Decimal.D256 memory tax</span>
        )</span> = <span class="marker" id="mapping-558"></span><span class="token del" data-title="variable_declaration_statement/call_expression">_getTransferValues(amount)</span>;</span>


        <span class="marker" id="mapping-559"></span><span class="token mv" id="move-src-161" data-title="function_body/expression_statement"><span class="marker" id="mapping-560"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-561"></span><span class="token del" data-title="assignment_expression/array_access">balances[sender]</span> = <span class="marker" id="mapping-562"></span><span class="token mv" id="move-src-162" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-563"></span><span class="token del" data-title="call_expression/member_expression">balances[sender].sub</span>(<span class="marker" id="mapping-564"></span><span class="token del" data-title="call_argument/identifier">internalAmount</span>, "Dollar: Insufficient token balance")</span></span>;</span>
        <span class="marker" id="mapping-565"></span><span class="token del" data-title="function_body/expression_statement">balances[recipient] = balances[recipient].add(internalAmountAfterTax);</span>

        <span class="marker" id="mapping-566"></span><span class="token del" data-title="function_body/expression_statement">_reflect(tax);</span>

        <span class="marker" id="mapping-567"></span><span class="token del" data-title="function_body/return_statement">return externalAmountAfterTax.asUint256();</span>
    }</span></span>

    <span class="marker" id="mapping-568"></span><span class="token del" data-title="contract_body/function_definition">function _getTransferValues(<span class="marker" id="mapping-569"></span><span class="token mv" id="move-src-163" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-570"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-571"></span><span class="token mv" id="move-src-164" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-572"></span><span class="token del" data-title="function_definition/return_type_definition">returns (<span class="marker" id="mapping-573"></span><span class="token mv" id="move-src-165" data-title="return_type_definition/parameter">Decimal.D256 memory <span class="marker" id="mapping-574"></span><span class="token upd" id="move-src-166" data-title="parameter/identifier">externalAmount</span></span>, <span class="marker" id="mapping-575"></span><span class="token mv" id="move-src-167" data-title="return_type_definition/parameter">Decimal.D256 memory <span class="marker" id="mapping-576"></span><span class="token upd" id="move-src-168" data-title="parameter/identifier">int<span class="cupd">er</span>nalAmount</span></span>, <span class="marker" id="mapping-577"></span><span class="token mv" id="move-src-169" data-title="return_type_definition/parameter">Decimal.D256 memory <span class="marker" id="mapping-578"></span><span class="token upd" id="move-src-170" data-title="parameter/identifier">exte<span class="cupd">r</span>nalAmountAfterTax</span></span>, <span class="marker" id="mapping-579"></span><span class="token mv" id="move-src-171" data-title="return_type_definition/parameter">Decimal.D256 memory <span class="marker" id="mapping-580"></span><span class="token upd" id="move-src-172" data-title="parameter/identifier">int<span class="cupd">e</span>rna<span class="cupd">l</span>Amoun<span class="cupd">t</span>AfterTax</span></span>, <span class="marker" id="mapping-581"></span><span class="token del" data-title="return_type_definition/parameter">Decimal.D256 memory externalTax</span>)</span> <span class="marker" id="mapping-582"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-583"></span><span class="token del" data-title="function_body/expression_statement">externalAmount = Decimal.from(amount);</span>
        <span class="marker" id="mapping-584"></span><span class="token del" data-title="function_body/expression_statement">internalAmount = externalAmount.div(ratio);</span>
        <span class="marker" id="mapping-585"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-586"></span><span class="token mv" id="move-src-173" data-title="variable_declaration_statement/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-587"></span><span class="token upd" id="move-src-174" data-title="variable_declaration/identifier"><span class="cupd">i</span>n<span class="cupd">t</span><span class="cupd">e</span>r<span class="cupd">nal</span>Tax</span></span> = <span class="marker" id="mapping-588"></span><span class="token del" data-title="variable_declaration_statement/call_expression">internalAmount.div(200)</span>;</span>
        <span class="marker" id="mapping-589"></span><span class="token del" data-title="function_body/expression_statement">externalTax = internalTax.mul(ratio);</span>
        <span class="marker" id="mapping-590"></span><span class="token del" data-title="function_body/expression_statement">internalAmountAfterTax = internalAmount.sub(internalTax);</span>
        <span class="marker" id="mapping-591"></span><span class="token del" data-title="function_body/expression_statement">externalAmountAfterTax = externalAmount.sub(externalTax);</span>
    }</span></span>

    <span class="marker" id="mapping-592"></span><span class="token del" data-title="contract_body/function_definition">function _reflect(<span class="marker" id="mapping-593"></span><span class="token mv" id="move-src-175" data-title="function_definition/parameter">Decimal.D256 memory <span class="marker" id="mapping-594"></span><span class="token upd" id="move-src-176" data-title="parameter/identifier"><span class="cupd">a</span>moun<span class="cupd">t</span>ToR<span class="cupd">e</span>flect</span></span>) <span class="marker" id="mapping-595"></span><span class="token mv" id="move-src-177" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-596"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-597"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-598"></span><span class="token mv" id="move-src-178" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-599"></span><span class="token upd" id="move-src-179" data-title="variable_declaration/identifier">totalSupplyStanda<span class="cupd">r</span><span class="cupd">d</span>C<span class="cupd">o</span><span class="cupd">n</span>verted</span></span> = <span class="marker" id="mapping-600"></span><span class="token del" data-title="variable_declaration_statement/call_expression">totalSupplyStandard.sub(amountToReflect).div(ratio).asUint256()</span>;</span>
        <span class="marker" id="mapping-601"></span><span class="token del" data-title="function_body/if_statement">if (<span class="marker" id="mapping-602"></span><span class="token del" data-title="if_statement/binary_expression">totalSupplyStandardConverted == 0</span>)
            <span class="marker" id="mapping-603"></span><span class="token mv" id="move-src-180" data-title="if_statement/return_statement">return;</span></span>
    
        <span class="marker" id="mapping-604"></span><span class="token del" data-title="function_body/expression_statement">ratio = ratio.add(amountToReflect.div(totalSupplyStandardConverted));</span>

        <span class="marker" id="mapping-605"></span><span class="token del" data-title="function_body/expression_statement">reflectionError = reflectionError.add(amountToReflect.value.mod(totalSupplyStandardConverted));</span>
        <span class="marker" id="mapping-606"></span><span class="token del" data-title="function_body/if_statement">if (<span class="marker" id="mapping-607"></span><span class="token del" data-title="if_statement/binary_expression">reflectionError &gt;= totalSupplyStandardConverted</span>) <span class="marker" id="mapping-608"></span><span class="token del" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-609"></span><span class="token del" data-title="block_statement/expression_statement">reflectionError = reflectionError.sub(totalSupplyStandardConverted);</span>
            <span class="marker" id="mapping-610"></span><span class="token del" data-title="block_statement/expression_statement"><span class="marker" id="mapping-611"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-612"></span><span class="token del" data-title="assignment_expression/member_expression">ratio.value</span> = <span class="marker" id="mapping-613"></span><span class="token del" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-614"></span><span class="token del" data-title="call_expression/member_expression">ratio.value.add</span>(<span class="marker" id="mapping-615"></span><span class="token mv" id="move-src-181" data-title="call_expression/call_argument">1</span>)</span></span>;</span>
        }</span></span>

        <span class="marker" id="mapping-616"></span><span class="token del" data-title="function_body/if_statement">if (<span class="marker" id="mapping-617"></span><span class="token del" data-title="if_statement/member_expression"><span class="marker" id="mapping-618"></span><span class="token del" data-title="member_expression/call_expression"><span class="marker" id="mapping-619"></span><span class="token mv" id="move-src-182" data-title="call_expression/member_expression"><span class="marker" id="mapping-620"></span><span class="token del" data-title="member_expression/binary_expression"><span class="marker" id="mapping-621"></span><span class="token del" data-title="binary_expression/member_expression">ratio.value</span> &gt;= <span class="marker" id="mapping-622"></span><span class="token mv" id="move-src-183" data-title="binary_expression/call_expression">Decimal.one()</span></span>.<span class="marker" id="mapping-623"></span><span class="token upd" id="move-src-184" data-title="member_expression/identifier">mul</span></span>(<span class="marker" id="mapping-624"></span><span class="token mv" id="move-src-185" data-title="call_expression/call_argument">2</span>)</span>.value</span>) <span class="marker" id="mapping-625"></span><span class="token del" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-626"></span><span class="token del" data-title="block_statement/expression_statement"><span class="marker" id="mapping-627"></span><span class="token del" data-title="expression_statement/assignment_expression">ratio = <span class="marker" id="mapping-628"></span><span class="token del" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-629"></span><span class="token del" data-title="call_expression/member_expression">ratio.div</span>(<span class="marker" id="mapping-630"></span><span class="token mv" id="move-src-186" data-title="call_expression/call_argument">2</span>)</span></span>;</span>
            <span class="marker" id="mapping-631"></span><span class="token del" data-title="block_statement/expression_statement"><span class="marker" id="mapping-632"></span><span class="token del" data-title="expression_statement/assignment_expression">adjustmentIndex = <span class="marker" id="mapping-633"></span><span class="token del" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-634"></span><span class="token del" data-title="call_expression/member_expression">adjustmentIndex.add</span>(<span class="marker" id="mapping-635"></span><span class="token mv" id="move-src-187" data-title="call_expression/call_argument">1</span>)</span></span>;</span>
        }</span></span>
    }</span></span>

}</span></span>

<span class="marker" id="mapping-636"></span><span class="token del" data-title="source_file/comment">/**
 * @dev Optional functions from the ERC20 standard.
 */</span>
<span class="marker" id="mapping-637"></span><span class="token del" data-title="source_file/contract_declaration">contract ERC20Detailed is <span class="marker" id="mapping-638"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">IERC20</span> <span class="marker" id="mapping-639"></span><span class="token del" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-640"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-641"></span><span class="token del" data-title="state_variable_declaration/type_name">string</span> <span class="marker" id="mapping-642"></span><span class="token mv" id="move-src-188" data-title="state_variable_declaration/visibility">private</span> _name;</span>
    <span class="marker" id="mapping-643"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-644"></span><span class="token del" data-title="state_variable_declaration/type_name">string</span> <span class="marker" id="mapping-645"></span><span class="token mv" id="move-src-189" data-title="state_variable_declaration/visibility">private</span> _symbol;</span>
    <span class="marker" id="mapping-646"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-647"></span><span class="token del" data-title="state_variable_declaration/type_name">uint8</span> <span class="marker" id="mapping-648"></span><span class="token mv" id="move-src-190" data-title="state_variable_declaration/visibility">private</span> _decimals;</span>

    /**
     * @dev Sets the values for `name`, `symbol`, and `decimals`. All three of
     * these values are immutable: they can only be set once during
     * construction.
     */
    <span class="marker" id="mapping-649"></span><span class="token del" data-title="contract_body/constructor_definition">constructor (string memory name, string memory symbol, uint8 decimals) public {
        _name = name;
        _symbol = symbol;
        _decimals = decimals;
    }</span>

    /**
     * @dev Returns the name of the token.
     */
    <span class="marker" id="mapping-650"></span><span class="token del" data-title="contract_body/function_definition">function name() public view returns (string memory) {
        return _name;
    }</span>

    /**
     * @dev Returns the symbol of the token, usually a shorter version of the
     * name.
     */
    <span class="marker" id="mapping-651"></span><span class="token del" data-title="contract_body/function_definition">function symbol() public view returns (string memory) {
        return _symbol;
    }</span>

    /**
     * @dev Returns the number of decimals used to get its user representation.
     * For example, if `decimals` equals `2`, a balance of `505` tokens should
     * be displayed to a user as `5,05` (`505 / 10 ** 2`).
     *
     * Tokens usually opt for a value of 18, imitating the relationship between
     * Ether and Wei.
     *
     * NOTE: This information is only used for _display_ purposes: it in
     * no way affects any of the arithmetic of the contract, including
     * {IERC20-balanceOf} and {IERC20-transfer}.
     */
    <span class="marker" id="mapping-652"></span><span class="token del" data-title="contract_body/function_definition">function decimals() public view returns (uint8) {
        return _decimals;
    }</span>
}</span></span>

<span class="marker" id="mapping-653"></span><span class="token del" data-title="source_file/comment">/*
    Copyright 2019 dYdX Trading Inc.

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/</span>
<span class="marker" id="mapping-654"></span><span class="token del" data-title="source_file/comment">/**
 * @title Require
 * @author dYdX
 *
 * Stringifies parameters to pretty-print revert messages. Costs more gas than regular require()
 */</span>
<span class="marker" id="mapping-655"></span><span class="token mv" id="move-src-191" data-title="source_file/library_declaration">library Require {

    // ============ Constants ============

    uint256 constant ASCII_ZERO = 48; // '0'
    uint256 constant ASCII_RELATIVE_ZERO = 87; // 'a' - 10
    uint256 constant ASCII_LOWER_EX = 120; // 'x'
    bytes2 constant COLON = 0x3a20; // ': '
    bytes2 constant COMMA = 0x2c20; // ', '
    bytes2 constant LPAREN = 0x203c; // ' &lt;'
    byte constant RPAREN = 0x3e; // '&gt;'
    uint256 constant FOUR_BIT_MASK = 0xf;

    // ============ Library Functions ============

    function that(
        bool must,
        bytes32 file,
        bytes32 reason
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason)
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        uint256 payloadA
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        uint256 payloadA,
        uint256 payloadB
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        COMMA,
                        stringify(payloadB),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        address payloadA
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        address payloadA,
        uint256 payloadB
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        COMMA,
                        stringify(payloadB),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        address payloadA,
        uint256 payloadB,
        uint256 payloadC
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        COMMA,
                        stringify(payloadB),
                        COMMA,
                        stringify(payloadC),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        bytes32 payloadA
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        bytes32 payloadA,
        uint256 payloadB,
        uint256 payloadC
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        COMMA,
                        stringify(payloadB),
                        COMMA,
                        stringify(payloadC),
                        RPAREN
                    )
                )
            );
        }
    }

    // ============ Private Functions ============

    function stringifyTruncated(
        bytes32 input
    )
    private
    pure
    returns (bytes memory)
    {
        // put the input bytes into the result
        bytes memory result = abi.encodePacked(input);

        // determine the length of the input by finding the location of the last non-zero byte
        for (uint256 i = 32; i &gt; 0; ) {
            // reverse-for-loops with unsigned integer
            /* solium-disable-next-line security/no-modify-for-iter-var */
            i--;

            // find the last non-zero byte in order to determine the length
            if (result[i] != 0) {
                uint256 length = i + 1;

                /* solium-disable-next-line security/no-inline-assembly */
                assembly {
                    mstore(result, length) // r.length = length;
                }

                return result;
            }
        }

        // all bytes are zero
        return new bytes(0);
    }

    function stringify(
        uint256 input
    )
    private
    pure
    returns (bytes memory)
    {
        if (input == 0) {
            return "0";
        }

        // get the final string length
        uint256 j = input;
        uint256 length;
        while (j != 0) {
            length++;
            j /= 10;
        }

        // allocate the string
        bytes memory bstr = new bytes(length);

        // populate the string starting with the least-significant character
        j = input;
        for (uint256 i = length; i &gt; 0; ) {
            // reverse-for-loops with unsigned integer
            /* solium-disable-next-line security/no-modify-for-iter-var */
            i--;

            // take last decimal digit
            bstr[i] = byte(uint8(ASCII_ZERO + (j % 10)));

            // remove the last decimal digit
            j /= 10;
        }

        return bstr;
    }

    function stringify(
        address input
    )
    private
    pure
    returns (bytes memory)
    {
        uint256 z = uint256(input);

        // addresses are "0x" followed by 20 bytes of data which take up 2 characters each
        bytes memory result = new bytes(42);

        // populate the result with "0x"
        result[0] = byte(uint8(ASCII_ZERO));
        result[1] = byte(uint8(ASCII_LOWER_EX));

        // for each byte (starting from the lowest byte), populate the result with two characters
        for (uint256 i = 0; i &lt; 20; i++) {
            // each byte takes two characters
            uint256 shift = i * 2;

            // populate the least-significant character
            result[41 - shift] = char(z &amp; FOUR_BIT_MASK);
            z = z &gt;&gt; 4;

            // populate the most-significant character
            result[40 - shift] = char(z &amp; FOUR_BIT_MASK);
            z = z &gt;&gt; 4;
        }

        return result;
    }

    function stringify(
        bytes32 input
    )
    private
    pure
    returns (bytes memory)
    {
        uint256 z = uint256(input);

        // bytes32 are "0x" followed by 32 bytes of data which take up 2 characters each
        bytes memory result = new bytes(66);

        // populate the result with "0x"
        result[0] = byte(uint8(ASCII_ZERO));
        result[1] = byte(uint8(ASCII_LOWER_EX));

        // for each byte (starting from the lowest byte), populate the result with two characters
        for (uint256 i = 0; i &lt; 32; i++) {
            // each byte takes two characters
            uint256 shift = i * 2;

            // populate the least-significant character
            result[65 - shift] = char(z &amp; FOUR_BIT_MASK);
            z = z &gt;&gt; 4;

            // populate the most-significant character
            result[64 - shift] = char(z &amp; FOUR_BIT_MASK);
            z = z &gt;&gt; 4;
        }

        return result;
    }

    function char(
        uint256 input
    )
    private
    pure
    returns (byte)
    {
        // return ASCII digit (0-9)
        if (input &lt; 10) {
            return byte(uint8(input + ASCII_ZERO));
        }

        // return ASCII letter (a-f)
        return byte(uint8(input + ASCII_RELATIVE_ZERO));
    }
}</span>

<span class="marker" id="mapping-656"></span><span class="token del" data-title="source_file/comment">/*
    Copyright 2019 ZeroEx Intl.

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/</span>
<span class="marker" id="mapping-657"></span><span class="token del" data-title="source_file/library_declaration">library LibEIP712 <span class="marker" id="mapping-658"></span><span class="token del" data-title="library_declaration/contract_body">{

    // Hash of the EIP712 Domain Separator Schema
    // keccak256(abi.encodePacked(
    //     "EIP712Domain(",
    //     "string name,",
    //     "string version,",
    //     "uint256 chainId,",
    //     "address verifyingContract",
    //     ")"
    // ))
    <span class="marker" id="mapping-659"></span><span class="token del" data-title="contract_body/state_variable_declaration">bytes32 constant internal _EIP712_DOMAIN_SEPARATOR_SCHEMA_HASH = 0x8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f;</span>

    /// @dev Calculates a EIP712 domain separator.
    /// @param name The EIP712 domain name.
    /// @param version The EIP712 domain version.
    /// @param verifyingContract The EIP712 verifying contract.
    /// @return EIP712 domain separator.
    <span class="marker" id="mapping-660"></span><span class="token del" data-title="contract_body/function_definition">function hashEIP712Domain(
        <span class="marker" id="mapping-661"></span><span class="token del" data-title="function_definition/parameter">string memory name</span>,
        <span class="marker" id="mapping-662"></span><span class="token del" data-title="function_definition/parameter">string memory version</span>,
        <span class="marker" id="mapping-663"></span><span class="token mv" id="move-src-192" data-title="function_definition/parameter">uint256 <span class="marker" id="mapping-664"></span><span class="token upd" id="move-src-193" data-title="parameter/identifier">cha<span class="cupd">in</span>Id</span></span>,
        <span class="marker" id="mapping-665"></span><span class="token del" data-title="function_definition/parameter">address verifyingContract</span>
    )
    <span class="marker" id="mapping-666"></span><span class="token del" data-title="function_definition/visibility">internal</span>
    <span class="marker" id="mapping-667"></span><span class="token mv" id="move-src-194" data-title="function_definition/state_mutability">pure</span>
    <span class="marker" id="mapping-668"></span><span class="token del" data-title="function_definition/return_type_definition">returns (bytes32 result)</span>
    <span class="marker" id="mapping-669"></span><span class="token del" data-title="function_definition/function_body">{
        bytes32 schemaHash = _EIP712_DOMAIN_SEPARATOR_SCHEMA_HASH;

        // Assembly for more efficient computing:
        // keccak256(abi.encodePacked(
        //     _EIP712_DOMAIN_SEPARATOR_SCHEMA_HASH,
        //     keccak256(bytes(name)),
        //     keccak256(bytes(version)),
        //     chainId,
        //     uint256(verifyingContract)
        // ))

        assembly {
        // Calculate hashes of dynamic data
            let nameHash := keccak256(add(name, 32), mload(name))
            let versionHash := keccak256(add(version, 32), mload(version))

        // Load free memory pointer
            let memPtr := mload(64)

        // Store params in memory
            mstore(memPtr, schemaHash)
            mstore(add(memPtr, 32), nameHash)
            mstore(add(memPtr, 64), versionHash)
            mstore(add(memPtr, 96), chainId)
            mstore(add(memPtr, 128), verifyingContract)

        // Compute hash
            result := keccak256(memPtr, 160)
        }
        return result;
    }</span></span>

    /// @dev Calculates EIP712 encoding for a hash struct with a given domain hash.
    /// @param eip712DomainHash Hash of the domain domain separator data, computed
    ///                         with getDomainHash().
    /// @param hashStruct The EIP712 hash struct.
    /// @return EIP712 hash applied to the given EIP712 Domain.
    <span class="marker" id="mapping-670"></span><span class="token del" data-title="contract_body/function_definition">function hashEIP712Message(<span class="marker" id="mapping-671"></span><span class="token del" data-title="function_definition/parameter">bytes32 eip712DomainHash</span>, <span class="marker" id="mapping-672"></span><span class="token del" data-title="function_definition/parameter">bytes32 hashStruct</span>)
    <span class="marker" id="mapping-673"></span><span class="token del" data-title="function_definition/visibility">internal</span>
    <span class="marker" id="mapping-674"></span><span class="token mv" id="move-src-195" data-title="function_definition/state_mutability">pure</span>
    <span class="marker" id="mapping-675"></span><span class="token del" data-title="function_definition/return_type_definition">returns (bytes32 result)</span>
    <span class="marker" id="mapping-676"></span><span class="token del" data-title="function_definition/function_body">{
        // Assembly for more efficient computing:
        // keccak256(abi.encodePacked(
        //     EIP191_HEADER,
        //     EIP712_DOMAIN_HASH,
        //     hashStruct
        // ));

        assembly {
        // Load free memory pointer
            let memPtr := mload(64)

            mstore(memPtr, 0x1901000000000000000000000000000000000000000000000000000000000000)  // EIP191 header
            mstore(add(memPtr, 2), eip712DomainHash)                                            // EIP712 domain hash
            mstore(add(memPtr, 34), hashStruct)                                                 // Hash of struct

        // Compute hash
            result := keccak256(memPtr, 66)
        }
        return result;
    }</span></span>
}</span></span>

/*
    Copyright 2020 Dynamic Dollar Devs, based on the works of the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
library Constants {
    /* Chain */
    uint256 private constant CHAIN_ID = 1; // Mainnet

    /* Bootstrapping */
    uint256 private constant BOOTSTRAPPING_PERIOD = 200; // 200 epochs
    uint256 private constant BOOTSTRAPPING_PRICE = 154e16; // 1.54 DAI (targeting 4.5% inflation)

    /* Oracle */
    address private constant DAI = address(0x6B175474E89094C44Da98b954EedeAC495271d0F);
    uint256 private constant ORACLE_RESERVE_MINIMUM = 1e22; // 10,000 DAI

    /* Bonding */
    uint256 private constant INITIAL_STAKE_MULTIPLE = 1e6; // 100 RFSD -&gt; 100M RSS

    /* Epoch */
    struct EpochStrategy {
        uint256 offset;
        uint256 minPeriod;
        uint256 maxPeriod;
    }

    uint256 private constant EPOCH_OFFSET = 0;
    uint256 private constant EPOCH_MIN_PERIOD = 1800;
    uint256 private constant EPOCH_MAX_PERIOD = 7200;

    /* Governance */
    uint256 private constant GOVERNANCE_PERIOD = 21;
    uint256 private constant GOVERNANCE_QUORUM = 20e16; // 20%
    uint256 private constant GOVERNANCE_SUPER_MAJORITY = 66e16; // 66%
    uint256 private constant GOVERNANCE_EMERGENCY_DELAY = 6; // 6 epochs

    /* DAO */
    uint256 private constant ADVANCE_INCENTIVE = 100e18; // 100 RFSD
    uint256 private constant DAO_EXIT_LOCKUP_EPOCHS = 36; // 36 epochs fluid

    /* Pool */
    uint256 private constant POOL_EXIT_LOCKUP_EPOCHS = 12; // 12 epochs fluid

    /* Market */
    uint256 private constant COUPON_EXPIRATION = 360;
    uint256 private constant DEBT_RATIO_CAP = 40e16; // 40%
    uint256 private constant INITIAL_COUPON_REDEMPTION_PENALTY = 50e16; // 50%

    /* Regulator */
    uint256 private constant SUPPLY_CHANGE_DIVISOR = 12e18; // 12
    uint256 private constant SUPPLY_CHANGE_LIMIT = 10e16; // 10%
    uint256 private constant ORACLE_POOL_RATIO = 60; // 60%

    /**
     * Getters
     */
    function getDAIAddress() internal pure returns (address) {
        return DAI;
    }

    function getOracleReserveMinimum() internal pure returns (uint256) {
        return ORACLE_RESERVE_MINIMUM;
    }

    function getEpochStrategy() internal pure returns (EpochStrategy memory) {
        return EpochStrategy({
            offset: EPOCH_OFFSET,
            minPeriod: EPOCH_MIN_PERIOD,
            maxPeriod: EPOCH_MAX_PERIOD
        });
    }

    function getInitialStakeMultiple() internal pure returns (uint256) {
        return INITIAL_STAKE_MULTIPLE;
    }

    function getBootstrappingPeriod() internal pure returns (uint256) {
        return BOOTSTRAPPING_PERIOD;
    }

    function getBootstrappingPrice() internal pure returns (Decimal.D256 memory) {
        return Decimal.D256({value: BOOTSTRAPPING_PRICE});
    }

    function getGovernancePeriod() internal pure returns (uint256) {
        return GOVERNANCE_PERIOD;
    }

    function getGovernanceQuorum() internal pure returns (Decimal.D256 memory) {
        return Decimal.D256({value: GOVERNANCE_QUORUM});
    }

    function getGovernanceSuperMajority() internal pure returns (Decimal.D256 memory) {
        return Decimal.D256({value: GOVERNANCE_SUPER_MAJORITY});
    }

    function getGovernanceEmergencyDelay() internal pure returns (uint256) {
        return GOVERNANCE_EMERGENCY_DELAY;
    }

    function getAdvanceIncentive() internal pure returns (uint256) {
        return ADVANCE_INCENTIVE;
    }

    function getDAOExitLockupEpochs() internal pure returns (uint256) {
        return DAO_EXIT_LOCKUP_EPOCHS;
    }

    function getPoolExitLockupEpochs() internal pure returns (uint256) {
        return POOL_EXIT_LOCKUP_EPOCHS;
    }

    function getCouponExpiration() internal pure returns (uint256) {
        return COUPON_EXPIRATION;
    }

    function getDebtRatioCap() internal pure returns (Decimal.D256 memory) {
        return Decimal.D256({value: DEBT_RATIO_CAP});
    }
    
    function getInitialCouponRedemptionPenalty() internal pure returns (Decimal.D256 memory) {
        return Decimal.D256({value: INITIAL_COUPON_REDEMPTION_PENALTY});
    }

    function getSupplyChangeLimit() internal pure returns (Decimal.D256 memory) {
        return Decimal.D256({value: SUPPLY_CHANGE_LIMIT});
    }

    function getSupplyChangeDivisor() internal pure returns (Decimal.D256 memory) {
        return Decimal.D256({value: SUPPLY_CHANGE_DIVISOR});
    }

    function getOraclePoolRatio() internal pure returns (uint256) {
        return ORACLE_POOL_RATIO;
    }

    function getChainId() internal pure returns (uint256) {
        return CHAIN_ID;
    }
}

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
<span class="marker" id="mapping-677"></span><span class="token del" data-title="source_file/contract_declaration">contract Permittable is <span class="marker" id="mapping-678"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">ERC20Detailed</span>, <span class="marker" id="mapping-679"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">ERC20</span> <span class="marker" id="mapping-680"></span><span class="token del" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-681"></span><span class="token del" data-title="contract_body/state_variable_declaration">bytes32 constant FILE = "Permittable";</span>

    // keccak256("Permit(address owner,address spender,uint256 value,uint256 nonce,uint256 deadline)");
    <span class="marker" id="mapping-682"></span><span class="token del" data-title="contract_body/state_variable_declaration">bytes32 public constant EIP712_PERMIT_TYPEHASH = 0x6e71edae12b1b97f4d1f60370fef10105fa2faae0126114a169c64845d6126c9;</span>
    <span class="marker" id="mapping-683"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-684"></span><span class="token del" data-title="state_variable_declaration/type_name">string</span> <span class="marker" id="mapping-685"></span><span class="token mv" id="move-src-196" data-title="state_variable_declaration/visibility">private</span> constant EIP712_VERSION = <span class="marker" id="mapping-686"></span><span class="token del" data-title="state_variable_declaration/string_literal">"1"</span>;</span>

    <span class="marker" id="mapping-687"></span><span class="token del" data-title="contract_body/state_variable_declaration">bytes32 public EIP712_DOMAIN_SEPARATOR;</span>

    <span class="marker" id="mapping-688"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-689"></span><span class="token del" data-title="state_variable_declaration/type_name">mapping(<span class="marker" id="mapping-690"></span><span class="token del" data-title="type_name/primitive_type">address</span> =&gt; <span class="marker" id="mapping-691"></span><span class="token mv" id="move-src-197" data-title="type_name/type_name">uint256</span>)</span> nonces;</span>

    <span class="marker" id="mapping-692"></span><span class="token del" data-title="contract_body/constructor_definition">constructor() public <span class="marker" id="mapping-693"></span><span class="token del" data-title="constructor_definition/function_body">{
        <span class="marker" id="mapping-694"></span><span class="token mv" id="move-src-198" data-title="function_body/expression_statement"><span class="marker" id="mapping-695"></span><span class="token del" data-title="expression_statement/assignment_expression">EIP712_DOMAIN_SEPARATOR = <span class="marker" id="mapping-696"></span><span class="token mv" id="move-src-199" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-697"></span><span class="token mv" id="move-src-200" data-title="member_expression/identifier"><span class="marker" id="mapping-698"></span><span class="token upd" id="move-src-201" data-title="member_expression/identifier">LibEIP712</span></span>.<span class="marker" id="mapping-699"></span><span class="token del" data-title="member_expression/identifier">hashEIP712Domain</span>(<span class="marker" id="mapping-700"></span><span class="token del" data-title="call_expression/call_argument">name()</span>, <span class="marker" id="mapping-701"></span><span class="token del" data-title="call_expression/call_argument">EIP712_VERSION</span><span class="marker" id="mapping-702"></span><span class="token mv" id="move-src-202" data-title="call_expression/,">,</span> <span class="marker" id="mapping-703"></span><span class="token del" data-title="call_expression/call_argument">Constants.getChainId()</span><span class="marker" id="mapping-704"></span><span class="token del" data-title="call_expression/,">,</span> address(this))</span></span>;</span>
    }</span></span>

    <span class="marker" id="mapping-705"></span><span class="token del" data-title="contract_body/function_definition">function permit(
        <span class="marker" id="mapping-706"></span><span class="token mv" id="move-src-203" data-title="function_definition/parameter">address <span class="marker" id="mapping-707"></span><span class="token upd" id="move-src-204" data-title="parameter/identifier">ow<span class="cupd">n</span>er</span></span>,
        <span class="marker" id="mapping-708"></span><span class="token del" data-title="function_definition/parameter">address spender</span>,
        <span class="marker" id="mapping-709"></span><span class="token mv" id="move-src-205" data-title="function_definition/parameter">uint256 value</span>,
        <span class="marker" id="mapping-710"></span><span class="token mv" id="move-src-206" data-title="function_definition/parameter">uint256 <span class="marker" id="mapping-711"></span><span class="token upd" id="move-src-207" data-title="parameter/identifier">deadline</span></span>,
        <span class="marker" id="mapping-712"></span><span class="token del" data-title="function_definition/parameter">uint8 v</span>,
        <span class="marker" id="mapping-713"></span><span class="token del" data-title="function_definition/parameter">bytes32 r</span>,
        <span class="marker" id="mapping-714"></span><span class="token del" data-title="function_definition/parameter">bytes32 s</span>
    ) <span class="marker" id="mapping-715"></span><span class="token mv" id="move-src-208" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-716"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-717"></span><span class="token del" data-title="function_body/variable_declaration_statement">bytes32 digest = LibEIP712.hashEIP712Message(
            EIP712_DOMAIN_SEPARATOR,
            keccak256(abi.encode(
                EIP712_PERMIT_TYPEHASH,
                owner,
                spender,
                value,
                nonces[owner]++,
                deadline
            ))
        );</span>

        <span class="marker" id="mapping-718"></span><span class="token del" data-title="function_body/variable_declaration_statement">address recovered = ecrecover(digest, v, r, s);</span>
        <span class="marker" id="mapping-719"></span><span class="token mv" id="move-src-209" data-title="function_body/expression_statement"><span class="marker" id="mapping-720"></span><span class="token mv" id="move-src-210" data-title="call_expression/member_expression">Require.that</span>(
            <span class="marker" id="mapping-721"></span><span class="token del" data-title="call_expression/call_argument">recovered == owner</span>,
            <span class="marker" id="mapping-722"></span><span class="token mv" id="move-src-211" data-title="call_expression/call_argument">FILE</span><span class="marker" id="mapping-723"></span><span class="token del" data-title="call_expression/,">,</span>
            "Invalid signature"
        );</span>

        <span class="marker" id="mapping-724"></span><span class="token mv" id="move-src-212" data-title="function_body/expression_statement">Require.that(
            <span class="marker" id="mapping-725"></span><span class="token upd" id="move-src-213" data-title="binary_expression/identifier"><span class="cupd">re</span>cov<span class="cupd">e</span>red</span> <span class="marker" id="mapping-726"></span><span class="token del" data-title="binary_expression/!=">!=</span> <span class="marker" id="mapping-727"></span><span class="token del" data-title="binary_expression/type_cast_expression">address(0)</span>,
            FILE,
            "Zero address"
        );</span>

        <span class="marker" id="mapping-728"></span><span class="token mv" id="move-src-214" data-title="function_body/expression_statement"><span class="marker" id="mapping-729"></span><span class="token mv" id="move-src-215" data-title="call_expression/member_expression">Require.that</span>(
            <span class="marker" id="mapping-730"></span><span class="token del" data-title="call_argument/binary_expression">now &lt;= deadline</span>,
            <span class="marker" id="mapping-731"></span><span class="token mv" id="move-src-216" data-title="call_expression/call_argument">FILE</span><span class="marker" id="mapping-732"></span><span class="token del" data-title="call_expression/,">,</span>
            "Expired"
        );</span>

        <span class="marker" id="mapping-733"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-734"></span><span class="token del" data-title="expression_statement/call_expression">_approve(<span class="marker" id="mapping-735"></span><span class="token del" data-title="call_expression/call_argument">owner</span>, <span class="marker" id="mapping-736"></span><span class="token mv" id="move-src-217" data-title="call_expression/call_argument">spender</span>, <span class="marker" id="mapping-737"></span><span class="token mv" id="move-src-218" data-title="call_expression/call_argument">value</span>)</span>;</span>
    }</span></span>
}</span></span>

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
contract IDollar is IERC20 {
    function burn(uint256 amount) public;
    function burnFrom(address account, uint256 amount) public;
    function mint(address account, uint256 amount) public returns (bool);
    function excludeAccount(address account) external;
}

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
<span class="marker" id="mapping-738"></span><span class="token del" data-title="source_file/contract_declaration">contract Dollar is <span class="marker" id="mapping-739"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">IDollar</span>, <span class="marker" id="mapping-740"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">Reflect</span>, <span class="marker" id="mapping-741"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">MinterRole</span>, <span class="marker" id="mapping-742"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">Permittable</span>, <span class="marker" id="mapping-743"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">ERC20Burnable</span> <span class="marker" id="mapping-744"></span><span class="token del" data-title="contract_declaration/contract_body">{

    <span class="marker" id="mapping-745"></span><span class="token del" data-title="contract_body/constructor_definition">constructor()
    ERC20Detailed("Reflective Set Dollar", "RFSD", 18)
    Permittable()
    public
    { }</span>

    <span class="marker" id="mapping-746"></span><span class="token del" data-title="contract_body/function_definition">function mint(<span class="marker" id="mapping-747"></span><span class="token mv" id="move-src-219" data-title="function_definition/parameter">address account</span>, <span class="marker" id="mapping-748"></span><span class="token mv" id="move-src-220" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-749"></span><span class="token del" data-title="function_definition/modifier_invocation">onlyMinter</span> <span class="marker" id="mapping-750"></span><span class="token del" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-751"></span><span class="token del" data-title="function_definition/return_type_definition">returns (bool)</span> <span class="marker" id="mapping-752"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-753"></span><span class="token mv" id="move-src-221" data-title="function_body/expression_statement"><span class="marker" id="mapping-754"></span><span class="token del" data-title="call_expression/identifier">_mint</span>(account, amount);</span>
        <span class="marker" id="mapping-755"></span><span class="token del" data-title="function_body/return_statement">return true;</span>
    }</span></span>

    <span class="marker" id="mapping-756"></span><span class="token del" data-title="contract_body/function_definition">function transferFrom(<span class="marker" id="mapping-757"></span><span class="token del" data-title="function_definition/parameter">address sender</span>, <span class="marker" id="mapping-758"></span><span class="token del" data-title="function_definition/parameter">address recipient</span>, <span class="marker" id="mapping-759"></span><span class="token mv" id="move-src-222" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-760"></span><span class="token del" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-761"></span><span class="token del" data-title="function_definition/return_type_definition">returns (bool)</span> <span class="marker" id="mapping-762"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-763"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-764"></span><span class="token del" data-title="expression_statement/call_expression">_transfer(<span class="marker" id="mapping-765"></span><span class="token del" data-title="call_expression/call_argument">sender</span>, <span class="marker" id="mapping-766"></span><span class="token del" data-title="call_expression/call_argument">recipient</span>, <span class="marker" id="mapping-767"></span><span class="token mv" id="move-src-223" data-title="call_expression/call_argument">amount</span>)</span>;</span>
        <span class="marker" id="mapping-768"></span><span class="token mv" id="move-src-224" data-title="function_body/if_statement">if (<span class="marker" id="mapping-769"></span><span class="token mv" id="move-src-225" data-title="if_statement/binary_expression"><span class="marker" id="mapping-770"></span><span class="token upd" id="move-src-226" data-title="call_expression/identifier"><span class="cupd">allowance</span></span>(sender, <span class="marker" id="mapping-771"></span><span class="token del" data-title="call_argument/call_expression">_msgSender()</span>) != uint256(-1)</span>) <span class="marker" id="mapping-772"></span><span class="token del" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-773"></span><span class="token del" data-title="block_statement/expression_statement"><span class="marker" id="mapping-774"></span><span class="token del" data-title="expression_statement/call_expression">_approve(
                <span class="marker" id="mapping-775"></span><span class="token mv" id="move-src-227" data-title="call_expression/call_argument">sender</span>,
                <span class="marker" id="mapping-776"></span><span class="token del" data-title="call_expression/call_argument">_msgSender()</span>,
                <span class="marker" id="mapping-777"></span><span class="token del" data-title="call_expression/call_argument"><span class="marker" id="mapping-778"></span><span class="token del" data-title="call_argument/call_expression"><span class="marker" id="mapping-779"></span><span class="token del" data-title="call_expression/member_expression">allowance(sender, _msgSender()).sub</span>(<span class="marker" id="mapping-780"></span><span class="token del" data-title="call_expression/call_argument">amount</span>, <span class="marker" id="mapping-781"></span><span class="token mv" id="move-src-228" data-title="call_expression/call_argument">"Dollar: transfer amount exceeds allowance"</span>)</span></span>)</span>;</span>
        }</span></span>
        <span class="marker" id="mapping-782"></span><span class="token del" data-title="function_body/return_statement">return true;</span>
    }</span></span>
}</span></span>

<span class="marker" id="mapping-783"></span><span class="token del" data-title="source_file/interface_declaration">interface IUniswapV2Factory <span class="marker" id="mapping-784"></span><span class="token del" data-title="interface_declaration/contract_body">{
    <span class="marker" id="mapping-785"></span><span class="token mv" id="move-src-229" data-title="contract_body/event_definition">event <span class="marker" id="mapping-786"></span><span class="token upd" id="move-src-230" data-title="event_definition/identifier">Pair<span class="cupd">C</span><span class="cupd">r</span>eated</span>(address indexed <span class="marker" id="mapping-787"></span><span class="token upd" id="move-src-231" data-title="event_paramater/identifier">t<span class="cupd">o</span>ken0</span>, address indexed <span class="marker" id="mapping-788"></span><span class="token upd" id="move-src-232" data-title="event_paramater/identifier">tok<span class="cupd">en</span>1</span>, <span class="marker" id="mapping-789"></span><span class="token mv" id="move-src-233" data-title="event_definition/event_paramater">address <span class="marker" id="mapping-790"></span><span class="token upd" id="move-src-234" data-title="event_paramater/identifier">p<span class="cupd">a</span>ir</span></span><span class="marker" id="mapping-791"></span><span class="token del" data-title="event_definition/,">,</span> <span class="marker" id="mapping-792"></span><span class="token del" data-title="event_definition/event_paramater">uint</span>);</span>

    <span class="marker" id="mapping-793"></span><span class="token del" data-title="contract_body/function_definition">function feeTo() external view returns (address);</span>
    <span class="marker" id="mapping-794"></span><span class="token del" data-title="contract_body/function_definition">function feeToSetter() external view returns (address);</span>

    <span class="marker" id="mapping-795"></span><span class="token del" data-title="contract_body/function_definition">function getPair(address tokenA, address tokenB) external view returns (address pair);</span>
    <span class="marker" id="mapping-796"></span><span class="token del" data-title="contract_body/function_definition">function allPairs(uint) external view returns (address pair);</span>
    <span class="marker" id="mapping-797"></span><span class="token del" data-title="contract_body/function_definition">function allPairsLength() external view returns (uint);</span>

    <span class="marker" id="mapping-798"></span><span class="token del" data-title="contract_body/function_definition">function createPair(address tokenA, address tokenB) external returns (address pair);</span>

    <span class="marker" id="mapping-799"></span><span class="token del" data-title="contract_body/function_definition">function setFeeTo(address) external;</span>
    <span class="marker" id="mapping-800"></span><span class="token del" data-title="contract_body/function_definition">function setFeeToSetter(address) external;</span>
}</span></span>

<span class="marker" id="mapping-801"></span><span class="token mv" id="move-src-235" data-title="source_file/interface_declaration">interface IUniswapV2Pair {
    event Approval(address indexed owner, address indexed spender, uint value);
    event Transfer(address indexed from, address indexed to, uint value);

    function name() external pure returns (string memory);
    function symbol() external pure returns (string memory);
    function decimals() external pure returns (uint8);
    function totalSupply() external view returns (uint);
    function balanceOf(address owner) external view returns (uint);
    function allowance(address owner, address spender) external view returns (uint);

    function approve(address spender, uint value) external returns (bool);
    function transfer(address to, uint value) external returns (bool);
    function transferFrom(address from, address to, uint value) external returns (bool);

    function DOMAIN_SEPARATOR() external view returns (bytes32);
    function PERMIT_TYPEHASH() external pure returns (bytes32);
    function nonces(address owner) external view returns (uint);

    function permit(address owner, address spender, uint value, uint deadline, uint8 v, bytes32 r, bytes32 s) external;

    event Mint(address indexed sender, uint amount0, uint amount1);
    event Burn(address indexed sender, uint amount0, uint amount1, address indexed to);
    event Swap(
        address indexed sender,
        uint amount0In,
        uint amount1In,
        uint amount0Out,
        uint amount1Out,
        address indexed to
    );
    event Sync(uint112 reserve0, uint112 reserve1);

    function MINIMUM_LIQUIDITY() external pure returns (uint);
    function factory() external view returns (address);
    function token0() external view returns (address);
    function token1() external view returns (address);
    function getReserves() external view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast);
    function price0CumulativeLast() external view returns (uint);
    function price1CumulativeLast() external view returns (uint);
    function kLast() external view returns (uint);

    function mint(address to) external returns (uint liquidity);
    function burn(address to) external returns (uint amount0, uint amount1);
    function swap(uint amount0Out, uint amount1Out, address to, bytes calldata data) external;
    function skim(address to) external;
    function sync() external;

    function initialize(address, address) external;
}</span>

<span class="marker" id="mapping-802"></span><span class="token del" data-title="source_file/comment">// </span>
<span class="marker" id="mapping-803"></span><span class="token del" data-title="source_file/comment">// computes square roots using the babylonian method</span>
<span class="marker" id="mapping-804"></span><span class="token del" data-title="source_file/comment">// https://en.wikipedia.org/wiki/Methods_of_computing_square_roots#Babylonian_method</span>
<span class="marker" id="mapping-805"></span><span class="token del" data-title="source_file/library_declaration">library Babylonian <span class="marker" id="mapping-806"></span><span class="token del" data-title="library_declaration/contract_body">{
    <span class="marker" id="mapping-807"></span><span class="token del" data-title="contract_body/function_definition">function sqrt(<span class="marker" id="mapping-808"></span><span class="token del" data-title="function_definition/parameter">uint y</span>) <span class="marker" id="mapping-809"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-810"></span><span class="token mv" id="move-src-236" data-title="function_definition/state_mutability">pure</span> <span class="marker" id="mapping-811"></span><span class="token del" data-title="function_definition/return_type_definition">returns (uint z)</span> <span class="marker" id="mapping-812"></span><span class="token del" data-title="function_definition/function_body">{
        if (y &gt; 3) {
            z = y;
            uint x = y / 2 + 1;
            while (x &lt; z) {
                z = x;
                x = (y / x + x) / 2;
            }
        } else if (y != 0) {
            z = 1;
        }
        // else z = 0
    }</span></span>
}</span></span>

<span class="marker" id="mapping-813"></span><span class="token del" data-title="source_file/comment">// </span>
<span class="marker" id="mapping-814"></span><span class="token del" data-title="source_file/comment">// a library for handling binary fixed point numbers (https://en.wikipedia.org/wiki/Q_(number_format))</span>
<span class="marker" id="mapping-815"></span><span class="token del" data-title="source_file/library_declaration">library FixedPoint <span class="marker" id="mapping-816"></span><span class="token del" data-title="library_declaration/contract_body">{
    // range: [0, 2**112 - 1]
    // resolution: 1 / 2**112
    <span class="marker" id="mapping-817"></span><span class="token del" data-title="contract_body/struct_declaration">struct uq112x112 {
        uint224 _x;
    }</span>

    // range: [0, 2**144 - 1]
    // resolution: 1 / 2**112
    <span class="marker" id="mapping-818"></span><span class="token del" data-title="contract_body/struct_declaration">struct uq144x112 {
        uint _x;
    }</span>

    <span class="marker" id="mapping-819"></span><span class="token del" data-title="contract_body/state_variable_declaration">uint8 private constant RESOLUTION = 112;</span>
    <span class="marker" id="mapping-820"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-821"></span><span class="token del" data-title="state_variable_declaration/type_name">uint</span> <span class="marker" id="mapping-822"></span><span class="token del" data-title="state_variable_declaration/visibility">private</span> constant Q112 = <span class="marker" id="mapping-823"></span><span class="token del" data-title="state_variable_declaration/binary_expression"><span class="marker" id="mapping-824"></span><span class="token del" data-title="binary_expression/type_cast_expression"><span class="marker" id="mapping-825"></span><span class="token del" data-title="type_cast_expression/primitive_type">uint</span>(<span class="marker" id="mapping-826"></span><span class="token mv" id="move-src-237" data-title="type_cast_expression/call_argument">1</span>)</span> &lt;&lt; RESOLUTION</span>;</span>
    <span class="marker" id="mapping-827"></span><span class="token del" data-title="contract_body/state_variable_declaration">uint private constant Q224 = Q112 &lt;&lt; RESOLUTION;</span>

    // encode a uint112 as a UQ112x112
    <span class="marker" id="mapping-828"></span><span class="token del" data-title="contract_body/function_definition">function encode(<span class="marker" id="mapping-829"></span><span class="token del" data-title="function_definition/parameter">uint112 x</span>) <span class="marker" id="mapping-830"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-831"></span><span class="token mv" id="move-src-238" data-title="function_definition/state_mutability">pure</span> <span class="marker" id="mapping-832"></span><span class="token del" data-title="function_definition/return_type_definition">returns (uq112x112 memory)</span> <span class="marker" id="mapping-833"></span><span class="token del" data-title="function_definition/function_body">{
        return uq112x112(uint224(x) &lt;&lt; RESOLUTION);
    }</span></span>

    // encodes a uint144 as a UQ144x112
    <span class="marker" id="mapping-834"></span><span class="token del" data-title="contract_body/function_definition">function encode144(uint144 x) internal pure returns (uq144x112 memory) {
        return uq144x112(uint256(x) &lt;&lt; RESOLUTION);
    }</span>

    // divide a UQ112x112 by a uint112, returning a UQ112x112
    <span class="marker" id="mapping-835"></span><span class="token del" data-title="contract_body/function_definition">function div(uq112x112 memory self, uint112 x) internal pure returns (uq112x112 memory) {
        require(x != 0, 'FixedPoint: DIV_BY_ZERO');
        return uq112x112(self._x / uint224(x));
    }</span>

    // multiply a UQ112x112 by a uint, returning a UQ144x112
    // reverts on overflow
    <span class="marker" id="mapping-836"></span><span class="token del" data-title="contract_body/function_definition">function mul(<span class="marker" id="mapping-837"></span><span class="token del" data-title="function_definition/parameter">uq112x112 memory self</span>, <span class="marker" id="mapping-838"></span><span class="token del" data-title="function_definition/parameter">uint y</span>) <span class="marker" id="mapping-839"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-840"></span><span class="token del" data-title="function_definition/state_mutability">pure</span> <span class="marker" id="mapping-841"></span><span class="token del" data-title="function_definition/return_type_definition">returns (uq144x112 memory)</span> <span class="marker" id="mapping-842"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-843"></span><span class="token mv" id="move-src-239" data-title="function_body/variable_declaration_statement">uint <span class="marker" id="mapping-844"></span><span class="token upd" id="move-src-240" data-title="variable_declaration/identifier">z</span>;</span>
        <span class="marker" id="mapping-845"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-846"></span><span class="token del" data-title="expression_statement/call_expression">require(<span class="marker" id="mapping-847"></span><span class="token del" data-title="call_expression/call_argument">y == 0 || (z = uint(self._x) * y) / y == uint(self._x)</span>, <span class="marker" id="mapping-848"></span><span class="token mv" id="move-src-241" data-title="call_expression/call_argument">"FixedPoint: MULTIPLICATION_OVERFLOW"</span>)</span>;</span>
        <span class="marker" id="mapping-849"></span><span class="token del" data-title="function_body/return_statement">return uq144x112(z);</span>
    }</span></span>

    // returns a UQ112x112 which represents the ratio of the numerator to the denominator
    // equivalent to encode(numerator).div(denominator)
    <span class="marker" id="mapping-850"></span><span class="token del" data-title="contract_body/function_definition">function fraction(<span class="marker" id="mapping-851"></span><span class="token del" data-title="function_definition/parameter">uint112 numerator</span>, <span class="marker" id="mapping-852"></span><span class="token del" data-title="function_definition/parameter">uint112 denominator</span>) <span class="marker" id="mapping-853"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-854"></span><span class="token del" data-title="function_definition/state_mutability">pure</span> <span class="marker" id="mapping-855"></span><span class="token del" data-title="function_definition/return_type_definition">returns (uq112x112 memory)</span> <span class="marker" id="mapping-856"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-857"></span><span class="token mv" id="move-src-242" data-title="function_body/expression_statement"><span class="marker" id="mapping-858"></span><span class="token upd" id="move-src-243" data-title="call_expression/identifier">r<span class="cupd">e</span>qui<span class="cupd">re</span></span>(<span class="marker" id="mapping-859"></span><span class="token mv" id="move-src-244" data-title="call_expression/call_argument"><span class="marker" id="mapping-860"></span><span class="token del" data-title="call_argument/binary_expression">denominator &gt; 0</span></span>, "FixedPoint: DIV_BY_ZERO");</span>
        <span class="marker" id="mapping-861"></span><span class="token del" data-title="function_body/return_statement">return uq112x112((uint224(numerator) &lt;&lt; RESOLUTION) / denominator);</span>
    }</span></span>

    // decode a UQ112x112 into a uint112 by truncating after the radix point
    <span class="marker" id="mapping-862"></span><span class="token del" data-title="contract_body/function_definition">function decode(uq112x112 memory self) internal pure returns (uint112) {
        return uint112(self._x &gt;&gt; RESOLUTION);
    }</span>

    // decode a UQ144x112 into a uint144 by truncating after the radix point
    <span class="marker" id="mapping-863"></span><span class="token del" data-title="contract_body/function_definition">function decode144(uq144x112 memory self) internal pure returns (uint144) {
        return uint144(self._x &gt;&gt; RESOLUTION);
    }</span>

    // take the reciprocal of a UQ112x112
    <span class="marker" id="mapping-864"></span><span class="token del" data-title="contract_body/function_definition">function reciprocal(uq112x112 memory self) internal pure returns (uq112x112 memory) {
        require(self._x != 0, 'FixedPoint: ZERO_RECIPROCAL');
        return uq112x112(uint224(Q224 / self._x));
    }</span>

    // square root of a UQ112x112
    <span class="marker" id="mapping-865"></span><span class="token del" data-title="contract_body/function_definition">function sqrt(uq112x112 memory self) internal pure returns (uq112x112 memory) {
        return uq112x112(uint224(Babylonian.sqrt(uint256(self._x)) &lt;&lt; 56));
    }</span>
}</span></span>

<span class="marker" id="mapping-866"></span><span class="token del" data-title="source_file/comment">// library with helper methods for oracles that are concerned with computing average prices</span>
<span class="marker" id="mapping-867"></span><span class="token del" data-title="source_file/library_declaration">library UniswapV2OracleLibrary <span class="marker" id="mapping-868"></span><span class="token del" data-title="library_declaration/contract_body">{
    <span class="marker" id="mapping-869"></span><span class="token del" data-title="contract_body/using_directive">using FixedPoint for *;</span>

    // helper function that returns the current block timestamp within the range of uint32, i.e. [0, 2**32 - 1]
    <span class="marker" id="mapping-870"></span><span class="token del" data-title="contract_body/function_definition">function currentBlockTimestamp() <span class="marker" id="mapping-871"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-872"></span><span class="token del" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-873"></span><span class="token del" data-title="function_definition/return_type_definition">returns (uint32)</span> <span class="marker" id="mapping-874"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-875"></span><span class="token del" data-title="function_body/return_statement">return <span class="marker" id="mapping-876"></span><span class="token del" data-title="return_statement/type_cast_expression"><span class="marker" id="mapping-877"></span><span class="token del" data-title="type_cast_expression/primitive_type">uint32</span>(<span class="marker" id="mapping-878"></span><span class="token mv" id="move-src-245" data-title="type_cast_expression/call_argument"><span class="marker" id="mapping-879"></span><span class="token del" data-title="call_argument/binary_expression"><span class="marker" id="mapping-880"></span><span class="token mv" id="move-src-246" data-title="binary_expression/member_expression">block.timestamp</span> % <span class="marker" id="mapping-881"></span><span class="token del" data-title="binary_expression/binary_expression">2 ** 32</span></span></span>)</span>;</span>
    }</span></span>

    // produces the cumulative price using counterfactuals to save gas and avoid a call to sync.
    <span class="marker" id="mapping-882"></span><span class="token del" data-title="contract_body/function_definition">function currentCumulativePrices(address pair)
    internal
    view
    returns (uint price0Cumulative, uint price1Cumulative, uint32 blockTimestamp) {
        blockTimestamp = currentBlockTimestamp();
        price0Cumulative = IUniswapV2Pair(pair).price0CumulativeLast();
        price1Cumulative = IUniswapV2Pair(pair).price1CumulativeLast();

        // if time has elapsed since the last update on the pair, mock the accumulated price values
        (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast) = IUniswapV2Pair(pair).getReserves();
        if (blockTimestampLast != blockTimestamp) {
            // subtraction overflow is desired
            uint32 timeElapsed = blockTimestamp - blockTimestampLast;
            // addition overflow is desired
            // counterfactual
            price0Cumulative += uint(FixedPoint.fraction(reserve1, reserve0)._x) * timeElapsed;
            // counterfactual
            price1Cumulative += uint(FixedPoint.fraction(reserve0, reserve1)._x) * timeElapsed;
        }
    }</span>
}</span></span>

<span class="marker" id="mapping-883"></span><span class="token del" data-title="source_file/library_declaration">library UniswapV2Library {
    using SafeMath for uint;

    // returns sorted token addresses, used to handle return values from pairs sorted in this order
    function sortTokens(address tokenA, address tokenB) internal pure returns (address token0, address token1) {
        require(tokenA != tokenB, 'UniswapV2Library: IDENTICAL_ADDRESSES');
        (token0, token1) = tokenA &lt; tokenB ? (tokenA, tokenB) : (tokenB, tokenA);
        require(token0 != address(0), 'UniswapV2Library: ZERO_ADDRESS');
    }

    // calculates the CREATE2 address for a pair without making any external calls
    function pairFor(address factory, address tokenA, address tokenB) internal pure returns (address pair) {
        (address token0, address token1) = sortTokens(tokenA, tokenB);
        pair = address(uint(keccak256(abi.encodePacked(
                hex'ff',
                factory,
                keccak256(abi.encodePacked(token0, token1)),
                hex'96e8ac4277198ff8b6f785478aa9a39f403cb768dd02cbee326c3e7da348845f' // init code hash
            ))));
    }

    // fetches and sorts the reserves for a pair
    function getReserves(address factory, address tokenA, address tokenB) internal view returns (uint reserveA, uint reserveB) {
        (address token0,) = sortTokens(tokenA, tokenB);
        (uint reserve0, uint reserve1,) = IUniswapV2Pair(pairFor(factory, tokenA, tokenB)).getReserves();
        (reserveA, reserveB) = tokenA == token0 ? (reserve0, reserve1) : (reserve1, reserve0);
    }

    // given some amount of an asset and pair reserves, returns an equivalent amount of the other asset
    function quote(uint amountA, uint reserveA, uint reserveB) internal pure returns (uint amountB) {
        require(amountA &gt; 0, 'UniswapV2Library: INSUFFICIENT_AMOUNT');
        require(reserveA &gt; 0 &amp;&amp; reserveB &gt; 0, 'UniswapV2Library: INSUFFICIENT_LIQUIDITY');
        amountB = amountA.mul(reserveB) / reserveA;
    }
}</span>

<span class="marker" id="mapping-884"></span><span class="token mv" id="move-src-247" data-title="source_file/comment">/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/</span>
contract IOracle {
    function setup() public;
    function capture() public returns (Decimal.D256 memory, bool);
    function pair() external view returns (address);
}

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
<span class="marker" id="mapping-885"></span><span class="token mv" id="move-src-248" data-title="source_file/contract_declaration">contract <span class="marker" id="mapping-886"></span><span class="token upd" id="move-src-249" data-title="contract_declaration/identifier">Oracle</span> is <span class="marker" id="mapping-887"></span><span class="token upd" id="move-src-250" data-title="user_defined_type/identifier">IO<span class="cupd">r</span>ac<span class="cupd">l</span>e</span> {
    using Decimal for Decimal.D256;

    <span class="marker" id="mapping-888"></span><span class="token mv" id="move-src-251" data-title="contract_body/state_variable_declaration">bytes32 private constant FILE = "Oracle";</span>
    <span class="marker" id="mapping-889"></span><span class="token del" data-title="contract_body/state_variable_declaration">address private constant UNISWAP_FACTORY = address(0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f);</span>

    <span class="marker" id="mapping-890"></span><span class="token del" data-title="contract_body/state_variable_declaration">address internal _dao;</span>
    <span class="marker" id="mapping-891"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-892"></span><span class="token mv" id="move-src-252" data-title="state_variable_declaration/type_name">address</span> <span class="marker" id="mapping-893"></span><span class="token del" data-title="state_variable_declaration/visibility">internal</span> _dollar;</span>

    <span class="marker" id="mapping-894"></span><span class="token del" data-title="contract_body/state_variable_declaration">bool internal _initialized;</span>
    <span class="marker" id="mapping-895"></span><span class="token del" data-title="contract_body/state_variable_declaration">IUniswapV2Pair internal _pair;</span>
    <span class="marker" id="mapping-896"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-897"></span><span class="token mv" id="move-src-253" data-title="state_variable_declaration/type_name">uint256</span> <span class="marker" id="mapping-898"></span><span class="token del" data-title="state_variable_declaration/visibility">internal</span> _index;</span>
    <span class="marker" id="mapping-899"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-900"></span><span class="token mv" id="move-src-254" data-title="state_variable_declaration/type_name">uint256</span> <span class="marker" id="mapping-901"></span><span class="token del" data-title="state_variable_declaration/visibility">internal</span> _cumulative;</span>
    <span class="marker" id="mapping-902"></span><span class="token del" data-title="contract_body/state_variable_declaration">uint32 internal _timestamp;</span>

    <span class="marker" id="mapping-903"></span><span class="token del" data-title="contract_body/state_variable_declaration"><span class="marker" id="mapping-904"></span><span class="token mv" id="move-src-255" data-title="state_variable_declaration/type_name">uint256</span> <span class="marker" id="mapping-905"></span><span class="token del" data-title="state_variable_declaration/visibility">internal</span> _reserve;</span>

    <span class="marker" id="mapping-906"></span><span class="token del" data-title="contract_body/constructor_definition">constructor (address dollar) public {
        _dao = msg.sender;
        _dollar = dollar;
    }</span>

    <span class="marker" id="mapping-907"></span><span class="token del" data-title="contract_body/function_definition">function setup() <span class="marker" id="mapping-908"></span><span class="token del" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-909"></span><span class="token del" data-title="function_definition/modifier_invocation">onlyDao</span> <span class="marker" id="mapping-910"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-911"></span><span class="token del" data-title="function_body/expression_statement">_pair = IUniswapV2Pair(IUniswapV2Factory(UNISWAP_FACTORY).createPair(_dollar, dai()));</span>

        <span class="marker" id="mapping-912"></span><span class="token del" data-title="function_body/variable_declaration_statement">(address token0, address token1) = (_pair.token0(), _pair.token1());</span>
        <span class="marker" id="mapping-913"></span><span class="token del" data-title="function_body/expression_statement">_index = _dollar == token0 ? 0 : 1;</span>

        <span class="marker" id="mapping-914"></span><span class="token mv" id="move-src-256" data-title="function_body/expression_statement">Require.that(
            <span class="marker" id="mapping-915"></span><span class="token del" data-title="binary_expression/binary_expression">_index == 0</span> <span class="marker" id="mapping-916"></span><span class="token del" data-title="binary_expression/||">||</span> <span class="marker" id="mapping-917"></span><span class="token del" data-title="binary_expression/binary_expression">_dollar == token1</span>,
            FILE,
            "Døllar not found"
        );</span>
    }</span></span>

    <span class="marker" id="mapping-918"></span><span class="token del" data-title="contract_body/comment">/**
     * Trades/Liquidity: (1) Initializes reserve and blockTimestampLast (can calculate a price)
     *                   (2) Has non-zero cumulative prices
     *
     * Steps: (1) Captures a reference blockTimestampLast
     *        (2) First reported value
     */</span>
    <span class="marker" id="mapping-919"></span><span class="token mv" id="move-src-257" data-title="contract_body/function_definition">function <span class="marker" id="mapping-920"></span><span class="token upd" id="move-src-258" data-title="function_definition/identifier"><span class="cupd">c</span><span class="cupd">apture</span></span>() <span class="marker" id="mapping-921"></span><span class="token del" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-922"></span><span class="token del" data-title="function_definition/modifier_invocation">onlyDao</span> <span class="marker" id="mapping-923"></span><span class="token del" data-title="function_definition/return_type_definition">returns (<span class="marker" id="mapping-924"></span><span class="token mv" id="move-src-259" data-title="return_type_definition/parameter">Decimal.D256 memory</span>, <span class="marker" id="mapping-925"></span><span class="token del" data-title="return_type_definition/parameter">bool</span>)</span> {
        if (<span class="marker" id="mapping-926"></span><span class="token del" data-title="if_statement/identifier">_initialized</span>) <span class="marker" id="mapping-927"></span><span class="token del" data-title="if_statement/block_statement">{
            return updateOracle();
        }</span> <span class="marker" id="mapping-928"></span><span class="token del" data-title="if_statement/else">else</span> {
            <span class="marker" id="mapping-929"></span><span class="token del" data-title="block_statement/expression_statement">initializeOracle();</span>
            return <span class="marker" id="mapping-930"></span><span class="token del" data-title="return_statement/tuple_expression">(<span class="marker" id="mapping-931"></span><span class="token mv" id="move-src-260" data-title="tuple_expression/call_expression">Decimal.one()</span>, <span class="marker" id="mapping-932"></span><span class="token mv" id="move-src-261" data-title="tuple_expression/boolean_literal">false</span>)</span>;
        }
    }</span>

    <span class="marker" id="mapping-933"></span><span class="token del" data-title="contract_body/function_definition">function initializeOracle() <span class="marker" id="mapping-934"></span><span class="token mv" id="move-src-262" data-title="function_definition/visibility">private</span> <span class="marker" id="mapping-935"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-936"></span><span class="token del" data-title="function_body/variable_declaration_statement">IUniswapV2Pair pair = _pair;</span>
        <span class="marker" id="mapping-937"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-938"></span><span class="token mv" id="move-src-263" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-939"></span><span class="token upd" id="move-src-264" data-title="variable_declaration/identifier">pric<span class="cupd">e</span>Cumula<span class="cupd">t</span>ive</span></span> = <span class="marker" id="mapping-940"></span><span class="token del" data-title="variable_declaration_statement/ternary_expression">_index == 0 ?
            pair.price0CumulativeLast() :
            pair.price1CumulativeLast()</span>;</span>
        <span class="marker" id="mapping-941"></span><span class="token del" data-title="function_body/variable_declaration_statement">(uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast) = pair.getReserves();</span>
        <span class="marker" id="mapping-942"></span><span class="token del" data-title="function_body/if_statement">if(reserve0 != 0 &amp;&amp; reserve1 != 0 &amp;&amp; blockTimestampLast != 0) {
            _cumulative = priceCumulative;
            _timestamp = blockTimestampLast;
            _initialized = true;
            _reserve = _index == 0 ? reserve1 : reserve0; // get counter's reserve
        }</span>
    }</span></span>

    <span class="marker" id="mapping-943"></span><span class="token del" data-title="contract_body/function_definition">function updateOracle() <span class="marker" id="mapping-944"></span><span class="token mv" id="move-src-265" data-title="function_definition/visibility">private</span> <span class="marker" id="mapping-945"></span><span class="token del" data-title="function_definition/return_type_definition">returns (<span class="marker" id="mapping-946"></span><span class="token mv" id="move-src-266" data-title="return_type_definition/parameter">Decimal.D256 memory</span>, <span class="marker" id="mapping-947"></span><span class="token del" data-title="return_type_definition/parameter">bool</span>)</span> <span class="marker" id="mapping-948"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-949"></span><span class="token mv" id="move-src-267" data-title="function_body/variable_declaration_statement">Decimal.D256 memory price = <span class="marker" id="mapping-950"></span><span class="token upd" id="move-src-268" data-title="call_expression/identifier">u<span class="cupd">p</span>da<span class="cupd">t</span>eP<span class="cupd">r</span>ice</span>();</span>
        <span class="marker" id="mapping-951"></span><span class="token mv" id="move-src-269" data-title="function_body/variable_declaration_statement">uint256 <span class="marker" id="mapping-952"></span><span class="token upd" id="move-src-270" data-title="variable_declaration/identifier">lastReserve</span> = <span class="marker" id="mapping-953"></span><span class="token upd" id="move-src-271" data-title="call_expression/identifier">upd<span class="cupd">a</span>teReserve</span>();</span>

        <span class="marker" id="mapping-954"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-955"></span><span class="token mv" id="move-src-272" data-title="variable_declaration_statement/variable_declaration">bool valid</span> = <span class="marker" id="mapping-956"></span><span class="token del" data-title="variable_declaration_statement/boolean_literal">true</span>;</span>
        <span class="marker" id="mapping-957"></span><span class="token del" data-title="function_body/if_statement">if (lastReserve &lt; Constants.getOracleReserveMinimum()) {
            valid = false;
        }</span>
        <span class="marker" id="mapping-958"></span><span class="token del" data-title="function_body/if_statement">if (_reserve &lt; Constants.getOracleReserveMinimum()) {
            valid = false;
        }</span>

        <span class="marker" id="mapping-959"></span><span class="token del" data-title="function_body/return_statement">return (price, valid);</span>
    }</span></span>

    function <span class="marker" id="mapping-960"></span><span class="token upd" id="move-src-273" data-title="function_definition/identifier"><span class="cupd">up</span>datePrice</span>() <span class="marker" id="mapping-961"></span><span class="token mv" id="move-src-274" data-title="function_definition/visibility">private</span> <span class="marker" id="mapping-962"></span><span class="token mv" id="move-src-275" data-title="function_definition/return_type_definition">returns (Decimal.D256 memory)</span> {
        (uint256 <span class="marker" id="mapping-963"></span><span class="token upd" id="move-src-276" data-title="variable_declaration/identifier">pric<span class="cupd">e</span>0Cu<span class="cupd">m</span>u<span class="cupd">l</span>ative</span>, uint256 <span class="marker" id="mapping-964"></span><span class="token upd" id="move-src-277" data-title="variable_declaration/identifier">pric<span class="cupd">e</span>1Cumulative</span>, <span class="marker" id="mapping-965"></span><span class="token del" data-title="variable_declaration/type_name">uint32</span> <span class="marker" id="mapping-966"></span><span class="token upd" id="move-src-278" data-title="variable_declaration/identifier">bl<span class="cupd">o</span>ckTimestamp</span>) =
        <span class="marker" id="mapping-967"></span><span class="token del" data-title="call_expression/member_expression">UniswapV2OracleLibrary.currentCumulativePrices</span>(<span class="marker" id="mapping-968"></span><span class="token del" data-title="call_argument/type_cast_expression">address(_pair)</span>);
        <span class="marker" id="mapping-969"></span><span class="token del" data-title="function_body/variable_declaration_statement">uint32 timeElapsed = blockTimestamp - _timestamp;</span> <span class="marker" id="mapping-970"></span><span class="token del" data-title="function_body/comment">// overflow is desired</span>
        <span class="marker" id="mapping-971"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-972"></span><span class="token mv" id="move-src-279" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-973"></span><span class="token upd" id="move-src-280" data-title="variable_declaration/identifier">priceCumu<span class="cupd">la</span>tive</span></span> = <span class="marker" id="mapping-974"></span><span class="token del" data-title="variable_declaration_statement/ternary_expression">_index == 0 ? price0Cumulative : price1Cumulative</span>;</span>
        <span class="marker" id="mapping-975"></span><span class="token mv" id="move-src-281" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-976"></span><span class="token mv" id="move-src-282" data-title="variable_declaration_statement/variable_declaration">Decimal.D256 memory price</span> = <span class="marker" id="mapping-977"></span><span class="token mv" id="move-src-283" data-title="call_expression/member_expression">Decimal.ratio</span>(<span class="marker" id="mapping-978"></span><span class="token del" data-title="call_expression/call_argument">(priceCumulative - _cumulative) / timeElapsed</span><span class="marker" id="mapping-979"></span><span class="token del" data-title="call_expression/,">,</span> <span class="marker" id="mapping-980"></span><span class="token del" data-title="call_expression/call_argument">2**112</span>);</span>

        <span class="marker" id="mapping-981"></span><span class="token del" data-title="function_body/expression_statement">_timestamp = blockTimestamp;</span>
        <span class="marker" id="mapping-982"></span><span class="token del" data-title="function_body/expression_statement">_cumulative = priceCumulative;</span>

        <span class="marker" id="mapping-983"></span><span class="token mv" id="move-src-284" data-title="function_body/return_statement">return price;</span>
    }

    <span class="marker" id="mapping-984"></span><span class="token del" data-title="contract_body/function_definition">function updateReserve() <span class="marker" id="mapping-985"></span><span class="token mv" id="move-src-285" data-title="function_definition/visibility">private</span> <span class="marker" id="mapping-986"></span><span class="token del" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-987"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-988"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-989"></span><span class="token mv" id="move-src-286" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-990"></span><span class="token upd" id="move-src-287" data-title="variable_declaration/identifier">la<span class="cupd">st</span>Reserve</span></span> = _reserve;</span>
        <span class="marker" id="mapping-991"></span><span class="token del" data-title="function_body/variable_declaration_statement">(uint112 reserve0, uint112 reserve1,) = _pair.getReserves();</span>
        <span class="marker" id="mapping-992"></span><span class="token del" data-title="function_body/expression_statement">_reserve = _index == 0 ? reserve1 : reserve0;</span> // get counter's reserve

        <span class="marker" id="mapping-993"></span><span class="token del" data-title="function_body/return_statement">return lastReserve;</span>
    }</span></span>

    <span class="marker" id="mapping-994"></span><span class="token del" data-title="contract_body/function_definition">function dai() internal view returns (address) {
        return Constants.getDAIAddress();
    }</span>

    <span class="marker" id="mapping-995"></span><span class="token del" data-title="contract_body/function_definition">function pair() <span class="marker" id="mapping-996"></span><span class="token mv" id="move-src-288" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-997"></span><span class="token del" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-998"></span><span class="token del" data-title="function_definition/return_type_definition">returns (address)</span> <span class="marker" id="mapping-999"></span><span class="token del" data-title="function_definition/function_body">{
        return address(_pair);
    }</span></span>

    <span class="marker" id="mapping-1000"></span><span class="token del" data-title="contract_body/function_definition">function reserve() <span class="marker" id="mapping-1001"></span><span class="token mv" id="move-src-289" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-1002"></span><span class="token del" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-1003"></span><span class="token del" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-1004"></span><span class="token del" data-title="function_definition/function_body">{
        return _reserve;
    }</span></span>

    <span class="marker" id="mapping-1005"></span><span class="token del" data-title="contract_body/modifier_definition">modifier onlyDao() <span class="marker" id="mapping-1006"></span><span class="token del" data-title="modifier_definition/function_body">{
        <span class="marker" id="mapping-1007"></span><span class="token mv" id="move-src-290" data-title="function_body/expression_statement">Require.that(
            <span class="marker" id="mapping-1008"></span><span class="token del" data-title="call_argument/binary_expression">msg.sender == _dao</span>,
            FILE,
            "Not dao"
        );</span>

        <span class="marker" id="mapping-1009"></span><span class="token mv" id="move-src-291" data-title="function_body/expression_statement">_;</span>
    }</span></span>
}</span>

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
<span class="marker" id="mapping-1010"></span><span class="token del" data-title="source_file/contract_declaration">contract IDAO <span class="marker" id="mapping-1011"></span><span class="token del" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-1012"></span><span class="token del" data-title="contract_body/function_definition">function epoch() <span class="marker" id="mapping-1013"></span><span class="token mv" id="move-src-292" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-1014"></span><span class="token del" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-1015"></span><span class="token del" data-title="function_definition/return_type_definition">returns (uint256)</span>;</span>
}</span></span>

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
<span class="marker" id="mapping-1016"></span><span class="token del" data-title="source_file/contract_declaration">contract PoolAccount <span class="marker" id="mapping-1017"></span><span class="token del" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-1018"></span><span class="token del" data-title="contract_body/enum_declaration">enum Status {
        Frozen,
        Fluid,
        Locked
    }</span>

    <span class="marker" id="mapping-1019"></span><span class="token del" data-title="contract_body/struct_declaration">struct State {
        <span class="marker" id="mapping-1020"></span><span class="token del" data-title="struct_declaration/struct_member"><span class="marker" id="mapping-1021"></span><span class="token mv" id="move-src-293" data-title="struct_member/type_name">uint256</span> staged;</span>
        <span class="marker" id="mapping-1022"></span><span class="token del" data-title="struct_declaration/struct_member"><span class="marker" id="mapping-1023"></span><span class="token mv" id="move-src-294" data-title="struct_member/type_name">uint256</span> claimable;</span>
        <span class="marker" id="mapping-1024"></span><span class="token del" data-title="struct_declaration/struct_member"><span class="marker" id="mapping-1025"></span><span class="token mv" id="move-src-295" data-title="struct_member/type_name">uint256</span> bonded;</span>
        <span class="marker" id="mapping-1026"></span><span class="token del" data-title="struct_declaration/struct_member"><span class="marker" id="mapping-1027"></span><span class="token mv" id="move-src-296" data-title="struct_member/type_name">uint256</span> phantom;</span>
        <span class="marker" id="mapping-1028"></span><span class="token del" data-title="struct_declaration/struct_member"><span class="marker" id="mapping-1029"></span><span class="token mv" id="move-src-297" data-title="struct_member/type_name">uint256</span> fluidUntil;</span>
    }</span>
}</span></span>

<span class="marker" id="mapping-1030"></span><span class="token del" data-title="source_file/contract_declaration">contract PoolStorage <span class="marker" id="mapping-1031"></span><span class="token del" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-1032"></span><span class="token del" data-title="contract_body/struct_declaration">struct Provider {
        IDAO dao;
        IDollar dollar;
        IERC20 univ2;
    }</span>
    
    <span class="marker" id="mapping-1033"></span><span class="token del" data-title="contract_body/struct_declaration">struct Balance {
        <span class="marker" id="mapping-1034"></span><span class="token del" data-title="struct_declaration/struct_member"><span class="marker" id="mapping-1035"></span><span class="token mv" id="move-src-298" data-title="struct_member/type_name">uint256</span> staged;</span>
        <span class="marker" id="mapping-1036"></span><span class="token del" data-title="struct_declaration/struct_member"><span class="marker" id="mapping-1037"></span><span class="token mv" id="move-src-299" data-title="struct_member/type_name">uint256</span> claimable;</span>
        <span class="marker" id="mapping-1038"></span><span class="token del" data-title="struct_declaration/struct_member"><span class="marker" id="mapping-1039"></span><span class="token mv" id="move-src-300" data-title="struct_member/type_name">uint256</span> bonded;</span>
        <span class="marker" id="mapping-1040"></span><span class="token del" data-title="struct_declaration/struct_member"><span class="marker" id="mapping-1041"></span><span class="token mv" id="move-src-301" data-title="struct_member/type_name">uint256</span> phantom;</span>
    }</span>

    <span class="marker" id="mapping-1042"></span><span class="token del" data-title="contract_body/struct_declaration">struct State {
        Balance balance;
        Provider provider;

        bool paused;

        mapping(address =&gt; PoolAccount.State) accounts;
    }</span>
}</span></span>

<span class="marker" id="mapping-1043"></span><span class="token del" data-title="source_file/contract_declaration">contract PoolState {
    PoolStorage.State _state;
}</span>

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
<span class="marker" id="mapping-1044"></span><span class="token del" data-title="source_file/contract_declaration">contract PoolGetters is <span class="marker" id="mapping-1045"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">PoolState</span> <span class="marker" id="mapping-1046"></span><span class="token del" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-1047"></span><span class="token mv" id="move-src-302" data-title="contract_body/using_directive">using SafeMath for uint256;</span>

    /**
     * Global
     */

    <span class="marker" id="mapping-1048"></span><span class="token del" data-title="contract_body/function_definition">function dai() public view returns (address) {
        return Constants.getDAIAddress();
    }</span>

    <span class="marker" id="mapping-1049"></span><span class="token del" data-title="contract_body/function_definition">function dao() public view returns (IDAO) {
        return _state.provider.dao;
    }</span>

    <span class="marker" id="mapping-1050"></span><span class="token del" data-title="contract_body/function_definition">function dollar() public view returns (IDollar) {
        return _state.provider.dollar;
    }</span>

    <span class="marker" id="mapping-1051"></span><span class="token del" data-title="contract_body/function_definition">function univ2() public view returns (IERC20) {
        return _state.provider.univ2;
    }</span>

    <span class="marker" id="mapping-1052"></span><span class="token del" data-title="contract_body/function_definition">function totalBonded() public view returns (uint256) {
        return _state.balance.bonded;
    }</span>

    <span class="marker" id="mapping-1053"></span><span class="token del" data-title="contract_body/function_definition">function totalStaged() public view returns (uint256) {
        return _state.balance.staged;
    }</span>

    <span class="marker" id="mapping-1054"></span><span class="token del" data-title="contract_body/function_definition">function totalClaimable() public view returns (uint256) {
        return _state.balance.claimable;
    }</span>

    <span class="marker" id="mapping-1055"></span><span class="token del" data-title="contract_body/function_definition">function totalPhantom() public view returns (uint256) {
        return _state.balance.phantom;
    }</span>

    <span class="marker" id="mapping-1056"></span><span class="token mv" id="move-src-303" data-title="contract_body/function_definition">function <span class="marker" id="mapping-1057"></span><span class="token upd" id="move-src-304" data-title="function_definition/identifier">t<span class="cupd">o</span>talRewarded</span>() <span class="marker" id="mapping-1058"></span><span class="token del" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-1059"></span><span class="token del" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-1060"></span><span class="token del" data-title="function_definition/return_type_definition">returns (uint256)</span> {
        <span class="marker" id="mapping-1061"></span><span class="token del" data-title="function_body/return_statement">return <span class="marker" id="mapping-1062"></span><span class="token mv" id="move-src-305" data-title="return_statement/call_expression">dollar().balanceOf(address(this)).sub(<span class="marker" id="mapping-1063"></span><span class="token del" data-title="call_argument/call_expression">totalClaimable()</span>)</span>;</span>
    }</span>

    <span class="marker" id="mapping-1064"></span><span class="token del" data-title="contract_body/function_definition">function paused() <span class="marker" id="mapping-1065"></span><span class="token del" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-1066"></span><span class="token mv" id="move-src-306" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-1067"></span><span class="token mv" id="move-src-307" data-title="function_definition/return_type_definition">returns (bool)</span> <span class="marker" id="mapping-1068"></span><span class="token del" data-title="function_definition/function_body">{
        return _state.paused;
    }</span></span>

    /**
     * Account
     */

    <span class="marker" id="mapping-1069"></span><span class="token del" data-title="contract_body/function_definition">function balanceOfStaged(<span class="marker" id="mapping-1070"></span><span class="token mv" id="move-src-308" data-title="function_definition/parameter">address account</span>) <span class="marker" id="mapping-1071"></span><span class="token del" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-1072"></span><span class="token del" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-1073"></span><span class="token del" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-1074"></span><span class="token del" data-title="function_definition/function_body">{
        return _state.accounts[account].staged;
    }</span></span>

    <span class="marker" id="mapping-1075"></span><span class="token del" data-title="contract_body/function_definition">function balanceOfClaimable(address account) public view returns (uint256) {
        return _state.accounts[account].claimable;
    }</span>

    <span class="marker" id="mapping-1076"></span><span class="token del" data-title="contract_body/function_definition">function balanceOfBonded(address account) public view returns (uint256) {
        return _state.accounts[account].bonded;
    }</span>

    <span class="marker" id="mapping-1077"></span><span class="token del" data-title="contract_body/function_definition">function balanceOfPhantom(address account) public view returns (uint256) {
        return _state.accounts[account].phantom;
    }</span>

    <span class="marker" id="mapping-1078"></span><span class="token del" data-title="contract_body/function_definition">function balanceOfRewarded(<span class="marker" id="mapping-1079"></span><span class="token del" data-title="function_definition/parameter">address account</span>) <span class="marker" id="mapping-1080"></span><span class="token mv" id="move-src-309" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-1081"></span><span class="token mv" id="move-src-310" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-1082"></span><span class="token mv" id="move-src-311" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-1083"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1084"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1085"></span><span class="token mv" id="move-src-312" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-1086"></span><span class="token upd" id="move-src-313" data-title="variable_declaration/identifier">tot<span class="cupd">al</span>Bo<span class="cupd">n</span>ded</span></span> = <span class="marker" id="mapping-1087"></span><span class="token mv" id="move-src-314" data-title="variable_declaration_statement/call_expression">totalBonded()</span>;</span>
        <span class="marker" id="mapping-1088"></span><span class="token mv" id="move-src-315" data-title="function_body/if_statement">if (<span class="marker" id="mapping-1089"></span><span class="token upd" id="move-src-316" data-title="binary_expression/identifier"><span class="cupd">t</span>o<span class="cupd">t</span>alBonded</span> <span class="marker" id="mapping-1090"></span><span class="token del" data-title="binary_expression/==">==</span> <span class="marker" id="mapping-1091"></span><span class="token del" data-title="binary_expression/number_literal">0</span>) {
            return 0;
        }</span>

        <span class="marker" id="mapping-1092"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1093"></span><span class="token mv" id="move-src-317" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-1094"></span><span class="token upd" id="move-src-318" data-title="variable_declaration/identifier">totalRewar<span class="cupd">de</span>dW<span class="cupd">it</span>hPha<span class="cupd">nt</span>om</span></span> = <span class="marker" id="mapping-1095"></span><span class="token del" data-title="variable_declaration_statement/call_expression">totalRewarded().add(totalPhantom())</span>;</span>
        <span class="marker" id="mapping-1096"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1097"></span><span class="token mv" id="move-src-319" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-1098"></span><span class="token upd" id="move-src-320" data-title="variable_declaration/identifier"><span class="cupd">balance</span>O<span class="cupd">f</span>Rewa<span class="cupd">r</span>d<span class="cupd">e</span>dW<span class="cupd">it</span>hPhantom</span></span> = <span class="marker" id="mapping-1099"></span><span class="token del" data-title="variable_declaration_statement/call_expression"><span class="marker" id="mapping-1100"></span><span class="token del" data-title="call_expression/member_expression"><span class="marker" id="mapping-1101"></span><span class="token del" data-title="member_expression/call_expression"><span class="marker" id="mapping-1102"></span><span class="token del" data-title="call_expression/member_expression">totalRewardedWithPhantom
            .mul</span>(<span class="marker" id="mapping-1103"></span><span class="token del" data-title="call_expression/call_argument"><span class="marker" id="mapping-1104"></span><span class="token del" data-title="call_argument/call_expression">balanceOfBonded(<span class="marker" id="mapping-1105"></span><span class="token mv" id="move-src-321" data-title="call_expression/call_argument">account</span>)</span></span>)</span>
            .div</span>(<span class="marker" id="mapping-1106"></span><span class="token del" data-title="call_expression/call_argument">totalBonded</span>)</span>;</span>

        <span class="marker" id="mapping-1107"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1108"></span><span class="token mv" id="move-src-322" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-1109"></span><span class="token upd" id="move-src-323" data-title="variable_declaration/identifier">bala<span class="cupd">n</span>ceOfPhantom</span></span> = <span class="marker" id="mapping-1110"></span><span class="token del" data-title="variable_declaration_statement/call_expression">balanceOfPhantom(<span class="marker" id="mapping-1111"></span><span class="token mv" id="move-src-324" data-title="call_expression/call_argument">account</span>)</span>;</span>
        <span class="marker" id="mapping-1112"></span><span class="token del" data-title="function_body/if_statement">if (balanceOfRewardedWithPhantom &gt; balanceOfPhantom) {
            return balanceOfRewardedWithPhantom.sub(balanceOfPhantom);
        }</span>
        <span class="marker" id="mapping-1113"></span><span class="token del" data-title="function_body/return_statement">return 0;</span>
    }</span></span>

    <span class="marker" id="mapping-1114"></span><span class="token del" data-title="contract_body/function_definition">function statusOf(<span class="marker" id="mapping-1115"></span><span class="token del" data-title="function_definition/parameter">address account</span>) <span class="marker" id="mapping-1116"></span><span class="token del" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-1117"></span><span class="token del" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-1118"></span><span class="token del" data-title="function_definition/return_type_definition">returns (PoolAccount.Status)</span> <span class="marker" id="mapping-1119"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1120"></span><span class="token del" data-title="function_body/return_statement">return <span class="marker" id="mapping-1121"></span><span class="token del" data-title="return_statement/member_expression"><span class="marker" id="mapping-1122"></span><span class="token del" data-title="member_expression/ternary_expression"><span class="marker" id="mapping-1123"></span><span class="token del" data-title="ternary_expression/member_expression"><span class="marker" id="mapping-1124"></span><span class="token del" data-title="member_expression/array_access"><span class="marker" id="mapping-1125"></span><span class="token mv" id="move-src-325" data-title="array_access/binary_expression">epoch() <span class="marker" id="mapping-1126"></span><span class="token del" data-title="binary_expression/>=">&gt;=</span> <span class="marker" id="mapping-1127"></span><span class="token del" data-title="binary_expression/member_expression">_state.accounts</span></span>[account]</span>.fluidUntil</span> ?
            <span class="marker" id="mapping-1128"></span><span class="token del" data-title="ternary_expression/member_expression">PoolAccount.Status.Frozen</span> :
            <span class="marker" id="mapping-1129"></span><span class="token del" data-title="ternary_expression/member_expression">PoolAccount.Status</span></span>.Fluid</span>;</span>
    }</span></span>

    /**
     * Epoch
     */

    <span class="marker" id="mapping-1130"></span><span class="token del" data-title="contract_body/function_definition">function epoch() internal view returns (uint256) {
        return dao().epoch();
    }</span>
}</span></span>

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
<span class="marker" id="mapping-1131"></span><span class="token del" data-title="source_file/contract_declaration">contract PoolSetters is <span class="marker" id="mapping-1132"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">PoolState</span>, <span class="marker" id="mapping-1133"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">PoolGetters</span> <span class="marker" id="mapping-1134"></span><span class="token del" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-1135"></span><span class="token mv" id="move-src-326" data-title="contract_body/using_directive">using SafeMath for uint256;</span>

    /**
     * Global
     */

    <span class="marker" id="mapping-1136"></span><span class="token del" data-title="contract_body/function_definition">function pause() internal {
        _state.paused = true;
    }</span>

    /**
     * Account
     */

    <span class="marker" id="mapping-1137"></span><span class="token del" data-title="contract_body/function_definition">function incrementBalanceOfBonded(<span class="marker" id="mapping-1138"></span><span class="token del" data-title="function_definition/parameter">address account</span>, <span class="marker" id="mapping-1139"></span><span class="token del" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-1140"></span><span class="token mv" id="move-src-327" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-1141"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1142"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-1143"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-1144"></span><span class="token del" data-title="assignment_expression/member_expression">_state.accounts[account].bonded</span> = <span class="marker" id="mapping-1145"></span><span class="token del" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-1146"></span><span class="token del" data-title="call_expression/member_expression">_state.accounts[account].bonded.add</span>(<span class="marker" id="mapping-1147"></span><span class="token mv" id="move-src-328" data-title="call_expression/call_argument">amount</span>)</span></span>;</span>
        <span class="marker" id="mapping-1148"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-1149"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-1150"></span><span class="token del" data-title="assignment_expression/member_expression">_state.balance.bonded</span> = <span class="marker" id="mapping-1151"></span><span class="token del" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-1152"></span><span class="token del" data-title="call_expression/member_expression">_state.balance.bonded.add</span>(<span class="marker" id="mapping-1153"></span><span class="token mv" id="move-src-329" data-title="call_expression/call_argument">amount</span>)</span></span>;</span>
    }</span></span>

    <span class="marker" id="mapping-1154"></span><span class="token del" data-title="contract_body/function_definition">function decrementBalanceOfBonded(<span class="marker" id="mapping-1155"></span><span class="token del" data-title="function_definition/parameter">address account</span>, <span class="marker" id="mapping-1156"></span><span class="token del" data-title="function_definition/parameter">uint256 amount</span>, <span class="marker" id="mapping-1157"></span><span class="token del" data-title="function_definition/parameter">string memory reason</span>) <span class="marker" id="mapping-1158"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-1159"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1160"></span><span class="token del" data-title="function_body/expression_statement">_state.accounts[account].bonded = _state.accounts[account].bonded.sub(amount, reason);</span>
        <span class="marker" id="mapping-1161"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-1162"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-1163"></span><span class="token del" data-title="assignment_expression/member_expression">_state.balance.bonded</span> = <span class="marker" id="mapping-1164"></span><span class="token del" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-1165"></span><span class="token del" data-title="call_expression/member_expression">_state.balance.bonded.sub</span>(<span class="marker" id="mapping-1166"></span><span class="token mv" id="move-src-330" data-title="call_expression/call_argument">amount</span>, <span class="marker" id="mapping-1167"></span><span class="token del" data-title="call_expression/call_argument">reason</span>)</span></span>;</span>
    }</span></span>

    <span class="marker" id="mapping-1168"></span><span class="token del" data-title="contract_body/function_definition">function incrementBalanceOfStaged(<span class="marker" id="mapping-1169"></span><span class="token del" data-title="function_definition/parameter">address account</span>, <span class="marker" id="mapping-1170"></span><span class="token del" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-1171"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-1172"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1173"></span><span class="token del" data-title="function_body/expression_statement">_state.accounts[account].staged = _state.accounts[account].staged.add(amount);</span>
        <span class="marker" id="mapping-1174"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-1175"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-1176"></span><span class="token del" data-title="assignment_expression/member_expression">_state.balance.staged</span> = <span class="marker" id="mapping-1177"></span><span class="token del" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-1178"></span><span class="token del" data-title="call_expression/member_expression">_state.balance.staged.add</span>(<span class="marker" id="mapping-1179"></span><span class="token mv" id="move-src-331" data-title="call_expression/call_argument">amount</span>)</span></span>;</span>
    }</span></span>

    <span class="marker" id="mapping-1180"></span><span class="token del" data-title="contract_body/function_definition">function decrementBalanceOfStaged(<span class="marker" id="mapping-1181"></span><span class="token del" data-title="function_definition/parameter">address account</span>, <span class="marker" id="mapping-1182"></span><span class="token del" data-title="function_definition/parameter">uint256 amount</span>, <span class="marker" id="mapping-1183"></span><span class="token del" data-title="function_definition/parameter">string memory reason</span>) <span class="marker" id="mapping-1184"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-1185"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1186"></span><span class="token del" data-title="function_body/expression_statement">_state.accounts[account].staged = _state.accounts[account].staged.sub(amount, reason);</span>
        <span class="marker" id="mapping-1187"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-1188"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-1189"></span><span class="token del" data-title="assignment_expression/member_expression">_state.balance.staged</span> = <span class="marker" id="mapping-1190"></span><span class="token del" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-1191"></span><span class="token del" data-title="call_expression/member_expression">_state.balance.staged.sub</span>(<span class="marker" id="mapping-1192"></span><span class="token mv" id="move-src-332" data-title="call_expression/call_argument">amount</span>, <span class="marker" id="mapping-1193"></span><span class="token del" data-title="call_expression/call_argument">reason</span>)</span></span>;</span>
    }</span></span>

    <span class="marker" id="mapping-1194"></span><span class="token del" data-title="contract_body/function_definition">function incrementBalanceOfClaimable(address account, uint256 amount) internal {
        _state.accounts[account].claimable = _state.accounts[account].claimable.add(amount);
        _state.balance.claimable = _state.balance.claimable.add(amount);
    }</span>

    <span class="marker" id="mapping-1195"></span><span class="token del" data-title="contract_body/function_definition">function decrementBalanceOfClaimable(address account, uint256 amount, string memory reason) internal {
        _state.accounts[account].claimable = _state.accounts[account].claimable.sub(amount, reason);
        _state.balance.claimable = _state.balance.claimable.sub(amount, reason);
    }</span>

    <span class="marker" id="mapping-1196"></span><span class="token del" data-title="contract_body/function_definition">function incrementBalanceOfPhantom(address account, uint256 amount) internal {
        _state.accounts[account].phantom = _state.accounts[account].phantom.add(amount);
        _state.balance.phantom = _state.balance.phantom.add(amount);
    }</span>

    <span class="marker" id="mapping-1197"></span><span class="token del" data-title="contract_body/function_definition">function decrementBalanceOfPhantom(address account, uint256 amount, string memory reason) internal {
        _state.accounts[account].phantom = _state.accounts[account].phantom.sub(amount, reason);
        _state.balance.phantom = _state.balance.phantom.sub(amount, reason);
    }</span>

    <span class="marker" id="mapping-1198"></span><span class="token mv" id="move-src-333" data-title="contract_body/function_definition">function <span class="marker" id="mapping-1199"></span><span class="token upd" id="move-src-334" data-title="function_definition/identifier">unfreeze</span>(<span class="marker" id="mapping-1200"></span><span class="token del" data-title="function_definition/parameter">address account</span>) internal {
        <span class="marker" id="mapping-1201"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-1202"></span><span class="token del" data-title="assignment_expression/member_expression">_state.accounts[account].fluidUntil</span> = <span class="marker" id="mapping-1203"></span><span class="token mv" id="move-src-335" data-title="assignment_expression/call_expression">epoch().add(Constants.<span class="marker" id="mapping-1204"></span><span class="token upd" id="move-src-336" data-title="member_expression/identifier"><span class="cupd">get</span>P<span class="cupd">o</span><span class="cupd">o</span>l<span class="cupd">Ex</span><span class="cupd">i</span><span class="cupd">t</span>LockupEpochs</span>())</span></span>;
    }</span>
}</span></span>

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
<span class="marker" id="mapping-1205"></span><span class="token del" data-title="source_file/contract_declaration">contract Liquidity is <span class="marker" id="mapping-1206"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">PoolGetters</span> <span class="marker" id="mapping-1207"></span><span class="token del" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-1208"></span><span class="token del" data-title="contract_body/state_variable_declaration">address private constant UNISWAP_FACTORY = address(0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f);</span>

    <span class="marker" id="mapping-1209"></span><span class="token del" data-title="contract_body/function_definition">function addLiquidity(<span class="marker" id="mapping-1210"></span><span class="token mv" id="move-src-337" data-title="function_definition/parameter">uint256 dollarAmount</span>) <span class="marker" id="mapping-1211"></span><span class="token mv" id="move-src-338" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-1212"></span><span class="token mv" id="move-src-339" data-title="function_definition/return_type_definition">returns (uint256, uint256)</span> <span class="marker" id="mapping-1213"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1214"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1215"></span><span class="token del" data-title="variable_declaration_statement/variable_declaration_tuple">(address dollar, address dai)</span> = <span class="marker" id="mapping-1216"></span><span class="token del" data-title="variable_declaration_statement/tuple_expression">(<span class="marker" id="mapping-1217"></span><span class="token del" data-title="tuple_expression/type_cast_expression"><span class="marker" id="mapping-1218"></span><span class="token del" data-title="type_cast_expression/primitive_type">address</span>(<span class="marker" id="mapping-1219"></span><span class="token del" data-title="type_cast_expression/call_argument"><span class="marker" id="mapping-1220"></span><span class="token mv" id="move-src-340" data-title="call_argument/call_expression">dollar()</span></span>)</span>, <span class="marker" id="mapping-1221"></span><span class="token del" data-title="tuple_expression/call_expression">dai()</span>)</span>;</span>
        <span class="marker" id="mapping-1222"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1223"></span><span class="token del" data-title="variable_declaration_statement/variable_declaration_tuple">(<span class="marker" id="mapping-1224"></span><span class="token mv" id="move-src-341" data-title="variable_declaration_tuple/variable_declaration">uint <span class="marker" id="mapping-1225"></span><span class="token upd" id="move-src-342" data-title="variable_declaration/identifier">reserveA</span></span>, <span class="marker" id="mapping-1226"></span><span class="token mv" id="move-src-343" data-title="variable_declaration_tuple/variable_declaration">uint <span class="marker" id="mapping-1227"></span><span class="token upd" id="move-src-344" data-title="variable_declaration/identifier">reserveB</span></span>)</span> = <span class="marker" id="mapping-1228"></span><span class="token del" data-title="variable_declaration_statement/call_expression">getReserves(dollar, dai)</span>;</span>

        <span class="marker" id="mapping-1229"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1230"></span><span class="token mv" id="move-src-345" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-1231"></span><span class="token upd" id="move-src-346" data-title="variable_declaration/identifier">daiAmou<span class="cupd">n</span>t</span></span> = <span class="marker" id="mapping-1232"></span><span class="token del" data-title="variable_declaration_statement/ternary_expression"><span class="marker" id="mapping-1233"></span><span class="token del" data-title="ternary_expression/parenthesized_expression">(reserveA == 0 &amp;&amp; reserveB == 0)</span> ?
             dollarAmount :
             <span class="marker" id="mapping-1234"></span><span class="token del" data-title="ternary_expression/call_expression"><span class="marker" id="mapping-1235"></span><span class="token del" data-title="call_expression/member_expression">UniswapV2Library.quote</span>(<span class="marker" id="mapping-1236"></span><span class="token mv" id="move-src-347" data-title="call_expression/call_argument">dollarAmount</span>, <span class="marker" id="mapping-1237"></span><span class="token del" data-title="call_expression/call_argument">reserveA</span>, <span class="marker" id="mapping-1238"></span><span class="token del" data-title="call_expression/call_argument">reserveB</span>)</span></span>;</span>

        <span class="marker" id="mapping-1239"></span><span class="token del" data-title="function_body/variable_declaration_statement">address pair = address(univ2());</span>
        <span class="marker" id="mapping-1240"></span><span class="token del" data-title="function_body/expression_statement">IERC20(dollar).transfer(pair, dollarAmount);</span>
        <span class="marker" id="mapping-1241"></span><span class="token mv" id="move-src-348" data-title="function_body/expression_statement"><span class="marker" id="mapping-1242"></span><span class="token del" data-title="call_expression/member_expression">IERC20(dai).transferFrom</span>(msg.sender, <span class="marker" id="mapping-1243"></span><span class="token upd" id="move-src-349" data-title="call_argument/identifier">p<span class="cupd">a</span>ir</span>, <span class="marker" id="mapping-1244"></span><span class="token upd" id="move-src-350" data-title="call_argument/identifier">daiAm<span class="cupd">o</span>unt</span>);</span>
        <span class="marker" id="mapping-1245"></span><span class="token del" data-title="function_body/return_statement">return <span class="marker" id="mapping-1246"></span><span class="token del" data-title="return_statement/tuple_expression">(daiAmount, <span class="marker" id="mapping-1247"></span><span class="token mv" id="move-src-351" data-title="tuple_expression/call_expression"><span class="marker" id="mapping-1248"></span><span class="token upd" id="move-src-352" data-title="call_expression/identifier">IUnisw<span class="cupd">a</span>pV2Pair</span>(<span class="marker" id="mapping-1249"></span><span class="token del" data-title="call_expression/call_argument">pair</span>).<span class="marker" id="mapping-1250"></span><span class="token upd" id="move-src-353" data-title="member_expression/identifier">mint</span>(address(this))</span>)</span>;</span>
    }</span></span>

    // overridable for testing
    <span class="marker" id="mapping-1251"></span><span class="token del" data-title="contract_body/function_definition">function getReserves(<span class="marker" id="mapping-1252"></span><span class="token mv" id="move-src-354" data-title="function_definition/parameter">address <span class="marker" id="mapping-1253"></span><span class="token upd" id="move-src-355" data-title="parameter/identifier"><span class="cupd">t</span>okenA</span></span>, <span class="marker" id="mapping-1254"></span><span class="token mv" id="move-src-356" data-title="function_definition/parameter">address <span class="marker" id="mapping-1255"></span><span class="token upd" id="move-src-357" data-title="parameter/identifier"><span class="cupd">t</span>okenB</span></span>) <span class="marker" id="mapping-1256"></span><span class="token del" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-1257"></span><span class="token del" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-1258"></span><span class="token del" data-title="function_definition/return_type_definition">returns (uint reserveA, uint reserveB)</span> <span class="marker" id="mapping-1259"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1260"></span><span class="token del" data-title="function_body/variable_declaration_statement">(address token0,) = UniswapV2Library.sortTokens(tokenA, tokenB);</span>
        <span class="marker" id="mapping-1261"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1262"></span><span class="token del" data-title="variable_declaration_statement/variable_declaration_tuple">(<span class="marker" id="mapping-1263"></span><span class="token mv" id="move-src-358" data-title="variable_declaration_tuple/variable_declaration">uint <span class="marker" id="mapping-1264"></span><span class="token upd" id="move-src-359" data-title="variable_declaration/identifier">reserve0</span></span>, <span class="marker" id="mapping-1265"></span><span class="token mv" id="move-src-360" data-title="variable_declaration_tuple/variable_declaration">uint <span class="marker" id="mapping-1266"></span><span class="token upd" id="move-src-361" data-title="variable_declaration/identifier">reserve1</span></span>,)</span> = <span class="marker" id="mapping-1267"></span><span class="token del" data-title="variable_declaration_statement/call_expression">IUniswapV2Pair(UniswapV2Library.pairFor(UNISWAP_FACTORY, tokenA, tokenB)).getReserves()</span>;</span>
        <span class="marker" id="mapping-1268"></span><span class="token del" data-title="function_body/expression_statement">(reserveA, reserveB) = tokenA == token0 ? (reserve0, reserve1) : (reserve1, reserve0);</span>
    }</span></span>
}</span></span>

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
contract <span class="marker" id="mapping-1269"></span><span class="token upd" id="move-src-362" data-title="contract_declaration/identifier">Pool</span> is <span class="marker" id="mapping-1270"></span><span class="token upd" id="move-src-363" data-title="user_defined_type/identifier">Pool<span class="cupd">Setters</span></span>, <span class="marker" id="mapping-1271"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">Liquidity</span> {
    using SafeMath for uint256;

    <span class="marker" id="mapping-1272"></span><span class="token del" data-title="contract_body/constructor_definition">constructor(<span class="marker" id="mapping-1273"></span><span class="token del" data-title="constructor_definition/parameter">address dollar</span>, <span class="marker" id="mapping-1274"></span><span class="token del" data-title="constructor_definition/parameter">address univ2</span>) public <span class="marker" id="mapping-1275"></span><span class="token del" data-title="constructor_definition/function_body">{
        <span class="marker" id="mapping-1276"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-1277"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-1278"></span><span class="token del" data-title="assignment_expression/member_expression">_state.provider.dao</span> = <span class="marker" id="mapping-1279"></span><span class="token del" data-title="assignment_expression/call_expression">IDAO(<span class="marker" id="mapping-1280"></span><span class="token mv" id="move-src-364" data-title="call_expression/call_argument">msg.sender</span>)</span></span>;</span>
        <span class="marker" id="mapping-1281"></span><span class="token del" data-title="function_body/expression_statement">_state.provider.dollar = IDollar(dollar);</span>
        <span class="marker" id="mapping-1282"></span><span class="token del" data-title="function_body/expression_statement">_state.provider.univ2 = IERC20(univ2);</span>
    }</span></span>

    bytes32 private constant FILE = "Pool";

    event Deposit(address indexed account, uint256 value);
    event Withdraw(address indexed account, uint256 value);
    <span class="marker" id="mapping-1283"></span><span class="token mv" id="move-src-365" data-title="contract_body/event_definition">event <span class="marker" id="mapping-1284"></span><span class="token upd" id="move-src-366" data-title="event_definition/identifier">Cl<span class="cupd">a</span>im</span>(address indexed account, <span class="marker" id="mapping-1285"></span><span class="token mv" id="move-src-367" data-title="event_definition/event_paramater">uint256 value</span>);</span>
    <span class="marker" id="mapping-1286"></span><span class="token mv" id="move-src-368" data-title="contract_body/event_definition">event <span class="marker" id="mapping-1287"></span><span class="token upd" id="move-src-369" data-title="event_definition/identifier">B<span class="cupd">ond</span></span>(address indexed account, uint256 start, uint256 value);</span>
    event <span class="marker" id="mapping-1288"></span><span class="token upd" id="move-src-370" data-title="event_definition/identifier">Unb<span class="cupd">ond</span></span>(address indexed account, uint256 start, uint256 value, <span class="marker" id="mapping-1289"></span><span class="token mv" id="move-src-371" data-title="event_definition/event_paramater">uint256 <span class="marker" id="mapping-1290"></span><span class="token upd" id="move-src-372" data-title="event_paramater/identifier">n<span class="cupd">e</span>wCl<span class="cupd">a</span>imable</span></span>);
    <span class="marker" id="mapping-1291"></span><span class="token mv" id="move-src-373" data-title="contract_body/event_definition">event <span class="marker" id="mapping-1292"></span><span class="token upd" id="move-src-374" data-title="event_definition/identifier">Pr<span class="cupd">o</span>vide</span>(address indexed account, <span class="marker" id="mapping-1293"></span><span class="token mv" id="move-src-375" data-title="event_definition/event_paramater">uint256 value</span><span class="marker" id="mapping-1294"></span><span class="token del" data-title="event_definition/,">,</span> <span class="marker" id="mapping-1295"></span><span class="token mv" id="move-src-376" data-title="event_definition/event_paramater">uint256 <span class="marker" id="mapping-1296"></span><span class="token upd" id="move-src-377" data-title="event_paramater/identifier">lessDai</span></span><span class="marker" id="mapping-1297"></span><span class="token del" data-title="event_definition/,">,</span> <span class="marker" id="mapping-1298"></span><span class="token mv" id="move-src-378" data-title="event_definition/event_paramater">uint256 <span class="marker" id="mapping-1299"></span><span class="token upd" id="move-src-379" data-title="event_paramater/identifier"><span class="cupd">n</span>ewUniv2</span></span>);</span>

    <span class="marker" id="mapping-1300"></span><span class="token mv" id="move-src-380" data-title="contract_body/function_definition">function <span class="marker" id="mapping-1301"></span><span class="token upd" id="move-src-381" data-title="function_definition/identifier">depos<span class="cupd">i</span>t</span>(<span class="marker" id="mapping-1302"></span><span class="token mv" id="move-src-382" data-title="function_definition/parameter">uint256 value</span>) <span class="marker" id="mapping-1303"></span><span class="token mv" id="move-src-383" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-1304"></span><span class="token mv" id="move-src-384" data-title="function_definition/modifier_invocation">onlyFrozenOrFluid(msg.sender)</span> <span class="marker" id="mapping-1305"></span><span class="token del" data-title="function_definition/modifier_invocation">notPaused</span> {
        <span class="marker" id="mapping-1306"></span><span class="token upd" id="move-src-385" data-title="call_expression/identifier">univ2</span>().<span class="marker" id="mapping-1307"></span><span class="token upd" id="move-src-386" data-title="member_expression/identifier">transf<span class="cupd">e</span>rFrom</span>(<span class="marker" id="mapping-1308"></span><span class="token mv" id="move-src-387" data-title="call_expression/call_argument">msg.sender</span><span class="marker" id="mapping-1309"></span><span class="token del" data-title="call_expression/,">,</span> address(this)<span class="marker" id="mapping-1310"></span><span class="token del" data-title="call_expression/,">,</span> <span class="marker" id="mapping-1311"></span><span class="token del" data-title="call_expression/call_argument">value</span>);
        <span class="marker" id="mapping-1312"></span><span class="token mv" id="move-src-388" data-title="function_body/expression_statement">incrementBalanceOfStaged(msg.sender, value);</span>

        <span class="marker" id="mapping-1313"></span><span class="token mv" id="move-src-389" data-title="function_body/expression_statement">balanceCheck();</span>

        <span class="marker" id="mapping-1314"></span><span class="token mv" id="move-src-390" data-title="function_body/emit_statement">emit <span class="marker" id="mapping-1315"></span><span class="token upd" id="move-src-391" data-title="emit_statement/identifier">Dep<span class="cupd">o</span>s<span class="cupd">it</span></span>(msg.sender, <span class="marker" id="mapping-1316"></span><span class="token mv" id="move-src-392" data-title="emit_statement/call_argument">value</span>);</span>
    }</span>

    function withdraw(uint256 value) external <span class="marker" id="mapping-1317"></span><span class="token mv" id="move-src-393" data-title="function_definition/modifier_invocation"><span class="marker" id="mapping-1318"></span><span class="token upd" id="move-src-394" data-title="modifier_invocation/identifier"><span class="cupd">onlyFrozen</span></span>(msg.sender)</span> {
        <span class="marker" id="mapping-1319"></span><span class="token mv" id="move-src-395" data-title="function_body/expression_statement"><span class="marker" id="mapping-1320"></span><span class="token upd" id="move-src-396" data-title="call_expression/identifier">univ2</span>().<span class="marker" id="mapping-1321"></span><span class="token upd" id="move-src-397" data-title="member_expression/identifier"><span class="cupd">transfer</span></span>(msg.sender, value);</span>
        decrementBalanceOfStaged(msg.sender, value, "Pool: insufficient staged balance");

        <span class="marker" id="mapping-1322"></span><span class="token mv" id="move-src-398" data-title="function_body/expression_statement">balanceCheck();</span>

        emit Withdraw(msg.sender, value);
    }

    <span class="marker" id="mapping-1323"></span><span class="token del" data-title="contract_body/function_definition">function claim(<span class="marker" id="mapping-1324"></span><span class="token del" data-title="function_definition/parameter">uint256 value</span>) <span class="marker" id="mapping-1325"></span><span class="token mv" id="move-src-399" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-1326"></span><span class="token mv" id="move-src-400" data-title="function_definition/modifier_invocation"><span class="marker" id="mapping-1327"></span><span class="token upd" id="move-src-401" data-title="modifier_invocation/identifier"><span class="cupd">onlyFrozen</span></span>(msg.sender)</span> <span class="marker" id="mapping-1328"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1329"></span><span class="token mv" id="move-src-402" data-title="function_body/expression_statement">dollar().transfer(msg.sender, value);</span>
        <span class="marker" id="mapping-1330"></span><span class="token mv" id="move-src-403" data-title="function_body/expression_statement"><span class="marker" id="mapping-1331"></span><span class="token upd" id="move-src-404" data-title="call_expression/identifier">de<span class="cupd">crementBalanceOf</span>Cl<span class="cupd">a</span>imable</span>(msg.sender, <span class="marker" id="mapping-1332"></span><span class="token mv" id="move-src-405" data-title="call_expression/call_argument">value</span><span class="marker" id="mapping-1333"></span><span class="token del" data-title="call_expression/,">,</span> <span class="marker" id="mapping-1334"></span><span class="token mv" id="move-src-406" data-title="call_expression/call_argument">"Pool: insufficient claimable balance"</span>);</span>

        <span class="marker" id="mapping-1335"></span><span class="token mv" id="move-src-407" data-title="function_body/expression_statement">balanceCheck();</span>

        <span class="marker" id="mapping-1336"></span><span class="token mv" id="move-src-408" data-title="function_body/emit_statement">emit <span class="marker" id="mapping-1337"></span><span class="token upd" id="move-src-409" data-title="emit_statement/identifier"><span class="cupd">C</span>laim</span>(msg.sender, <span class="marker" id="mapping-1338"></span><span class="token upd" id="move-src-410" data-title="call_argument/identifier">v<span class="cupd">a</span>lue</span>);</span>
    }</span></span>

    function bond(uint256 value) external <span class="marker" id="mapping-1339"></span><span class="token upd" id="move-src-411" data-title="modifier_invocation/identifier"><span class="cupd">n</span><span class="cupd">o</span>tPa<span class="cupd">u</span>sed</span> {
        unfreeze(msg.sender);

        <span class="marker" id="mapping-1340"></span><span class="token mv" id="move-src-412" data-title="function_body/variable_declaration_statement">uint256 <span class="marker" id="mapping-1341"></span><span class="token upd" id="move-src-413" data-title="variable_declaration/identifier"><span class="cupd">total</span>R<span class="cupd">e</span>wa<span class="cupd">r</span>d<span class="cupd">e</span>dWithPhantom</span> = <span class="marker" id="mapping-1342"></span><span class="token del" data-title="call_expression/member_expression">totalRewarded().add</span>(<span class="marker" id="mapping-1343"></span><span class="token del" data-title="call_expression/call_argument">totalPhantom()</span>);</span>
        <span class="marker" id="mapping-1344"></span><span class="token mv" id="move-src-414" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-1345"></span><span class="token upd" id="move-src-415" data-title="variable_declaration/identifier">n<span class="cupd">e</span>wPh<span class="cupd">a</span><span class="cupd">n</span>tom</span></span> = <span class="marker" id="mapping-1346"></span><span class="token del" data-title="member_expression/ternary_expression"><span class="marker" id="mapping-1347"></span><span class="token mv" id="move-src-416" data-title="ternary_expression/binary_expression">totalBonded() == 0</span> ?
            <span class="marker" id="mapping-1348"></span><span class="token mv" id="move-src-417" data-title="ternary_expression/ternary_expression"><span class="marker" id="mapping-1349"></span><span class="token del" data-title="ternary_expression/binary_expression">totalRewarded() == 0</span> ? <span class="marker" id="mapping-1350"></span><span class="token mv" id="move-src-418" data-title="member_expression/call_expression">Constants.getInitialStakeMultiple()</span>.mul(<span class="marker" id="mapping-1351"></span><span class="token del" data-title="call_argument/identifier">value</span>) : <span class="marker" id="mapping-1352"></span><span class="token del" data-title="ternary_expression/number_literal">0</span></span> :
            <span class="marker" id="mapping-1353"></span><span class="token del" data-title="ternary_expression/call_expression">totalRewardedWithPhantom.mul(value)</span></span>.div(totalBonded());

        <span class="marker" id="mapping-1354"></span><span class="token mv" id="move-src-419" data-title="function_body/expression_statement"><span class="marker" id="mapping-1355"></span><span class="token upd" id="move-src-420" data-title="call_expression/identifier">in<span class="cupd">crementBalanceOf</span>Bonded</span>(msg.sender, value);</span>
        <span class="marker" id="mapping-1356"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-1357"></span><span class="token del" data-title="expression_statement/call_expression">incrementBalanceOfPhantom(<span class="marker" id="mapping-1358"></span><span class="token mv" id="move-src-421" data-title="call_expression/call_argument">msg.sender</span>, <span class="marker" id="mapping-1359"></span><span class="token del" data-title="call_expression/call_argument">newPhantom</span>)</span>;</span>
        decrementBalanceOfStaged(msg.sender, value, "Pool: insufficient staged balance");

        <span class="marker" id="mapping-1360"></span><span class="token mv" id="move-src-422" data-title="function_body/expression_statement">balanceCheck();</span>

        <span class="marker" id="mapping-1361"></span><span class="token mv" id="move-src-423" data-title="function_body/emit_statement">emit <span class="marker" id="mapping-1362"></span><span class="token upd" id="move-src-424" data-title="emit_statement/identifier">B<span class="cupd">ond</span></span>(msg.sender, epoch().add(1), value);</span>
    }

    function unbond(uint256 value) external {
        unfreeze(msg.sender);

        <span class="marker" id="mapping-1363"></span><span class="token mv" id="move-src-425" data-title="function_body/variable_declaration_statement">uint256 <span class="marker" id="mapping-1364"></span><span class="token upd" id="move-src-426" data-title="variable_declaration/identifier">b<span class="cupd">al</span>anc<span class="cupd">e</span>O<span class="cupd">f</span><span class="cupd">B</span>onded</span> = <span class="marker" id="mapping-1365"></span><span class="token mv" id="move-src-427" data-title="variable_declaration_statement/call_expression">balanceOfBonded(msg.sender)</span>;</span>
        <span class="marker" id="mapping-1366"></span><span class="token mv" id="move-src-428" data-title="function_body/expression_statement">Require.that(
            <span class="marker" id="mapping-1367"></span><span class="token del" data-title="call_argument/binary_expression">balanceOfBonded &gt; 0</span>,
            FILE,
            "insufficient bonded balance"
        );</span>

        <span class="marker" id="mapping-1368"></span><span class="token mv" id="move-src-429" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1369"></span><span class="token mv" id="move-src-430" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-1370"></span><span class="token upd" id="move-src-431" data-title="variable_declaration/identifier">n<span class="cupd">e</span>wClai<span class="cupd">mable</span></span></span> = <span class="marker" id="mapping-1371"></span><span class="token del" data-title="variable_declaration_statement/call_expression"><span class="marker" id="mapping-1372"></span><span class="token del" data-title="call_expression/member_expression"><span class="marker" id="mapping-1373"></span><span class="token del" data-title="member_expression/call_expression"><span class="marker" id="mapping-1374"></span><span class="token del" data-title="call_expression/member_expression"><span class="marker" id="mapping-1375"></span><span class="token mv" id="move-src-432" data-title="member_expression/call_expression"><span class="marker" id="mapping-1376"></span><span class="token upd" id="move-src-433" data-title="call_expression/identifier"><span class="cupd">b</span>ala<span class="cupd">n</span>ceOfRewarded</span>(msg.sender)</span>.mul</span>(<span class="marker" id="mapping-1377"></span><span class="token del" data-title="call_expression/call_argument">value</span>)</span>.div</span>(<span class="marker" id="mapping-1378"></span><span class="token del" data-title="call_expression/call_argument">balanceOfBonded</span>)</span>;</span>
        <span class="marker" id="mapping-1379"></span><span class="token mv" id="move-src-434" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-1380"></span><span class="token upd" id="move-src-435" data-title="variable_declaration/identifier">l<span class="cupd">e</span>ssPhantom</span></span> = <span class="marker" id="mapping-1381"></span><span class="token del" data-title="variable_declaration_statement/call_expression"><span class="marker" id="mapping-1382"></span><span class="token del" data-title="call_expression/member_expression"><span class="marker" id="mapping-1383"></span><span class="token mv" id="move-src-436" data-title="member_expression/call_expression"><span class="marker" id="mapping-1384"></span><span class="token mv" id="move-src-437" data-title="member_expression/call_expression"><span class="marker" id="mapping-1385"></span><span class="token upd" id="move-src-438" data-title="call_expression/identifier"><span class="cupd">balanceOf</span>Phantom</span>(msg.sender)</span>.<span class="marker" id="mapping-1386"></span><span class="token upd" id="move-src-439" data-title="member_expression/identifier">mul</span>(<span class="marker" id="mapping-1387"></span><span class="token del" data-title="call_argument/identifier">value</span>)</span>.div</span>(<span class="marker" id="mapping-1388"></span><span class="token del" data-title="call_expression/call_argument">balanceOfBonded</span>)</span>;

        <span class="marker" id="mapping-1389"></span><span class="token upd" id="move-src-440" data-title="call_expression/identifier">in<span class="cupd">crement</span>B<span class="cupd">al</span>a<span class="cupd">n</span>c<span class="cupd">e</span>OfStaged</span>(<span class="marker" id="mapping-1390"></span><span class="token del" data-title="call_expression/call_argument">msg.sender</span><span class="marker" id="mapping-1391"></span><span class="token mv" id="move-src-441" data-title="call_expression/,">,</span> <span class="marker" id="mapping-1392"></span><span class="token upd" id="move-src-442" data-title="call_argument/identifier">v<span class="cupd">a</span>lue</span>);
        <span class="marker" id="mapping-1393"></span><span class="token mv" id="move-src-443" data-title="function_body/expression_statement"><span class="marker" id="mapping-1394"></span><span class="token upd" id="move-src-444" data-title="call_expression/identifier"><span class="cupd">incrementBalanceOf</span>Cl<span class="cupd">a</span>imable</span>(msg.sender, <span class="marker" id="mapping-1395"></span><span class="token upd" id="move-src-445" data-title="call_argument/identifier">n<span class="cupd">e</span>wCla<span class="cupd">i</span>mable</span>);</span>
        <span class="marker" id="mapping-1396"></span><span class="token mv" id="move-src-446" data-title="function_body/expression_statement"><span class="marker" id="mapping-1397"></span><span class="token upd" id="move-src-447" data-title="call_expression/identifier">de<span class="cupd">crementBalanceOf</span>B<span class="cupd">o</span>nded</span>(msg.sender, <span class="marker" id="mapping-1398"></span><span class="token upd" id="move-src-448" data-title="call_argument/identifier">value</span>, <span class="marker" id="mapping-1399"></span><span class="token mv" id="move-src-449" data-title="call_expression/call_argument">"Pool: insufficient bonded balance"</span>);</span>
        <span class="marker" id="mapping-1400"></span><span class="token mv" id="move-src-450" data-title="function_body/expression_statement"><span class="marker" id="mapping-1401"></span><span class="token upd" id="move-src-451" data-title="call_expression/identifier">decrementBa<span class="cupd">la</span>n<span class="cupd">ce</span>OfPhantom</span>(msg.sender, <span class="marker" id="mapping-1402"></span><span class="token upd" id="move-src-452" data-title="call_argument/identifier">lessPh<span class="cupd">an</span>tom</span><span class="marker" id="mapping-1403"></span><span class="token del" data-title="call_expression/,">,</span> <span class="marker" id="mapping-1404"></span><span class="token mv" id="move-src-453" data-title="call_expression/call_argument">"Pool: insufficient phantom balance"</span>);</span>

        <span class="marker" id="mapping-1405"></span><span class="token mv" id="move-src-454" data-title="function_body/expression_statement">balanceCheck();</span>

        emit Unbond(msg.sender, epoch().add(1), value, <span class="marker" id="mapping-1406"></span><span class="token upd" id="move-src-455" data-title="call_argument/identifier">newCl<span class="cupd">a</span>imable</span>);
    }

    <span class="marker" id="mapping-1407"></span><span class="token del" data-title="contract_body/function_definition">function provide(<span class="marker" id="mapping-1408"></span><span class="token del" data-title="function_definition/parameter">uint256 value</span>) <span class="marker" id="mapping-1409"></span><span class="token mv" id="move-src-456" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-1410"></span><span class="token del" data-title="function_definition/modifier_invocation">onlyFrozen(<span class="marker" id="mapping-1411"></span><span class="token mv" id="move-src-457" data-title="modifier_invocation/call_argument">msg.sender</span>)</span> <span class="marker" id="mapping-1412"></span><span class="token del" data-title="function_definition/modifier_invocation">notPaused</span> <span class="marker" id="mapping-1413"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1414"></span><span class="token mv" id="move-src-458" data-title="function_body/expression_statement">Require.that(
            totalBonded() &gt; 0,
            FILE,
            "insufficient total bonded"
        );</span>

        <span class="marker" id="mapping-1415"></span><span class="token mv" id="move-src-459" data-title="function_body/expression_statement">Require.that(
            <span class="marker" id="mapping-1416"></span><span class="token del" data-title="call_argument/binary_expression">totalRewarded() &gt; 0</span>,
            FILE,
            "insufficient total rewarded"
        );</span>

        <span class="marker" id="mapping-1417"></span><span class="token mv" id="move-src-460" data-title="function_body/expression_statement">Require.that(
            <span class="marker" id="mapping-1418"></span><span class="token mv" id="move-src-461" data-title="call_expression/call_argument"><span class="marker" id="mapping-1419"></span><span class="token upd" id="move-src-462" data-title="call_expression/identifier"><span class="cupd">balanceOf</span>Rewarded</span>(msg.sender) <span class="marker" id="mapping-1420"></span><span class="token del" data-title="binary_expression/>=">&gt;=</span> <span class="marker" id="mapping-1421"></span><span class="token del" data-title="binary_expression/identifier">value</span></span>,
            FILE,
            "insufficient rewarded balance"
        );</span>

        <span class="marker" id="mapping-1422"></span><span class="token mv" id="move-src-463" data-title="function_body/variable_declaration_statement">(uint256 <span class="marker" id="mapping-1423"></span><span class="token upd" id="move-src-464" data-title="variable_declaration/identifier"><span class="cupd">less</span>Dai</span>, <span class="marker" id="mapping-1424"></span><span class="token del" data-title="variable_declaration_tuple/variable_declaration"><span class="marker" id="mapping-1425"></span><span class="token mv" id="move-src-465" data-title="variable_declaration/type_name">uint256</span> newUniv2</span>) = <span class="marker" id="mapping-1426"></span><span class="token del" data-title="variable_declaration_statement/call_expression">addLiquidity(value)</span>;</span>

        <span class="marker" id="mapping-1427"></span><span class="token del" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1428"></span><span class="token mv" id="move-src-466" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-1429"></span><span class="token upd" id="move-src-467" data-title="variable_declaration/identifier">totalR<span class="cupd">e</span>war<span class="cupd">de</span>dWithPha<span class="cupd">nt</span>om</span></span> = <span class="marker" id="mapping-1430"></span><span class="token del" data-title="variable_declaration_statement/call_expression">totalRewarded().add(totalPhantom()).add(value)</span>;</span>
        <span class="marker" id="mapping-1431"></span><span class="token mv" id="move-src-468" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1432"></span><span class="token mv" id="move-src-469" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-1433"></span><span class="token upd" id="move-src-470" data-title="variable_declaration/identifier">newPhant<span class="cupd">o</span>mFr<span class="cupd">o</span><span class="cupd">m</span>B<span class="cupd">o</span>nded</span></span> = <span class="marker" id="mapping-1434"></span><span class="token upd" id="move-src-471" data-title="member_expression/identifier">tot<span class="cupd">al</span>RewardedWithPhantom</span>.mul(<span class="marker" id="mapping-1435"></span><span class="token del" data-title="call_argument/identifier">newUniv2</span>).div(totalBonded());</span>

        <span class="marker" id="mapping-1436"></span><span class="token mv" id="move-src-472" data-title="function_body/expression_statement"><span class="marker" id="mapping-1437"></span><span class="token upd" id="move-src-473" data-title="call_expression/identifier">inc<span class="cupd">re</span>m<span class="cupd">e</span>ntBalanc<span class="cupd">e</span>OfB<span class="cupd">o</span>nded</span>(msg.sender, <span class="marker" id="mapping-1438"></span><span class="token upd" id="move-src-474" data-title="call_argument/identifier">n<span class="cupd">e</span>wUniv2</span>);</span>
        <span class="marker" id="mapping-1439"></span><span class="token mv" id="move-src-475" data-title="function_body/expression_statement"><span class="marker" id="mapping-1440"></span><span class="token upd" id="move-src-476" data-title="call_expression/identifier">inc<span class="cupd">re</span><span class="cupd">m</span>entBalan<span class="cupd">c</span>eOfPha<span class="cupd">nt</span>om</span>(msg.sender, <span class="marker" id="mapping-1441"></span><span class="token del" data-title="call_argument/call_expression">value.add(newPhantomFromBonded)</span>);</span>


        <span class="marker" id="mapping-1442"></span><span class="token mv" id="move-src-477" data-title="function_body/expression_statement">balanceCheck();</span>

        <span class="marker" id="mapping-1443"></span><span class="token mv" id="move-src-478" data-title="function_body/emit_statement">emit <span class="marker" id="mapping-1444"></span><span class="token upd" id="move-src-479" data-title="emit_statement/identifier">Pr<span class="cupd">o</span>vide</span>(msg.sender, <span class="marker" id="mapping-1445"></span><span class="token upd" id="move-src-480" data-title="call_argument/identifier">v<span class="cupd">a</span>lue</span>, <span class="marker" id="mapping-1446"></span><span class="token upd" id="move-src-481" data-title="call_argument/identifier">lessDai</span>, <span class="marker" id="mapping-1447"></span><span class="token upd" id="move-src-482" data-title="call_argument/identifier"><span class="cupd">n</span>ewUniv2</span>);</span>
    }</span></span>

    <span class="marker" id="mapping-1448"></span><span class="token del" data-title="contract_body/function_definition">function emergencyWithdraw(<span class="marker" id="mapping-1449"></span><span class="token del" data-title="function_definition/parameter">address token</span>, <span class="marker" id="mapping-1450"></span><span class="token del" data-title="function_definition/parameter">uint256 value</span>) <span class="marker" id="mapping-1451"></span><span class="token mv" id="move-src-483" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-1452"></span><span class="token del" data-title="function_definition/modifier_invocation">onlyDao</span> <span class="marker" id="mapping-1453"></span><span class="token del" data-title="function_definition/function_body">{
        IERC20(token).transfer(address(dao()), value);
    }</span></span>

    <span class="marker" id="mapping-1454"></span><span class="token del" data-title="contract_body/function_definition">function emergencyPause() <span class="marker" id="mapping-1455"></span><span class="token mv" id="move-src-484" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-1456"></span><span class="token del" data-title="function_definition/modifier_invocation">onlyDao</span> <span class="marker" id="mapping-1457"></span><span class="token del" data-title="function_definition/function_body">{
        pause();
    }</span></span>

    <span class="marker" id="mapping-1458"></span><span class="token mv" id="move-src-485" data-title="contract_body/function_definition">function balanceCheck() private {
        Require.that(
            <span class="marker" id="mapping-1459"></span><span class="token mv" id="move-src-486" data-title="call_argument/call_expression"><span class="marker" id="mapping-1460"></span><span class="token upd" id="move-src-487" data-title="call_expression/identifier">univ2</span>().balanceOf(address(this)) &gt;= <span class="marker" id="mapping-1461"></span><span class="token mv" id="move-src-488" data-title="binary_expression/call_expression">totalStaged()</span>.add(<span class="marker" id="mapping-1462"></span><span class="token del" data-title="call_argument/call_expression">totalBonded()</span>)</span>,
            FILE,
            "Inconsistent UNI-V2 balances"
        );
    }</span>

    <span class="marker" id="mapping-1463"></span><span class="token del" data-title="contract_body/modifier_definition">modifier onlyFrozen(<span class="marker" id="mapping-1464"></span><span class="token del" data-title="modifier_definition/parameter">address account</span>) <span class="marker" id="mapping-1465"></span><span class="token del" data-title="modifier_definition/function_body">{
        <span class="marker" id="mapping-1466"></span><span class="token mv" id="move-src-489" data-title="function_body/expression_statement">Require.that(
            <span class="marker" id="mapping-1467"></span><span class="token del" data-title="call_expression/call_argument">statusOf(account) == PoolAccount.Status.Frozen</span>,
            FILE,
            "Not frozen"
        );</span>

        <span class="marker" id="mapping-1468"></span><span class="token del" data-title="function_body/expression_statement">_;</span>
    }</span></span>

    <span class="marker" id="mapping-1469"></span><span class="token del" data-title="contract_body/modifier_definition">modifier onlyFrozenOrFluid(<span class="marker" id="mapping-1470"></span><span class="token del" data-title="modifier_definition/parameter">address account</span>) <span class="marker" id="mapping-1471"></span><span class="token del" data-title="modifier_definition/function_body">{
        <span class="marker" id="mapping-1472"></span><span class="token mv" id="move-src-490" data-title="function_body/expression_statement">Require.that(
            <span class="marker" id="mapping-1473"></span><span class="token del" data-title="call_argument/member_expression">statusOf(account) == PoolAccount.Status.Frozen ||  statusOf(account) == PoolAccount.Status.Fluid</span>,
            FILE,
            "Not frozen or fluid"
        );</span>

        <span class="marker" id="mapping-1474"></span><span class="token del" data-title="function_body/expression_statement">_;</span>
    }</span></span>

    <span class="marker" id="mapping-1475"></span><span class="token del" data-title="contract_body/modifier_definition">modifier onlyDao() <span class="marker" id="mapping-1476"></span><span class="token del" data-title="modifier_definition/function_body">{
        <span class="marker" id="mapping-1477"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-1478"></span><span class="token del" data-title="expression_statement/call_expression"><span class="marker" id="mapping-1479"></span><span class="token mv" id="move-src-491" data-title="call_expression/member_expression">Require.that</span>(
            <span class="marker" id="mapping-1480"></span><span class="token del" data-title="call_expression/call_argument">msg.sender == address(dao())</span>,
            <span class="marker" id="mapping-1481"></span><span class="token mv" id="move-src-492" data-title="call_expression/call_argument">FILE</span>,
            <span class="marker" id="mapping-1482"></span><span class="token del" data-title="call_expression/call_argument">"Not dao"</span>
        )</span>;</span>

        <span class="marker" id="mapping-1483"></span><span class="token del" data-title="function_body/expression_statement">_;</span>
    }</span></span>

    <span class="marker" id="mapping-1484"></span><span class="token del" data-title="contract_body/modifier_definition">modifier notPaused() <span class="marker" id="mapping-1485"></span><span class="token del" data-title="modifier_definition/function_body">{
        <span class="marker" id="mapping-1486"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-1487"></span><span class="token del" data-title="expression_statement/call_expression"><span class="marker" id="mapping-1488"></span><span class="token mv" id="move-src-493" data-title="call_expression/member_expression">Require.that</span>(
            <span class="marker" id="mapping-1489"></span><span class="token del" data-title="call_expression/call_argument">!paused()</span>,
            <span class="marker" id="mapping-1490"></span><span class="token mv" id="move-src-494" data-title="call_expression/call_argument">FILE</span>,
            <span class="marker" id="mapping-1491"></span><span class="token del" data-title="call_expression/call_argument">"Paused"</span>
        )</span>;</span>

        <span class="marker" id="mapping-1492"></span><span class="token del" data-title="function_body/expression_statement">_;</span>
    }</span></span>
}

/**
 * Utility library of inline functions on addresses
 *
 * Source https://raw.githubusercontent.com/OpenZeppelin/openzeppelin-solidity/v2.1.3/contracts/utils/Address.sol
 * This contract is copied here and renamed from the original to avoid clashes in the compiled artifacts
 * when the user imports a zos-lib contract (that transitively causes this contract to be compiled and added to the
 * build/artifacts folder) as well as the vanilla Address implementation from an openzeppelin version.
 */
library OpenZeppelinUpgradesAddress {
    /**
     * Returns whether the target address is a contract
     * @dev This function will return false if invoked during the constructor of a contract,
     * as the code is not actually created until after the constructor finishes.
     * @param account address of the account to check
     * @return whether the target address is a contract
     */
    function isContract(address account) internal view returns (bool) {
        uint256 size;
        // XXX Currently there is no better way to check if there is a contract in an address
        // than to check the size of the code at that address.
        // See https://ethereum.stackexchange.com/a/14016/36603
        // for more details about how this works.
        // TODO Check this again before the Serenity release, because all addresses will be
        // contracts then.
        // solhint-disable-next-line no-inline-assembly
        assembly { size := extcodesize(account) }
        return size &gt; 0;
    }
}

<span class="marker" id="mapping-1493"></span><span class="token del" data-title="source_file/comment">/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/</span>
<span class="marker" id="mapping-1494"></span><span class="token mv" id="move-src-495" data-title="source_file/contract_declaration">contract Account {
    enum Status {
        Frozen,
        Fluid,
        Locked
    }

    struct State {
        uint256 staged;
        uint256 balance;
        mapping(uint256 =&gt; uint256) coupons;
        mapping(address =&gt; uint256) couponAllowances;
        uint256 fluidUntil;
        uint256 lockedUntil;
    }
}</span>

<span class="marker" id="mapping-1495"></span><span class="token mv" id="move-src-496" data-title="source_file/contract_declaration">contract Epoch {
    struct Global {
        uint256 current;
        uint256 currentStart;
        uint256 currentPeriod;
    }

    struct Coupons {
        uint256 outstanding;
        uint256 expiration;
        uint256[] expiring;
    }

    struct State {
        uint256 bonded;
        Coupons coupons;
    }
}</span>

<span class="marker" id="mapping-1496"></span><span class="token mv" id="move-src-497" data-title="source_file/contract_declaration">contract Candidate {
    enum Vote {
        UNDECIDED,
        APPROVE,
        REJECT
    }

    struct State {
        uint256 start;
        uint256 period;
        uint256 approve;
        uint256 reject;
        mapping(address =&gt; Vote) votes;
        bool initialized;
    }
}</span>

<span class="marker" id="mapping-1497"></span><span class="token mv" id="move-src-498" data-title="source_file/contract_declaration">contract Storage {
    struct Provider {
        IDollar dollar;
        IOracle oracle;
        address pool;
    }

    struct Balance {
        uint256 supply;
        uint256 bonded;
        uint256 staged;
        uint256 redeemable;
        uint256 debt;
        uint256 coupons;
    }

    struct State {
        Epoch.Global epoch;
        Balance balance;
        Provider provider;

        mapping(address =&gt; Account.State) accounts;
        mapping(uint256 =&gt; Epoch.State) epochs;
        mapping(address =&gt; Candidate.State) candidates;
    }
}</span>

<span class="marker" id="mapping-1498"></span><span class="token mv" id="move-src-499" data-title="source_file/contract_declaration">contract State {
    Storage.State _state;
}</span>

/*
    Copyright 2018-2019 zOS Global Limited
    Copyright 2020 Dynamic Dollar Devs, based on the works of the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
/**
 * Based off of, and designed to interface with, openzeppelin/upgrades package
 */
contract Upgradeable is State {
    /**
     * @dev Storage slot with the address of the current implementation.
     * This is the keccak-256 hash of "eip1967.proxy.implementation" subtracted by 1, and is
     * validated in the constructor.
     */
    bytes32 private constant IMPLEMENTATION_SLOT = 0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc;

    /**
     * @dev Emitted when the implementation is upgraded.
     * @param implementation Address of the new implementation.
     */
    event Upgraded(address indexed implementation);

    function initialize() public;

    /**
     * @dev Upgrades the proxy to a new implementation.
     * @param newImplementation Address of the new implementation.
     */
    function upgradeTo(address newImplementation) internal {
        setImplementation(newImplementation);

        (bool success, bytes memory reason) = newImplementation.delegatecall(abi.encodeWithSignature("initialize()"));
        require(success, string(reason));

        emit Upgraded(newImplementation);
    }

    /**
     * @dev Sets the implementation address of the proxy.
     * @param newImplementation Address of the new implementation.
     */
    function setImplementation(address newImplementation) private {
        require(OpenZeppelinUpgradesAddress.isContract(newImplementation), "Cannot set a proxy implementation to a non-contract address");

        bytes32 slot = IMPLEMENTATION_SLOT;

        assembly {
            sstore(slot, newImplementation)
        }
    }
}

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
<span class="marker" id="mapping-1499"></span><span class="token mv" id="move-src-500" data-title="source_file/contract_declaration">contract Getters is State {
    using SafeMath for uint256;
    using Decimal for Decimal.D256;

    bytes32 private constant IMPLEMENTATION_SLOT = 0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc;

    /**
     * ERC20 Interface
     */

    function name() public view returns (string memory) {
        return "Reflective Set Stake";
    }

    function symbol() public view returns (string memory) {
        return "RSS";
    }

    function decimals() public view returns (uint8) {
        return 18;
    }

    function balanceOf(address account) public view returns (uint256) {
        return _state.accounts[account].balance;
    }

    function totalSupply() public view returns (uint256) {
        return _state.balance.supply;
    }

    function allowance(address owner, address spender) external view returns (uint256) {
        return 0;
    }

    /**
     * Global
     */

    function dollar() public view returns (IDollar) {
        return _state.provider.dollar;
    }

    function oracle() public view returns (IOracle) {
        return _state.provider.oracle;
    }

    function pool() public view returns (address) {
        return _state.provider.pool;
    }

    function totalBonded() public view returns (uint256) {
        return _state.balance.bonded;
    }

    function totalStaged() public view returns (uint256) {
        return _state.balance.staged;
    }

    function totalDebt() public view returns (uint256) {
        return _state.balance.debt;
    }

    function totalRedeemable() public view returns (uint256) {
        return _state.balance.redeemable;
    }

    function totalCoupons() public view returns (uint256) {
        return _state.balance.coupons;
    }

    function totalNet() public view returns (uint256) {
        return dollar().totalSupply().sub(totalDebt());
    }

    /**
     * Account
     */

    function balanceOfStaged(address account) public view returns (uint256) {
        return _state.accounts[account].staged;
    }

    function balanceOfBonded(address account) public view returns (uint256) {
        uint256 totalSupply = totalSupply();
        if (totalSupply == 0) {
            return 0;
        }
        return totalBonded().mul(balanceOf(account)).div(totalSupply);
    }

    function balanceOfCoupons(address account, uint256 epoch) public view returns (uint256) {
        if (outstandingCoupons(epoch) == 0) {
            return 0;
        }
        return _state.accounts[account].coupons[epoch];
    }

    function statusOf(address account) public view returns (Account.Status) {
        if (_state.accounts[account].lockedUntil &gt; epoch()) {
            return Account.Status.Locked;
        }

        return epoch() &gt;= _state.accounts[account].fluidUntil ? Account.Status.Frozen : Account.Status.Fluid;
    }

    function allowanceCoupons(address owner, address spender) public view returns (uint256) {
        return _state.accounts[owner].couponAllowances[spender];
    }

    /**
     * Epoch
     */

    function epoch() public view returns (uint256) {
        return _state.epoch.current;
    }

    function epochTime() public view returns (uint256) {
        return block.timestamp &gt;= nextEpochStart()
            ? epoch().add(1)
            : epoch();
    }

    function timeInEpoch() public view returns (uint256) {
        return block.timestamp.sub(_state.epoch.currentStart);
    }

    function timeLeftInEpoch() public view returns (uint256) {
        if (block.timestamp &gt; nextEpochStart()) 
            return 0;

        return nextEpochStart().sub(block.timestamp);
    }

    function currentEpochDuration() public view returns (uint256) {
        return _state.epoch.currentPeriod;
    }

    function nextEpochStart() public view returns (uint256) {
        return _state.epoch.currentStart.add(_state.epoch.currentPeriod);
    }

    function outstandingCoupons(uint256 epoch) public view returns (uint256) {
        return _state.epochs[epoch].coupons.outstanding;
    }

    function couponsExpiration(uint256 epoch) public view returns (uint256) {
        return _state.epochs[epoch].coupons.expiration;
    }

    function expiringCoupons(uint256 epoch) public view returns (uint256) {
        return _state.epochs[epoch].coupons.expiring.length;
    }

    function expiringCouponsAtIndex(uint256 epoch, uint256 i) public view returns (uint256) {
        return _state.epochs[epoch].coupons.expiring[i];
    }

    function totalBondedAt(uint256 epoch) public view returns (uint256) {
        return _state.epochs[epoch].bonded;
    }

    function bootstrappingAt(uint256 epoch) public view returns (bool) {
        return epoch &lt;= Constants.getBootstrappingPeriod();
    }

    /**
     * Governance
     */

    function recordedVote(address account, address candidate) public view returns (Candidate.Vote) {
        return _state.candidates[candidate].votes[account];
    }

    function startFor(address candidate) public view returns (uint256) {
        return _state.candidates[candidate].start;
    }

    function periodFor(address candidate) public view returns (uint256) {
        return _state.candidates[candidate].period;
    }

    function approveFor(address candidate) public view returns (uint256) {
        return _state.candidates[candidate].approve;
    }

    function rejectFor(address candidate) public view returns (uint256) {
        return _state.candidates[candidate].reject;
    }

    function votesFor(address candidate) public view returns (uint256) {
        return approveFor(candidate).add(rejectFor(candidate));
    }

    function isNominated(address candidate) public view returns (bool) {
        return _state.candidates[candidate].start &gt; 0;
    }

    function isInitialized(address candidate) public view returns (bool) {
        return _state.candidates[candidate].initialized;
    }

    function implementation() public view returns (address impl) {
        bytes32 slot = IMPLEMENTATION_SLOT;
        assembly {
            impl := sload(slot)
        }
    }
}</span>

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
<span class="marker" id="mapping-1500"></span><span class="token mv" id="move-src-501" data-title="source_file/contract_declaration">contract Setters is State, Getters {
    using SafeMath for uint256;

    event Transfer(address indexed from, address indexed to, uint256 value);

    /**
     * ERC20 Interface
     */

    function transfer(address recipient, uint256 amount) external returns (bool) {
        return false;
    }

    function approve(address spender, uint256 amount) external returns (bool) {
        return false;
    }

    function transferFrom(address sender, address recipient, uint256 amount) external returns (bool) {
        return false;
    }

    /**
     * Global
     */

    function incrementTotalBonded(uint256 amount) internal {
        _state.balance.bonded = _state.balance.bonded.add(amount);
    }

    function decrementTotalBonded(uint256 amount, string memory reason) internal {
        _state.balance.bonded = _state.balance.bonded.sub(amount, reason);
    }

    function incrementTotalDebt(uint256 amount) internal {
        _state.balance.debt = _state.balance.debt.add(amount);
    }

    function decrementTotalDebt(uint256 amount, string memory reason) internal {
        _state.balance.debt = _state.balance.debt.sub(amount, reason);
    }

    function setDebtToZero() internal {
        _state.balance.debt = 0;
    }

    function incrementTotalRedeemable(uint256 amount) internal {
        _state.balance.redeemable = _state.balance.redeemable.add(amount);
    }

    function decrementTotalRedeemable(uint256 amount, string memory reason) internal {
        _state.balance.redeemable = _state.balance.redeemable.sub(amount, reason);
    }

    /**
     * Account
     */

    function incrementBalanceOf(address account, uint256 amount) internal {
        _state.accounts[account].balance = _state.accounts[account].balance.add(amount);
        _state.balance.supply = _state.balance.supply.add(amount);

        emit Transfer(address(0), account, amount);
    }

    function decrementBalanceOf(address account, uint256 amount, string memory reason) internal {
        _state.accounts[account].balance = _state.accounts[account].balance.sub(amount, reason);
        _state.balance.supply = _state.balance.supply.sub(amount, reason);

        emit Transfer(account, address(0), amount);
    }

    function incrementBalanceOfStaged(address account, uint256 amount) internal {
        _state.accounts[account].staged = _state.accounts[account].staged.add(amount);
        _state.balance.staged = _state.balance.staged.add(amount);
    }

    function decrementBalanceOfStaged(address account, uint256 amount, string memory reason) internal {
        _state.accounts[account].staged = _state.accounts[account].staged.sub(amount, reason);
        _state.balance.staged = _state.balance.staged.sub(amount, reason);
    }

    function incrementBalanceOfCoupons(address account, uint256 epoch, uint256 amount) internal {
        _state.accounts[account].coupons[epoch] = _state.accounts[account].coupons[epoch].add(amount);
        _state.epochs[epoch].coupons.outstanding = _state.epochs[epoch].coupons.outstanding.add(amount);
        _state.balance.coupons = _state.balance.coupons.add(amount);
    }

    function decrementBalanceOfCoupons(address account, uint256 epoch, uint256 amount, string memory reason) internal {
        _state.accounts[account].coupons[epoch] = _state.accounts[account].coupons[epoch].sub(amount, reason);
        _state.epochs[epoch].coupons.outstanding = _state.epochs[epoch].coupons.outstanding.sub(amount, reason);
        _state.balance.coupons = _state.balance.coupons.sub(amount, reason);
    }

    function unfreeze(address account) internal {
        _state.accounts[account].fluidUntil = epoch().add(Constants.getDAOExitLockupEpochs());
    }

    function updateAllowanceCoupons(address owner, address spender, uint256 amount) internal {
        _state.accounts[owner].couponAllowances[spender] = amount;
    }

    function decrementAllowanceCoupons(address owner, address spender, uint256 amount, string memory reason) internal {
        _state.accounts[owner].couponAllowances[spender] =
            _state.accounts[owner].couponAllowances[spender].sub(amount, reason);
    }

    /**
     * Epoch
     */

    function initializeEpochs() internal {
        _state.epoch.currentStart = block.timestamp.sub(_state.epoch.currentPeriod);
    }

    function incrementEpoch() internal {
        _state.epoch.current = _state.epoch.current.add(1);
        _state.epoch.currentStart = _state.epoch.currentStart.add(_state.epoch.currentPeriod);
    }

    function adjustPeriod(Decimal.D256 memory price) internal {
        Decimal.D256 memory normalizedPrice;
        if (price.greaterThan(Decimal.one())) 
            normalizedPrice = Decimal.one().div(price);
        else
            normalizedPrice = price;
        
        Constants.EpochStrategy memory epochStrategy = Constants.getEpochStrategy();
        
        _state.epoch.currentPeriod = normalizedPrice
            .mul(epochStrategy.maxPeriod.sub(epochStrategy.minPeriod))
            .add(epochStrategy.minPeriod)
            .asUint256();
    }

    function snapshotTotalBonded() internal {
        _state.epochs[epoch()].bonded = totalSupply();
    }

    function initializeCouponsExpiration(uint256 epoch, uint256 expiration) internal {
        _state.epochs[epoch].coupons.expiration = expiration;
        _state.epochs[expiration].coupons.expiring.push(epoch);
    }

    function eliminateOutstandingCoupons(uint256 epoch) internal {
        uint256 outstandingCouponsForEpoch = outstandingCoupons(epoch);
        if(outstandingCouponsForEpoch == 0) {
            return;
        }
        _state.balance.coupons = _state.balance.coupons.sub(outstandingCouponsForEpoch);
        _state.epochs[epoch].coupons.outstanding = 0;
    }

    /**
     * Governance
     */

    function createCandidate(address candidate, uint256 period) internal {
        _state.candidates[candidate].start = epoch();
        _state.candidates[candidate].period = period;
    }

    function recordVote(address account, address candidate, Candidate.Vote vote) internal {
        _state.candidates[candidate].votes[account] = vote;
    }

    function incrementApproveFor(address candidate, uint256 amount) internal {
        _state.candidates[candidate].approve = _state.candidates[candidate].approve.add(amount);
    }

    function decrementApproveFor(address candidate, uint256 amount, string memory reason) internal {
        _state.candidates[candidate].approve = _state.candidates[candidate].approve.sub(amount, reason);
    }

    function incrementRejectFor(address candidate, uint256 amount) internal {
        _state.candidates[candidate].reject = _state.candidates[candidate].reject.add(amount);
    }

    function decrementRejectFor(address candidate, uint256 amount, string memory reason) internal {
        _state.candidates[candidate].reject = _state.candidates[candidate].reject.sub(amount, reason);
    }

    function placeLock(address account, address candidate) internal {
        uint256 currentLock = _state.accounts[account].lockedUntil;
        uint256 newLock = startFor(candidate).add(periodFor(candidate));
        if (newLock &gt; currentLock) {
            _state.accounts[account].lockedUntil = newLock;
        }
    }

    function initialized(address candidate) internal {
        _state.candidates[candidate].initialized = true;
    }
}</span>

<span class="marker" id="mapping-1501"></span><span class="token del" data-title="source_file/comment">/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/</span>
<span class="marker" id="mapping-1502"></span><span class="token mv" id="move-src-502" data-title="source_file/contract_declaration">contract Permission is Setters {

    bytes32 private constant FILE = "Permission";

    // Can modify account state
    modifier onlyFrozenOrFluid(address account) {
        Require.that(
            statusOf(account) != Account.Status.Locked,
            FILE,
            "Not frozen or fluid"
        );

        _;
    }

    // Can participate in balance-dependant activities
    modifier onlyFrozenOrLocked(address account) {
        Require.that(
            statusOf(account) != Account.Status.Fluid,
            FILE,
            "Not frozen or locked"
        );

        _;
    }

    modifier initializer() {
        Require.that(
            !isInitialized(implementation()),
            FILE,
            "Already initialized"
        );

        initialized(implementation());

        _;
    }
}</span>

<span class="marker" id="mapping-1503"></span><span class="token del" data-title="source_file/comment">/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/</span>
<span class="marker" id="mapping-1504"></span><span class="token del" data-title="source_file/contract_declaration">contract Deployer1 is <span class="marker" id="mapping-1505"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">State</span>, <span class="marker" id="mapping-1506"></span><span class="token mv" id="move-src-503" data-title="contract_declaration/inheritance_specifier">Permission</span>, <span class="marker" id="mapping-1507"></span><span class="token mv" id="move-src-504" data-title="contract_declaration/inheritance_specifier">Upgradeable</span> <span class="marker" id="mapping-1508"></span><span class="token del" data-title="contract_declaration/contract_body">{
    function initialize() initializer public {
        _state.provider.dollar = new Dollar();
    }

    function implement(address implementation) external {
        upgradeTo(implementation);
    }
}</span></span>

<span class="marker" id="mapping-1509"></span><span class="token del" data-title="source_file/contract_declaration">contract Deployer2 is <span class="marker" id="mapping-1510"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">State</span>, <span class="marker" id="mapping-1511"></span><span class="token mv" id="move-src-505" data-title="contract_declaration/inheritance_specifier">Permission</span>, <span class="marker" id="mapping-1512"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">Upgradeable</span> <span class="marker" id="mapping-1513"></span><span class="token del" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-1514"></span><span class="token del" data-title="contract_body/function_definition">function initialize() <span class="marker" id="mapping-1515"></span><span class="token del" data-title="function_definition/modifier_invocation">initializer</span> <span class="marker" id="mapping-1516"></span><span class="token del" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-1517"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1518"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-1519"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-1520"></span><span class="token del" data-title="assignment_expression/member_expression">_state.provider.oracle</span> = <span class="marker" id="mapping-1521"></span><span class="token del" data-title="assignment_expression/call_expression"><span class="marker" id="mapping-1522"></span><span class="token del" data-title="call_expression/new_expression">new Oracle</span>(<span class="marker" id="mapping-1523"></span><span class="token del" data-title="call_expression/call_argument"><span class="marker" id="mapping-1524"></span><span class="token del" data-title="call_argument/type_cast_expression"><span class="marker" id="mapping-1525"></span><span class="token del" data-title="type_cast_expression/primitive_type">address</span>(<span class="marker" id="mapping-1526"></span><span class="token del" data-title="type_cast_expression/call_argument"><span class="marker" id="mapping-1527"></span><span class="token mv" id="move-src-506" data-title="call_argument/call_expression">dollar()</span></span>)</span></span>)</span></span>;</span>
        <span class="marker" id="mapping-1528"></span><span class="token del" data-title="function_body/expression_statement"><span class="marker" id="mapping-1529"></span><span class="token del" data-title="expression_statement/call_expression"><span class="marker" id="mapping-1530"></span><span class="token mv" id="move-src-507" data-title="call_expression/member_expression">oracle().<span class="marker" id="mapping-1531"></span><span class="token upd" id="move-src-508" data-title="member_expression/identifier">se<span class="cupd">tu</span>p</span></span>()</span>;</span>
    }</span></span>

    <span class="marker" id="mapping-1532"></span><span class="token del" data-title="contract_body/function_definition">function implement(address implementation) external {
        upgradeTo(implementation);
    }</span>
}</span></span>

<span class="marker" id="mapping-1533"></span><span class="token del" data-title="source_file/contract_declaration">contract Deployer3 is <span class="marker" id="mapping-1534"></span><span class="token mv" id="move-src-509" data-title="contract_declaration/inheritance_specifier">State</span>, <span class="marker" id="mapping-1535"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">Permission</span>, <span class="marker" id="mapping-1536"></span><span class="token del" data-title="contract_declaration/inheritance_specifier">Upgradeable</span> <span class="marker" id="mapping-1537"></span><span class="token del" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-1538"></span><span class="token del" data-title="contract_body/function_definition">function initialize() <span class="marker" id="mapping-1539"></span><span class="token mv" id="move-src-510" data-title="function_definition/modifier_invocation">initializer</span> <span class="marker" id="mapping-1540"></span><span class="token mv" id="move-src-511" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-1541"></span><span class="token del" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1542"></span><span class="token mv" id="move-src-512" data-title="function_body/expression_statement"><span class="marker" id="mapping-1543"></span><span class="token del" data-title="expression_statement/assignment_expression"><span class="marker" id="mapping-1544"></span><span class="token del" data-title="assignment_expression/member_expression">_state.provider.pool</span> = <span class="marker" id="mapping-1545"></span><span class="token del" data-title="assignment_expression/type_cast_expression"><span class="marker" id="mapping-1546"></span><span class="token del" data-title="type_cast_expression/primitive_type">address</span>(<span class="marker" id="mapping-1547"></span><span class="token del" data-title="type_cast_expression/call_argument"><span class="marker" id="mapping-1548"></span><span class="token mv" id="move-src-513" data-title="call_argument/call_expression"><span class="marker" id="mapping-1549"></span><span class="token del" data-title="call_expression/new_expression">new Pool</span>(<span class="marker" id="mapping-1550"></span><span class="token del" data-title="call_expression/call_argument"><span class="marker" id="mapping-1551"></span><span class="token del" data-title="call_argument/type_cast_expression"><span class="marker" id="mapping-1552"></span><span class="token del" data-title="type_cast_expression/primitive_type">address</span>(<span class="marker" id="mapping-1553"></span><span class="token del" data-title="type_cast_expression/call_argument"><span class="marker" id="mapping-1554"></span><span class="token mv" id="move-src-514" data-title="call_argument/call_expression">dollar()</span></span>)</span></span><span class="marker" id="mapping-1555"></span><span class="token del" data-title="call_expression/,">,</span> <span class="marker" id="mapping-1556"></span><span class="token del" data-title="call_expression/call_argument"><span class="marker" id="mapping-1557"></span><span class="token del" data-title="call_argument/type_cast_expression"><span class="marker" id="mapping-1558"></span><span class="token del" data-title="type_cast_expression/primitive_type">address</span>(<span class="marker" id="mapping-1559"></span><span class="token mv" id="move-src-515" data-title="type_cast_expression/call_argument">oracle().pair()</span>)</span></span>)</span></span>)</span></span>;</span>
    }</span></span>

    <span class="marker" id="mapping-1560"></span><span class="token del" data-title="contract_body/function_definition">function implement(address implementation) external {
        upgradeTo(implementation);
    }</span>
}</span></span></pre></div><div class="col-6"><h5>0x9086b180cb76bda8876296f5becf2baa76831161.etherscan.io-Implementation.sol</h5><pre class="pre-scrollable">// SPDX-License-Identifier: none

pragma solidity ^0.5.17;
pragma experimental ABIEncoderV2;


<span class="marker" id="mapping-1561"></span><span class="token mv" id="move-dst-2" data-title="source_file/comment"><span class="marker" id="mapping-1562"></span><span class="token upd" id="move-dst-2" data-title="source_file/comment"><span class="cupd">/*</span>*<span class="cupd">
 * @dev </span>W<span class="cupd">r</span>appers <span class="cupd">ov</span>er Sol<span class="cupd">id</span>ity'<span class="cupd">s </span>ar<span class="cupd">i</span>thmetic <span class="cupd">o</span>pe<span class="cupd">r</span><span class="cupd">ation</span>s<span class="cupd"> </span>wi<span class="cupd">t</span><span class="cupd">h</span><span class="cupd"> </span>add<span class="cupd">e</span>d<span class="cupd"> </span>ov<span class="cupd">e</span>rfl<span class="cupd">o</span>w<span class="cupd">
</span><span class="cupd"> </span>* <span class="cupd">c</span><span class="cupd">he</span>cks.<span class="cupd">
 *
</span><span class="cupd"> </span>*<span class="cupd"> </span>Ari<span class="cupd">th</span>m<span class="cupd">e</span>tic<span class="cupd"> </span>ope<span class="cupd">ra</span><span class="cupd">tion</span>s<span class="cupd"> </span>i<span class="cupd">n</span><span class="cupd"> </span>Sol<span class="cupd">i</span>di<span class="cupd">t</span>y<span class="cupd"> </span>wr<span class="cupd">a</span>p on overflow<span class="cupd">. </span>T<span class="cupd">hi</span><span class="cupd">s</span><span class="cupd"> </span>c<span class="cupd">a</span>n<span class="cupd"> </span><span class="cupd">e</span><span class="cupd">a</span>si<span class="cupd">l</span><span class="cupd">y </span>resu<span class="cupd">l</span>t<span class="cupd">
 * </span><span class="cupd">i</span>n<span class="cupd"> </span>bu<span class="cupd">g</span><span class="cupd">s</span>, b<span class="cupd">e</span>caus<span class="cupd">e</span> p<span class="cupd">r</span>ogr<span class="cupd">a</span><span class="cupd">m</span>mer<span class="cupd">s</span> usu<span class="cupd">a</span>lly <span class="cupd">a</span>ssume<span class="cupd"> th</span>at<span class="cupd"> </span>an <span class="cupd">o</span>verf<span class="cupd">l</span><span class="cupd">o</span>w<span class="cupd"> </span>r<span class="cupd">a</span>i<span class="cupd">s</span><span class="cupd">e</span><span class="cupd">s</span><span class="cupd"> a</span>n<span class="cupd">
</span><span class="cupd"> </span><span class="cupd">* </span><span class="cupd">er</span>ror<span class="cupd">, </span>wh<span class="cupd">i</span><span class="cupd">c</span><span class="cupd">h</span><span class="cupd"> </span><span class="cupd">i</span>s<span class="cupd"> </span><span class="cupd">th</span>e<span class="cupd"> </span>s<span class="cupd">ta</span>nda<span class="cupd">r</span>d beh<span class="cupd">a</span>v<span class="cupd">io</span>r i<span class="cupd">n</span><span class="cupd"> </span><span class="cupd">h</span>igh l<span class="cupd">e</span>vel<span class="cupd"> </span>progr<span class="cupd">a</span>mm<span class="cupd">ing </span>l<span class="cupd">an</span>guages.<span class="cupd">
 * </span>`S<span class="cupd">a</span>feMath`<span class="cupd"> </span>rest<span class="cupd">or</span>es<span class="cupd"> </span>this int<span class="cupd">u</span>i<span class="cupd">tion </span>b<span class="cupd">y </span>reverti<span class="cupd">n</span>g<span class="cupd"> </span><span class="cupd">the </span>tr<span class="cupd">a</span>nsa<span class="cupd">ct</span>ion<span class="cupd"> </span>wh<span class="cupd">en</span><span class="cupd"> </span><span class="cupd">a</span>n<span class="cupd">
</span><span class="cupd"> </span>*<span class="cupd"> </span>o<span class="cupd">p</span>er<span class="cupd">ation </span><span class="cupd">o</span>v<span class="cupd">er</span>flows<span class="cupd">.
 *
 * </span>Using t<span class="cupd">his </span>lib<span class="cupd">ra</span>ry<span class="cupd"> i</span>n<span class="cupd">s</span>tead<span class="cupd"> o</span>f<span class="cupd"> </span>th<span class="cupd">e</span> <span class="cupd">u</span>nch<span class="cupd">e</span>cke<span class="cupd">d </span><span class="cupd">o</span>pe<span class="cupd">r</span>at<span class="cupd">i</span>o<span class="cupd">n</span>s <span class="cupd">e</span>li<span class="cupd">m</span><span class="cupd">i</span>n<span class="cupd">ate</span>s<span class="cupd"> </span>an ent<span class="cupd">i</span><span class="cupd">r</span><span class="cupd">e
</span> * <span class="cupd">c</span>lass <span class="cupd">o</span>f bugs, so i<span class="cupd">t</span>'s <span class="cupd">r</span>e<span class="cupd">c</span>ommended <span class="cupd">t</span>o u<span class="cupd">s</span>e it always<span class="cupd">.
 */</span></span></span>
library SafeMath {
    /**
     * @dev Returns the addition of two unsigned integers, reverting on
     * overflow.
     *
     * Counterpart to Solidity's `+` operator.
     *
     * Requirements:
     * - Addition cannot overflow.
     */
    function add(uint256 a, uint256 b) internal pure returns (uint256) {
        uint256 c = a + b;
        require(c &gt;= a, "SafeMath: addition overflow");

        return c;
    }

    /**
     * @dev Returns the subtraction of two unsigned integers, reverting on
     * overflow (when the result is negative).
     *
     * Counterpart to Solidity's `-` operator.
     *
     * Requirements:
     * - Subtraction cannot overflow.
     */
    function sub(uint256 a, uint256 b) internal pure returns (uint256) {
        return sub(a, b, "SafeMath: subtraction overflow");
    }

    /**
     * @dev Returns the subtraction of two unsigned integers, reverting with custom message on
     * overflow (when the result is negative).
     *
     * Counterpart to Solidity's `-` operator.
     *
     * Requirements:
     * - Subtraction cannot overflow.
     *
     * _Available since v2.4.0._
     */
    function sub(uint256 a, uint256 b, string memory errorMessage) internal pure returns (uint256) {
        require(b &lt;= a, errorMessage);
        uint256 c = a - b;

        return c;
    }

    /**
     * @dev Returns the multiplication of two unsigned integers, reverting on
     * overflow.
     *
     * Counterpart to Solidity's `*` operator.
     *
     * Requirements:
     * - Multiplication cannot overflow.
     */
    function mul(uint256 a, uint256 b) internal pure returns (uint256) {
        // Gas optimization: this is cheaper than requiring 'a' not being zero, but the
        // benefit is lost if 'b' is also tested.
        // See: https://github.com/OpenZeppelin/openzeppelin-contracts/pull/522
        if (a == 0) {
            return 0;
        }

        uint256 c = a * b;
        require(c / a == b, "SafeMath: multiplication overflow");

        return c;
    }

    /**
     * @dev Returns the integer division of two unsigned integers. Reverts on
     * division by zero. The result is rounded towards zero.
     *
     * Counterpart to Solidity's `/` operator. Note: this function uses a
     * `revert` opcode (which leaves remaining gas untouched) while Solidity
     * uses an invalid opcode to revert (consuming all remaining gas).
     *
     * Requirements:
     * - The divisor cannot be zero.
     */
    function div(uint256 a, uint256 b) internal pure returns (uint256) {
        return div(a, b, "SafeMath: division by zero");
    }

    /**
     * @dev Returns the integer division of two unsigned integers. Reverts with custom message on
     * division by zero. The result is rounded towards zero.
     *
     * Counterpart to Solidity's `/` operator. Note: this function uses a
     * `revert` opcode (which leaves remaining gas untouched) while Solidity
     * uses an invalid opcode to revert (consuming all remaining gas).
     *
     * Requirements:
     * - The divisor cannot be zero.
     *
     * _Available since v2.4.0._
     */
    function div(uint256 a, uint256 b, string memory errorMessage) internal pure returns (uint256) {
        // Solidity only automatically asserts when dividing by 0
        require(b &gt; 0, errorMessage);
        uint256 c = a / b;
        // assert(a == b * c + a % b); // There is no case in which this doesn't hold

        return c;
    }

    /**
     * @dev Returns the remainder of dividing two unsigned integers. (unsigned integer modulo),
     * Reverts when dividing by zero.
     *
     * Counterpart to Solidity's `%` operator. This function uses a `revert`
     * opcode (which leaves remaining gas untouched) while Solidity uses an
     * invalid opcode to revert (consuming all remaining gas).
     *
     * Requirements:
     * - The divisor cannot be zero.
     */
    function mod(uint256 a, uint256 b) internal pure returns (uint256) {
        return mod(a, b, "SafeMath: modulo by zero");
    }

    /**
     * @dev Returns the remainder of dividing two unsigned integers. (unsigned integer modulo),
     * Reverts with custom message when dividing by zero.
     *
     * Counterpart to Solidity's `%` operator. This function uses a `revert`
     * opcode (which leaves remaining gas untouched) while Solidity uses an
     * invalid opcode to revert (consuming all remaining gas).
     *
     * Requirements:
     * - The divisor cannot be zero.
     *
     * _Available since v2.4.0._
     */
    function mod(uint256 a, uint256 b, string memory errorMessage) internal pure returns (uint256) {
        require(b != 0, errorMessage);
        return a % b;
    }
}

/*
    Copyright 2019 dYdX Trading Inc.
    Copyright 2020 Dynamic Dollar Devs, based on the works of the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
/**
 * @title Decimal
 * @author dYdX
 *
 * Library that defines a fixed-point number with 18 decimal places.
 */
library Decimal {
    using SafeMath for uint256;

    // ============ Constants ============

    uint256 constant BASE = 10**18;

    // ============ Structs ============


    struct D256 {
        uint256 value;
    }

    // ============ Static Functions ============

    function zero()
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: 0 });
    }

    function one()
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: BASE });
    }

    function from(
        uint256 a
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: a.mul(BASE) });
    }

    function ratio(
        uint256 a,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: getPartial(a, BASE, b) });
    }

    // ============ Self Functions ============

    function add(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.add(b.mul(BASE)) });
    }

    function sub(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.sub(b.mul(BASE)) });
    }

    function sub(
        D256 memory self,
        uint256 b,
        string memory reason
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.sub(b.mul(BASE), reason) });
    }

    function mul(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.mul(b) });
    }

    function div(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.div(b) });
    }

    function pow(
        D256 memory self,
        uint256 b
    )
    internal
    pure
    returns (D256 memory)
    {
        if (b == 0) {
            return from(1);
        }

        D256 memory temp = D256({ value: self.value });
        for (uint256 i = 1; i &lt; b; i++) {
            temp = mul(temp, self);
        }

        return temp;
    }

    function add(
        D256 memory self,
        D256 memory b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.add(b.value) });
    }

    function sub(
        D256 memory self,
        D256 memory b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.sub(b.value) });
    }

    function sub(
        D256 memory self,
        D256 memory b,
        string memory reason
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: self.value.sub(b.value, reason) });
    }

    function mul(
        D256 memory self,
        D256 memory b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: getPartial(self.value, b.value, BASE) });
    }

    function div(
        D256 memory self,
        D256 memory b
    )
    internal
    pure
    returns (D256 memory)
    {
        return D256({ value: getPartial(self.value, BASE, b.value) });
    }

    function equals(D256 memory self, D256 memory b) internal pure returns (bool) {
        return self.value == b.value;
    }

    function greaterThan(D256 memory self, D256 memory b) internal pure returns (bool) {
        return compareTo(self, b) == 2;
    }

    function lessThan(D256 memory self, D256 memory b) internal pure returns (bool) {
        return compareTo(self, b) == 0;
    }

    function greaterThanOrEqualTo(D256 memory self, D256 memory b) internal pure returns (bool) {
        return compareTo(self, b) &gt; 0;
    }

    function lessThanOrEqualTo(D256 memory self, D256 memory b) internal pure returns (bool) {
        return compareTo(self, b) &lt; 2;
    }

    function isZero(D256 memory self) internal pure returns (bool) {
        return self.value == 0;
    }

    function asUint256(D256 memory self) internal pure returns (uint256) {
        return self.value.div(BASE);
    }

    // ============ Core Methods ============

    function getPartial(
        uint256 target,
        uint256 numerator,
        uint256 denominator
    )
    private
    pure
    returns (uint256)
    {
        return target.mul(numerator).div(denominator);
    }

    function compareTo(
        D256 memory a,
        D256 memory b
    )
    private
    pure
    returns (uint256)
    {
        if (a.value == b.value) {
            return 1;
        }
        return a.value &gt; b.value ? 2 : 0;
    }
}

/*
    Copyright 2020 Dynamic Dollar Devs, based on the works of the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
library Constants {
    /* Chain */
    uint256 private constant CHAIN_ID = 1; // Mainnet

    /* Bootstrapping */
    uint256 private constant BOOTSTRAPPING_PERIOD = 200; // 200 epochs
    uint256 private constant BOOTSTRAPPING_PRICE = 154e16; // 1.54 DAI (targeting 4.5% inflation)

    /* Oracle */
    address private constant DAI = address(0x6B175474E89094C44Da98b954EedeAC495271d0F);
    uint256 private constant ORACLE_RESERVE_MINIMUM = 1e22; // 10,000 DAI

    /* Bonding */
    uint256 private constant INITIAL_STAKE_MULTIPLE = 1e6; // 100 RFSD -&gt; 100M RSS

    /* Epoch */
    struct EpochStrategy {
        uint256 offset;
        uint256 minPeriod;
        uint256 maxPeriod;
    }

    uint256 private constant EPOCH_OFFSET = 0;
    uint256 private constant EPOCH_MIN_PERIOD = 1800;
    uint256 private constant EPOCH_MAX_PERIOD = 7200;

    /* Governance */
    uint256 private constant GOVERNANCE_PERIOD = 21;
    uint256 private constant GOVERNANCE_QUORUM = 20e16; // 20%
    uint256 private constant GOVERNANCE_SUPER_MAJORITY = 66e16; // 66%
    uint256 private constant GOVERNANCE_EMERGENCY_DELAY = 6; // 6 epochs

    /* DAO */
    uint256 private constant ADVANCE_INCENTIVE = 100e18; // 100 RFSD
    uint256 private constant DAO_EXIT_LOCKUP_EPOCHS = 36; // 36 epochs fluid

    /* Pool */
    uint256 private constant POOL_EXIT_LOCKUP_EPOCHS = 12; // 12 epochs fluid

    /* Market */
    uint256 private constant COUPON_EXPIRATION = 360;
    uint256 private constant DEBT_RATIO_CAP = 40e16; // 40%
    uint256 private constant INITIAL_COUPON_REDEMPTION_PENALTY = 50e16; // 50%

    /* Regulator */
    uint256 private constant SUPPLY_CHANGE_DIVISOR = 12e18; // 12
    uint256 private constant SUPPLY_CHANGE_LIMIT = 10e16; // 10%
    uint256 private constant ORACLE_POOL_RATIO = 60; // 60%

    /**
     * Getters
     */
    function getDAIAddress() internal pure returns (address) {
        return DAI;
    }

    function getOracleReserveMinimum() internal pure returns (uint256) {
        return ORACLE_RESERVE_MINIMUM;
    }

    function getEpochStrategy() internal pure returns (EpochStrategy memory) {
        return EpochStrategy({
            offset: EPOCH_OFFSET,
            minPeriod: EPOCH_MIN_PERIOD,
            maxPeriod: EPOCH_MAX_PERIOD
        });
    }

    function getInitialStakeMultiple() internal pure returns (uint256) {
        return INITIAL_STAKE_MULTIPLE;
    }

    function getBootstrappingPeriod() internal pure returns (uint256) {
        return BOOTSTRAPPING_PERIOD;
    }

    function getBootstrappingPrice() internal pure returns (Decimal.D256 memory) {
        return Decimal.D256({value: BOOTSTRAPPING_PRICE});
    }

    function getGovernancePeriod() internal pure returns (uint256) {
        return GOVERNANCE_PERIOD;
    }

    function getGovernanceQuorum() internal pure returns (Decimal.D256 memory) {
        return Decimal.D256({value: GOVERNANCE_QUORUM});
    }

    function getGovernanceSuperMajority() internal pure returns (Decimal.D256 memory) {
        return Decimal.D256({value: GOVERNANCE_SUPER_MAJORITY});
    }

    function getGovernanceEmergencyDelay() internal pure returns (uint256) {
        return GOVERNANCE_EMERGENCY_DELAY;
    }

    function getAdvanceIncentive() internal pure returns (uint256) {
        return ADVANCE_INCENTIVE;
    }

    function getDAOExitLockupEpochs() internal pure returns (uint256) {
        return DAO_EXIT_LOCKUP_EPOCHS;
    }

    function getPoolExitLockupEpochs() internal pure returns (uint256) {
        return POOL_EXIT_LOCKUP_EPOCHS;
    }

    function getCouponExpiration() internal pure returns (uint256) {
        return COUPON_EXPIRATION;
    }

    function getDebtRatioCap() internal pure returns (Decimal.D256 memory) {
        return Decimal.D256({value: DEBT_RATIO_CAP});
    }
    
    function getInitialCouponRedemptionPenalty() internal pure returns (Decimal.D256 memory) {
        return Decimal.D256({value: INITIAL_COUPON_REDEMPTION_PENALTY});
    }

    function getSupplyChangeLimit() internal pure returns (Decimal.D256 memory) {
        return Decimal.D256({value: SUPPLY_CHANGE_LIMIT});
    }

    function getSupplyChangeDivisor() internal pure returns (Decimal.D256 memory) {
        return Decimal.D256({value: SUPPLY_CHANGE_DIVISOR});
    }

    function getOraclePoolRatio() internal pure returns (uint256) {
        return ORACLE_POOL_RATIO;
    }

    function getChainId() internal pure returns (uint256) {
        return CHAIN_ID;
    }
}

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
<span class="marker" id="mapping-1563"></span><span class="token add" data-title="source_file/contract_declaration">contract Curve <span class="marker" id="mapping-1564"></span><span class="token add" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-1565"></span><span class="token add" data-title="contract_body/using_directive">using SafeMath for uint256;</span>
    <span class="marker" id="mapping-1566"></span><span class="token mv" id="move-dst-75" data-title="contract_body/using_directive">using Decimal for Decimal.D256;</span>

    <span class="marker" id="mapping-1567"></span><span class="token add" data-title="contract_body/function_definition">function calculateCouponPremium(
        <span class="marker" id="mapping-1568"></span><span class="token add" data-title="function_definition/parameter"><span class="marker" id="mapping-1569"></span><span class="token mv" id="move-dst-14" data-title="parameter/type_name">uint256</span> totalSupply</span>,
        <span class="marker" id="mapping-1570"></span><span class="token add" data-title="function_definition/parameter"><span class="marker" id="mapping-1571"></span><span class="token mv" id="move-dst-82" data-title="parameter/type_name">uint256</span> totalDebt</span>,
        <span class="marker" id="mapping-1572"></span><span class="token mv" id="move-dst-51" data-title="function_definition/parameter">uint256 amount</span>
    ) <span class="marker" id="mapping-1573"></span><span class="token mv" id="move-dst-83" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-1574"></span><span class="token mv" id="move-dst-236" data-title="function_definition/state_mutability">pure</span> <span class="marker" id="mapping-1575"></span><span class="token mv" id="move-dst-19" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-1576"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1577"></span><span class="token add" data-title="function_body/return_statement">return <span class="marker" id="mapping-1578"></span><span class="token add" data-title="return_statement/call_expression"><span class="marker" id="mapping-1579"></span><span class="token add" data-title="call_expression/member_expression"><span class="marker" id="mapping-1580"></span><span class="token add" data-title="member_expression/call_expression"><span class="marker" id="mapping-1581"></span><span class="token add" data-title="call_expression/member_expression"><span class="marker" id="mapping-1582"></span><span class="token add" data-title="member_expression/call_expression">effectivePremium(<span class="marker" id="mapping-1583"></span><span class="token add" data-title="call_expression/call_argument">totalSupply</span>, <span class="marker" id="mapping-1584"></span><span class="token add" data-title="call_expression/call_argument">totalDebt</span>, <span class="marker" id="mapping-1585"></span><span class="token mv" id="move-dst-116" data-title="call_expression/call_argument">amount</span>)</span>.mul</span>(<span class="marker" id="mapping-1586"></span><span class="token mv" id="move-dst-103" data-title="call_expression/call_argument">amount</span>)</span>.asUint256</span>()</span>;</span>
    }</span></span>

    <span class="marker" id="mapping-1587"></span><span class="token add" data-title="contract_body/function_definition">function effectivePremium(
        <span class="marker" id="mapping-1588"></span><span class="token mv" id="move-dst-27" data-title="function_definition/parameter">uint256 <span class="marker" id="mapping-1589"></span><span class="token upd" id="move-dst-28" data-title="parameter/identifier"><span class="cupd">t</span>o<span class="cupd">t</span><span class="cupd">al</span>Supply</span></span>,
        <span class="marker" id="mapping-1590"></span><span class="token mv" id="move-dst-25" data-title="function_definition/parameter">uint256 <span class="marker" id="mapping-1591"></span><span class="token upd" id="move-dst-26" data-title="parameter/identifier">tot<span class="cupd">a</span><span class="cupd">l</span>Debt</span></span>,
        <span class="marker" id="mapping-1592"></span><span class="token mv" id="move-dst-55" data-title="function_definition/parameter">uint256 amount</span>
    ) <span class="marker" id="mapping-1593"></span><span class="token mv" id="move-dst-16" data-title="function_definition/visibility">private</span> <span class="marker" id="mapping-1594"></span><span class="token mv" id="move-dst-238" data-title="function_definition/state_mutability">pure</span> <span class="marker" id="mapping-1595"></span><span class="token add" data-title="function_definition/return_type_definition">returns (Decimal.D256 memory)</span> <span class="marker" id="mapping-1596"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1597"></span><span class="token mv" id="move-dst-125" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1598"></span><span class="token mv" id="move-dst-126" data-title="variable_declaration_statement/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-1599"></span><span class="token upd" id="move-dst-127" data-title="variable_declaration/identifier">d<span class="cupd">e</span>b<span class="cupd">t</span>R<span class="cupd">a</span>tio</span></span> = <span class="marker" id="mapping-1600"></span><span class="token add" data-title="call_expression/member_expression">Decimal.ratio</span>(<span class="marker" id="mapping-1601"></span><span class="token add" data-title="call_expression/call_argument">totalDebt</span><span class="marker" id="mapping-1602"></span><span class="token add" data-title="call_expression/,">,</span> <span class="marker" id="mapping-1603"></span><span class="token add" data-title="call_expression/call_argument">totalSupply</span>);</span>
        <span class="marker" id="mapping-1604"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1605"></span><span class="token mv" id="move-dst-137" data-title="variable_declaration_statement/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-1606"></span><span class="token upd" id="move-dst-138" data-title="variable_declaration/identifier">d<span class="cupd">e</span>b<span class="cupd">t</span>RatioUpp<span class="cupd">er</span>B<span class="cupd">oun</span>d</span></span> = <span class="marker" id="mapping-1607"></span><span class="token add" data-title="variable_declaration_statement/call_expression">Constants.getDebtRatioCap()</span>;</span>

        <span class="marker" id="mapping-1608"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1609"></span><span class="token add" data-title="variable_declaration_statement/variable_declaration">uint256 totalSupplyEnd</span> = <span class="marker" id="mapping-1610"></span><span class="token add" data-title="variable_declaration_statement/call_expression"><span class="marker" id="mapping-1611"></span><span class="token add" data-title="call_expression/member_expression">totalSupply.sub</span>(<span class="marker" id="mapping-1612"></span><span class="token mv" id="move-dst-132" data-title="call_expression/call_argument">amount</span>)</span>;</span>
        <span class="marker" id="mapping-1613"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1614"></span><span class="token add" data-title="variable_declaration_statement/variable_declaration">uint256 totalDebtEnd</span> = <span class="marker" id="mapping-1615"></span><span class="token add" data-title="variable_declaration_statement/call_expression"><span class="marker" id="mapping-1616"></span><span class="token add" data-title="call_expression/member_expression">totalDebt.sub</span>(<span class="marker" id="mapping-1617"></span><span class="token mv" id="move-dst-143" data-title="call_expression/call_argument">amount</span>)</span>;</span>
        <span class="marker" id="mapping-1618"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1619"></span><span class="token mv" id="move-dst-128" data-title="variable_declaration_statement/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-1620"></span><span class="token upd" id="move-dst-129" data-title="variable_declaration/identifier">d<span class="cupd">e</span>b<span class="cupd">t</span>R<span class="cupd">a</span>ti<span class="cupd">o</span>End</span></span> = <span class="marker" id="mapping-1621"></span><span class="token add" data-title="variable_declaration_statement/call_expression">Decimal.ratio(totalDebtEnd, totalSupplyEnd)</span>;</span>

        <span class="marker" id="mapping-1622"></span><span class="token add" data-title="function_body/if_statement">if (<span class="marker" id="mapping-1623"></span><span class="token add" data-title="if_statement/call_expression">debtRatio.greaterThan(debtRatioUpperBound)</span>) <span class="marker" id="mapping-1624"></span><span class="token add" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-1625"></span><span class="token add" data-title="block_statement/if_statement">if (debtRatioEnd.greaterThan(debtRatioUpperBound)) {
                return curve(debtRatioUpperBound);
            }</span>

            <span class="marker" id="mapping-1626"></span><span class="token mv" id="move-dst-100" data-title="block_statement/variable_declaration_statement">Decimal.D256 memory <span class="marker" id="mapping-1627"></span><span class="token upd" id="move-dst-101" data-title="variable_declaration/identifier">premiumCur<span class="cupd">v</span>e</span> = <span class="marker" id="mapping-1628"></span><span class="token add" data-title="variable_declaration_statement/call_expression">curveMean(debtRatioEnd, debtRatioUpperBound)</span>;</span>
            <span class="marker" id="mapping-1629"></span><span class="token mv" id="move-dst-113" data-title="block_statement/variable_declaration_statement">Decimal.D256 memory <span class="marker" id="mapping-1630"></span><span class="token upd" id="move-dst-114" data-title="variable_declaration/identifier">pr<span class="cupd">e</span>mi<span class="cupd">u</span>mCurveDelta</span> = <span class="marker" id="mapping-1631"></span><span class="token add" data-title="variable_declaration_statement/call_expression">debtRatioUpperBound.sub(debtRatioEnd)</span>;</span>
            <span class="marker" id="mapping-1632"></span><span class="token add" data-title="block_statement/variable_declaration_statement"><span class="marker" id="mapping-1633"></span><span class="token mv" id="move-dst-157" data-title="variable_declaration_statement/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-1634"></span><span class="token upd" id="move-dst-158" data-title="variable_declaration/identifier">pr<span class="cupd">e</span><span class="cupd">m</span>i<span class="cupd">u</span>mFlat</span></span> = <span class="marker" id="mapping-1635"></span><span class="token add" data-title="variable_declaration_statement/call_expression">curve(debtRatioUpperBound)</span>;</span>
            <span class="marker" id="mapping-1636"></span><span class="token add" data-title="block_statement/variable_declaration_statement"><span class="marker" id="mapping-1637"></span><span class="token mv" id="move-dst-159" data-title="variable_declaration_statement/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-1638"></span><span class="token upd" id="move-dst-160" data-title="variable_declaration/identifier">pr<span class="cupd">e</span>miumFla<span class="cupd">t</span>D<span class="cupd">e</span><span class="cupd">l</span><span class="cupd">t</span>a</span></span> = <span class="marker" id="mapping-1639"></span><span class="token add" data-title="variable_declaration_statement/call_expression">debtRatio.sub(debtRatioUpperBound)</span>;</span>
            <span class="marker" id="mapping-1640"></span><span class="token add" data-title="block_statement/return_statement">return (premiumCurve.mul(premiumCurveDelta)).add(premiumFlat.mul(premiumFlatDelta))
                .div(premiumCurveDelta.add(premiumFlatDelta));</span>
        }</span></span>

        <span class="marker" id="mapping-1641"></span><span class="token add" data-title="function_body/return_statement">return curveMean(debtRatioEnd, debtRatio);</span>
    }</span></span>

    // 1/(3(1-R)^2)-1/3
    <span class="marker" id="mapping-1642"></span><span class="token add" data-title="contract_body/function_definition">function curve(<span class="marker" id="mapping-1643"></span><span class="token mv" id="move-dst-259" data-title="function_definition/parameter">Decimal.D256 memory <span class="marker" id="mapping-1644"></span><span class="token add" data-title="parameter/identifier">debtRatio</span></span>) <span class="marker" id="mapping-1645"></span><span class="token mv" id="move-dst-18" data-title="function_definition/visibility">private</span> <span class="marker" id="mapping-1646"></span><span class="token mv" id="move-dst-195" data-title="function_definition/state_mutability">pure</span> <span class="marker" id="mapping-1647"></span><span class="token add" data-title="function_definition/return_type_definition">returns (Decimal.D256 memory)</span> <span class="marker" id="mapping-1648"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1649"></span><span class="token add" data-title="function_body/return_statement">return <span class="marker" id="mapping-1650"></span><span class="token add" data-title="return_statement/call_expression"><span class="marker" id="mapping-1651"></span><span class="token add" data-title="call_expression/member_expression"><span class="marker" id="mapping-1652"></span><span class="token add" data-title="member_expression/call_expression"><span class="marker" id="mapping-1653"></span><span class="token add" data-title="call_expression/member_expression">Decimal.one().div</span>(
            <span class="marker" id="mapping-1654"></span><span class="token add" data-title="call_expression/call_argument"><span class="marker" id="mapping-1655"></span><span class="token mv" id="move-dst-102" data-title="call_argument/call_expression">Decimal.from(<span class="marker" id="mapping-1656"></span><span class="token add" data-title="call_expression/call_argument">3</span>).<span class="marker" id="mapping-1657"></span><span class="token upd" id="move-dst-104" data-title="member_expression/identifier">mul</span>(<span class="marker" id="mapping-1658"></span><span class="token add" data-title="call_argument/call_expression"><span class="marker" id="mapping-1659"></span><span class="token add" data-title="call_expression/member_expression">(Decimal.one().sub(debtRatio)).pow</span>(<span class="marker" id="mapping-1660"></span><span class="token mv" id="move-dst-186" data-title="call_expression/call_argument">2</span>)</span>)</span></span>
        )</span>.sub</span>(<span class="marker" id="mapping-1661"></span><span class="token add" data-title="call_expression/call_argument">Decimal.ratio(1, 3)</span>)</span>;</span>
    }</span></span>

    // 1/(3(1-R)(1-R'))-1/3
    <span class="marker" id="mapping-1662"></span><span class="token add" data-title="contract_body/function_definition">function curveMean(
        <span class="marker" id="mapping-1663"></span><span class="token mv" id="move-dst-266" data-title="function_definition/parameter">Decimal.D256 memory <span class="marker" id="mapping-1664"></span><span class="token add" data-title="parameter/identifier">lower</span></span>,
        <span class="marker" id="mapping-1665"></span><span class="token mv" id="move-dst-167" data-title="function_definition/parameter">Decimal.D256 memory <span class="marker" id="mapping-1666"></span><span class="token upd" id="move-dst-168" data-title="parameter/identifier">upp<span class="cupd">er</span></span></span>
    ) <span class="marker" id="mapping-1667"></span><span class="token mv" id="move-dst-265" data-title="function_definition/visibility">private</span> <span class="marker" id="mapping-1668"></span><span class="token mv" id="move-dst-194" data-title="function_definition/state_mutability">pure</span> <span class="marker" id="mapping-1669"></span><span class="token add" data-title="function_definition/return_type_definition">returns (Decimal.D256 memory)</span> <span class="marker" id="mapping-1670"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1671"></span><span class="token add" data-title="function_body/if_statement">if (lower.equals(upper)) {
            return curve(lower);
        }</span>

        <span class="marker" id="mapping-1672"></span><span class="token add" data-title="function_body/return_statement">return <span class="marker" id="mapping-1673"></span><span class="token add" data-title="return_statement/call_expression"><span class="marker" id="mapping-1674"></span><span class="token add" data-title="call_expression/member_expression"><span class="marker" id="mapping-1675"></span><span class="token add" data-title="member_expression/call_expression"><span class="marker" id="mapping-1676"></span><span class="token mv" id="move-dst-182" data-title="call_expression/member_expression"><span class="marker" id="mapping-1677"></span><span class="token mv" id="move-dst-183" data-title="member_expression/call_expression">Decimal.one()</span>.<span class="marker" id="mapping-1678"></span><span class="token upd" id="move-dst-184" data-title="member_expression/identifier">div</span></span>(
            <span class="marker" id="mapping-1679"></span><span class="token add" data-title="call_expression/call_argument"><span class="marker" id="mapping-1680"></span><span class="token add" data-title="call_argument/call_expression"><span class="marker" id="mapping-1681"></span><span class="token add" data-title="call_expression/member_expression"><span class="marker" id="mapping-1682"></span><span class="token mv" id="move-dst-115" data-title="member_expression/call_expression">Decimal.from(<span class="marker" id="mapping-1683"></span><span class="token add" data-title="call_expression/call_argument">3</span>).<span class="marker" id="mapping-1684"></span><span class="token upd" id="move-dst-117" data-title="member_expression/identifier">mul</span>(<span class="marker" id="mapping-1685"></span><span class="token add" data-title="call_argument/call_expression">Decimal.one().sub(upper)</span>)</span>.mul</span>(<span class="marker" id="mapping-1686"></span><span class="token add" data-title="call_expression/call_argument">Decimal.one().sub(lower)</span>)</span></span>
        )</span>.sub</span>(<span class="marker" id="mapping-1687"></span><span class="token add" data-title="call_expression/call_argument"><span class="marker" id="mapping-1688"></span><span class="token add" data-title="call_argument/call_expression"><span class="marker" id="mapping-1689"></span><span class="token add" data-title="call_expression/member_expression">Decimal.ratio</span>(<span class="marker" id="mapping-1690"></span><span class="token mv" id="move-dst-237" data-title="call_expression/call_argument">1</span>, <span class="marker" id="mapping-1691"></span><span class="token add" data-title="call_expression/call_argument">3</span>)</span></span>)</span>;</span>
    }</span></span>
}</span></span>

<span class="marker" id="mapping-1692"></span><span class="token mv" id="move-dst-235" data-title="source_file/interface_declaration">interface IUniswapV2Pair {
    event Approval(address indexed owner, address indexed spender, uint value);
    event Transfer(address indexed from, address indexed to, uint value);

    function name() external pure returns (string memory);
    function symbol() external pure returns (string memory);
    function decimals() external pure returns (uint8);
    function totalSupply() external view returns (uint);
    function balanceOf(address owner) external view returns (uint);
    function allowance(address owner, address spender) external view returns (uint);

    function approve(address spender, uint value) external returns (bool);
    function transfer(address to, uint value) external returns (bool);
    function transferFrom(address from, address to, uint value) external returns (bool);

    function DOMAIN_SEPARATOR() external view returns (bytes32);
    function PERMIT_TYPEHASH() external pure returns (bytes32);
    function nonces(address owner) external view returns (uint);

    function permit(address owner, address spender, uint value, uint deadline, uint8 v, bytes32 r, bytes32 s) external;

    event Mint(address indexed sender, uint amount0, uint amount1);
    event Burn(address indexed sender, uint amount0, uint amount1, address indexed to);
    event Swap(
        address indexed sender,
        uint amount0In,
        uint amount1In,
        uint amount0Out,
        uint amount1Out,
        address indexed to
    );
    event Sync(uint112 reserve0, uint112 reserve1);

    function MINIMUM_LIQUIDITY() external pure returns (uint);
    function factory() external view returns (address);
    function token0() external view returns (address);
    function token1() external view returns (address);
    function getReserves() external view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast);
    function price0CumulativeLast() external view returns (uint);
    function price1CumulativeLast() external view returns (uint);
    function kLast() external view returns (uint);

    function mint(address to) external returns (uint liquidity);
    function burn(address to) external returns (uint amount0, uint amount1);
    function swap(uint amount0Out, uint amount1Out, address to, bytes calldata data) external;
    function skim(address to) external;
    function sync() external;

    function initialize(address, address) external;
}</span>

<span class="marker" id="mapping-1693"></span><span class="token mv" id="move-dst-4" data-title="source_file/comment">/**
 * @dev Interface of the ERC20 standard as defined in the EIP. Does not include
 * the optional functions; to access them see {ERC20Detailed}.
 */</span>
<span class="marker" id="mapping-1694"></span><span class="token mv" id="move-dst-5" data-title="source_file/interface_declaration">interface IERC20 {
    /**
     * @dev Returns the amount of tokens in existence.
     */
    function totalSupply() external view returns (uint256);

    /**
     * @dev Returns the amount of tokens owned by `account`.
     */
    function balanceOf(address account) external view returns (uint256);

    /**
     * @dev Moves `amount` tokens from the caller's account to `recipient`.
     *
     * Returns a boolean value indicating whether the operation succeeded.
     *
     * Emits a {Transfer} event.
     */
    function transfer(address recipient, uint256 amount) external returns (bool);

    /**
     * @dev Returns the remaining number of tokens that `spender` will be
     * allowed to spend on behalf of `owner` through {transferFrom}. This is
     * zero by default.
     *
     * This value changes when {approve} or {transferFrom} are called.
     */
    function allowance(address owner, address spender) external view returns (uint256);

    /**
     * @dev Sets `amount` as the allowance of `spender` over the caller's tokens.
     *
     * Returns a boolean value indicating whether the operation succeeded.
     *
     * IMPORTANT: Beware that changing an allowance with this method brings the risk
     * that someone may use both the old and the new allowance by unfortunate
     * transaction ordering. One possible solution to mitigate this race
     * condition is to first reduce the spender's allowance to 0 and set the
     * desired value afterwards:
     * https://github.com/ethereum/EIPs/issues/20#issuecomment-263524729
     *
     * Emits an {Approval} event.
     */
    function approve(address spender, uint256 amount) external returns (bool);

    /**
     * @dev Moves `amount` tokens from `sender` to `recipient` using the
     * allowance mechanism. `amount` is then deducted from the caller's
     * allowance.
     *
     * Returns a boolean value indicating whether the operation succeeded.
     *
     * Emits a {Transfer} event.
     */
    function transferFrom(address sender, address recipient, uint256 amount) external returns (bool);

    /**
     * @dev Emitted when `value` tokens are moved from one account (`from`) to
     * another (`to`).
     *
     * Note that `value` may be zero.
     */
    event Transfer(address indexed from, address indexed to, uint256 value);

    /**
     * @dev Emitted when the allowance of a `spender` for an `owner` is set by
     * a call to {approve}. `value` is the new allowance.
     */
    event Approval(address indexed owner, address indexed spender, uint256 value);
}</span>

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
contract IDollar is IERC20 {
    function burn(uint256 amount) public;
    function burnFrom(address account, uint256 amount) public;
    function mint(address account, uint256 amount) public returns (bool);
    function excludeAccount(address account) external;
}

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
contract IOracle {
    function setup() public;
    function capture() public returns (Decimal.D256 memory, bool);
    function pair() external view returns (address);
}

<span class="marker" id="mapping-1695"></span><span class="token mv" id="move-dst-247" data-title="source_file/comment">/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/</span>
<span class="marker" id="mapping-1696"></span><span class="token mv" id="move-dst-495" data-title="source_file/contract_declaration">contract Account {
    enum Status {
        Frozen,
        Fluid,
        Locked
    }

    struct State {
        uint256 staged;
        uint256 balance;
        mapping(uint256 =&gt; uint256) coupons;
        mapping(address =&gt; uint256) couponAllowances;
        uint256 fluidUntil;
        uint256 lockedUntil;
    }
}</span>

<span class="marker" id="mapping-1697"></span><span class="token mv" id="move-dst-496" data-title="source_file/contract_declaration">contract Epoch {
    struct Global {
        uint256 current;
        uint256 currentStart;
        uint256 currentPeriod;
    }

    struct Coupons {
        uint256 outstanding;
        uint256 expiration;
        uint256[] expiring;
    }

    struct State {
        uint256 bonded;
        Coupons coupons;
    }
}</span>

<span class="marker" id="mapping-1698"></span><span class="token mv" id="move-dst-497" data-title="source_file/contract_declaration">contract Candidate {
    enum Vote {
        UNDECIDED,
        APPROVE,
        REJECT
    }

    struct State {
        uint256 start;
        uint256 period;
        uint256 approve;
        uint256 reject;
        mapping(address =&gt; Vote) votes;
        bool initialized;
    }
}</span>

<span class="marker" id="mapping-1699"></span><span class="token mv" id="move-dst-498" data-title="source_file/contract_declaration">contract Storage {
    struct Provider {
        IDollar dollar;
        IOracle oracle;
        address pool;
    }

    struct Balance {
        uint256 supply;
        uint256 bonded;
        uint256 staged;
        uint256 redeemable;
        uint256 debt;
        uint256 coupons;
    }

    struct State {
        Epoch.Global epoch;
        Balance balance;
        Provider provider;

        mapping(address =&gt; Account.State) accounts;
        mapping(uint256 =&gt; Epoch.State) epochs;
        mapping(address =&gt; Candidate.State) candidates;
    }
}</span>

<span class="marker" id="mapping-1700"></span><span class="token mv" id="move-dst-499" data-title="source_file/contract_declaration">contract State {
    Storage.State _state;
}</span>

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
<span class="marker" id="mapping-1701"></span><span class="token mv" id="move-dst-500" data-title="source_file/contract_declaration">contract Getters is State {
    using SafeMath for uint256;
    using Decimal for Decimal.D256;

    bytes32 private constant IMPLEMENTATION_SLOT = 0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc;

    /**
     * ERC20 Interface
     */

    function name() public view returns (string memory) {
        return "Reflective Set Stake";
    }

    function symbol() public view returns (string memory) {
        return "RSS";
    }

    function decimals() public view returns (uint8) {
        return 18;
    }

    function balanceOf(address account) public view returns (uint256) {
        return _state.accounts[account].balance;
    }

    function totalSupply() public view returns (uint256) {
        return _state.balance.supply;
    }

    function allowance(address owner, address spender) external view returns (uint256) {
        return 0;
    }

    /**
     * Global
     */

    function dollar() public view returns (IDollar) {
        return _state.provider.dollar;
    }

    function oracle() public view returns (IOracle) {
        return _state.provider.oracle;
    }

    function pool() public view returns (address) {
        return _state.provider.pool;
    }

    function totalBonded() public view returns (uint256) {
        return _state.balance.bonded;
    }

    function totalStaged() public view returns (uint256) {
        return _state.balance.staged;
    }

    function totalDebt() public view returns (uint256) {
        return _state.balance.debt;
    }

    function totalRedeemable() public view returns (uint256) {
        return _state.balance.redeemable;
    }

    function totalCoupons() public view returns (uint256) {
        return _state.balance.coupons;
    }

    function totalNet() public view returns (uint256) {
        return dollar().totalSupply().sub(totalDebt());
    }

    /**
     * Account
     */

    function balanceOfStaged(address account) public view returns (uint256) {
        return _state.accounts[account].staged;
    }

    function balanceOfBonded(address account) public view returns (uint256) {
        uint256 totalSupply = totalSupply();
        if (totalSupply == 0) {
            return 0;
        }
        return totalBonded().mul(balanceOf(account)).div(totalSupply);
    }

    function balanceOfCoupons(address account, uint256 epoch) public view returns (uint256) {
        if (outstandingCoupons(epoch) == 0) {
            return 0;
        }
        return _state.accounts[account].coupons[epoch];
    }

    function statusOf(address account) public view returns (Account.Status) {
        if (_state.accounts[account].lockedUntil &gt; epoch()) {
            return Account.Status.Locked;
        }

        return epoch() &gt;= _state.accounts[account].fluidUntil ? Account.Status.Frozen : Account.Status.Fluid;
    }

    function allowanceCoupons(address owner, address spender) public view returns (uint256) {
        return _state.accounts[owner].couponAllowances[spender];
    }

    /**
     * Epoch
     */

    function epoch() public view returns (uint256) {
        return _state.epoch.current;
    }

    function epochTime() public view returns (uint256) {
        return block.timestamp &gt;= nextEpochStart()
            ? epoch().add(1)
            : epoch();
    }

    function timeInEpoch() public view returns (uint256) {
        return block.timestamp.sub(_state.epoch.currentStart);
    }

    function timeLeftInEpoch() public view returns (uint256) {
        if (block.timestamp &gt; nextEpochStart()) 
            return 0;

        return nextEpochStart().sub(block.timestamp);
    }

    function currentEpochDuration() public view returns (uint256) {
        return _state.epoch.currentPeriod;
    }

    function nextEpochStart() public view returns (uint256) {
        return _state.epoch.currentStart.add(_state.epoch.currentPeriod);
    }

    function outstandingCoupons(uint256 epoch) public view returns (uint256) {
        return _state.epochs[epoch].coupons.outstanding;
    }

    function couponsExpiration(uint256 epoch) public view returns (uint256) {
        return _state.epochs[epoch].coupons.expiration;
    }

    function expiringCoupons(uint256 epoch) public view returns (uint256) {
        return _state.epochs[epoch].coupons.expiring.length;
    }

    function expiringCouponsAtIndex(uint256 epoch, uint256 i) public view returns (uint256) {
        return _state.epochs[epoch].coupons.expiring[i];
    }

    function totalBondedAt(uint256 epoch) public view returns (uint256) {
        return _state.epochs[epoch].bonded;
    }

    function bootstrappingAt(uint256 epoch) public view returns (bool) {
        return epoch &lt;= Constants.getBootstrappingPeriod();
    }

    /**
     * Governance
     */

    function recordedVote(address account, address candidate) public view returns (Candidate.Vote) {
        return _state.candidates[candidate].votes[account];
    }

    function startFor(address candidate) public view returns (uint256) {
        return _state.candidates[candidate].start;
    }

    function periodFor(address candidate) public view returns (uint256) {
        return _state.candidates[candidate].period;
    }

    function approveFor(address candidate) public view returns (uint256) {
        return _state.candidates[candidate].approve;
    }

    function rejectFor(address candidate) public view returns (uint256) {
        return _state.candidates[candidate].reject;
    }

    function votesFor(address candidate) public view returns (uint256) {
        return approveFor(candidate).add(rejectFor(candidate));
    }

    function isNominated(address candidate) public view returns (bool) {
        return _state.candidates[candidate].start &gt; 0;
    }

    function isInitialized(address candidate) public view returns (bool) {
        return _state.candidates[candidate].initialized;
    }

    function implementation() public view returns (address impl) {
        bytes32 slot = IMPLEMENTATION_SLOT;
        assembly {
            impl := sload(slot)
        }
    }
}</span>

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
<span class="marker" id="mapping-1702"></span><span class="token mv" id="move-dst-501" data-title="source_file/contract_declaration">contract Setters is State, Getters {
    using SafeMath for uint256;

    event Transfer(address indexed from, address indexed to, uint256 value);

    /**
     * ERC20 Interface
     */

    function transfer(address recipient, uint256 amount) external returns (bool) {
        return false;
    }

    function approve(address spender, uint256 amount) external returns (bool) {
        return false;
    }

    function transferFrom(address sender, address recipient, uint256 amount) external returns (bool) {
        return false;
    }

    /**
     * Global
     */

    function incrementTotalBonded(uint256 amount) internal {
        _state.balance.bonded = _state.balance.bonded.add(amount);
    }

    function decrementTotalBonded(uint256 amount, string memory reason) internal {
        _state.balance.bonded = _state.balance.bonded.sub(amount, reason);
    }

    function incrementTotalDebt(uint256 amount) internal {
        _state.balance.debt = _state.balance.debt.add(amount);
    }

    function decrementTotalDebt(uint256 amount, string memory reason) internal {
        _state.balance.debt = _state.balance.debt.sub(amount, reason);
    }

    function setDebtToZero() internal {
        _state.balance.debt = 0;
    }

    function incrementTotalRedeemable(uint256 amount) internal {
        _state.balance.redeemable = _state.balance.redeemable.add(amount);
    }

    function decrementTotalRedeemable(uint256 amount, string memory reason) internal {
        _state.balance.redeemable = _state.balance.redeemable.sub(amount, reason);
    }

    /**
     * Account
     */

    function incrementBalanceOf(address account, uint256 amount) internal {
        _state.accounts[account].balance = _state.accounts[account].balance.add(amount);
        _state.balance.supply = _state.balance.supply.add(amount);

        emit Transfer(address(0), account, amount);
    }

    function decrementBalanceOf(address account, uint256 amount, string memory reason) internal {
        _state.accounts[account].balance = _state.accounts[account].balance.sub(amount, reason);
        _state.balance.supply = _state.balance.supply.sub(amount, reason);

        emit Transfer(account, address(0), amount);
    }

    function incrementBalanceOfStaged(address account, uint256 amount) internal {
        _state.accounts[account].staged = _state.accounts[account].staged.add(amount);
        _state.balance.staged = _state.balance.staged.add(amount);
    }

    function decrementBalanceOfStaged(address account, uint256 amount, string memory reason) internal {
        _state.accounts[account].staged = _state.accounts[account].staged.sub(amount, reason);
        _state.balance.staged = _state.balance.staged.sub(amount, reason);
    }

    function incrementBalanceOfCoupons(address account, uint256 epoch, uint256 amount) internal {
        _state.accounts[account].coupons[epoch] = _state.accounts[account].coupons[epoch].add(amount);
        _state.epochs[epoch].coupons.outstanding = _state.epochs[epoch].coupons.outstanding.add(amount);
        _state.balance.coupons = _state.balance.coupons.add(amount);
    }

    function decrementBalanceOfCoupons(address account, uint256 epoch, uint256 amount, string memory reason) internal {
        _state.accounts[account].coupons[epoch] = _state.accounts[account].coupons[epoch].sub(amount, reason);
        _state.epochs[epoch].coupons.outstanding = _state.epochs[epoch].coupons.outstanding.sub(amount, reason);
        _state.balance.coupons = _state.balance.coupons.sub(amount, reason);
    }

    function unfreeze(address account) internal {
        _state.accounts[account].fluidUntil = epoch().add(Constants.getDAOExitLockupEpochs());
    }

    function updateAllowanceCoupons(address owner, address spender, uint256 amount) internal {
        _state.accounts[owner].couponAllowances[spender] = amount;
    }

    function decrementAllowanceCoupons(address owner, address spender, uint256 amount, string memory reason) internal {
        _state.accounts[owner].couponAllowances[spender] =
            _state.accounts[owner].couponAllowances[spender].sub(amount, reason);
    }

    /**
     * Epoch
     */

    function initializeEpochs() internal {
        _state.epoch.currentStart = block.timestamp.sub(_state.epoch.currentPeriod);
    }

    function incrementEpoch() internal {
        _state.epoch.current = _state.epoch.current.add(1);
        _state.epoch.currentStart = _state.epoch.currentStart.add(_state.epoch.currentPeriod);
    }

    function adjustPeriod(Decimal.D256 memory price) internal {
        Decimal.D256 memory normalizedPrice;
        if (price.greaterThan(Decimal.one())) 
            normalizedPrice = Decimal.one().div(price);
        else
            normalizedPrice = price;
        
        Constants.EpochStrategy memory epochStrategy = Constants.getEpochStrategy();
        
        _state.epoch.currentPeriod = normalizedPrice
            .mul(epochStrategy.maxPeriod.sub(epochStrategy.minPeriod))
            .add(epochStrategy.minPeriod)
            .asUint256();
    }

    function snapshotTotalBonded() internal {
        _state.epochs[epoch()].bonded = totalSupply();
    }

    function initializeCouponsExpiration(uint256 epoch, uint256 expiration) internal {
        _state.epochs[epoch].coupons.expiration = expiration;
        _state.epochs[expiration].coupons.expiring.push(epoch);
    }

    function eliminateOutstandingCoupons(uint256 epoch) internal {
        uint256 outstandingCouponsForEpoch = outstandingCoupons(epoch);
        if(outstandingCouponsForEpoch == 0) {
            return;
        }
        _state.balance.coupons = _state.balance.coupons.sub(outstandingCouponsForEpoch);
        _state.epochs[epoch].coupons.outstanding = 0;
    }

    /**
     * Governance
     */

    function createCandidate(address candidate, uint256 period) internal {
        _state.candidates[candidate].start = epoch();
        _state.candidates[candidate].period = period;
    }

    function recordVote(address account, address candidate, Candidate.Vote vote) internal {
        _state.candidates[candidate].votes[account] = vote;
    }

    function incrementApproveFor(address candidate, uint256 amount) internal {
        _state.candidates[candidate].approve = _state.candidates[candidate].approve.add(amount);
    }

    function decrementApproveFor(address candidate, uint256 amount, string memory reason) internal {
        _state.candidates[candidate].approve = _state.candidates[candidate].approve.sub(amount, reason);
    }

    function incrementRejectFor(address candidate, uint256 amount) internal {
        _state.candidates[candidate].reject = _state.candidates[candidate].reject.add(amount);
    }

    function decrementRejectFor(address candidate, uint256 amount, string memory reason) internal {
        _state.candidates[candidate].reject = _state.candidates[candidate].reject.sub(amount, reason);
    }

    function placeLock(address account, address candidate) internal {
        uint256 currentLock = _state.accounts[account].lockedUntil;
        uint256 newLock = startFor(candidate).add(periodFor(candidate));
        if (newLock &gt; currentLock) {
            _state.accounts[account].lockedUntil = newLock;
        }
    }

    function initialized(address candidate) internal {
        _state.candidates[candidate].initialized = true;
    }
}</span>

<span class="marker" id="mapping-1703"></span><span class="token mv" id="move-dst-7" data-title="source_file/comment"><span class="marker" id="mapping-1704"></span><span class="token upd" id="move-dst-7" data-title="source_file/comment"><span class="cupd">/*</span><span class="cupd">
 </span><span class="cupd"> </span><span class="cupd"> </span><span class="cupd"> </span>C<span class="cupd">o</span>p<span class="cupd">y</span><span class="cupd">ri</span>g<span class="cupd">h</span><span class="cupd">t</span><span class="cupd"> </span>2019 dYdX T<span class="cupd">ra</span>d<span class="cupd">i</span><span class="cupd">n</span>g<span class="cupd"> </span>Inc.<span class="cupd">
</span><span class="cupd">
</span><span class="cupd">  </span><span class="cupd"> </span> Li<span class="cupd">c</span><span class="cupd">e</span>n<span class="cupd">s</span>ed<span class="cupd"> </span>under<span class="cupd"> </span>the<span class="cupd"> </span><span class="cupd">A</span>pac<span class="cupd">h</span><span class="cupd">e</span> L<span class="cupd">ic</span>ense,<span class="cupd"> </span>V<span class="cupd">er</span>s<span class="cupd">ion</span><span class="cupd"> </span>2.0 (the "L<span class="cupd">i</span>ce<span class="cupd">n</span>se");<span class="cupd">
</span>    y<span class="cupd">o</span>u<span class="cupd"> </span>m<span class="cupd">a</span>y<span class="cupd"> </span>n<span class="cupd">o</span>t<span class="cupd"> </span>us<span class="cupd">e</span><span class="cupd"> </span>t<span class="cupd">his </span>f<span class="cupd">il</span>e<span class="cupd"> </span><span class="cupd">e</span>xcep<span class="cupd">t </span>in<span class="cupd"> </span>compl<span class="cupd">i</span>a<span class="cupd">n</span>ce<span class="cupd"> </span>with<span class="cupd"> </span>th<span class="cupd">e</span> Li<span class="cupd">c</span>en<span class="cupd">se</span>.<span class="cupd">
</span>    Y<span class="cupd">o</span>u <span class="cupd">m</span><span class="cupd">a</span><span class="cupd">y </span>ob<span class="cupd">t</span><span class="cupd">a</span>in<span class="cupd"> a</span><span class="cupd"> </span>c<span class="cupd">o</span>py o<span class="cupd">f</span><span class="cupd"> </span>the L<span class="cupd">i</span>cen<span class="cupd">se</span><span class="cupd"> a</span>t<span class="cupd">

</span><span class="cupd"> </span><span class="cupd"> </span><span class="cupd"> </span><span class="cupd"> </span><span class="cupd">h</span><span class="cupd">t</span>tp://www.<span class="cupd">a</span>p<span class="cupd">a</span>ch<span class="cupd">e</span>.<span class="cupd">or</span>g/l<span class="cupd">i</span>ce<span class="cupd">n</span>ses/LICENSE-2.0<span class="cupd">
</span><span class="cupd">
</span>    Un<span class="cupd">le</span>ss<span class="cupd"> </span><span class="cupd">r</span>equi<span class="cupd">r</span>ed by <span class="cupd">a</span>ppl<span class="cupd">i</span>cable<span class="cupd"> la</span>w or <span class="cupd">ag</span>r<span class="cupd">e</span>ed<span class="cupd"> </span>to<span class="cupd"> </span>in<span class="cupd"> </span>wri<span class="cupd">t</span>ing,<span class="cupd"> </span><span class="cupd">s</span>of<span class="cupd">t</span>wa<span class="cupd">re</span><span class="cupd">
</span>    d<span class="cupd">is</span>tr<span class="cupd">i</span>bu<span class="cupd">t</span>ed <span class="cupd">u</span><span class="cupd">n</span>d<span class="cupd">e</span><span class="cupd">r</span><span class="cupd"> the </span>Lice<span class="cupd">ns</span>e is dis<span class="cupd">t</span>r<span class="cupd">i</span>buted <span class="cupd">on </span><span class="cupd">an </span>"AS<span class="cupd"> </span>IS"<span class="cupd"> </span>BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, <span class="cupd">e</span>ithe<span class="cupd">r</span><span class="cupd"> </span><span class="cupd">e</span>xp<span class="cupd">r</span>ess or imp<span class="cupd">l</span>ied<span class="cupd">.
 </span><span class="cupd">  </span><span class="cupd"> </span>See<span class="cupd"> th</span>e<span class="cupd"> </span>L<span class="cupd">i</span>ce<span class="cupd">ns</span><span class="cupd">e</span><span class="cupd"> </span>f<span class="cupd">o</span>r<span class="cupd"> the </span>sp<span class="cupd">ec</span>ific languag<span class="cupd">e</span><span class="cupd"> </span>g<span class="cupd">o</span>v<span class="cupd">er</span>n<span class="cupd">i</span><span class="cupd">n</span>g<span class="cupd"> </span>p<span class="cupd">e</span>r<span class="cupd">mi</span>ssio<span class="cupd">n</span><span class="cupd">s an</span>d<span class="cupd">
</span><span class="cupd">  </span><span class="cupd"> </span> <span class="cupd">l</span>imit<span class="cupd">a</span>tion<span class="cupd">s</span><span class="cupd"> </span><span class="cupd">u</span><span class="cupd">nde</span>r<span class="cupd"> t</span>h<span class="cupd">e </span>L<span class="cupd">i</span>cen<span class="cupd">s</span>e<span class="cupd">.
</span><span class="cupd">*/</span></span></span>
<span class="marker" id="mapping-1705"></span><span class="token mv" id="move-dst-9" data-title="source_file/comment"><span class="marker" id="mapping-1706"></span><span class="token upd" id="move-dst-9" data-title="source_file/comment"><span class="cupd">/**
 * @</span><span class="cupd">t</span><span class="cupd">i</span><span class="cupd">t</span>l<span class="cupd">e </span><span class="cupd">R</span>equ<span class="cupd">i</span><span class="cupd">r</span><span class="cupd">e</span><span class="cupd">
 * </span>@<span class="cupd">a</span>u<span class="cupd">t</span><span class="cupd">h</span><span class="cupd">o</span><span class="cupd">r</span><span class="cupd"> </span><span class="cupd">d</span>YdX<span class="cupd">
</span><span class="cupd"> </span>*<span class="cupd">
 * </span>S<span class="cupd">t</span><span class="cupd">ri</span><span class="cupd">n</span><span class="cupd">g</span><span class="cupd">i</span>f<span class="cupd">i</span><span class="cupd">e</span><span class="cupd">s</span><span class="cupd"> </span>p<span class="cupd">a</span><span class="cupd">r</span><span class="cupd">a</span>m<span class="cupd">et</span><span class="cupd">e</span><span class="cupd">r</span><span class="cupd">s</span><span class="cupd"> </span>t<span class="cupd">o</span><span class="cupd"> </span><span class="cupd">p</span><span class="cupd">r</span><span class="cupd">e</span><span class="cupd">t</span><span class="cupd">t</span><span class="cupd">y-</span><span class="cupd">p</span><span class="cupd">r</span><span class="cupd">in</span><span class="cupd">t</span><span class="cupd"> revert </span>m<span class="cupd">e</span><span class="cupd">s</span><span class="cupd">s</span><span class="cupd">a</span>g<span class="cupd">e</span><span class="cupd">s</span>.<span class="cupd"> </span><span class="cupd">C</span><span class="cupd">o</span><span class="cupd">s</span><span class="cupd">t</span><span class="cupd">s </span><span class="cupd">m</span><span class="cupd">o</span><span class="cupd">r</span><span class="cupd">e</span><span class="cupd"> </span>g<span class="cupd">a</span><span class="cupd">s </span><span class="cupd">t</span><span class="cupd">h</span><span class="cupd">a</span><span class="cupd">n</span><span class="cupd"> </span><span class="cupd">r</span><span class="cupd">e</span><span class="cupd">g</span><span class="cupd">u</span><span class="cupd">l</span><span class="cupd">a</span><span class="cupd">r</span><span class="cupd"> </span><span class="cupd">re</span>q<span class="cupd">u</span><span class="cupd">i</span><span class="cupd">r</span><span class="cupd">e</span>()<span class="cupd">
 *</span>/</span></span>
<span class="marker" id="mapping-1707"></span><span class="token mv" id="move-dst-191" data-title="source_file/library_declaration">library Require {

    // ============ Constants ============

    uint256 constant ASCII_ZERO = 48; // '0'
    uint256 constant ASCII_RELATIVE_ZERO = 87; // 'a' - 10
    uint256 constant ASCII_LOWER_EX = 120; // 'x'
    bytes2 constant COLON = 0x3a20; // ': '
    bytes2 constant COMMA = 0x2c20; // ', '
    bytes2 constant LPAREN = 0x203c; // ' &lt;'
    byte constant RPAREN = 0x3e; // '&gt;'
    uint256 constant FOUR_BIT_MASK = 0xf;

    // ============ Library Functions ============

    function that(
        bool must,
        bytes32 file,
        bytes32 reason
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason)
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        uint256 payloadA
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        uint256 payloadA,
        uint256 payloadB
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        COMMA,
                        stringify(payloadB),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        address payloadA
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        address payloadA,
        uint256 payloadB
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        COMMA,
                        stringify(payloadB),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        address payloadA,
        uint256 payloadB,
        uint256 payloadC
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        COMMA,
                        stringify(payloadB),
                        COMMA,
                        stringify(payloadC),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        bytes32 payloadA
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        RPAREN
                    )
                )
            );
        }
    }

    function that(
        bool must,
        bytes32 file,
        bytes32 reason,
        bytes32 payloadA,
        uint256 payloadB,
        uint256 payloadC
    )
    internal
    pure
    {
        if (!must) {
            revert(
                string(
                    abi.encodePacked(
                        stringifyTruncated(file),
                        COLON,
                        stringifyTruncated(reason),
                        LPAREN,
                        stringify(payloadA),
                        COMMA,
                        stringify(payloadB),
                        COMMA,
                        stringify(payloadC),
                        RPAREN
                    )
                )
            );
        }
    }

    // ============ Private Functions ============

    function stringifyTruncated(
        bytes32 input
    )
    private
    pure
    returns (bytes memory)
    {
        // put the input bytes into the result
        bytes memory result = abi.encodePacked(input);

        // determine the length of the input by finding the location of the last non-zero byte
        for (uint256 i = 32; i &gt; 0; ) {
            // reverse-for-loops with unsigned integer
            /* solium-disable-next-line security/no-modify-for-iter-var */
            i--;

            // find the last non-zero byte in order to determine the length
            if (result[i] != 0) {
                uint256 length = i + 1;

                /* solium-disable-next-line security/no-inline-assembly */
                assembly {
                    mstore(result, length) // r.length = length;
                }

                return result;
            }
        }

        // all bytes are zero
        return new bytes(0);
    }

    function stringify(
        uint256 input
    )
    private
    pure
    returns (bytes memory)
    {
        if (input == 0) {
            return "0";
        }

        // get the final string length
        uint256 j = input;
        uint256 length;
        while (j != 0) {
            length++;
            j /= 10;
        }

        // allocate the string
        bytes memory bstr = new bytes(length);

        // populate the string starting with the least-significant character
        j = input;
        for (uint256 i = length; i &gt; 0; ) {
            // reverse-for-loops with unsigned integer
            /* solium-disable-next-line security/no-modify-for-iter-var */
            i--;

            // take last decimal digit
            bstr[i] = byte(uint8(ASCII_ZERO + (j % 10)));

            // remove the last decimal digit
            j /= 10;
        }

        return bstr;
    }

    function stringify(
        address input
    )
    private
    pure
    returns (bytes memory)
    {
        uint256 z = uint256(input);

        // addresses are "0x" followed by 20 bytes of data which take up 2 characters each
        bytes memory result = new bytes(42);

        // populate the result with "0x"
        result[0] = byte(uint8(ASCII_ZERO));
        result[1] = byte(uint8(ASCII_LOWER_EX));

        // for each byte (starting from the lowest byte), populate the result with two characters
        for (uint256 i = 0; i &lt; 20; i++) {
            // each byte takes two characters
            uint256 shift = i * 2;

            // populate the least-significant character
            result[41 - shift] = char(z &amp; FOUR_BIT_MASK);
            z = z &gt;&gt; 4;

            // populate the most-significant character
            result[40 - shift] = char(z &amp; FOUR_BIT_MASK);
            z = z &gt;&gt; 4;
        }

        return result;
    }

    function stringify(
        bytes32 input
    )
    private
    pure
    returns (bytes memory)
    {
        uint256 z = uint256(input);

        // bytes32 are "0x" followed by 32 bytes of data which take up 2 characters each
        bytes memory result = new bytes(66);

        // populate the result with "0x"
        result[0] = byte(uint8(ASCII_ZERO));
        result[1] = byte(uint8(ASCII_LOWER_EX));

        // for each byte (starting from the lowest byte), populate the result with two characters
        for (uint256 i = 0; i &lt; 32; i++) {
            // each byte takes two characters
            uint256 shift = i * 2;

            // populate the least-significant character
            result[65 - shift] = char(z &amp; FOUR_BIT_MASK);
            z = z &gt;&gt; 4;

            // populate the most-significant character
            result[64 - shift] = char(z &amp; FOUR_BIT_MASK);
            z = z &gt;&gt; 4;
        }

        return result;
    }

    function char(
        uint256 input
    )
    private
    pure
    returns (byte)
    {
        // return ASCII digit (0-9)
        if (input &lt; 10) {
            return byte(uint8(input + ASCII_ZERO));
        }

        // return ASCII letter (a-f)
        return byte(uint8(input + ASCII_RELATIVE_ZERO));
    }
}</span>

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
<span class="marker" id="mapping-1708"></span><span class="token add" data-title="source_file/contract_declaration">contract Comptroller is <span class="marker" id="mapping-1709"></span><span class="token add" data-title="contract_declaration/inheritance_specifier">Setters</span> <span class="marker" id="mapping-1710"></span><span class="token add" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-1711"></span><span class="token add" data-title="contract_body/using_directive">using SafeMath for uint256;</span>

    <span class="marker" id="mapping-1712"></span><span class="token add" data-title="contract_body/state_variable_declaration">bytes32 private constant FILE = "Comptroller";</span>

    <span class="marker" id="mapping-1713"></span><span class="token add" data-title="contract_body/function_definition">function mintToAccount(<span class="marker" id="mapping-1714"></span><span class="token mv" id="move-dst-94" data-title="function_definition/parameter">address account</span>, <span class="marker" id="mapping-1715"></span><span class="token mv" id="move-dst-95" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-1716"></span><span class="token mv" id="move-dst-96" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-1717"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1718"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1719"></span><span class="token add" data-title="variable_declaration_statement/variable_declaration">uint256 balanceBeforeMint</span> = <span class="marker" id="mapping-1720"></span><span class="token add" data-title="variable_declaration_statement/call_expression"><span class="marker" id="mapping-1721"></span><span class="token add" data-title="call_expression/member_expression"><span class="marker" id="mapping-1722"></span><span class="token mv" id="move-dst-340" data-title="member_expression/call_expression">dollar()</span>.balanceOf</span>(<span class="marker" id="mapping-1723"></span><span class="token mv" id="move-dst-324" data-title="call_expression/call_argument">account</span>)</span>;</span>
        <span class="marker" id="mapping-1724"></span><span class="token mv" id="move-dst-221" data-title="function_body/expression_statement"><span class="marker" id="mapping-1725"></span><span class="token add" data-title="call_expression/member_expression"><span class="marker" id="mapping-1726"></span><span class="token mv" id="move-dst-506" data-title="member_expression/call_expression">dollar()</span>.mint</span>(account, amount);</span>
        <span class="marker" id="mapping-1727"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1728"></span><span class="token mv" id="move-dst-97" data-title="variable_declaration_statement/variable_declaration">uint256 realMintValue</span> = <span class="marker" id="mapping-1729"></span><span class="token add" data-title="variable_declaration_statement/call_expression"><span class="marker" id="mapping-1730"></span><span class="token add" data-title="call_expression/member_expression"><span class="marker" id="mapping-1731"></span><span class="token add" data-title="member_expression/call_expression"><span class="marker" id="mapping-1732"></span><span class="token add" data-title="call_expression/member_expression">dollar().balanceOf</span>(<span class="marker" id="mapping-1733"></span><span class="token mv" id="move-dst-321" data-title="call_expression/call_argument">account</span>)</span>.sub</span>(<span class="marker" id="mapping-1734"></span><span class="token add" data-title="call_expression/call_argument">balanceBeforeMint</span>)</span>;</span>
        <span class="marker" id="mapping-1735"></span><span class="token add" data-title="function_body/if_statement">if (<span class="marker" id="mapping-1736"></span><span class="token add" data-title="if_statement/unary_expression">!bootstrappingAt(epoch())</span>) <span class="marker" id="mapping-1737"></span><span class="token add" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-1738"></span><span class="token add" data-title="block_statement/expression_statement"><span class="marker" id="mapping-1739"></span><span class="token add" data-title="expression_statement/call_expression">increaseDebt(<span class="marker" id="mapping-1740"></span><span class="token mv" id="move-dst-105" data-title="call_expression/call_argument">realMintValue</span>)</span>;</span>
        }</span></span>

        <span class="marker" id="mapping-1741"></span><span class="token add" data-title="function_body/expression_statement">balanceCheck();</span>
    }</span></span>

    <span class="marker" id="mapping-1742"></span><span class="token add" data-title="contract_body/function_definition">function burnFromAccount(<span class="marker" id="mapping-1743"></span><span class="token mv" id="move-dst-219" data-title="function_definition/parameter">address account</span>, <span class="marker" id="mapping-1744"></span><span class="token mv" id="move-dst-220" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-1745"></span><span class="token mv" id="move-dst-338" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-1746"></span><span class="token add" data-title="function_definition/return_type_definition">returns (uint256 realTransferValue)</span> <span class="marker" id="mapping-1747"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1748"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1749"></span><span class="token add" data-title="variable_declaration_statement/variable_declaration">uint256 balanceBeforeTransfer</span> = <span class="marker" id="mapping-1750"></span><span class="token mv" id="move-dst-351" data-title="variable_declaration_statement/call_expression"><span class="marker" id="mapping-1751"></span><span class="token upd" id="move-dst-352" data-title="call_expression/identifier">doll<span class="cupd">a</span>r</span>().<span class="marker" id="mapping-1752"></span><span class="token upd" id="move-dst-353" data-title="member_expression/identifier">balanceOf</span>(address(this))</span>;</span>
        <span class="marker" id="mapping-1753"></span><span class="token mv" id="move-dst-198" data-title="function_body/expression_statement"><span class="marker" id="mapping-1754"></span><span class="token mv" id="move-dst-199" data-title="expression_statement/call_expression"><span class="marker" id="mapping-1755"></span><span class="token add" data-title="member_expression/call_expression">dollar()</span>.<span class="marker" id="mapping-1756"></span><span class="token mv" id="move-dst-201" data-title="member_expression/identifier"><span class="marker" id="mapping-1757"></span><span class="token upd" id="move-dst-201" data-title="member_expression/identifier">transferFrom</span></span>(<span class="marker" id="mapping-1758"></span><span class="token mv" id="move-dst-65" data-title="call_expression/call_argument">account</span>, address(this)<span class="marker" id="mapping-1759"></span><span class="token mv" id="move-dst-202" data-title="call_expression/,">,</span> <span class="marker" id="mapping-1760"></span><span class="token mv" id="move-dst-223" data-title="call_expression/call_argument">amount</span>)</span>;</span>
        <span class="marker" id="mapping-1761"></span><span class="token add" data-title="function_body/expression_statement">realTransferValue = dollar().balanceOf(address(this)).sub(balanceBeforeTransfer);</span>
        <span class="marker" id="mapping-1762"></span><span class="token add" data-title="function_body/expression_statement">dollar().burn(realTransferValue);</span>
        <span class="marker" id="mapping-1763"></span><span class="token mv" id="move-dst-214" data-title="function_body/expression_statement"><span class="marker" id="mapping-1764"></span><span class="token add" data-title="call_expression/identifier">decrementTotalDebt</span>(<span class="marker" id="mapping-1765"></span><span class="token add" data-title="call_argument/identifier">realTransferValue</span>, "Comptroller: not enough outstanding debt");</span>

        <span class="marker" id="mapping-1766"></span><span class="token mv" id="move-dst-454" data-title="function_body/expression_statement">balanceCheck();</span>
    }</span></span>

    <span class="marker" id="mapping-1767"></span><span class="token mv" id="move-dst-53" data-title="contract_body/function_definition">function <span class="marker" id="mapping-1768"></span><span class="token upd" id="move-dst-54" data-title="function_definition/identifier">redeemToAcco<span class="cupd">u</span>nt</span>(<span class="marker" id="mapping-1769"></span><span class="token mv" id="move-dst-85" data-title="function_definition/parameter">address account</span>, <span class="marker" id="mapping-1770"></span><span class="token mv" id="move-dst-222" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-1771"></span><span class="token mv" id="move-dst-66" data-title="function_definition/visibility">internal</span> {
        <span class="marker" id="mapping-1772"></span><span class="token add" data-title="call_expression/member_expression">dollar().transfer</span>(account, amount);
        <span class="marker" id="mapping-1773"></span><span class="token mv" id="move-dst-209" data-title="function_body/expression_statement"><span class="marker" id="mapping-1774"></span><span class="token add" data-title="call_expression/identifier">decrementTotalRedeemable</span>(<span class="marker" id="mapping-1775"></span><span class="token mv" id="move-dst-52" data-title="call_expression/call_argument">amount</span>, "Comptroller: not enough redeemable balance");</span>

        <span class="marker" id="mapping-1776"></span><span class="token add" data-title="function_body/expression_statement">balanceCheck();</span>
    }</span>

    <span class="marker" id="mapping-1777"></span><span class="token add" data-title="contract_body/function_definition">function burnRedeemable(<span class="marker" id="mapping-1778"></span><span class="token mv" id="move-dst-123" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-1779"></span><span class="token mv" id="move-dst-124" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-1780"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1781"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-1782"></span><span class="token add" data-title="expression_statement/call_expression"><span class="marker" id="mapping-1783"></span><span class="token add" data-title="call_expression/member_expression"><span class="marker" id="mapping-1784"></span><span class="token mv" id="move-dst-514" data-title="member_expression/call_expression">dollar()</span>.burn</span>(<span class="marker" id="mapping-1785"></span><span class="token mv" id="move-dst-331" data-title="call_expression/call_argument">amount</span>)</span>;</span>
        <span class="marker" id="mapping-1786"></span><span class="token mv" id="move-dst-133" data-title="function_body/expression_statement"><span class="marker" id="mapping-1787"></span><span class="token mv" id="move-dst-134" data-title="expression_statement/call_expression"><span class="marker" id="mapping-1788"></span><span class="token add" data-title="call_expression/identifier">decrementTotalRedeemable</span>(<span class="marker" id="mapping-1789"></span><span class="token mv" id="move-dst-328" data-title="call_expression/call_argument">amount</span>, "Comptroller: not enough redeemable balance")</span>;</span>

        <span class="marker" id="mapping-1790"></span><span class="token mv" id="move-dst-422" data-title="function_body/expression_statement">balanceCheck();</span>
    }</span></span>

    <span class="marker" id="mapping-1791"></span><span class="token add" data-title="contract_body/function_definition">function increaseDebt(<span class="marker" id="mapping-1792"></span><span class="token mv" id="move-dst-20" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-1793"></span><span class="token mv" id="move-dst-327" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-1794"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1795"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-1796"></span><span class="token add" data-title="expression_statement/call_expression">incrementTotalDebt(<span class="marker" id="mapping-1797"></span><span class="token mv" id="move-dst-329" data-title="call_expression/call_argument">amount</span>)</span>;</span>
        <span class="marker" id="mapping-1798"></span><span class="token add" data-title="function_body/expression_statement">resetDebt(Constants.getDebtRatioCap());</span>

        <span class="marker" id="mapping-1799"></span><span class="token mv" id="move-dst-398" data-title="function_body/expression_statement">balanceCheck();</span>
    }</span></span>

    <span class="marker" id="mapping-1800"></span><span class="token mv" id="move-dst-72" data-title="contract_body/function_definition">function <span class="marker" id="mapping-1801"></span><span class="token upd" id="move-dst-73" data-title="function_definition/identifier">dec<span class="cupd">r</span>e<span class="cupd">a</span><span class="cupd">s</span><span class="cupd">e</span>Debt</span>(<span class="marker" id="mapping-1802"></span><span class="token mv" id="move-dst-163" data-title="function_definition/parameter">uint256 amount</span>) internal {
        <span class="marker" id="mapping-1803"></span><span class="token upd" id="move-dst-74" data-title="call_expression/identifier">d<span class="cupd">e</span>c<span class="cupd">re</span>mentTotalDebt</span>(<span class="marker" id="mapping-1804"></span><span class="token mv" id="move-dst-21" data-title="call_expression/call_argument">amount</span>, "Comptroller: not enough debt");

        <span class="marker" id="mapping-1805"></span><span class="token mv" id="move-dst-389" data-title="function_body/expression_statement">balanceCheck();</span>
    }</span>

    <span class="marker" id="mapping-1806"></span><span class="token add" data-title="contract_body/function_definition">function increaseSupply(<span class="marker" id="mapping-1807"></span><span class="token add" data-title="function_definition/parameter"><span class="marker" id="mapping-1808"></span><span class="token mv" id="move-dst-197" data-title="parameter/type_name">uint256</span> newSupply</span>) <span class="marker" id="mapping-1809"></span><span class="token mv" id="move-dst-93" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-1810"></span><span class="token mv" id="move-dst-339" data-title="function_definition/return_type_definition">returns (uint256, uint256<span class="marker" id="mapping-1811"></span><span class="token add" data-title="return_type_definition/,">,</span> <span class="marker" id="mapping-1812"></span><span class="token add" data-title="return_type_definition/parameter">uint256</span>)</span> <span class="marker" id="mapping-1813"></span><span class="token add" data-title="function_definition/function_body">{
        (uint256 newRedeemable, uint256 lessDebt, uint256 poolReward) = (0, 0, 0);

        // 1. True up redeemable pool
        uint256 totalRedeemable = totalRedeemable();
        uint256 totalCoupons = totalCoupons();
        if (totalRedeemable &lt; totalCoupons) {

            // Get new redeemable coupons
            newRedeemable = totalCoupons.sub(totalRedeemable);
            // Pad with Pool's potential cut
            newRedeemable = newRedeemable.mul(100).div(SafeMath.sub(100, Constants.getOraclePoolRatio()));
            // Cap at newSupply
            newRedeemable = newRedeemable &gt; newSupply ? newSupply : newRedeemable;
            // Determine Pool's final cut
            poolReward = newRedeemable.mul(Constants.getOraclePoolRatio()).div(100);
            // Determine Redeemable's final cut
            newRedeemable = newRedeemable.sub(poolReward);
            
            mintToPool(poolReward);
            mintToRedeemable(newRedeemable);

            newSupply = newSupply.sub(poolReward);
            newSupply = newSupply.sub(newRedeemable);
        }
        // 2. Eliminate debt
        uint256 totalDebt = totalDebt();
        if (newSupply &gt; 0 &amp;&amp; totalDebt &gt; 0) {
            lessDebt = totalDebt &gt; newSupply ? newSupply : totalDebt;
            decreaseDebt(lessDebt);

            newSupply = newSupply.sub(lessDebt);
        }

        // 3. Payout to bonded
        if (totalBonded() == 0) {
            newSupply = 0;
        }
        if (newSupply &gt; 0) {
            mintToBonded(newSupply);
        }

        return (newRedeemable, lessDebt, newSupply.add(poolReward));
    }</span></span>

    <span class="marker" id="mapping-1814"></span><span class="token add" data-title="contract_body/function_definition">function resetDebt(<span class="marker" id="mapping-1815"></span><span class="token mv" id="move-dst-175" data-title="function_definition/parameter">Decimal.D256 memory <span class="marker" id="mapping-1816"></span><span class="token upd" id="move-dst-176" data-title="parameter/identifier">t<span class="cupd">a</span>rge<span class="cupd">t</span>D<span class="cupd">e</span>btRatio</span></span>) <span class="marker" id="mapping-1817"></span><span class="token mv" id="move-dst-177" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-1818"></span><span class="token add" data-title="function_definition/function_body">{
        uint256 targetDebt = targetDebtRatio.mul(dollar().totalSupply()).asUint256();
        uint256 currentDebt = totalDebt();

        if (currentDebt &gt; targetDebt) {
            uint256 lessDebt = currentDebt.sub(targetDebt);
            decreaseDebt(lessDebt);
        }
    }</span></span>

    <span class="marker" id="mapping-1819"></span><span class="token mv" id="move-dst-485" data-title="contract_body/function_definition">function balanceCheck() private {
        Require.that(
            <span class="marker" id="mapping-1820"></span><span class="token add" data-title="call_argument/call_expression"><span class="marker" id="mapping-1821"></span><span class="token add" data-title="call_expression/member_expression"><span class="marker" id="mapping-1822"></span><span class="token mv" id="move-dst-486" data-title="member_expression/call_expression"><span class="marker" id="mapping-1823"></span><span class="token upd" id="move-dst-487" data-title="call_expression/identifier">dollar</span>().balanceOf(address(this)) &gt;= <span class="marker" id="mapping-1824"></span><span class="token mv" id="move-dst-314" data-title="binary_expression/call_expression">totalBonded()</span>.add(<span class="marker" id="mapping-1825"></span><span class="token mv" id="move-dst-488" data-title="call_argument/call_expression">totalStaged()</span>)</span>.add</span>(<span class="marker" id="mapping-1826"></span><span class="token add" data-title="call_expression/call_argument">totalRedeemable()</span>)</span>,
            FILE,
            "Inconsistent balances"
        );
    }</span>

    <span class="marker" id="mapping-1827"></span><span class="token add" data-title="contract_body/function_definition">function mintToBonded(<span class="marker" id="mapping-1828"></span><span class="token mv" id="move-dst-145" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-1829"></span><span class="token mv" id="move-dst-190" data-title="function_definition/visibility">private</span> <span class="marker" id="mapping-1830"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1831"></span><span class="token mv" id="move-dst-458" data-title="function_body/expression_statement">Require.that(
            totalBonded() &gt; 0,
            FILE,
            "Cant mint to empty pool"
        );</span>

        <span class="marker" id="mapping-1832"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1833"></span><span class="token mv" id="move-dst-107" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-1834"></span><span class="token upd" id="move-dst-108" data-title="variable_declaration/identifier">poo<span class="cupd">l</span>Amo<span class="cupd">u</span>nt</span></span> = <span class="marker" id="mapping-1835"></span><span class="token add" data-title="variable_declaration_statement/call_expression">amount.mul(Constants.getOraclePoolRatio()).div(100)</span>;</span>
        <span class="marker" id="mapping-1836"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1837"></span><span class="token mv" id="move-dst-121" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-1838"></span><span class="token upd" id="move-dst-122" data-title="variable_declaration/identifier">d<span class="cupd">a</span>o<span class="cupd">Amount</span></span></span> = <span class="marker" id="mapping-1839"></span><span class="token add" data-title="variable_declaration_statement/ternary_expression">amount &gt; poolAmount ? amount.sub(poolAmount) : 0</span>;</span>

        <span class="marker" id="mapping-1840"></span><span class="token add" data-title="function_body/expression_statement">mintToPool(poolAmount);</span>
        <span class="marker" id="mapping-1841"></span><span class="token add" data-title="function_body/expression_statement">mintToDAO(daoAmount);</span>

        <span class="marker" id="mapping-1842"></span><span class="token mv" id="move-dst-477" data-title="function_body/expression_statement">balanceCheck();</span>
    }</span></span>

    <span class="marker" id="mapping-1843"></span><span class="token add" data-title="contract_body/function_definition">function mintToDAO(<span class="marker" id="mapping-1844"></span><span class="token mv" id="move-dst-135" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-1845"></span><span class="token mv" id="move-dst-81" data-title="function_definition/visibility">private</span> <span class="marker" id="mapping-1846"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1847"></span><span class="token add" data-title="function_body/if_statement">if (<span class="marker" id="mapping-1848"></span><span class="token add" data-title="if_statement/binary_expression">amount &gt; 0</span>) <span class="marker" id="mapping-1849"></span><span class="token add" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-1850"></span><span class="token add" data-title="block_statement/expression_statement"><span class="marker" id="mapping-1851"></span><span class="token add" data-title="expression_statement/call_expression"><span class="marker" id="mapping-1852"></span><span class="token add" data-title="call_expression/member_expression">dollar().mint</span>(<span class="marker" id="mapping-1853"></span><span class="token add" data-title="call_expression/call_argument">address(this)</span>, <span class="marker" id="mapping-1854"></span><span class="token mv" id="move-dst-98" data-title="call_expression/call_argument">amount</span>)</span>;</span>
            <span class="marker" id="mapping-1855"></span><span class="token add" data-title="block_statement/expression_statement"><span class="marker" id="mapping-1856"></span><span class="token add" data-title="expression_statement/call_expression">incrementTotalBonded(<span class="marker" id="mapping-1857"></span><span class="token mv" id="move-dst-99" data-title="call_expression/call_argument">amount</span>)</span>;</span>
        }</span></span>
    }</span></span>

    <span class="marker" id="mapping-1858"></span><span class="token add" data-title="contract_body/function_definition">function mintToPool(<span class="marker" id="mapping-1859"></span><span class="token mv" id="move-dst-120" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-1860"></span><span class="token mv" id="move-dst-79" data-title="function_definition/visibility">private</span> <span class="marker" id="mapping-1861"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1862"></span><span class="token add" data-title="function_body/if_statement">if (<span class="marker" id="mapping-1863"></span><span class="token add" data-title="if_statement/binary_expression">amount &gt; 0</span>) <span class="marker" id="mapping-1864"></span><span class="token add" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-1865"></span><span class="token add" data-title="block_statement/expression_statement"><span class="marker" id="mapping-1866"></span><span class="token add" data-title="expression_statement/call_expression"><span class="marker" id="mapping-1867"></span><span class="token add" data-title="call_expression/member_expression">dollar().mint</span>(<span class="marker" id="mapping-1868"></span><span class="token add" data-title="call_expression/call_argument">pool()</span>, <span class="marker" id="mapping-1869"></span><span class="token mv" id="move-dst-112" data-title="call_expression/call_argument">amount</span>)</span>;</span>
        }</span></span>
    }</span></span>

    <span class="marker" id="mapping-1870"></span><span class="token add" data-title="contract_body/function_definition">function mintToRedeemable(<span class="marker" id="mapping-1871"></span><span class="token mv" id="move-dst-106" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-1872"></span><span class="token mv" id="move-dst-62" data-title="function_definition/visibility">private</span> <span class="marker" id="mapping-1873"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1874"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-1875"></span><span class="token add" data-title="expression_statement/call_expression"><span class="marker" id="mapping-1876"></span><span class="token add" data-title="call_expression/member_expression">dollar().mint</span>(<span class="marker" id="mapping-1877"></span><span class="token add" data-title="call_expression/call_argument">address(this)</span>, <span class="marker" id="mapping-1878"></span><span class="token mv" id="move-dst-22" data-title="call_expression/call_argument">amount</span>)</span>;</span>
        <span class="marker" id="mapping-1879"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-1880"></span><span class="token add" data-title="expression_statement/call_expression">incrementTotalRedeemable(<span class="marker" id="mapping-1881"></span><span class="token mv" id="move-dst-23" data-title="call_expression/call_argument">amount</span>)</span>;</span>

        <span class="marker" id="mapping-1882"></span><span class="token mv" id="move-dst-407" data-title="function_body/expression_statement">balanceCheck();</span>
    }</span></span>
}</span></span>

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
<span class="marker" id="mapping-1883"></span><span class="token mv" id="move-dst-10" data-title="source_file/contract_declaration">contract <span class="marker" id="mapping-1884"></span><span class="token upd" id="move-dst-11" data-title="contract_declaration/identifier">Market</span> is <span class="marker" id="mapping-1885"></span><span class="token upd" id="move-dst-12" data-title="user_defined_type/identifier"><span class="cupd">Co</span>mp<span class="cupd">t</span>roller</span>, <span class="marker" id="mapping-1886"></span><span class="token upd" id="move-dst-13" data-title="user_defined_type/identifier">Curve</span> {
    using SafeMath for uint256;

    <span class="marker" id="mapping-1887"></span><span class="token add" data-title="contract_body/state_variable_declaration">bytes32 private constant FILE = "Market";</span>

    <span class="marker" id="mapping-1888"></span><span class="token add" data-title="contract_body/event_definition">event CouponExpiration(<span class="marker" id="mapping-1889"></span><span class="token add" data-title="event_definition/event_paramater"><span class="marker" id="mapping-1890"></span><span class="token mv" id="move-dst-15" data-title="event_paramater/type_name">uint256</span> indexed epoch</span>, <span class="marker" id="mapping-1891"></span><span class="token add" data-title="event_definition/event_paramater">uint256 couponsExpired</span>, <span class="marker" id="mapping-1892"></span><span class="token add" data-title="event_definition/event_paramater">uint256 lessRedeemable</span>, <span class="marker" id="mapping-1893"></span><span class="token add" data-title="event_definition/event_paramater">uint256 lessDebt</span>, <span class="marker" id="mapping-1894"></span><span class="token add" data-title="event_definition/event_paramater"><span class="marker" id="mapping-1895"></span><span class="token mv" id="move-dst-255" data-title="event_paramater/type_name">uint256</span> newBonded</span>);</span>
    <span class="marker" id="mapping-1896"></span><span class="token add" data-title="contract_body/event_definition">event CouponPurchase(<span class="marker" id="mapping-1897"></span><span class="token mv" id="move-dst-61" data-title="event_definition/event_paramater">address indexed account</span>, <span class="marker" id="mapping-1898"></span><span class="token add" data-title="event_definition/event_paramater">uint256 indexed epoch</span>, <span class="marker" id="mapping-1899"></span><span class="token add" data-title="event_definition/event_paramater">uint256 dollarAmount</span>, <span class="marker" id="mapping-1900"></span><span class="token add" data-title="event_definition/event_paramater"><span class="marker" id="mapping-1901"></span><span class="token mv" id="move-dst-253" data-title="event_paramater/type_name">uint256</span> couponAmount</span>);</span>
    <span class="marker" id="mapping-1902"></span><span class="token mv" id="move-dst-59" data-title="contract_body/event_definition">event <span class="marker" id="mapping-1903"></span><span class="token upd" id="move-dst-60" data-title="event_definition/identifier">Coupo<span class="cupd">n</span>R<span class="cupd">e</span><span class="cupd">d</span>emption</span>(address indexed account<span class="marker" id="mapping-1904"></span><span class="token add" data-title="event_definition/,">,</span> <span class="marker" id="mapping-1905"></span><span class="token add" data-title="event_definition/event_paramater">uint256 indexed epoch</span><span class="marker" id="mapping-1906"></span><span class="token add" data-title="event_definition/,">,</span> <span class="marker" id="mapping-1907"></span><span class="token add" data-title="event_definition/event_paramater">uint256 couponAmount</span>);</span>
    <span class="marker" id="mapping-1908"></span><span class="token add" data-title="contract_body/event_definition">event CouponBurn(address indexed account, uint256 indexed epoch, uint256 couponAmount);</span>
    <span class="marker" id="mapping-1909"></span><span class="token mv" id="move-dst-68" data-title="contract_body/event_definition">event <span class="marker" id="mapping-1910"></span><span class="token upd" id="move-dst-69" data-title="event_definition/identifier">Coupo<span class="cupd">n</span><span class="cupd">Transfer</span></span>(address indexed <span class="marker" id="mapping-1911"></span><span class="token upd" id="move-dst-70" data-title="event_paramater/identifier">f<span class="cupd">r</span>om</span>, address indexed <span class="marker" id="mapping-1912"></span><span class="token upd" id="move-dst-71" data-title="event_paramater/identifier">to</span><span class="marker" id="mapping-1913"></span><span class="token add" data-title="event_definition/,">,</span> <span class="marker" id="mapping-1914"></span><span class="token add" data-title="event_definition/event_paramater">uint256 indexed epoch</span><span class="marker" id="mapping-1915"></span><span class="token add" data-title="event_definition/,">,</span> <span class="marker" id="mapping-1916"></span><span class="token mv" id="move-dst-367" data-title="event_definition/event_paramater">uint256 value</span>);</span>
    <span class="marker" id="mapping-1917"></span><span class="token mv" id="move-dst-229" data-title="contract_body/event_definition">event <span class="marker" id="mapping-1918"></span><span class="token upd" id="move-dst-230" data-title="event_definition/identifier"><span class="cupd">C</span>ouponApp<span class="cupd">r</span>oval</span>(address indexed <span class="marker" id="mapping-1919"></span><span class="token upd" id="move-dst-231" data-title="event_paramater/identifier"><span class="cupd">o</span>wner</span>, address indexed <span class="marker" id="mapping-1920"></span><span class="token upd" id="move-dst-232" data-title="event_paramater/identifier">sp<span class="cupd">en</span>der</span>, <span class="marker" id="mapping-1921"></span><span class="token mv" id="move-dst-375" data-title="event_definition/event_paramater">uint256 value</span>);</span>

    <span class="marker" id="mapping-1922"></span><span class="token mv" id="move-dst-333" data-title="contract_body/function_definition">function <span class="marker" id="mapping-1923"></span><span class="token upd" id="move-dst-334" data-title="function_definition/identifier">step</span>() internal {
        <span class="marker" id="mapping-1924"></span><span class="token add" data-title="function_body/comment">// Expire prior coupons</span>
        <span class="marker" id="mapping-1925"></span><span class="token add" data-title="function_body/for_statement">for (uint256 i = 0; i &lt; expiringCoupons(epoch()); i++) {
            expireCouponsForEpoch(expiringCouponsAtIndex(epoch(), i));
        }</span>

        <span class="marker" id="mapping-1926"></span><span class="token add" data-title="function_body/comment">// Record expiry for current epoch's coupons</span>
        <span class="marker" id="mapping-1927"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1928"></span><span class="token add" data-title="variable_declaration_statement/variable_declaration">uint256 expirationEpoch</span> = <span class="marker" id="mapping-1929"></span><span class="token mv" id="move-dst-335" data-title="variable_declaration_statement/call_expression">epoch().add(Constants.<span class="marker" id="mapping-1930"></span><span class="token upd" id="move-dst-336" data-title="member_expression/identifier"><span class="cupd">get</span>C<span class="cupd">o</span>up<span class="cupd">o</span>n<span class="cupd">Ex</span>p<span class="cupd">i</span>ra<span class="cupd">t</span>ion</span>())</span>;</span>
        <span class="marker" id="mapping-1931"></span><span class="token add" data-title="expression_statement/call_expression">initializeCouponsExpiration(epoch(), expirationEpoch)</span>;
    }</span>

    <span class="marker" id="mapping-1932"></span><span class="token add" data-title="contract_body/function_definition">function expireCouponsForEpoch(<span class="marker" id="mapping-1933"></span><span class="token add" data-title="function_definition/parameter">uint256 epoch</span>) <span class="marker" id="mapping-1934"></span><span class="token mv" id="move-dst-189" data-title="function_definition/visibility">private</span> <span class="marker" id="mapping-1935"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1936"></span><span class="token add" data-title="function_body/variable_declaration_statement">uint256 couponsForEpoch = outstandingCoupons(epoch);</span>
        <span class="marker" id="mapping-1937"></span><span class="token mv" id="move-dst-463" data-title="function_body/variable_declaration_statement">(uint256 <span class="marker" id="mapping-1938"></span><span class="token upd" id="move-dst-464" data-title="variable_declaration/identifier"><span class="cupd">less</span>Redeemable</span>, <span class="marker" id="mapping-1939"></span><span class="token add" data-title="variable_declaration_tuple/variable_declaration">uint256 lessDebt</span><span class="marker" id="mapping-1940"></span><span class="token add" data-title="variable_declaration_tuple/,">,</span> <span class="marker" id="mapping-1941"></span><span class="token add" data-title="variable_declaration_tuple/variable_declaration">uint256 newBonded</span>) = <span class="marker" id="mapping-1942"></span><span class="token add" data-title="variable_declaration_statement/tuple_expression">(0, 0, 0)</span>;</span>

        <span class="marker" id="mapping-1943"></span><span class="token add" data-title="function_body/expression_statement">eliminateOutstandingCoupons(epoch);</span>

        <span class="marker" id="mapping-1944"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1945"></span><span class="token mv" id="move-dst-430" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-1946"></span><span class="token upd" id="move-dst-431" data-title="variable_declaration/identifier">totalR<span class="cupd">e</span>dee<span class="cupd">mable</span></span></span> = <span class="marker" id="mapping-1947"></span><span class="token add" data-title="variable_declaration_statement/call_expression">totalRedeemable()</span>;</span>
        <span class="marker" id="mapping-1948"></span><span class="token add" data-title="function_body/variable_declaration_statement">uint256 totalCoupons = totalCoupons();</span>
        <span class="marker" id="mapping-1949"></span><span class="token add" data-title="function_body/if_statement">if (totalRedeemable &gt; totalCoupons) {
            lessRedeemable = totalRedeemable.sub(totalCoupons);
            burnRedeemable(lessRedeemable);
            (, lessDebt, newBonded) = increaseSupply(lessRedeemable);
        }</span>

        <span class="marker" id="mapping-1950"></span><span class="token add" data-title="function_body/emit_statement">emit CouponExpiration(epoch, couponsForEpoch, lessRedeemable, lessDebt, newBonded);</span>
    }</span></span>

    <span class="marker" id="mapping-1951"></span><span class="token add" data-title="contract_body/function_definition">function couponPremium(<span class="marker" id="mapping-1952"></span><span class="token mv" id="move-dst-156" data-title="function_definition/parameter">uint256 amount</span>) <span class="marker" id="mapping-1953"></span><span class="token mv" id="move-dst-86" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-1954"></span><span class="token mv" id="move-dst-87" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-1955"></span><span class="token mv" id="move-dst-88" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-1956"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1957"></span><span class="token add" data-title="function_body/return_statement">return <span class="marker" id="mapping-1958"></span><span class="token add" data-title="return_statement/call_expression">calculateCouponPremium(<span class="marker" id="mapping-1959"></span><span class="token add" data-title="call_expression/call_argument">dollar().totalSupply()</span>, <span class="marker" id="mapping-1960"></span><span class="token add" data-title="call_expression/call_argument">totalDebt()</span>, <span class="marker" id="mapping-1961"></span><span class="token mv" id="move-dst-153" data-title="call_expression/call_argument">amount</span>)</span>;</span>
    }</span></span>

    <span class="marker" id="mapping-1962"></span><span class="token add" data-title="contract_body/function_definition">function couponRedemptionPenalty(<span class="marker" id="mapping-1963"></span><span class="token add" data-title="function_definition/parameter">uint256 couponEpoch</span>, <span class="marker" id="mapping-1964"></span><span class="token mv" id="move-dst-206" data-title="function_definition/parameter">uint256 <span class="marker" id="mapping-1965"></span><span class="token upd" id="move-dst-207" data-title="parameter/identifier">couponAmount</span></span>) <span class="marker" id="mapping-1966"></span><span class="token mv" id="move-dst-309" data-title="function_definition/visibility">public</span> <span class="marker" id="mapping-1967"></span><span class="token mv" id="move-dst-310" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-1968"></span><span class="token mv" id="move-dst-311" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-1969"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-1970"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1971"></span><span class="token mv" id="move-dst-360" data-title="variable_declaration_statement/variable_declaration">uint <span class="marker" id="mapping-1972"></span><span class="token upd" id="move-dst-361" data-title="variable_declaration/identifier">timeIntoEpoch</span></span> = <span class="marker" id="mapping-1973"></span><span class="token add" data-title="variable_declaration_statement/call_expression">timeInEpoch()</span>;</span>
        <span class="marker" id="mapping-1974"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1975"></span><span class="token mv" id="move-dst-341" data-title="variable_declaration_statement/variable_declaration">uint <span class="marker" id="mapping-1976"></span><span class="token upd" id="move-dst-342" data-title="variable_declaration/identifier">couponAge</span></span> = <span class="marker" id="mapping-1977"></span><span class="token mv" id="move-dst-325" data-title="variable_declaration_statement/binary_expression">epoch() <span class="marker" id="mapping-1978"></span><span class="token add" data-title="binary_expression/-">-</span> <span class="marker" id="mapping-1979"></span><span class="token add" data-title="binary_expression/identifier">couponEpoch</span></span>;</span>

        <span class="marker" id="mapping-1980"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1981"></span><span class="token mv" id="move-dst-343" data-title="variable_declaration_statement/variable_declaration">uint <span class="marker" id="mapping-1982"></span><span class="token upd" id="move-dst-344" data-title="variable_declaration/identifier">couponEpochDecay</span></span> = <span class="marker" id="mapping-1983"></span><span class="token add" data-title="variable_declaration_statement/binary_expression"><span class="marker" id="mapping-1984"></span><span class="token add" data-title="binary_expression/binary_expression"><span class="marker" id="mapping-1985"></span><span class="token add" data-title="binary_expression/call_expression"><span class="marker" id="mapping-1986"></span><span class="token add" data-title="call_expression/member_expression">currentEpochDuration().div</span>(<span class="marker" id="mapping-1987"></span><span class="token mv" id="move-dst-185" data-title="call_expression/call_argument">2</span>)</span> * <span class="marker" id="mapping-1988"></span><span class="token add" data-title="binary_expression/parenthesized_expression">(Constants.getCouponExpiration() - couponAge)</span></span> / <span class="marker" id="mapping-1989"></span><span class="token add" data-title="binary_expression/call_expression">Constants.getCouponExpiration()</span></span>;</span>

        <span class="marker" id="mapping-1990"></span><span class="token mv" id="move-dst-315" data-title="function_body/if_statement">if(<span class="marker" id="mapping-1991"></span><span class="token upd" id="move-dst-316" data-title="binary_expression/identifier"><span class="cupd">t</span>imeIn<span class="cupd">t</span>oEpoch</span> <span class="marker" id="mapping-1992"></span><span class="token add" data-title="binary_expression/>">&gt;</span> <span class="marker" id="mapping-1993"></span><span class="token add" data-title="binary_expression/identifier">couponEpochDecay</span>) {
            return 0;
        }</span>

        <span class="marker" id="mapping-1994"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1995"></span><span class="token mv" id="move-dst-173" data-title="variable_declaration_statement/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-1996"></span><span class="token upd" id="move-dst-174" data-title="variable_declaration/identifier">couponEpochIn<span class="cupd">i</span><span class="cupd">t</span>ialP<span class="cupd">e</span><span class="cupd">nal</span>ty</span></span> = <span class="marker" id="mapping-1997"></span><span class="token add" data-title="variable_declaration_statement/call_expression">Constants.getInitialCouponRedemptionPenalty().div(Decimal.D256({value: Constants.getCouponExpiration() })).mul(Decimal.D256({value: Constants.getCouponExpiration() - couponAge}))</span>;</span>
        <span class="marker" id="mapping-1998"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-1999"></span><span class="token mv" id="move-dst-139" data-title="variable_declaration_statement/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-2000"></span><span class="token upd" id="move-dst-140" data-title="variable_declaration/identifier">couponEpochD<span class="cupd">e</span>cay<span class="cupd">e</span>dPe<span class="cupd">nal</span>ty</span></span> = <span class="marker" id="mapping-2001"></span><span class="token add" data-title="variable_declaration_statement/call_expression">couponEpochInitialPenalty.div(Decimal.D256({value: couponEpochDecay})).mul(Decimal.D256({value: couponEpochDecay - timeIntoEpoch}))</span>;</span>

        <span class="marker" id="mapping-2002"></span><span class="token add" data-title="function_body/return_statement">return Decimal.D256({value: couponAmount}).mul(couponEpochDecayedPenalty).value;</span>
    }</span></span>

    <span class="marker" id="mapping-2003"></span><span class="token add" data-title="contract_body/function_definition">function purchaseCoupons(<span class="marker" id="mapping-2004"></span><span class="token mv" id="move-dst-337" data-title="function_definition/parameter">uint256 dollarAmount</span>) <span class="marker" id="mapping-2005"></span><span class="token mv" id="move-dst-208" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-2006"></span><span class="token mv" id="move-dst-84" data-title="function_definition/return_type_definition">returns (uint256)</span> <span class="marker" id="mapping-2007"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-2008"></span><span class="token mv" id="move-dst-425" data-title="function_body/variable_declaration_statement">uint256 <span class="marker" id="mapping-2009"></span><span class="token upd" id="move-dst-426" data-title="variable_declaration/identifier">tot<span class="cupd">al</span>SupplyB<span class="cupd">e</span><span class="cupd">f</span>ore<span class="cupd">B</span>urn</span> = <span class="marker" id="mapping-2010"></span><span class="token add" data-title="variable_declaration_statement/call_expression">dollar().totalSupply()</span>;</span>
        <span class="marker" id="mapping-2011"></span><span class="token mv" id="move-dst-412" data-title="function_body/variable_declaration_statement">uint256 <span class="marker" id="mapping-2012"></span><span class="token upd" id="move-dst-413" data-title="variable_declaration/identifier"><span class="cupd">total</span>D<span class="cupd">e</span>btBefo<span class="cupd">r</span><span class="cupd">e</span>Burn</span> = <span class="marker" id="mapping-2013"></span><span class="token add" data-title="call_expression/identifier">totalDebt</span>();</span>
        <span class="marker" id="mapping-2014"></span><span class="token mv" id="move-dst-429" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-2015"></span><span class="token mv" id="move-dst-414" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-2016"></span><span class="token upd" id="move-dst-415" data-title="variable_declaration/identifier">r<span class="cupd">e</span><span class="cupd">a</span>lBur<span class="cupd">n</span>Amount</span></span> = <span class="marker" id="mapping-2017"></span><span class="token mv" id="move-dst-432" data-title="variable_declaration_statement/call_expression"><span class="marker" id="mapping-2018"></span><span class="token upd" id="move-dst-433" data-title="call_expression/identifier"><span class="cupd">b</span>ur<span class="cupd">n</span>FromAccount</span>(msg.sender<span class="marker" id="mapping-2019"></span><span class="token add" data-title="call_expression/,">,</span> <span class="marker" id="mapping-2020"></span><span class="token mv" id="move-dst-347" data-title="call_expression/call_argument">dollarAmount</span>)</span>;</span>

        <span class="marker" id="mapping-2021"></span><span class="token mv" id="move-dst-154" data-title="function_body/expression_statement"><span class="marker" id="mapping-2022"></span><span class="token mv" id="move-dst-155" data-title="expression_statement/call_expression"><span class="marker" id="mapping-2023"></span><span class="token mv" id="move-dst-210" data-title="call_expression/member_expression">Require.that</span>(
            <span class="marker" id="mapping-2024"></span><span class="token add" data-title="call_argument/binary_expression">realBurnAmount &gt; 0</span>,
            <span class="marker" id="mapping-2025"></span><span class="token mv" id="move-dst-211" data-title="call_expression/call_argument">FILE</span><span class="marker" id="mapping-2026"></span><span class="token add" data-title="call_expression/,">,</span>
            "Must purchase non-zero amount"
        )</span>;</span>

        <span class="marker" id="mapping-2027"></span><span class="token mv" id="move-dst-161" data-title="function_body/expression_statement"><span class="marker" id="mapping-2028"></span><span class="token mv" id="move-dst-162" data-title="expression_statement/call_expression"><span class="marker" id="mapping-2029"></span><span class="token mv" id="move-dst-215" data-title="call_expression/member_expression">Require.that</span>(
            <span class="marker" id="mapping-2030"></span><span class="token add" data-title="call_argument/binary_expression">totalDebtBeforeBurn &gt;= realBurnAmount</span>,
            <span class="marker" id="mapping-2031"></span><span class="token mv" id="move-dst-216" data-title="call_expression/call_argument">FILE</span><span class="marker" id="mapping-2032"></span><span class="token add" data-title="call_expression/,">,</span>
            "Not enough debt"
        )</span>;</span>

        <span class="marker" id="mapping-2033"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-2034"></span><span class="token mv" id="move-dst-434" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-2035"></span><span class="token upd" id="move-dst-435" data-title="variable_declaration/identifier"><span class="cupd">e</span>poch</span></span> = <span class="marker" id="mapping-2036"></span><span class="token add" data-title="variable_declaration_statement/call_expression">epoch()</span>;</span>
        <span class="marker" id="mapping-2037"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-2038"></span><span class="token mv" id="move-dst-469" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-2039"></span><span class="token upd" id="move-dst-470" data-title="variable_declaration/identifier">c<span class="cupd">o</span>up<span class="cupd">o</span>nA<span class="cupd">m</span><span class="cupd">o</span>unt</span></span> = <span class="marker" id="mapping-2040"></span><span class="token add" data-title="variable_declaration_statement/call_expression">realBurnAmount.add(calculateCouponPremium(totalSupplyBeforeBurn, totalDebtBeforeBurn, realBurnAmount))</span>;</span>
        <span class="marker" id="mapping-2041"></span><span class="token mv" id="move-dst-446" data-title="function_body/expression_statement"><span class="marker" id="mapping-2042"></span><span class="token upd" id="move-dst-447" data-title="call_expression/identifier">in<span class="cupd">crementBalanceOf</span>C<span class="cupd">o</span>upons</span>(msg.sender, <span class="marker" id="mapping-2043"></span><span class="token upd" id="move-dst-448" data-title="call_argument/identifier">epoch</span>, <span class="marker" id="mapping-2044"></span><span class="token add" data-title="call_expression/call_argument">couponAmount</span>);</span>

        <span class="marker" id="mapping-2045"></span><span class="token add" data-title="function_body/emit_statement">emit CouponPurchase(msg.sender, epoch, realBurnAmount, couponAmount);</span>

        <span class="marker" id="mapping-2046"></span><span class="token add" data-title="function_body/return_statement">return couponAmount;</span>
    }</span></span>

    <span class="marker" id="mapping-2047"></span><span class="token add" data-title="contract_body/function_definition">function redeemCoupons(<span class="marker" id="mapping-2048"></span><span class="token add" data-title="function_definition/parameter">uint256 couponEpoch</span>, <span class="marker" id="mapping-2049"></span><span class="token add" data-title="function_definition/parameter">uint256 couponAmount</span>) <span class="marker" id="mapping-2050"></span><span class="token mv" id="move-dst-91" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-2051"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-2052"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-2053"></span><span class="token add" data-title="expression_statement/call_expression">require(<span class="marker" id="mapping-2054"></span><span class="token add" data-title="call_expression/call_argument">epoch().sub(couponEpoch) &gt;= 2</span>, <span class="marker" id="mapping-2055"></span><span class="token mv" id="move-dst-144" data-title="call_expression/call_argument">"Market: Too early to redeem"</span>)</span>;</span>
        <span class="marker" id="mapping-2056"></span><span class="token mv" id="move-dst-32" data-title="function_body/expression_statement"><span class="marker" id="mapping-2057"></span><span class="token mv" id="move-dst-33" data-title="expression_statement/call_expression"><span class="marker" id="mapping-2058"></span><span class="token add" data-title="call_expression/identifier">decrementBalanceOfCoupons</span>(<span class="marker" id="mapping-2059"></span><span class="token mv" id="move-dst-364" data-title="call_expression/call_argument">msg.sender</span>, <span class="marker" id="mapping-2060"></span><span class="token mv" id="move-dst-34" data-title="call_expression/call_argument"><span class="marker" id="mapping-2061"></span><span class="token upd" id="move-dst-35" data-title="call_argument/identifier">c<span class="cupd">ou</span>ponEpoch</span></span><span class="marker" id="mapping-2062"></span><span class="token add" data-title="call_expression/,">,</span> <span class="marker" id="mapping-2063"></span><span class="token add" data-title="call_expression/call_argument">couponAmount</span><span class="marker" id="mapping-2064"></span><span class="token add" data-title="call_expression/,">,</span> "Market: Insufficient coupon balance")</span>;</span>
        
        <span class="marker" id="mapping-2065"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-2066"></span><span class="token mv" id="move-dst-358" data-title="variable_declaration_statement/variable_declaration">uint <span class="marker" id="mapping-2067"></span><span class="token upd" id="move-dst-359" data-title="variable_declaration/identifier">burnAmount</span></span> = <span class="marker" id="mapping-2068"></span><span class="token add" data-title="variable_declaration_statement/call_expression">couponRedemptionPenalty(couponEpoch, couponAmount)</span>;</span>
        <span class="marker" id="mapping-2069"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-2070"></span><span class="token mv" id="move-dst-466" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-2071"></span><span class="token upd" id="move-dst-467" data-title="variable_declaration/identifier">r<span class="cupd">e</span><span class="cupd">de</span>emAmou<span class="cupd">nt</span></span></span> = <span class="marker" id="mapping-2072"></span><span class="token add" data-title="variable_declaration_statement/binary_expression">couponAmount - burnAmount</span>;</span>
        
        <span class="marker" id="mapping-2073"></span><span class="token mv" id="move-dst-475" data-title="function_body/expression_statement"><span class="marker" id="mapping-2074"></span><span class="token upd" id="move-dst-476" data-title="call_expression/identifier"><span class="cupd">re</span>dee<span class="cupd">m</span>ToA<span class="cupd">c</span>cou<span class="cupd">nt</span></span>(msg.sender, <span class="marker" id="mapping-2075"></span><span class="token add" data-title="call_argument/identifier">redeemAmount</span>);</span>

        <span class="marker" id="mapping-2076"></span><span class="token add" data-title="function_body/if_statement">if(burnAmount &gt; 0){
            emit CouponBurn(msg.sender, couponEpoch, burnAmount);
        }</span>

        <span class="marker" id="mapping-2077"></span><span class="token add" data-title="function_body/emit_statement">emit CouponRedemption(msg.sender, couponEpoch, redeemAmount);</span>
    }</span></span>

    <span class="marker" id="mapping-2078"></span><span class="token add" data-title="contract_body/function_definition">function redeemCoupons(<span class="marker" id="mapping-2079"></span><span class="token add" data-title="function_definition/parameter">uint256 couponEpoch</span>, <span class="marker" id="mapping-2080"></span><span class="token add" data-title="function_definition/parameter">uint256 couponAmount</span>, <span class="marker" id="mapping-2081"></span><span class="token mv" id="move-dst-192" data-title="function_definition/parameter">uint256 <span class="marker" id="mapping-2082"></span><span class="token upd" id="move-dst-193" data-title="parameter/identifier">m<span class="cupd">in</span>Output</span></span>) <span class="marker" id="mapping-2083"></span><span class="token mv" id="move-dst-483" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-2084"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-2085"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-2086"></span><span class="token add" data-title="expression_statement/call_expression">require(<span class="marker" id="mapping-2087"></span><span class="token add" data-title="call_expression/call_argument">epoch().sub(couponEpoch) &gt;= 2</span>, <span class="marker" id="mapping-2088"></span><span class="token mv" id="move-dst-37" data-title="call_expression/call_argument">"Market: Too early to redeem"</span>)</span>;</span>
        <span class="marker" id="mapping-2089"></span><span class="token mv" id="move-dst-46" data-title="function_body/expression_statement"><span class="marker" id="mapping-2090"></span><span class="token upd" id="move-dst-47" data-title="call_expression/identifier">dec<span class="cupd">re</span>mentBalanceOfCoupons</span>(<span class="marker" id="mapping-2091"></span><span class="token add" data-title="call_expression/call_argument">msg.sender</span>, <span class="marker" id="mapping-2092"></span><span class="token add" data-title="call_expression/call_argument">couponEpoch</span><span class="marker" id="mapping-2093"></span><span class="token add" data-title="call_expression/,">,</span> <span class="marker" id="mapping-2094"></span><span class="token add" data-title="call_expression/call_argument">couponAmount</span><span class="marker" id="mapping-2095"></span><span class="token add" data-title="call_expression/,">,</span> "Market: Insufficient coupon balance");</span>
        
        <span class="marker" id="mapping-2096"></span><span class="token mv" id="move-dst-239" data-title="function_body/variable_declaration_statement">uint <span class="marker" id="mapping-2097"></span><span class="token upd" id="move-dst-240" data-title="variable_declaration/identifier">burnAmount</span> <span class="marker" id="mapping-2098"></span><span class="token add" data-title="variable_declaration_statement/=">=</span> <span class="marker" id="mapping-2099"></span><span class="token add" data-title="variable_declaration_statement/call_expression">couponRedemptionPenalty(couponEpoch, couponAmount)</span>;</span>
        <span class="marker" id="mapping-2100"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-2101"></span><span class="token mv" id="move-dst-178" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-2102"></span><span class="token upd" id="move-dst-179" data-title="variable_declaration/identifier"><span class="cupd">r</span>e<span class="cupd">d</span>eemAm<span class="cupd">o</span>u<span class="cupd">n</span>t</span></span> = <span class="marker" id="mapping-2103"></span><span class="token add" data-title="variable_declaration_statement/binary_expression">couponAmount - burnAmount</span>;</span>

        <span class="marker" id="mapping-2104"></span><span class="token mv" id="move-dst-212" data-title="function_body/expression_statement">Require.that(
            <span class="marker" id="mapping-2105"></span><span class="token upd" id="move-dst-213" data-title="binary_expression/identifier"><span class="cupd">re</span>d<span class="cupd">e</span>emAmount</span> <span class="marker" id="mapping-2106"></span><span class="token add" data-title="binary_expression/>=">&gt;=</span> <span class="marker" id="mapping-2107"></span><span class="token add" data-title="binary_expression/identifier">minOutput</span>,
            FILE,
            "Insufficient output amount"
        );</span>
        
        <span class="marker" id="mapping-2108"></span><span class="token mv" id="move-dst-472" data-title="function_body/expression_statement"><span class="marker" id="mapping-2109"></span><span class="token upd" id="move-dst-473" data-title="call_expression/identifier"><span class="cupd">re</span>d<span class="cupd">e</span><span class="cupd">e</span>mT<span class="cupd">o</span>Account</span>(msg.sender, <span class="marker" id="mapping-2110"></span><span class="token upd" id="move-dst-474" data-title="call_argument/identifier">r<span class="cupd">e</span>deemAmount</span>);</span>

        <span class="marker" id="mapping-2111"></span><span class="token add" data-title="function_body/if_statement">if(burnAmount &gt; 0){
            emit CouponBurn(msg.sender, couponEpoch, burnAmount);
        }</span>

        <span class="marker" id="mapping-2112"></span><span class="token add" data-title="function_body/emit_statement">emit CouponRedemption(msg.sender, couponEpoch, redeemAmount);</span>
    }</span></span>

    function <span class="marker" id="mapping-2113"></span><span class="token upd" id="move-dst-44" data-title="function_definition/identifier"><span class="cupd">approve</span>Coupons</span>(address spender<span class="marker" id="mapping-2114"></span><span class="token mv" id="move-dst-45" data-title="function_definition/,">,</span> uint256 amount) <span class="marker" id="mapping-2115"></span><span class="token mv" id="move-dst-289" data-title="function_definition/visibility">external</span> {
        require(spender != address(0), "Market: Coupon approve to the zero address");

        <span class="marker" id="mapping-2116"></span><span class="token add" data-title="expression_statement/call_expression">updateAllowanceCoupons(<span class="marker" id="mapping-2117"></span><span class="token add" data-title="call_expression/call_argument">msg.sender</span>, <span class="marker" id="mapping-2118"></span><span class="token mv" id="move-dst-217" data-title="call_expression/call_argument">spender</span>, <span class="marker" id="mapping-2119"></span><span class="token mv" id="move-dst-330" data-title="call_expression/call_argument">amount</span>)</span>;

        emit <span class="marker" id="mapping-2120"></span><span class="token upd" id="move-dst-48" data-title="emit_statement/identifier">Coupon<span class="cupd">Approval</span></span>(<span class="marker" id="mapping-2121"></span><span class="token add" data-title="emit_statement/call_argument">msg.sender</span>, spender, <span class="marker" id="mapping-2122"></span><span class="token mv" id="move-dst-38" data-title="emit_statement/call_argument">amount</span>);
    }

    <span class="marker" id="mapping-2123"></span><span class="token mv" id="move-dst-30" data-title="contract_body/function_definition">function <span class="marker" id="mapping-2124"></span><span class="token upd" id="move-dst-31" data-title="function_definition/identifier"><span class="cupd">transfer</span>Coupons</span>(address sender, address recipient, <span class="marker" id="mapping-2125"></span><span class="token add" data-title="function_definition/parameter">uint256 epoch</span><span class="marker" id="mapping-2126"></span><span class="token add" data-title="function_definition/,">,</span> uint256 amount) <span class="marker" id="mapping-2127"></span><span class="token mv" id="move-dst-484" data-title="function_definition/visibility">external</span> {
        require(sender != address(0), "Market: Coupon transfer from the zero address");
        require(recipient != address(0), "Market: Coupon transfer to the zero address");

        <span class="marker" id="mapping-2128"></span><span class="token mv" id="move-dst-40" data-title="function_body/expression_statement"><span class="marker" id="mapping-2129"></span><span class="token upd" id="move-dst-41" data-title="call_expression/identifier">dec<span class="cupd">re</span>mentBalanceOfCoupons</span>(<span class="marker" id="mapping-2130"></span><span class="token mv" id="move-dst-146" data-title="call_expression/call_argument">sender</span>, <span class="marker" id="mapping-2131"></span><span class="token mv" id="move-dst-42" data-title="call_expression/call_argument"><span class="marker" id="mapping-2132"></span><span class="token add" data-title="call_argument/identifier">epoch</span></span><span class="marker" id="mapping-2133"></span><span class="token add" data-title="call_expression/,">,</span> <span class="marker" id="mapping-2134"></span><span class="token mv" id="move-dst-49" data-title="call_expression/call_argument">amount</span><span class="marker" id="mapping-2135"></span><span class="token add" data-title="call_expression/,">,</span> "Market: Insufficient coupon balance");</span>
        <span class="marker" id="mapping-2136"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-2137"></span><span class="token add" data-title="expression_statement/call_expression">incrementBalanceOfCoupons(<span class="marker" id="mapping-2138"></span><span class="token mv" id="move-dst-136" data-title="call_expression/call_argument">recipient</span>, <span class="marker" id="mapping-2139"></span><span class="token add" data-title="call_expression/call_argument">epoch</span>, <span class="marker" id="mapping-2140"></span><span class="token mv" id="move-dst-332" data-title="call_expression/call_argument">amount</span>)</span>;</span>

        <span class="marker" id="mapping-2141"></span><span class="token mv" id="move-dst-224" data-title="function_body/if_statement">if (<span class="marker" id="mapping-2142"></span><span class="token add" data-title="if_statement/binary_expression"><span class="marker" id="mapping-2143"></span><span class="token add" data-title="binary_expression/binary_expression"><span class="marker" id="mapping-2144"></span><span class="token mv" id="move-dst-3" data-title="binary_expression/member_expression">msg.sender</span> != sender</span> &amp;&amp; <span class="marker" id="mapping-2145"></span><span class="token mv" id="move-dst-225" data-title="binary_expression/binary_expression"><span class="marker" id="mapping-2146"></span><span class="token upd" id="move-dst-226" data-title="call_expression/identifier"><span class="cupd">allowance</span>Coupons</span>(sender, <span class="marker" id="mapping-2147"></span><span class="token add" data-title="call_argument/member_expression">msg.sender</span>) != uint256(-1)</span></span>) <span class="marker" id="mapping-2148"></span><span class="token mv" id="move-dst-109" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-2149"></span><span class="token mv" id="move-dst-110" data-title="expression_statement/call_expression"><span class="marker" id="mapping-2150"></span><span class="token add" data-title="call_expression/identifier">decrementAllowanceCoupons</span>(<span class="marker" id="mapping-2151"></span><span class="token mv" id="move-dst-227" data-title="call_expression/call_argument">sender</span>, <span class="marker" id="mapping-2152"></span><span class="token add" data-title="call_expression/call_argument">msg.sender</span><span class="marker" id="mapping-2153"></span><span class="token add" data-title="call_expression/,">,</span> <span class="marker" id="mapping-2154"></span><span class="token mv" id="move-dst-111" data-title="call_expression/call_argument">amount</span><span class="marker" id="mapping-2155"></span><span class="token add" data-title="call_expression/,">,</span> "Market: Insufficient coupon approval")</span>;
        }</span></span>

        emit <span class="marker" id="mapping-2156"></span><span class="token upd" id="move-dst-36" data-title="emit_statement/identifier">Coupon<span class="cupd">Transfer</span></span>(sender, recipient, <span class="marker" id="mapping-2157"></span><span class="token add" data-title="emit_statement/call_argument">epoch</span><span class="marker" id="mapping-2158"></span><span class="token add" data-title="emit_statement/,">,</span> amount);
    }</span>
}</span>

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
<span class="marker" id="mapping-2159"></span><span class="token mv" id="move-dst-248" data-title="source_file/contract_declaration">contract <span class="marker" id="mapping-2160"></span><span class="token upd" id="move-dst-249" data-title="contract_declaration/identifier">Regulator</span> is <span class="marker" id="mapping-2161"></span><span class="token upd" id="move-dst-250" data-title="user_defined_type/identifier">Compt<span class="cupd">r</span>o<span class="cupd">l</span>ler</span> {
    <span class="marker" id="mapping-2162"></span><span class="token add" data-title="contract_body/using_directive">using SafeMath for uint256;</span>
    using Decimal for Decimal.D256;

    <span class="marker" id="mapping-2163"></span><span class="token add" data-title="contract_body/event_definition">event SupplyIncrease(<span class="marker" id="mapping-2164"></span><span class="token add" data-title="event_definition/event_paramater"><span class="marker" id="mapping-2165"></span><span class="token mv" id="move-dst-293" data-title="event_paramater/type_name">uint256</span> indexed epoch</span>, <span class="marker" id="mapping-2166"></span><span class="token add" data-title="event_definition/event_paramater"><span class="marker" id="mapping-2167"></span><span class="token mv" id="move-dst-295" data-title="event_paramater/type_name">uint256</span> epochPeriod</span>, <span class="marker" id="mapping-2168"></span><span class="token add" data-title="event_definition/event_paramater"><span class="marker" id="mapping-2169"></span><span class="token mv" id="move-dst-301" data-title="event_paramater/type_name">uint256</span> price</span>, <span class="marker" id="mapping-2170"></span><span class="token add" data-title="event_definition/event_paramater">uint256 newRedeemable</span>, <span class="marker" id="mapping-2171"></span><span class="token add" data-title="event_definition/event_paramater">uint256 lessDebt</span>, <span class="marker" id="mapping-2172"></span><span class="token add" data-title="event_definition/event_paramater">uint256 newBonded</span>);</span>
    <span class="marker" id="mapping-2173"></span><span class="token add" data-title="contract_body/event_definition">event SupplyDecrease(<span class="marker" id="mapping-2174"></span><span class="token add" data-title="event_definition/event_paramater"><span class="marker" id="mapping-2175"></span><span class="token mv" id="move-dst-298" data-title="event_paramater/type_name">uint256</span> indexed epoch</span>, <span class="marker" id="mapping-2176"></span><span class="token add" data-title="event_definition/event_paramater"><span class="marker" id="mapping-2177"></span><span class="token mv" id="move-dst-294" data-title="event_paramater/type_name">uint256</span> epochPeriod</span>, <span class="marker" id="mapping-2178"></span><span class="token add" data-title="event_definition/event_paramater"><span class="marker" id="mapping-2179"></span><span class="token mv" id="move-dst-300" data-title="event_paramater/type_name">uint256</span> price</span>, <span class="marker" id="mapping-2180"></span><span class="token add" data-title="event_definition/event_paramater">uint256 newDebt</span>);</span>
    <span class="marker" id="mapping-2181"></span><span class="token add" data-title="contract_body/event_definition">event SupplyNeutral(<span class="marker" id="mapping-2182"></span><span class="token add" data-title="event_definition/event_paramater">uint256 indexed epoch</span>, <span class="marker" id="mapping-2183"></span><span class="token add" data-title="event_definition/event_paramater"><span class="marker" id="mapping-2184"></span><span class="token mv" id="move-dst-299" data-title="event_paramater/type_name">uint256</span> epochPeriod</span>);</span>

    <span class="marker" id="mapping-2185"></span><span class="token add" data-title="contract_body/function_definition">function step() <span class="marker" id="mapping-2186"></span><span class="token mv" id="move-dst-76" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-2187"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-2188"></span><span class="token mv" id="move-dst-267" data-title="function_body/variable_declaration_statement">Decimal.D256 memory price = <span class="marker" id="mapping-2189"></span><span class="token upd" id="move-dst-268" data-title="call_expression/identifier">oracleCa<span class="cupd">p</span><span class="cupd">t</span>u<span class="cupd">r</span>e</span>();</span>
        <span class="marker" id="mapping-2190"></span><span class="token add" data-title="function_body/expression_statement">adjustPeriod(price);</span>

        <span class="marker" id="mapping-2191"></span><span class="token add" data-title="function_body/if_statement">if (<span class="marker" id="mapping-2192"></span><span class="token add" data-title="if_statement/call_expression">price.greaterThan(Decimal.one())</span>) <span class="marker" id="mapping-2193"></span><span class="token add" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-2194"></span><span class="token add" data-title="block_statement/expression_statement">setDebtToZero();</span>
            <span class="marker" id="mapping-2195"></span><span class="token add" data-title="block_statement/expression_statement">growSupply(price);</span>
            <span class="marker" id="mapping-2196"></span><span class="token mv" id="move-dst-180" data-title="block_statement/return_statement">return;</span>
        }</span></span>

        <span class="marker" id="mapping-2197"></span><span class="token add" data-title="function_body/if_statement">if (<span class="marker" id="mapping-2198"></span><span class="token add" data-title="if_statement/call_expression"><span class="marker" id="mapping-2199"></span><span class="token add" data-title="call_expression/member_expression">price.lessThan</span>(<span class="marker" id="mapping-2200"></span><span class="token add" data-title="call_expression/call_argument"><span class="marker" id="mapping-2201"></span><span class="token mv" id="move-dst-77" data-title="call_argument/call_expression">Decimal.one()</span></span>)</span>) <span class="marker" id="mapping-2202"></span><span class="token add" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-2203"></span><span class="token mv" id="move-dst-118" data-title="block_statement/expression_statement"><span class="marker" id="mapping-2204"></span><span class="token mv" id="move-dst-119" data-title="expression_statement/call_expression"><span class="marker" id="mapping-2205"></span><span class="token add" data-title="call_expression/identifier">decrementTotalRedeemable</span>(<span class="marker" id="mapping-2206"></span><span class="token add" data-title="call_argument/call_expression">totalRedeemable()</span>, "Blockchain broke???????")</span>;</span>
            <span class="marker" id="mapping-2207"></span><span class="token add" data-title="block_statement/expression_statement">shrinkSupply(price);</span>
            <span class="marker" id="mapping-2208"></span><span class="token mv" id="move-dst-92" data-title="block_statement/return_statement">return;</span>
        }</span></span>

        <span class="marker" id="mapping-2209"></span><span class="token add" data-title="function_body/emit_statement">emit SupplyNeutral(epoch(), currentEpochDuration());</span>
    }</span></span>

    <span class="marker" id="mapping-2210"></span><span class="token add" data-title="contract_body/function_definition">function shrinkSupply(<span class="marker" id="mapping-2211"></span><span class="token mv" id="move-dst-165" data-title="function_definition/parameter">Decimal.D256 memory <span class="marker" id="mapping-2212"></span><span class="token upd" id="move-dst-166" data-title="parameter/identifier">price</span></span>) <span class="marker" id="mapping-2213"></span><span class="token mv" id="move-dst-196" data-title="function_definition/visibility">private</span> <span class="marker" id="mapping-2214"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-2215"></span><span class="token mv" id="move-dst-147" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-2216"></span><span class="token mv" id="move-dst-148" data-title="variable_declaration_statement/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-2217"></span><span class="token upd" id="move-dst-149" data-title="variable_declaration/identifier">d<span class="cupd">e</span><span class="cupd">l</span>ta</span></span> = <span class="marker" id="mapping-2218"></span><span class="token upd" id="move-dst-152" data-title="call_expression/identifier">limit</span>(<span class="marker" id="mapping-2219"></span><span class="token add" data-title="call_expression/call_argument">Decimal.one().sub(price)</span>);</span>
        <span class="marker" id="mapping-2220"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-2221"></span><span class="token mv" id="move-dst-345" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-2222"></span><span class="token upd" id="move-dst-346" data-title="variable_declaration/identifier"><span class="cupd">n</span>ewDebt</span></span> = <span class="marker" id="mapping-2223"></span><span class="token add" data-title="variable_declaration_statement/call_expression">delta.mul(totalNet()).asUint256()</span>;</span>
        <span class="marker" id="mapping-2224"></span><span class="token add" data-title="function_body/expression_statement">increaseDebt(newDebt);</span>

        <span class="marker" id="mapping-2225"></span><span class="token add" data-title="function_body/emit_statement">emit SupplyDecrease(epoch(), currentEpochDuration(), price.value, newDebt);</span>
        <span class="marker" id="mapping-2226"></span><span class="token add" data-title="function_body/return_statement">return;</span>
    }</span></span>

    function <span class="marker" id="mapping-2227"></span><span class="token upd" id="move-dst-273" data-title="function_definition/identifier">growS<span class="cupd">up</span>ply</span>(<span class="marker" id="mapping-2228"></span><span class="token mv" id="move-dst-169" data-title="function_definition/parameter">Decimal.D256 memory <span class="marker" id="mapping-2229"></span><span class="token upd" id="move-dst-170" data-title="parameter/identifier">p<span class="cupd">r</span>ice</span></span>) <span class="marker" id="mapping-2230"></span><span class="token mv" id="move-dst-188" data-title="function_definition/visibility">private</span> {
        <span class="marker" id="mapping-2231"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-2232"></span><span class="token mv" id="move-dst-130" data-title="variable_declaration_statement/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-2233"></span><span class="token upd" id="move-dst-131" data-title="variable_declaration/identifier">del<span class="cupd">ta</span></span></span> = <span class="marker" id="mapping-2234"></span><span class="token add" data-title="variable_declaration_statement/call_expression">limit(price.sub(Decimal.one()).div(Constants.getSupplyChangeDivisor()))</span>;</span>
        <span class="marker" id="mapping-2235"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-2236"></span><span class="token mv" id="move-dst-322" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-2237"></span><span class="token upd" id="move-dst-323" data-title="variable_declaration/identifier"><span class="cupd">n</span>ewSupply</span></span> = <span class="marker" id="mapping-2238"></span><span class="token add" data-title="variable_declaration_statement/call_expression">delta.mul(totalNet()).asUint256()</span>;</span>
        (uint256 <span class="marker" id="mapping-2239"></span><span class="token upd" id="move-dst-276" data-title="variable_declaration/identifier">n<span class="cupd">e</span>wRedee<span class="cupd">m</span>ab<span class="cupd">l</span>e</span>, uint256 <span class="marker" id="mapping-2240"></span><span class="token upd" id="move-dst-277" data-title="variable_declaration/identifier">l<span class="cupd">e</span>ssDebt</span>, <span class="marker" id="mapping-2241"></span><span class="token mv" id="move-dst-465" data-title="variable_declaration/type_name">uint256</span> <span class="marker" id="mapping-2242"></span><span class="token upd" id="move-dst-278" data-title="variable_declaration/identifier">newB<span class="cupd">o</span>nded</span>) = <span class="marker" id="mapping-2243"></span><span class="token add" data-title="call_expression/identifier">increaseSupply</span>(<span class="marker" id="mapping-2244"></span><span class="token add" data-title="call_argument/identifier">newSupply</span>);
        <span class="marker" id="mapping-2245"></span><span class="token add" data-title="function_body/emit_statement">emit SupplyIncrease(epoch(), currentEpochDuration(), price.value, newRedeemable, lessDebt, newBonded);</span>
    }

    <span class="marker" id="mapping-2246"></span><span class="token add" data-title="contract_body/function_definition">function limit(<span class="marker" id="mapping-2247"></span><span class="token mv" id="move-dst-171" data-title="function_definition/parameter">Decimal.D256 memory <span class="marker" id="mapping-2248"></span><span class="token upd" id="move-dst-172" data-title="parameter/identifier">d<span class="cupd">e</span><span class="cupd">l</span><span class="cupd">t</span>a</span></span>) <span class="marker" id="mapping-2249"></span><span class="token mv" id="move-dst-285" data-title="function_definition/visibility">private</span> <span class="marker" id="mapping-2250"></span><span class="token mv" id="move-dst-164" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-2251"></span><span class="token add" data-title="function_definition/return_type_definition">returns (Decimal.D256 memory)</span> <span class="marker" id="mapping-2252"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-2253"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-2254"></span><span class="token mv" id="move-dst-141" data-title="variable_declaration_statement/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-2255"></span><span class="token upd" id="move-dst-142" data-title="variable_declaration/identifier">supplyCha<span class="cupd">n</span>g<span class="cupd">e</span>Li<span class="cupd">m</span>it</span></span> = <span class="marker" id="mapping-2256"></span><span class="token add" data-title="variable_declaration_statement/call_expression">Constants.getSupplyChangeLimit()</span>;</span>

        <span class="marker" id="mapping-2257"></span><span class="token add" data-title="function_body/return_statement">return delta.greaterThan(supplyChangeLimit) ? supplyChangeLimit : delta;</span>

    }</span></span>

    <span class="marker" id="mapping-2258"></span><span class="token mv" id="move-dst-257" data-title="contract_body/function_definition">function <span class="marker" id="mapping-2259"></span><span class="token upd" id="move-dst-258" data-title="function_definition/identifier">ora<span class="cupd">c</span>leC<span class="cupd">apture</span></span>() <span class="marker" id="mapping-2260"></span><span class="token mv" id="move-dst-274" data-title="function_definition/visibility">private</span> <span class="marker" id="mapping-2261"></span><span class="token mv" id="move-dst-275" data-title="function_definition/return_type_definition">returns (Decimal.D256 memory)</span> {
        <span class="marker" id="mapping-2262"></span><span class="token mv" id="move-dst-281" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-2263"></span><span class="token add" data-title="variable_declaration_statement/variable_declaration_tuple">(<span class="marker" id="mapping-2264"></span><span class="token mv" id="move-dst-282" data-title="variable_declaration_tuple/variable_declaration">Decimal.D256 memory price</span>, <span class="marker" id="mapping-2265"></span><span class="token mv" id="move-dst-272" data-title="variable_declaration_tuple/variable_declaration">bool valid</span>)</span> = <span class="marker" id="mapping-2266"></span><span class="token mv" id="move-dst-507" data-title="call_expression/member_expression">oracle().<span class="marker" id="mapping-2267"></span><span class="token upd" id="move-dst-508" data-title="member_expression/identifier">cap<span class="cupd">tu</span>re</span></span>();</span>

        <span class="marker" id="mapping-2268"></span><span class="token add" data-title="function_body/if_statement">if (<span class="marker" id="mapping-2269"></span><span class="token add" data-title="if_statement/call_expression">bootstrappingAt(<span class="marker" id="mapping-2270"></span><span class="token add" data-title="call_expression/call_argument"><span class="marker" id="mapping-2271"></span><span class="token add" data-title="call_argument/call_expression"><span class="marker" id="mapping-2272"></span><span class="token add" data-title="call_expression/member_expression">epoch().sub</span>(<span class="marker" id="mapping-2273"></span><span class="token mv" id="move-dst-187" data-title="call_expression/call_argument">1</span>)</span></span>)</span>) <span class="marker" id="mapping-2274"></span><span class="token add" data-title="if_statement/block_statement">{
            return Constants.getBootstrappingPrice();
        }</span></span>
        if (<span class="marker" id="mapping-2275"></span><span class="token add" data-title="if_statement/unary_expression">!valid</span>) {
            return <span class="marker" id="mapping-2276"></span><span class="token mv" id="move-dst-260" data-title="return_statement/call_expression">Decimal.one()</span>;
        }

        <span class="marker" id="mapping-2277"></span><span class="token mv" id="move-dst-284" data-title="function_body/return_statement">return price;</span>
    }</span>
}</span>

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
<span class="marker" id="mapping-2278"></span><span class="token mv" id="move-dst-502" data-title="source_file/contract_declaration">contract Permission is Setters {

    bytes32 private constant FILE = "Permission";

    // Can modify account state
    modifier onlyFrozenOrFluid(address account) {
        Require.that(
            statusOf(account) != Account.Status.Locked,
            FILE,
            "Not frozen or fluid"
        );

        _;
    }

    // Can participate in balance-dependant activities
    modifier onlyFrozenOrLocked(address account) {
        Require.that(
            statusOf(account) != Account.Status.Fluid,
            FILE,
            "Not frozen or locked"
        );

        _;
    }

    modifier initializer() {
        Require.that(
            !isInitialized(implementation()),
            FILE,
            "Already initialized"
        );

        initialized(implementation());

        _;
    }
}</span>

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
contract <span class="marker" id="mapping-2279"></span><span class="token upd" id="move-dst-362" data-title="contract_declaration/identifier">Bonding</span> is <span class="marker" id="mapping-2280"></span><span class="token upd" id="move-dst-363" data-title="user_defined_type/identifier"><span class="cupd">Setters</span></span>, <span class="marker" id="mapping-2281"></span><span class="token mv" id="move-dst-505" data-title="contract_declaration/inheritance_specifier">Permission</span> {
    using SafeMath for uint256;

    bytes32 private constant FILE = "Bonding";

    event Deposit(address indexed account, uint256 value);
    event Withdraw(address indexed account, uint256 value);
    event <span class="marker" id="mapping-2282"></span><span class="token upd" id="move-dst-370" data-title="event_definition/identifier">B<span class="cupd">ond</span></span>(address indexed account, uint256 start, uint256 value, <span class="marker" id="mapping-2283"></span><span class="token add" data-title="event_definition/event_paramater"><span class="marker" id="mapping-2284"></span><span class="token mv" id="move-dst-297" data-title="event_paramater/type_name">uint256</span> valueUnderlying</span>);
    <span class="marker" id="mapping-2285"></span><span class="token mv" id="move-dst-368" data-title="contract_body/event_definition">event <span class="marker" id="mapping-2286"></span><span class="token upd" id="move-dst-369" data-title="event_definition/identifier">Unb<span class="cupd">ond</span></span>(address indexed account, uint256 start, uint256 value<span class="marker" id="mapping-2287"></span><span class="token add" data-title="event_definition/,">,</span> <span class="marker" id="mapping-2288"></span><span class="token add" data-title="event_definition/event_paramater"><span class="marker" id="mapping-2289"></span><span class="token mv" id="move-dst-296" data-title="event_paramater/type_name">uint256</span> valueUnderlying</span>);</span>

    <span class="marker" id="mapping-2290"></span><span class="token add" data-title="contract_body/function_definition">function step() <span class="marker" id="mapping-2291"></span><span class="token mv" id="move-dst-39" data-title="function_definition/visibility">internal</span> <span class="marker" id="mapping-2292"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-2293"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-2294"></span><span class="token add" data-title="expression_statement/call_expression"><span class="marker" id="mapping-2295"></span><span class="token add" data-title="call_expression/member_expression">Require.that</span>(
            <span class="marker" id="mapping-2296"></span><span class="token add" data-title="call_expression/call_argument">epochTime() &gt; epoch()</span>,
            <span class="marker" id="mapping-2297"></span><span class="token add" data-title="call_expression/call_argument">FILE</span>,
            <span class="marker" id="mapping-2298"></span><span class="token mv" id="move-dst-43" data-title="call_expression/call_argument">"Still current epoch"</span>
        )</span>;</span>

        <span class="marker" id="mapping-2299"></span><span class="token add" data-title="function_body/if_statement">if (epoch() == 0)
            initializeEpochs();</span>

        <span class="marker" id="mapping-2300"></span><span class="token add" data-title="function_body/expression_statement">snapshotTotalBonded();</span>
        <span class="marker" id="mapping-2301"></span><span class="token add" data-title="function_body/expression_statement">incrementEpoch();</span>
    }</span></span>

    <span class="marker" id="mapping-2302"></span><span class="token mv" id="move-dst-303" data-title="contract_body/function_definition">function <span class="marker" id="mapping-2303"></span><span class="token upd" id="move-dst-304" data-title="function_definition/identifier">dep<span class="cupd">o</span>sit</span>(<span class="marker" id="mapping-2304"></span><span class="token mv" id="move-dst-205" data-title="function_definition/parameter">uint256 value</span>) <span class="marker" id="mapping-2305"></span><span class="token mv" id="move-dst-288" data-title="function_definition/visibility">external</span> {
        <span class="marker" id="mapping-2306"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-2307"></span><span class="token mv" id="move-dst-319" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-2308"></span><span class="token upd" id="move-dst-320" data-title="variable_declaration/identifier"><span class="cupd">balance</span>Be<span class="cupd">f</span>o<span class="cupd">r</span><span class="cupd">e</span>Depos<span class="cupd">it</span></span></span> = <span class="marker" id="mapping-2309"></span><span class="token add" data-title="variable_declaration_statement/call_expression">dollar().balanceOf(address(this))</span>;</span>
        <span class="marker" id="mapping-2310"></span><span class="token mv" id="move-dst-395" data-title="function_body/expression_statement"><span class="marker" id="mapping-2311"></span><span class="token upd" id="move-dst-396" data-title="call_expression/identifier">dollar</span>().<span class="marker" id="mapping-2312"></span><span class="token upd" id="move-dst-397" data-title="member_expression/identifier"><span class="cupd">transfer</span>From</span>(msg.sender, <span class="marker" id="mapping-2313"></span><span class="token add" data-title="call_expression/call_argument">address(this)</span><span class="marker" id="mapping-2314"></span><span class="token add" data-title="call_expression/,">,</span> value);</span>
        <span class="marker" id="mapping-2315"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-2316"></span><span class="token mv" id="move-dst-317" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-2317"></span><span class="token upd" id="move-dst-318" data-title="variable_declaration/identifier"><span class="cupd">de</span>pos<span class="cupd">it</span>Amou<span class="cupd">nt</span></span></span> = <span class="marker" id="mapping-2318"></span><span class="token mv" id="move-dst-305" data-title="variable_declaration_statement/call_expression">dollar().balanceOf(address(this)).sub(<span class="marker" id="mapping-2319"></span><span class="token add" data-title="call_argument/identifier">balanceBeforeDeposit</span>)</span>;</span>
        <span class="marker" id="mapping-2320"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-2321"></span><span class="token add" data-title="expression_statement/call_expression">require(<span class="marker" id="mapping-2322"></span><span class="token add" data-title="call_expression/call_argument">depositAmount &gt; 0</span>, <span class="marker" id="mapping-2323"></span><span class="token mv" id="move-dst-50" data-title="call_expression/call_argument">"Bonding: Insufficient deposit amount"</span>)</span>;</span>
        <span class="marker" id="mapping-2324"></span><span class="token mv" id="move-dst-443" data-title="function_body/expression_statement"><span class="marker" id="mapping-2325"></span><span class="token upd" id="move-dst-444" data-title="call_expression/identifier"><span class="cupd">incrementBalanceOf</span>St<span class="cupd">a</span>ged</span>(msg.sender, <span class="marker" id="mapping-2326"></span><span class="token upd" id="move-dst-445" data-title="call_argument/identifier">d<span class="cupd">e</span>pos<span class="cupd">i</span>tAmount</span>);</span>

        <span class="marker" id="mapping-2327"></span><span class="token add" data-title="function_body/emit_statement">emit Deposit(msg.sender, depositAmount);</span>
    }</span>

    function withdraw(uint256 value) external <span class="marker" id="mapping-2328"></span><span class="token mv" id="move-dst-400" data-title="function_definition/modifier_invocation"><span class="marker" id="mapping-2329"></span><span class="token upd" id="move-dst-401" data-title="modifier_invocation/identifier"><span class="cupd">onlyFrozen</span>OrLocked</span>(msg.sender)</span> {
        <span class="marker" id="mapping-2330"></span><span class="token mv" id="move-dst-402" data-title="function_body/expression_statement">dollar().transfer(msg.sender, value);</span>
        decrementBalanceOfStaged(msg.sender, value, "Bonding: insufficient staged balance");

        emit Withdraw(msg.sender, value);
    }

    function bond(uint256 value) external <span class="marker" id="mapping-2331"></span><span class="token upd" id="move-dst-411" data-title="modifier_invocation/identifier">o<span class="cupd">n</span>lyFr<span class="cupd">o</span>zenOrFl<span class="cupd">u</span>id</span><span class="marker" id="mapping-2332"></span><span class="token add" data-title="modifier_invocation/(">(</span><span class="marker" id="mapping-2333"></span><span class="token add" data-title="modifier_invocation/call_argument">msg.sender</span><span class="marker" id="mapping-2334"></span><span class="token add" data-title="modifier_invocation/)">)</span> {
        unfreeze(msg.sender);

        <span class="marker" id="mapping-2335"></span><span class="token mv" id="move-dst-312" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-2336"></span><span class="token upd" id="move-dst-313" data-title="variable_declaration/identifier">b<span class="cupd">al</span>a<span class="cupd">n</span>ce</span></span> = <span class="marker" id="mapping-2337"></span><span class="token mv" id="move-dst-417" data-title="member_expression/ternary_expression"><span class="marker" id="mapping-2338"></span><span class="token mv" id="move-dst-416" data-title="ternary_expression/binary_expression">totalBonded() == 0</span> ?
            <span class="marker" id="mapping-2339"></span><span class="token add" data-title="member_expression/identifier">value</span>.mul(<span class="marker" id="mapping-2340"></span><span class="token mv" id="move-dst-418" data-title="call_argument/call_expression">Constants.getInitialStakeMultiple()</span>) :
            <span class="marker" id="mapping-2341"></span><span class="token add" data-title="ternary_expression/call_expression">value.mul(totalSupply())</span></span>.div(totalBonded());
        <span class="marker" id="mapping-2342"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-2343"></span><span class="token add" data-title="expression_statement/call_expression">incrementBalanceOf(<span class="marker" id="mapping-2344"></span><span class="token mv" id="move-dst-387" data-title="call_expression/call_argument">msg.sender</span>, <span class="marker" id="mapping-2345"></span><span class="token add" data-title="call_expression/call_argument">balance</span>)</span>;</span>

        <span class="marker" id="mapping-2346"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-2347"></span><span class="token add" data-title="expression_statement/call_expression">incrementTotalBonded(<span class="marker" id="mapping-2348"></span><span class="token mv" id="move-dst-218" data-title="call_expression/call_argument">value</span>)</span>;</span>
        decrementBalanceOfStaged(msg.sender, value, "Bonding: insufficient staged balance");

        <span class="marker" id="mapping-2349"></span><span class="token add" data-title="function_body/emit_statement">emit Bond(<span class="marker" id="mapping-2350"></span><span class="token mv" id="move-dst-457" data-title="emit_statement/call_argument">msg.sender</span>, <span class="marker" id="mapping-2351"></span><span class="token add" data-title="emit_statement/call_argument">epoch().add(1)</span>, <span class="marker" id="mapping-2352"></span><span class="token add" data-title="emit_statement/call_argument">balance</span>, <span class="marker" id="mapping-2353"></span><span class="token mv" id="move-dst-392" data-title="emit_statement/call_argument">value</span>);</span>
    }

    function unbond(uint256 value) external <span class="marker" id="mapping-2354"></span><span class="token add" data-title="function_definition/modifier_invocation">onlyFrozenOrFluid(msg.sender)</span> {
        unfreeze(msg.sender);

        <span class="marker" id="mapping-2355"></span><span class="token mv" id="move-dst-286" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-2356"></span><span class="token upd" id="move-dst-287" data-title="variable_declaration/identifier"><span class="cupd">st</span>aged</span></span> = <span class="marker" id="mapping-2357"></span><span class="token mv" id="move-dst-436" data-title="variable_declaration_statement/call_expression"><span class="marker" id="mapping-2358"></span><span class="token add" data-title="member_expression/call_expression"><span class="marker" id="mapping-2359"></span><span class="token add" data-title="call_expression/member_expression">value.mul</span>(<span class="marker" id="mapping-2360"></span><span class="token add" data-title="call_expression/call_argument"><span class="marker" id="mapping-2361"></span><span class="token mv" id="move-dst-427" data-title="call_argument/call_expression">balanceOfBonded(msg.sender)</span></span>)</span>.<span class="marker" id="mapping-2362"></span><span class="token upd" id="move-dst-439" data-title="member_expression/identifier">div</span>(<span class="marker" id="mapping-2363"></span><span class="token mv" id="move-dst-437" data-title="call_argument/call_expression"><span class="marker" id="mapping-2364"></span><span class="token upd" id="move-dst-438" data-title="call_expression/identifier"><span class="cupd">balanceOf</span></span>(msg.sender)</span>)</span>;
        <span class="marker" id="mapping-2365"></span><span class="token mv" id="move-dst-403" data-title="function_body/expression_statement"><span class="marker" id="mapping-2366"></span><span class="token upd" id="move-dst-404" data-title="call_expression/identifier">in<span class="cupd">crementBalanceOf</span>St<span class="cupd">a</span>ged</span>(msg.sender, <span class="marker" id="mapping-2367"></span><span class="token add" data-title="call_expression/call_argument">staged</span>);</span>
        <span class="marker" id="mapping-2368"></span><span class="token upd" id="move-dst-440" data-title="call_expression/identifier">de<span class="cupd">crement</span>Tot<span class="cupd">al</span>Bo<span class="cupd">n</span>d<span class="cupd">e</span>d</span>(<span class="marker" id="mapping-2369"></span><span class="token upd" id="move-dst-442" data-title="call_argument/identifier">st<span class="cupd">a</span>ged</span><span class="marker" id="mapping-2370"></span><span class="token mv" id="move-dst-441" data-title="call_expression/,">,</span> <span class="marker" id="mapping-2371"></span><span class="token mv" id="move-dst-29" data-title="call_expression/call_argument">"Bonding: insufficient total bonded"</span>);
        <span class="marker" id="mapping-2372"></span><span class="token mv" id="move-dst-419" data-title="function_body/expression_statement"><span class="marker" id="mapping-2373"></span><span class="token upd" id="move-dst-420" data-title="call_expression/identifier">de<span class="cupd">crementBalanceOf</span></span>(msg.sender, value<span class="marker" id="mapping-2374"></span><span class="token add" data-title="call_expression/,">,</span> <span class="marker" id="mapping-2375"></span><span class="token mv" id="move-dst-24" data-title="call_expression/call_argument">"Bonding: insufficient balance"</span>);</span>

        emit Unbond(msg.sender, epoch().add(1), value, <span class="marker" id="mapping-2376"></span><span class="token upd" id="move-dst-455" data-title="call_argument/identifier">st<span class="cupd">a</span>ged</span>);
    }

    <span class="marker" id="mapping-2377"></span><span class="token add" data-title="contract_body/function_definition">function unbondUnderlying(<span class="marker" id="mapping-2378"></span><span class="token mv" id="move-dst-382" data-title="function_definition/parameter">uint256 value</span>) <span class="marker" id="mapping-2379"></span><span class="token mv" id="move-dst-383" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-2380"></span><span class="token mv" id="move-dst-384" data-title="function_definition/modifier_invocation">onlyFrozenOrFluid(msg.sender)</span> <span class="marker" id="mapping-2381"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-2382"></span><span class="token add" data-title="function_body/expression_statement">unfreeze(msg.sender);</span>

        <span class="marker" id="mapping-2383"></span><span class="token mv" id="move-dst-468" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-2384"></span><span class="token mv" id="move-dst-279" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-2385"></span><span class="token upd" id="move-dst-280" data-title="variable_declaration/identifier">ba<span class="cupd">la</span>nce</span></span> = <span class="marker" id="mapping-2386"></span><span class="token upd" id="move-dst-471" data-title="member_expression/identifier">v<span class="cupd">al</span>ue</span>.mul(<span class="marker" id="mapping-2387"></span><span class="token add" data-title="call_argument/call_expression">totalSupply()</span>).div(totalBonded());</span>
        <span class="marker" id="mapping-2388"></span><span class="token mv" id="move-dst-388" data-title="function_body/expression_statement">incrementBalanceOfStaged(msg.sender, value);</span>
        <span class="marker" id="mapping-2389"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-2390"></span><span class="token add" data-title="expression_statement/call_expression">decrementTotalBonded(<span class="marker" id="mapping-2391"></span><span class="token mv" id="move-dst-405" data-title="call_expression/call_argument">value</span>, <span class="marker" id="mapping-2392"></span><span class="token mv" id="move-dst-241" data-title="call_expression/call_argument">"Bonding: insufficient total bonded"</span>)</span>;</span>
        <span class="marker" id="mapping-2393"></span><span class="token mv" id="move-dst-242" data-title="function_body/expression_statement"><span class="marker" id="mapping-2394"></span><span class="token upd" id="move-dst-243" data-title="call_expression/identifier">d<span class="cupd">e</span>c<span class="cupd">re</span>mentBalanceOf</span>(<span class="marker" id="mapping-2395"></span><span class="token mv" id="move-dst-421" data-title="call_expression/call_argument">msg.sender</span>, <span class="marker" id="mapping-2396"></span><span class="token mv" id="move-dst-244" data-title="call_expression/call_argument"><span class="marker" id="mapping-2397"></span><span class="token add" data-title="call_argument/identifier">balance</span></span><span class="marker" id="mapping-2398"></span><span class="token add" data-title="call_expression/,">,</span> "Bonding: insufficient balance");</span>

        <span class="marker" id="mapping-2399"></span><span class="token mv" id="move-dst-423" data-title="function_body/emit_statement">emit <span class="marker" id="mapping-2400"></span><span class="token upd" id="move-dst-424" data-title="emit_statement/identifier">Unb<span class="cupd">ond</span></span>(msg.sender, epoch().add(1), <span class="marker" id="mapping-2401"></span><span class="token add" data-title="emit_statement/call_argument">balance</span><span class="marker" id="mapping-2402"></span><span class="token add" data-title="emit_statement/,">,</span> value);</span>
    }</span></span>
}

/**
 * Utility library of inline functions on addresses
 *
 * Source https://raw.githubusercontent.com/OpenZeppelin/openzeppelin-solidity/v2.1.3/contracts/utils/Address.sol
 * This contract is copied here and renamed from the original to avoid clashes in the compiled artifacts
 * when the user imports a zos-lib contract (that transitively causes this contract to be compiled and added to the
 * build/artifacts folder) as well as the vanilla Address implementation from an openzeppelin version.
 */
library OpenZeppelinUpgradesAddress {
    /**
     * Returns whether the target address is a contract
     * @dev This function will return false if invoked during the constructor of a contract,
     * as the code is not actually created until after the constructor finishes.
     * @param account address of the account to check
     * @return whether the target address is a contract
     */
    function isContract(address account) internal view returns (bool) {
        uint256 size;
        // XXX Currently there is no better way to check if there is a contract in an address
        // than to check the size of the code at that address.
        // See https://ethereum.stackexchange.com/a/14016/36603
        // for more details about how this works.
        // TODO Check this again before the Serenity release, because all addresses will be
        // contracts then.
        // solhint-disable-next-line no-inline-assembly
        assembly { size := extcodesize(account) }
        return size &gt; 0;
    }
}

/*
    Copyright 2018-2019 zOS Global Limited
    Copyright 2020 Dynamic Dollar Devs, based on the works of the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
/**
 * Based off of, and designed to interface with, openzeppelin/upgrades package
 */
contract Upgradeable is State {
    /**
     * @dev Storage slot with the address of the current implementation.
     * This is the keccak-256 hash of "eip1967.proxy.implementation" subtracted by 1, and is
     * validated in the constructor.
     */
    bytes32 private constant IMPLEMENTATION_SLOT = 0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc;

    /**
     * @dev Emitted when the implementation is upgraded.
     * @param implementation Address of the new implementation.
     */
    event Upgraded(address indexed implementation);

    function initialize() public;

    /**
     * @dev Upgrades the proxy to a new implementation.
     * @param newImplementation Address of the new implementation.
     */
    function upgradeTo(address newImplementation) internal {
        setImplementation(newImplementation);

        (bool success, bytes memory reason) = newImplementation.delegatecall(abi.encodeWithSignature("initialize()"));
        require(success, string(reason));

        emit Upgraded(newImplementation);
    }

    /**
     * @dev Sets the implementation address of the proxy.
     * @param newImplementation Address of the new implementation.
     */
    function setImplementation(address newImplementation) private {
        require(OpenZeppelinUpgradesAddress.isContract(newImplementation), "Cannot set a proxy implementation to a non-contract address");

        bytes32 slot = IMPLEMENTATION_SLOT;

        assembly {
            sstore(slot, newImplementation)
        }
    }
}

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
<span class="marker" id="mapping-2403"></span><span class="token add" data-title="source_file/contract_declaration">contract Govern is <span class="marker" id="mapping-2404"></span><span class="token add" data-title="contract_declaration/inheritance_specifier">Setters</span>, <span class="marker" id="mapping-2405"></span><span class="token mv" id="move-dst-503" data-title="contract_declaration/inheritance_specifier">Permission</span>, <span class="marker" id="mapping-2406"></span><span class="token mv" id="move-dst-504" data-title="contract_declaration/inheritance_specifier">Upgradeable</span> <span class="marker" id="mapping-2407"></span><span class="token add" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-2408"></span><span class="token mv" id="move-dst-302" data-title="contract_body/using_directive">using SafeMath for uint256;</span>
    <span class="marker" id="mapping-2409"></span><span class="token add" data-title="contract_body/using_directive">using Decimal for Decimal.D256;</span>

    <span class="marker" id="mapping-2410"></span><span class="token mv" id="move-dst-251" data-title="contract_body/state_variable_declaration">bytes32 private constant FILE = "Govern";</span>

    <span class="marker" id="mapping-2411"></span><span class="token add" data-title="contract_body/event_definition">event Proposal(<span class="marker" id="mapping-2412"></span><span class="token add" data-title="event_definition/event_paramater"><span class="marker" id="mapping-2413"></span><span class="token mv" id="move-dst-67" data-title="event_paramater/type_name">address</span> indexed candidate</span>, <span class="marker" id="mapping-2414"></span><span class="token add" data-title="event_definition/event_paramater">address indexed account</span>, <span class="marker" id="mapping-2415"></span><span class="token add" data-title="event_definition/event_paramater"><span class="marker" id="mapping-2416"></span><span class="token mv" id="move-dst-80" data-title="event_paramater/type_name">uint256</span> indexed start</span>, <span class="marker" id="mapping-2417"></span><span class="token add" data-title="event_definition/event_paramater"><span class="marker" id="mapping-2418"></span><span class="token mv" id="move-dst-254" data-title="event_paramater/type_name">uint256</span> period</span>);</span>
    <span class="marker" id="mapping-2419"></span><span class="token add" data-title="contract_body/event_definition">event Vote(<span class="marker" id="mapping-2420"></span><span class="token add" data-title="event_definition/event_paramater">address indexed account</span>, <span class="marker" id="mapping-2421"></span><span class="token mv" id="move-dst-233" data-title="event_definition/event_paramater">address <span class="marker" id="mapping-2422"></span><span class="token add" data-title="event_paramater/indexed">indexed</span> <span class="marker" id="mapping-2423"></span><span class="token upd" id="move-dst-234" data-title="event_paramater/identifier">c<span class="cupd">a</span>ndidate</span></span>, <span class="marker" id="mapping-2424"></span><span class="token add" data-title="event_definition/event_paramater">Candidate.Vote vote</span>, <span class="marker" id="mapping-2425"></span><span class="token mv" id="move-dst-378" data-title="event_definition/event_paramater">uint256 <span class="marker" id="mapping-2426"></span><span class="token upd" id="move-dst-379" data-title="event_paramater/identifier">bo<span class="cupd">n</span>ded</span></span>);</span>
    <span class="marker" id="mapping-2427"></span><span class="token mv" id="move-dst-373" data-title="contract_body/event_definition">event <span class="marker" id="mapping-2428"></span><span class="token upd" id="move-dst-374" data-title="event_definition/identifier">C<span class="cupd">o</span>mmit</span>(address indexed account, <span class="marker" id="mapping-2429"></span><span class="token add" data-title="event_definition/event_paramater"><span class="marker" id="mapping-2430"></span><span class="token mv" id="move-dst-252" data-title="event_paramater/type_name">address</span> indexed candidate</span>);</span>

    <span class="marker" id="mapping-2431"></span><span class="token add" data-title="contract_body/function_definition">function vote(<span class="marker" id="mapping-2432"></span><span class="token mv" id="move-dst-354" data-title="function_definition/parameter">address <span class="marker" id="mapping-2433"></span><span class="token upd" id="move-dst-355" data-title="parameter/identifier">candida<span class="cupd">t</span>e</span></span>, <span class="marker" id="mapping-2434"></span><span class="token add" data-title="function_definition/parameter">Candidate.Vote vote</span>) <span class="marker" id="mapping-2435"></span><span class="token mv" id="move-dst-89" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-2436"></span><span class="token mv" id="move-dst-393" data-title="function_definition/modifier_invocation"><span class="marker" id="mapping-2437"></span><span class="token upd" id="move-dst-394" data-title="modifier_invocation/identifier"><span class="cupd">onlyFrozen</span>OrLocked</span>(msg.sender)</span> <span class="marker" id="mapping-2438"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-2439"></span><span class="token mv" id="move-dst-489" data-title="function_body/expression_statement">Require.that(
            <span class="marker" id="mapping-2440"></span><span class="token mv" id="move-dst-461" data-title="call_expression/call_argument"><span class="marker" id="mapping-2441"></span><span class="token upd" id="move-dst-462" data-title="call_expression/identifier"><span class="cupd">balanceOf</span></span>(msg.sender) <span class="marker" id="mapping-2442"></span><span class="token add" data-title="binary_expression/>">&gt;</span> <span class="marker" id="mapping-2443"></span><span class="token add" data-title="binary_expression/number_literal">0</span></span>,
            FILE,
            "Must have stake"
        );</span>

        <span class="marker" id="mapping-2444"></span><span class="token add" data-title="function_body/if_statement">if (<span class="marker" id="mapping-2445"></span><span class="token add" data-title="if_statement/unary_expression">!isNominated(candidate)</span>) <span class="marker" id="mapping-2446"></span><span class="token add" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-2447"></span><span class="token add" data-title="block_statement/expression_statement"><span class="marker" id="mapping-2448"></span><span class="token add" data-title="expression_statement/call_expression"><span class="marker" id="mapping-2449"></span><span class="token add" data-title="call_expression/member_expression">Require.that</span>(
                <span class="marker" id="mapping-2450"></span><span class="token add" data-title="call_expression/call_argument">canPropose(msg.sender)</span>,
                <span class="marker" id="mapping-2451"></span><span class="token add" data-title="call_expression/call_argument">FILE</span>,
                <span class="marker" id="mapping-2452"></span><span class="token mv" id="move-dst-228" data-title="call_expression/call_argument">"Not enough stake to propose"</span>
            )</span>;</span>

            <span class="marker" id="mapping-2453"></span><span class="token add" data-title="block_statement/expression_statement">createCandidate(candidate, Constants.getGovernancePeriod());</span>
            <span class="marker" id="mapping-2454"></span><span class="token add" data-title="block_statement/emit_statement">emit Proposal(candidate, msg.sender, epoch(), Constants.getGovernancePeriod());</span>
        }</span></span>

        <span class="marker" id="mapping-2455"></span><span class="token mv" id="move-dst-490" data-title="function_body/expression_statement">Require.that(
            <span class="marker" id="mapping-2456"></span><span class="token add" data-title="call_argument/call_expression">epoch() &lt; startFor(candidate).add(periodFor(candidate))</span>,
            FILE,
            "Ended"
        );</span>

        <span class="marker" id="mapping-2457"></span><span class="token mv" id="move-dst-269" data-title="function_body/variable_declaration_statement">uint256 <span class="marker" id="mapping-2458"></span><span class="token upd" id="move-dst-270" data-title="variable_declaration/identifier">bonded</span> = <span class="marker" id="mapping-2459"></span><span class="token upd" id="move-dst-271" data-title="call_expression/identifier">b<span class="cupd">a</span>lanceOf</span>(<span class="marker" id="mapping-2460"></span><span class="token add" data-title="call_expression/call_argument">msg.sender</span>);</span>
        <span class="marker" id="mapping-2461"></span><span class="token add" data-title="function_body/variable_declaration_statement">Candidate.Vote recordedVote = recordedVote(msg.sender, candidate);</span>
        <span class="marker" id="mapping-2462"></span><span class="token add" data-title="function_body/if_statement">if (<span class="marker" id="mapping-2463"></span><span class="token add" data-title="if_statement/binary_expression">vote == recordedVote</span>) <span class="marker" id="mapping-2464"></span><span class="token add" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-2465"></span><span class="token mv" id="move-dst-90" data-title="block_statement/return_statement">return;</span>
        }</span></span>

        <span class="marker" id="mapping-2466"></span><span class="token add" data-title="function_body/if_statement">if (<span class="marker" id="mapping-2467"></span><span class="token add" data-title="if_statement/member_expression">recordedVote == Candidate.Vote.REJECT</span>) <span class="marker" id="mapping-2468"></span><span class="token add" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-2469"></span><span class="token mv" id="move-dst-63" data-title="block_statement/expression_statement"><span class="marker" id="mapping-2470"></span><span class="token upd" id="move-dst-64" data-title="call_expression/identifier">dec<span class="cupd">re</span>mentRejectFor</span>(<span class="marker" id="mapping-2471"></span><span class="token add" data-title="call_expression/call_argument">candidate</span>, <span class="marker" id="mapping-2472"></span><span class="token add" data-title="call_expression/call_argument">bonded</span><span class="marker" id="mapping-2473"></span><span class="token add" data-title="call_expression/,">,</span> "Govern: Insufficient reject");</span>
        }</span></span>
        <span class="marker" id="mapping-2474"></span><span class="token add" data-title="function_body/if_statement">if (<span class="marker" id="mapping-2475"></span><span class="token add" data-title="if_statement/member_expression">recordedVote == Candidate.Vote.APPROVE</span>) <span class="marker" id="mapping-2476"></span><span class="token add" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-2477"></span><span class="token mv" id="move-dst-56" data-title="block_statement/expression_statement"><span class="marker" id="mapping-2478"></span><span class="token upd" id="move-dst-57" data-title="call_expression/identifier">dec<span class="cupd">re</span>mentApp<span class="cupd">r</span>oveFor</span>(<span class="marker" id="mapping-2479"></span><span class="token add" data-title="call_expression/call_argument">candidate</span>, <span class="marker" id="mapping-2480"></span><span class="token add" data-title="call_expression/call_argument">bonded</span><span class="marker" id="mapping-2481"></span><span class="token add" data-title="call_expression/,">,</span> "Govern: Insufficient approve");</span>
        }</span></span>
        <span class="marker" id="mapping-2482"></span><span class="token add" data-title="function_body/if_statement">if (vote == Candidate.Vote.REJECT) {
            incrementRejectFor(candidate, bonded);
        }</span>
        <span class="marker" id="mapping-2483"></span><span class="token add" data-title="function_body/if_statement">if (vote == Candidate.Vote.APPROVE) {
            incrementApproveFor(candidate, bonded);
        }</span>

        <span class="marker" id="mapping-2484"></span><span class="token mv" id="move-dst-348" data-title="function_body/expression_statement"><span class="marker" id="mapping-2485"></span><span class="token add" data-title="call_expression/identifier">recordVote</span>(msg.sender, <span class="marker" id="mapping-2486"></span><span class="token upd" id="move-dst-349" data-title="call_argument/identifier">c<span class="cupd">a</span>ndidate</span>, <span class="marker" id="mapping-2487"></span><span class="token upd" id="move-dst-350" data-title="call_argument/identifier">v<span class="cupd">o</span>te</span>);</span>
        <span class="marker" id="mapping-2488"></span><span class="token mv" id="move-dst-450" data-title="function_body/expression_statement"><span class="marker" id="mapping-2489"></span><span class="token upd" id="move-dst-451" data-title="call_expression/identifier">p<span class="cupd">la</span><span class="cupd">ce</span>Lock</span>(msg.sender, <span class="marker" id="mapping-2490"></span><span class="token upd" id="move-dst-452" data-title="call_argument/identifier">c<span class="cupd">an</span>didate</span>);</span>

        <span class="marker" id="mapping-2491"></span><span class="token mv" id="move-dst-478" data-title="function_body/emit_statement">emit <span class="marker" id="mapping-2492"></span><span class="token upd" id="move-dst-479" data-title="emit_statement/identifier">V<span class="cupd">o</span>te</span>(msg.sender, <span class="marker" id="mapping-2493"></span><span class="token upd" id="move-dst-480" data-title="call_argument/identifier">c<span class="cupd">a</span>ndidate</span>, <span class="marker" id="mapping-2494"></span><span class="token upd" id="move-dst-481" data-title="call_argument/identifier">vote</span>, <span class="marker" id="mapping-2495"></span><span class="token upd" id="move-dst-482" data-title="call_argument/identifier">bo<span class="cupd">n</span>ded</span>);</span>
    }</span></span>

    <span class="marker" id="mapping-2496"></span><span class="token add" data-title="contract_body/function_definition">function commit(<span class="marker" id="mapping-2497"></span><span class="token mv" id="move-dst-203" data-title="function_definition/parameter">address <span class="marker" id="mapping-2498"></span><span class="token upd" id="move-dst-204" data-title="parameter/identifier">ca<span class="cupd">n</span>didate</span></span>) <span class="marker" id="mapping-2499"></span><span class="token mv" id="move-dst-399" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-2500"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-2501"></span><span class="token mv" id="move-dst-290" data-title="function_body/expression_statement">Require.that(
            <span class="marker" id="mapping-2502"></span><span class="token add" data-title="call_argument/call_expression">isNominated(candidate)</span>,
            FILE,
            "Not nominated"
        );</span>

        <span class="marker" id="mapping-2503"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-2504"></span><span class="token mv" id="move-dst-263" data-title="variable_declaration_statement/variable_declaration">uint256 <span class="marker" id="mapping-2505"></span><span class="token upd" id="move-dst-264" data-title="variable_declaration/identifier"><span class="cupd">e</span>ndsAf<span class="cupd">t</span>er</span></span> = <span class="marker" id="mapping-2506"></span><span class="token add" data-title="variable_declaration_statement/call_expression"><span class="marker" id="mapping-2507"></span><span class="token add" data-title="call_expression/member_expression">startFor(candidate).add(periodFor(candidate)).sub</span>(<span class="marker" id="mapping-2508"></span><span class="token mv" id="move-dst-181" data-title="call_expression/call_argument">1</span>)</span>;</span>

        <span class="marker" id="mapping-2509"></span><span class="token mv" id="move-dst-460" data-title="function_body/expression_statement">Require.that(
            <span class="marker" id="mapping-2510"></span><span class="token add" data-title="call_expression/call_argument">epoch() &gt; endsAfter</span>,
            FILE,
            "Not ended"
        );</span>

        <span class="marker" id="mapping-2511"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-2512"></span><span class="token add" data-title="expression_statement/call_expression"><span class="marker" id="mapping-2513"></span><span class="token mv" id="move-dst-493" data-title="call_expression/member_expression">Require.that</span>(
            <span class="marker" id="mapping-2514"></span><span class="token add" data-title="call_expression/call_argument">Decimal.ratio(votesFor(candidate), totalBondedAt(endsAfter)).greaterThan(Constants.getGovernanceQuorum())</span>,
            <span class="marker" id="mapping-2515"></span><span class="token mv" id="move-dst-494" data-title="call_expression/call_argument">FILE</span>,
            <span class="marker" id="mapping-2516"></span><span class="token mv" id="move-dst-453" data-title="call_expression/call_argument">"Must have quorom"</span>
        )</span>;</span>

        <span class="marker" id="mapping-2517"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-2518"></span><span class="token add" data-title="expression_statement/call_expression"><span class="marker" id="mapping-2519"></span><span class="token add" data-title="call_expression/member_expression">Require.that</span>(
            <span class="marker" id="mapping-2520"></span><span class="token add" data-title="call_expression/call_argument">approveFor(candidate) &gt; rejectFor(candidate)</span>,
            <span class="marker" id="mapping-2521"></span><span class="token add" data-title="call_expression/call_argument">FILE</span>,
            <span class="marker" id="mapping-2522"></span><span class="token mv" id="move-dst-449" data-title="call_expression/call_argument">"Not approved"</span>
        )</span>;</span>

        <span class="marker" id="mapping-2523"></span><span class="token add" data-title="function_body/expression_statement">upgradeTo(candidate);</span>

        <span class="marker" id="mapping-2524"></span><span class="token mv" id="move-dst-408" data-title="function_body/emit_statement">emit <span class="marker" id="mapping-2525"></span><span class="token upd" id="move-dst-409" data-title="emit_statement/identifier"><span class="cupd">C</span>ommit</span>(msg.sender, <span class="marker" id="mapping-2526"></span><span class="token upd" id="move-dst-410" data-title="call_argument/identifier">c<span class="cupd">a</span>ndidate</span>);</span>
    }</span></span>

    <span class="marker" id="mapping-2527"></span><span class="token add" data-title="contract_body/function_definition">function emergencyCommit(<span class="marker" id="mapping-2528"></span><span class="token mv" id="move-dst-356" data-title="function_definition/parameter">address <span class="marker" id="mapping-2529"></span><span class="token upd" id="move-dst-357" data-title="parameter/identifier">candida<span class="cupd">t</span>e</span></span>) <span class="marker" id="mapping-2530"></span><span class="token mv" id="move-dst-456" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-2531"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-2532"></span><span class="token mv" id="move-dst-459" data-title="function_body/expression_statement">Require.that(
            <span class="marker" id="mapping-2533"></span><span class="token add" data-title="call_argument/call_expression">isNominated(candidate)</span>,
            FILE,
            "Not nominated"
        );</span>

        <span class="marker" id="mapping-2534"></span><span class="token add" data-title="function_body/expression_statement"><span class="marker" id="mapping-2535"></span><span class="token add" data-title="expression_statement/call_expression"><span class="marker" id="mapping-2536"></span><span class="token mv" id="move-dst-491" data-title="call_expression/member_expression">Require.that</span>(
            <span class="marker" id="mapping-2537"></span><span class="token add" data-title="call_expression/call_argument">epochTime() &gt; epoch().add(Constants.getGovernanceEmergencyDelay())</span>,
            <span class="marker" id="mapping-2538"></span><span class="token mv" id="move-dst-492" data-title="call_expression/call_argument">FILE</span>,
            <span class="marker" id="mapping-2539"></span><span class="token mv" id="move-dst-406" data-title="call_expression/call_argument">"Epoch synced"</span>
        )</span>;</span>

        <span class="marker" id="mapping-2540"></span><span class="token mv" id="move-dst-428" data-title="function_body/expression_statement">Require.that(
            <span class="marker" id="mapping-2541"></span><span class="token add" data-title="call_argument/call_expression">Decimal.ratio(approveFor(candidate), totalSupply()).greaterThan(Constants.getGovernanceSuperMajority())</span>,
            FILE,
            "Must have super majority"
        );</span>

        <span class="marker" id="mapping-2542"></span><span class="token mv" id="move-dst-256" data-title="function_body/expression_statement">Require.that(
            <span class="marker" id="mapping-2543"></span><span class="token add" data-title="binary_expression/call_expression">approveFor(candidate)</span> <span class="marker" id="mapping-2544"></span><span class="token add" data-title="binary_expression/>">&gt;</span> <span class="marker" id="mapping-2545"></span><span class="token add" data-title="binary_expression/call_expression">rejectFor(candidate)</span>,
            FILE,
            "Not approved"
        );</span>

        <span class="marker" id="mapping-2546"></span><span class="token add" data-title="function_body/expression_statement">upgradeTo(candidate);</span>

        <span class="marker" id="mapping-2547"></span><span class="token mv" id="move-dst-390" data-title="function_body/emit_statement">emit <span class="marker" id="mapping-2548"></span><span class="token upd" id="move-dst-391" data-title="emit_statement/identifier">C<span class="cupd">o</span>mm<span class="cupd">it</span></span>(msg.sender, <span class="marker" id="mapping-2549"></span><span class="token add" data-title="emit_statement/call_argument">candidate</span>);</span>
    }</span></span>

    <span class="marker" id="mapping-2550"></span><span class="token add" data-title="contract_body/function_definition">function canPropose(<span class="marker" id="mapping-2551"></span><span class="token mv" id="move-dst-308" data-title="function_definition/parameter">address account</span>) <span class="marker" id="mapping-2552"></span><span class="token mv" id="move-dst-262" data-title="function_definition/visibility">private</span> <span class="marker" id="mapping-2553"></span><span class="token mv" id="move-dst-306" data-title="function_definition/state_mutability">view</span> <span class="marker" id="mapping-2554"></span><span class="token mv" id="move-dst-307" data-title="function_definition/return_type_definition">returns (bool)</span> <span class="marker" id="mapping-2555"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-2556"></span><span class="token add" data-title="function_body/if_statement">if (<span class="marker" id="mapping-2557"></span><span class="token add" data-title="if_statement/binary_expression">totalBonded() == 0</span>) <span class="marker" id="mapping-2558"></span><span class="token add" data-title="if_statement/block_statement">{
            <span class="marker" id="mapping-2559"></span><span class="token add" data-title="block_statement/return_statement">return <span class="marker" id="mapping-2560"></span><span class="token mv" id="move-dst-261" data-title="return_statement/boolean_literal">false</span>;</span>
        }</span></span>

        <span class="marker" id="mapping-2561"></span><span class="token add" data-title="function_body/variable_declaration_statement"><span class="marker" id="mapping-2562"></span><span class="token mv" id="move-dst-150" data-title="variable_declaration_statement/variable_declaration">Decimal.D256 memory <span class="marker" id="mapping-2563"></span><span class="token upd" id="move-dst-151" data-title="variable_declaration/identifier">s<span class="cupd">t</span><span class="cupd">a</span>ke</span></span> = <span class="marker" id="mapping-2564"></span><span class="token add" data-title="variable_declaration_statement/call_expression"><span class="marker" id="mapping-2565"></span><span class="token mv" id="move-dst-283" data-title="call_expression/member_expression">Decimal.ratio</span>(<span class="marker" id="mapping-2566"></span><span class="token add" data-title="call_expression/call_argument"><span class="marker" id="mapping-2567"></span><span class="token add" data-title="call_argument/call_expression">balanceOf(<span class="marker" id="mapping-2568"></span><span class="token mv" id="move-dst-58" data-title="call_expression/call_argument">account</span>)</span></span>, <span class="marker" id="mapping-2569"></span><span class="token add" data-title="call_expression/call_argument">totalSupply()</span>)</span>;</span>
        <span class="marker" id="mapping-2570"></span><span class="token add" data-title="function_body/return_statement">return stake.greaterThan(Decimal.ratio(1, 100));</span> // 1%
    }</span></span>
}</span></span>

/*
    Copyright 2020 Reflective Dollar Devs, based on the works of the Dynamic Dollar Devs and the Empty Set Squad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
<span class="marker" id="mapping-2571"></span><span class="token add" data-title="source_file/contract_declaration">contract Implementation is <span class="marker" id="mapping-2572"></span><span class="token mv" id="move-dst-509" data-title="contract_declaration/inheritance_specifier">State</span>, <span class="marker" id="mapping-2573"></span><span class="token add" data-title="contract_declaration/inheritance_specifier">Bonding</span>, <span class="marker" id="mapping-2574"></span><span class="token add" data-title="contract_declaration/inheritance_specifier">Market</span>, <span class="marker" id="mapping-2575"></span><span class="token add" data-title="contract_declaration/inheritance_specifier">Regulator</span>, <span class="marker" id="mapping-2576"></span><span class="token add" data-title="contract_declaration/inheritance_specifier">Govern</span> <span class="marker" id="mapping-2577"></span><span class="token add" data-title="contract_declaration/contract_body">{
    <span class="marker" id="mapping-2578"></span><span class="token mv" id="move-dst-326" data-title="contract_body/using_directive">using SafeMath for uint256;</span>

    <span class="marker" id="mapping-2579"></span><span class="token add" data-title="contract_body/event_definition">event Advance(<span class="marker" id="mapping-2580"></span><span class="token add" data-title="event_definition/event_paramater"><span class="marker" id="mapping-2581"></span><span class="token mv" id="move-dst-17" data-title="event_paramater/type_name">uint256</span> indexed epoch</span>, <span class="marker" id="mapping-2582"></span><span class="token add" data-title="event_definition/event_paramater"><span class="marker" id="mapping-2583"></span><span class="token mv" id="move-dst-78" data-title="event_paramater/type_name">uint256</span> block</span>, <span class="marker" id="mapping-2584"></span><span class="token mv" id="move-dst-371" data-title="event_definition/event_paramater">uint256 <span class="marker" id="mapping-2585"></span><span class="token upd" id="move-dst-372" data-title="event_paramater/identifier">tim<span class="cupd">e</span>st<span class="cupd">a</span>mp</span></span>);</span>
    <span class="marker" id="mapping-2586"></span><span class="token mv" id="move-dst-365" data-title="contract_body/event_definition">event <span class="marker" id="mapping-2587"></span><span class="token upd" id="move-dst-366" data-title="event_definition/identifier">Incentiviz<span class="cupd">a</span>tion</span>(address indexed account, <span class="marker" id="mapping-2588"></span><span class="token mv" id="move-dst-376" data-title="event_definition/event_paramater">uint256 <span class="marker" id="mapping-2589"></span><span class="token upd" id="move-dst-377" data-title="event_paramater/identifier">amount</span></span>);</span>

    <span class="marker" id="mapping-2590"></span><span class="token mv" id="move-dst-380" data-title="contract_body/function_definition">function <span class="marker" id="mapping-2591"></span><span class="token upd" id="move-dst-381" data-title="function_definition/identifier"><span class="cupd">i</span>nitialize</span>() <span class="marker" id="mapping-2592"></span><span class="token mv" id="move-dst-510" data-title="function_definition/modifier_invocation">initializer</span> <span class="marker" id="mapping-2593"></span><span class="token mv" id="move-dst-511" data-title="function_definition/visibility">public</span> {
        <span class="marker" id="mapping-2594"></span><span class="token add" data-title="function_body/expression_statement">dollar().excludeAccount(pool());</span>
        <span class="marker" id="mapping-2595"></span><span class="token upd" id="move-dst-385" data-title="call_expression/identifier">dollar</span>().<span class="marker" id="mapping-2596"></span><span class="token upd" id="move-dst-386" data-title="member_expression/identifier"><span class="cupd">e</span>xcludeAccount</span>(address(this));
        <span class="marker" id="mapping-2597"></span><span class="token mv" id="move-dst-512" data-title="function_body/expression_statement"><span class="marker" id="mapping-2598"></span><span class="token mv" id="move-dst-513" data-title="expression_statement/call_expression"><span class="marker" id="mapping-2599"></span><span class="token add" data-title="call_expression/member_expression">dollar().excludeAccount</span>(<span class="marker" id="mapping-2600"></span><span class="token mv" id="move-dst-515" data-title="call_expression/call_argument">oracle().pair()</span>)</span>;</span>
    }</span>

    <span class="marker" id="mapping-2601"></span><span class="token add" data-title="contract_body/function_definition">function advance() <span class="marker" id="mapping-2602"></span><span class="token mv" id="move-dst-292" data-title="function_definition/visibility">external</span> <span class="marker" id="mapping-2603"></span><span class="token add" data-title="function_definition/modifier_invocation">incentivized</span> <span class="marker" id="mapping-2604"></span><span class="token add" data-title="function_definition/function_body">{
        <span class="marker" id="mapping-2605"></span><span class="token add" data-title="function_body/expression_statement">Bonding.step();</span>
        <span class="marker" id="mapping-2606"></span><span class="token add" data-title="function_body/expression_statement">Regulator.step();</span>
        <span class="marker" id="mapping-2607"></span><span class="token add" data-title="function_body/expression_statement">Market.step();</span>

        <span class="marker" id="mapping-2608"></span><span class="token add" data-title="function_body/emit_statement">emit Advance(<span class="marker" id="mapping-2609"></span><span class="token add" data-title="emit_statement/call_argument">epoch()</span>, <span class="marker" id="mapping-2610"></span><span class="token add" data-title="emit_statement/call_argument">block.number</span>, <span class="marker" id="mapping-2611"></span><span class="token mv" id="move-dst-245" data-title="emit_statement/call_argument"><span class="marker" id="mapping-2612"></span><span class="token mv" id="move-dst-246" data-title="call_argument/member_expression">block.timestamp</span></span>);</span>
    }</span></span>

    <span class="marker" id="mapping-2613"></span><span class="token add" data-title="contract_body/modifier_definition">modifier incentivized <span class="marker" id="mapping-2614"></span><span class="token add" data-title="modifier_definition/function_body">{
        // Mint advance reward to sender
        <span class="marker" id="mapping-2615"></span><span class="token add" data-title="function_body/variable_declaration_statement">uint256 incentive = Constants.getAdvanceIncentive();</span>
        <span class="marker" id="mapping-2616"></span><span class="token add" data-title="function_body/expression_statement">mintToAccount(msg.sender, incentive);</span>
        <span class="marker" id="mapping-2617"></span><span class="token add" data-title="function_body/emit_statement">emit Incentivization(msg.sender, incentive);</span>
        <span class="marker" id="mapping-2618"></span><span class="token mv" id="move-dst-291" data-title="function_body/expression_statement">_;</span>
    }</span></span>
}</span></span></pre></div></div></div></body></html>