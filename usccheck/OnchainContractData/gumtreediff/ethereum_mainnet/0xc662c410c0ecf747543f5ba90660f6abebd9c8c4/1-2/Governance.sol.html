<html lang="en"><head><meta charset="utf8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>GumTree</title><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><style type="text/css">/*
 * This file is part of GumTree.
 *
 * GumTree is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * GumTree is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with GumTree.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Copyright 2011-2015 Jean-Rémy Falleri <jr.falleri@gmail.com>
 * Copyright 2011-2015 Floréal Morandat <florealm@gmail.com>
 */

.add {
	border: 1px solid black;
	background-color: MediumSeaGreen;
}

.del {
	border: 1px solid black;
	background-color: IndianRed;
}

.mv {
	border: 1px solid black;
	background-color: Plum;
}

.upd {
	border: 1px solid black;
	background-color: DarkOrange;
	font-weight: bold;
}

.cupd {
	font-weight: normal;
	color: DimGray;
}

.selected {
	background-color: Gold;
}

.marker {
	margin: 0;
	padding: 0;
}

div {
	margin: 0px;
	padding: 0px;
}

.pre-scrollable {
	margin: 0px;
	padding: 0px;
	font-size: 10pt;
	color: black;
	max-height: 90vh;
	background-color: white;
	border: 1px solid black;
	font-family: "Hack, Inconsolata", "Consolas", "Liberation Sans Regular", "DejaVu Sans Mono", monospace;
}

.tooltip-inner {
    max-width: none;
}
</style><script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script><script type="text/javascript">/*
 * This file is part of GumTree.
 *
 * GumTree is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * GumTree is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with GumTree.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Copyright 2011-2015 Jean-Rémy Falleri <jr.falleri@gmail.com>
 * Copyright 2011-2015 Floréal Morandat <florealm@gmail.com>
 */

$(function(){
    let popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
    let popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
      return new bootstrap.Popover(popoverTriggerEl)
    })

    $("body").keypress(function (event) {
        switch (event.which) {
            case 116:
                $('html, body').animate({scrollTop: 0}, 100);
                break;
            case 98:
                $("html, body").animate({ scrollTop: $(document).height() }, 100);
                break;
            case 113:
                window.location = "/quit";
                break;
            case 108:
                window.location = "/list";
                break;
        }
    });
});
</script><script type="text/javascript">/*
 * This file is part of GumTree.
 *
 * GumTree is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * GumTree is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with GumTree.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Copyright 2011-2015 Jean-Rémy Falleri <jr.falleri@gmail.com>
 * Copyright 2011-2015 Floréal Morandat <florealm@gmail.com>
 */

currentMapping = 0;

if (typeof String.prototype.startsWith != 'function') {
  String.prototype.startsWith = function (str){
    return this.slice(0, str.length) == str;
  };
}

function getMappedElement(eltId) {
	if (eltId.startsWith("move-src")) {
		return eltId.replace("src","dst");  	 	
  	}
  	else {
  		return eltId.replace("dst","src");
  	}
}

function nextMapping() {
	if (currentMapping == 0) {
		currentMapping = 1;
		return "#mapping-" + currentMapping.toString();
	} else {
		currentMapping++;
		
		if ($("#mapping-" + currentMapping.toString()).length > 0) {
			return "#mapping-" + currentMapping.toString();
		} else {
			currentMapping = 1;
			return "#mapping-" + currentMapping.toString();		
		}		
	}
}

function isSrc(eltId) {
	return eltId.startsWith("move-src");
}

$(function() {
    $("body").keypress(function (event) {
        switch(event.which) {
            case 110:
                const mapping = $(nextMapping());
                const pre = mapping.closest("pre");
                pre.animate({scrollTop: pre.scrollTop() + mapping.position().top - 200}, 100);
                break;
        }
    });

    // highlight
    $("span.mv.token, span.token.upd").click(function(event) {
        if ($(this).hasClass("selected")) {
            $("span.mv.token, span.token.upd").removeClass("selected");
        } else {
            $("span.mv.token, span.token.upd").removeClass("selected");
            const refElt = $("#" + getMappedElement($(this).attr("id")));
            $(this).addClass("selected");
            refElt.addClass("selected");
            const pre = refElt.closest("pre");
            console.log(pre);
            pre.animate({scrollTop: pre.scrollTop() + refElt.position().top - 200}, 100);
        }
        event.stopPropagation();
    });
    
    $("span.add.token, span.token.del").click(function(event) {
        $("span.mv.token, span.token.upd").removeClass("selected");
        event.stopPropagation();
    });

    // tooltip
    $("span.token").hover(
    	function (event) {
    		$(this).tooltip('show');
    		event.stopPropagation();
    	},
    	function (event) {
    		$(this).tooltip('hide');
    		event.stopPropagation();
    	}
    );
});
</script></head><body><div class="container-fluid"><div class="row"><div class="col"><div class="btn-toolbar justify-content-end"><div class="btn-group mr-2"><button class="btn btn-primary btn-sm" id="legend" data-bs-toggle="popover" data-bs-placement="bottom" data-bs-html="true" data-bs-content="<span class='del'>&nbsp;&nbsp;</span> deleted<br><span class='add'>&nbsp;&nbsp;</span> added<br><span class='mv'>&nbsp;&nbsp;</span> moved<br><span class='upd';>&nbsp;&nbsp;</span> updated<br>">Legend</button><button class="btn btn-primary btn-sm" id="shortcuts" data-bs-toggle="popover" data-bs-placement="bottom" data-bs-html="true" data-bs-content="<b>q</b> quit<br><b>l</b> list<br><b>n</b> next<br><b>t</b> top<br><b>b</b> bottom">Shortcuts</button></div><div class="btn-group"><a href="/list" class="btn btn-default btn-sm btn-primary">Back</a><a href="/quit" class="btn btn-default btn-sm btn-danger">Quit</a></div></div></div></div><div class="row"><div class="col-6"><h5>Governance.sol</h5><pre class="pre-scrollable">// SPDX-License-Identifier: Apache-2.0.
pragma solidity ^0.6.12;

import "MGovernance.sol";

<span class="marker" id="mapping-1"></span><span class="token mv" id="move-src-1" data-title="source_file/comment"><span class="marker" id="mapping-2"></span><span class="token upd" id="move-src-2" data-title="source_file/comment"><span class="cupd">/*
  </span>Im<span class="cupd">p</span>lemen<span class="cupd">t</span>s<span class="cupd"> </span>G<span class="cupd">e</span><span class="cupd">n</span>e<span class="cupd">ri</span><span class="cupd">c</span> Gov<span class="cupd">e</span>r<span class="cupd">n</span>anc<span class="cupd">e</span>,<span class="cupd"> </span>applicabl<span class="cupd">e</span> fo<span class="cupd">r </span>bo<span class="cupd">th</span><span class="cupd"> </span><span class="cupd">p</span>roxy <span class="cupd">a</span>nd<span class="cupd"> </span>ma<span class="cupd">i</span>n <span class="cupd">c</span>o<span class="cupd">n</span>tract<span class="cupd">, </span>and po<span class="cupd">s</span>s<span class="cupd">i</span>bly<span class="cupd"> </span>o<span class="cupd">the</span>r<span class="cupd">s</span><span class="cupd">.
  </span>N<span class="cupd">o</span>tes:<span class="cupd">
</span><span class="cupd"> </span><span class="cupd"> </span> The <span class="cupd">use </span>of <span class="cupd">th</span><span class="cupd">e </span>sam<span class="cupd">e</span> fun<span class="cupd">c</span><span class="cupd">t</span><span class="cupd">i</span>o<span class="cupd">n </span><span class="cupd">n</span>am<span class="cupd">e</span>s<span class="cupd"> </span>by bo<span class="cupd">th the </span>Pr<span class="cupd">o</span>x<span class="cupd">y </span><span class="cupd">a</span><span class="cupd">n</span>d<span class="cupd"> a </span>delega<span class="cupd">t</span><span class="cupd">e</span>d<span class="cupd"> </span><span class="cupd">i</span>mpl<span class="cupd">e</span>m<span class="cupd">e</span>nt<span class="cupd">at</span>ion<span class="cupd">
   </span>i<span class="cupd">s</span> n<span class="cupd">o</span>t <span class="cupd">p</span><span class="cupd">o</span><span class="cupd">s</span>sib<span class="cupd">le</span><span class="cupd"> </span>s<span class="cupd">i</span>nc<span class="cupd">e</span><span class="cupd"> </span><span class="cupd">ca</span><span class="cupd">l</span><span class="cupd">l</span>in<span class="cupd">g</span><span class="cupd"> t</span>he<span class="cupd"> i</span>mpleme<span class="cupd">n</span><span class="cupd">t</span>at<span class="cupd">i</span>o<span class="cupd">n</span><span class="cupd"> </span><span class="cupd">f</span><span class="cupd">u</span><span class="cupd">n</span>c<span class="cupd">t</span><span class="cupd">i</span>o<span class="cupd">ns</span><span class="cupd"> is d</span>one v<span class="cupd">i</span>a <span class="cupd">t</span>h<span class="cupd">e</span> <span class="cupd">d</span>efault<span class="cupd"> </span>functi<span class="cupd">on
</span><span class="cupd"> </span><span class="cupd"> </span><span class="cupd"> </span>of<span class="cupd"> </span>the<span class="cupd"> </span>Proxy.<span class="cupd"> </span><span class="cupd">F</span>or<span class="cupd"> </span><span class="cupd">th</span>is<span class="cupd"> </span><span class="cupd">re</span>a<span class="cupd">s</span>on,<span class="cupd"> </span>f<span class="cupd">or </span>exa<span class="cupd">mpl</span><span class="cupd">e</span>,<span class="cupd"> </span><span class="cupd">the </span><span class="cupd">i</span>mpl<span class="cupd">e</span>m<span class="cupd">e</span>n<span class="cupd">t</span>at<span class="cupd">i</span>on o<span class="cupd">f</span><span class="cupd"> </span>M<span class="cupd">a</span>i<span class="cupd">n</span>Contr<span class="cupd">a</span>ct<span class="cupd"> </span>(MainG<span class="cupd">overn</span>a<span class="cupd">n</span>ce)<span class="cupd">
</span>   ex<span class="cupd">p</span>os<span class="cupd">e</span>s <span class="cupd">m</span>a<span class="cupd">i</span>nI<span class="cupd">s</span>G<span class="cupd">o</span>ver<span class="cupd">n</span>or,<span class="cupd"> </span>which<span class="cupd"> </span>c<span class="cupd">a</span><span class="cupd">l</span>l<span class="cupd">s </span><span class="cupd">the </span><span class="cupd">i</span>nt<span class="cupd">e</span>r<span class="cupd">n</span>al i<span class="cupd">s</span>Gov<span class="cupd">e</span>rnor method<span class="cupd">.
*/</span></span></span>
abstract contract Governance is MGovernance {
    event LogNominatedGovernor(address nominatedGovernor);
    event LogNewGovernorAccepted(address acceptedGovernor);
    event LogRemovedGovernor(address removedGovernor);
    event LogNominationCancelled();

    function getGovernanceInfo() internal view virtual returns (GovernanceInfoStruct storage);

    /*
      Current code intentionally prevents governance re-initialization.
      This may be a problem in an upgrade situation, in a case that the upgrade-to implementation
      performs an initialization (for real) and within that calls initGovernance().

      Possible workarounds:
      1. Clearing the governance info altogether by changing the MAIN_GOVERNANCE_INFO_TAG.
         This will remove existing main governance information.
      2. Modify the require part in this function, so that it will exit quietly
         when trying to re-initialize (uncomment the lines below).
    */
    function initGovernance() internal {
        GovernanceInfoStruct storage gub = getGovernanceInfo();
        require(!gub.initialized, "ALREADY_INITIALIZED");
        gub.initialized = true; // to ensure addGovernor() won't fail.
        // Add the initial governer.
        addGovernor(msg.sender);
    }

    function <span class="marker" id="mapping-3"></span><span class="token upd" id="move-src-3" data-title="function_definition/identifier"><span class="cupd">isGovernor</span></span>(address testGovernor) internal view override returns (bool) {
        GovernanceInfoStruct storage gub = getGovernanceInfo();
        return gub.effectiveGovernors[testGovernor];
    }

    /*
      Cancels the nomination of a governor candidate.
    */
    function <span class="marker" id="mapping-4"></span><span class="token upd" id="move-src-4" data-title="function_definition/identifier"><span class="cupd">cancelNomination</span></span>() internal onlyGovernance {
        GovernanceInfoStruct storage gub = getGovernanceInfo();
        gub.candidateGovernor = address(0x0);
        emit LogNominationCancelled();
    }

    function <span class="marker" id="mapping-5"></span><span class="token upd" id="move-src-5" data-title="function_definition/identifier"><span class="cupd">nominateNewGovernor</span></span>(address newGovernor) internal onlyGovernance {
        GovernanceInfoStruct storage gub = getGovernanceInfo();
        require(!<span class="marker" id="mapping-6"></span><span class="token upd" id="move-src-6" data-title="call_expression/identifier"><span class="cupd">isGovernor</span></span>(newGovernor), "ALREADY_GOVERNOR");
        gub.candidateGovernor = newGovernor;
        emit LogNominatedGovernor(newGovernor);
    }

    <span class="marker" id="mapping-7"></span><span class="token upd" id="move-src-7" data-title="contract_body/comment"><span class="cupd">/*
      The addGovernor is called in two cases:
      1. by </span><span class="cupd">acceptGovernance when a new governor accepts its role.
      2. by initGovernance to add the initial governor.
      The difference is that the init path skips the nominate step
      that would fail because of the onlyGovernance modifier.
    */</span></span>
    function addGovernor(address newGovernor) private {
        require(!<span class="marker" id="mapping-8"></span><span class="token upd" id="move-src-8" data-title="call_expression/identifier"><span class="cupd">isGovernor</span></span>(newGovernor), "ALREADY_GOVERNOR");
        GovernanceInfoStruct storage gub = getGovernanceInfo();
        gub.effectiveGovernors[newGovernor] = true;
    }

    function <span class="marker" id="mapping-9"></span><span class="token upd" id="move-src-9" data-title="function_definition/identifier"><span class="cupd">acceptGovernance</span></span>() internal {
        // The new governor was proposed as a candidate by the current governor.
        GovernanceInfoStruct storage gub = getGovernanceInfo();
        require(msg.sender == gub.candidateGovernor, "ONLY_CANDIDATE_GOVERNOR");

        // Update state.
        addGovernor(gub.candidateGovernor);
        gub.candidateGovernor = address(0x0);

        // Send a notification about the change of governor.
        emit LogNewGovernorAccepted(msg.sender);
    }

    /*
      Remove a governor from office.
    */
    function <span class="marker" id="mapping-10"></span><span class="token upd" id="move-src-10" data-title="function_definition/identifier"><span class="cupd">removeGovernor</span></span>(address governorForRemoval) internal onlyGovernance {
        require(msg.sender != governorForRemoval, "GOVERNOR_SELF_REMOVE");
        GovernanceInfoStruct storage gub = getGovernanceInfo();
        require(<span class="marker" id="mapping-11"></span><span class="token upd" id="move-src-11" data-title="call_expression/identifier"><span class="cupd">isGovernor</span></span>(governorForRemoval), "NOT_GOVERNOR");
        gub.effectiveGovernors[governorForRemoval] = false;
        emit LogRemovedGovernor(governorForRemoval);
    }
}
</pre></div><div class="col-6"><h5>Governance.sol</h5><pre class="pre-scrollable"><span class="marker" id="mapping-12"></span><span class="token mv" id="move-dst-2" data-title="source_file/comment"><span class="marker" id="mapping-13"></span><span class="token upd" id="move-dst-2" data-title="source_file/comment"><span class="cupd">/*
  </span>Co<span class="cupd">p</span>yrigh<span class="cupd">t</span><span class="cupd"> </span>2019-2022 StarkWar<span class="cupd">e</span> I<span class="cupd">n</span>dust<span class="cupd">ri</span>es Ltd.

  Li<span class="cupd">c</span><span class="cupd">e</span><span class="cupd">n</span>s<span class="cupd">e</span>d<span class="cupd"> </span>und<span class="cupd">e</span><span class="cupd">r </span><span class="cupd">th</span>e<span class="cupd"> </span>A<span class="cupd">p</span><span class="cupd">a</span>che<span class="cupd"> </span>L<span class="cupd">i</span><span class="cupd">c</span>e<span class="cupd">n</span>se<span class="cupd">, </span>Ver<span class="cupd">s</span><span class="cupd">i</span>on<span class="cupd"> </span>2.0 (<span class="cupd">the</span> "Licen<span class="cupd">s</span>e")<span class="cupd">.
  </span>Y<span class="cupd">o</span>u<span class="cupd"> </span>may<span class="cupd"> </span>not<span class="cupd"> </span><span class="cupd">use </span><span class="cupd">th</span>is fil<span class="cupd">e </span><span class="cupd">e</span>x<span class="cupd">c</span>ep<span class="cupd">t</span> <span class="cupd">i</span><span class="cupd">n </span>complia<span class="cupd">n</span>c<span class="cupd">e</span><span class="cupd"> </span>wi<span class="cupd">th the </span>License.
  Y<span class="cupd">o</span>u ma<span class="cupd">y </span>obt<span class="cupd">a</span>i<span class="cupd">n</span><span class="cupd"> a </span>copy of <span class="cupd">t</span>h<span class="cupd">e</span><span class="cupd"> </span>L<span class="cupd">i</span>c<span class="cupd">e</span>ns<span class="cupd">e</span> <span class="cupd">at</span><span class="cupd">

  </span>http<span class="cupd">s</span>://www.starkware.c<span class="cupd">o</span>/o<span class="cupd">p</span>en-s<span class="cupd">o</span>urce-licen<span class="cupd">s</span>e/

  Un<span class="cupd">le</span>ss<span class="cupd"> </span>requ<span class="cupd">i</span>r<span class="cupd">e</span>d<span class="cupd"> </span>by appli<span class="cupd">ca</span>b<span class="cupd">l</span>e <span class="cupd">l</span>aw or a<span class="cupd">g</span>reed<span class="cupd"> t</span>o<span class="cupd"> i</span><span class="cupd">n</span> wri<span class="cupd">t</span><span class="cupd">i</span><span class="cupd">n</span>g,<span class="cupd">
</span>  so<span class="cupd">f</span>tware distrib<span class="cupd">u</span>ted u<span class="cupd">n</span>der <span class="cupd">t</span>he L<span class="cupd">i</span>ce<span class="cupd">ns</span>e<span class="cupd"> is d</span><span class="cupd">i</span>s<span class="cupd">t</span>ribut<span class="cupd">e</span><span class="cupd">d</span><span class="cupd"> </span><span class="cupd">on </span>an<span class="cupd"> </span>"AS<span class="cupd"> </span>IS"<span class="cupd"> </span>BASIS,<span class="cupd">
</span><span class="cupd"> </span><span class="cupd"> </span>WITHOUT WARRANTIES OR CONDITIONS O<span class="cupd">F</span><span class="cupd"> </span>ANY KIND, ei<span class="cupd">th</span>er<span class="cupd"> </span>exp<span class="cupd">re</span><span class="cupd">s</span>s<span class="cupd"> </span><span class="cupd">or </span>i<span class="cupd">mpl</span>i<span class="cupd">e</span>d.<span class="cupd">
</span>  See <span class="cupd">the </span>L<span class="cupd">i</span>c<span class="cupd">e</span>ns<span class="cupd">e</span> for <span class="cupd">t</span>he spec<span class="cupd">i</span><span class="cupd">f</span>ic<span class="cupd"> </span>l<span class="cupd">a</span><span class="cupd">n</span>gu<span class="cupd">a</span>ge<span class="cupd"> </span>g<span class="cupd">overn</span>i<span class="cupd">n</span>g<span class="cupd"> </span><span class="cupd">p</span><span class="cupd">e</span>r<span class="cupd">m</span><span class="cupd">i</span><span class="cupd">s</span>si<span class="cupd">o</span><span class="cupd">n</span>s<span class="cupd">
</span><span class="cupd"> </span> <span class="cupd">a</span>nd <span class="cupd">l</span>imitation<span class="cupd">s </span>under <span class="cupd">the </span>L<span class="cupd">i</span>c<span class="cupd">e</span><span class="cupd">n</span><span class="cupd">s</span><span class="cupd">e</span><span class="cupd">.
*/</span></span></span>
// SPDX-License-Identifier: Apache-2.0.
pragma solidity ^0.6.12;

import "MGovernance.sol";

<span class="marker" id="mapping-14"></span><span class="token add" data-title="source_file/comment">/*
  Implements Generic Governance, applicable for both proxy and main contract, and possibly others.
  Notes:
   The use of the same function names by both the Proxy and a delegated implementation
   is not possible since calling the implementation functions is done via the default function
   of the Proxy. For this reason, for example, the implementation of MainContract (MainGovernance)
   exposes mainIsGovernor, which calls the internal _isGovernor method.
*/</span>
abstract contract Governance is MGovernance {
    event LogNominatedGovernor(address nominatedGovernor);
    event LogNewGovernorAccepted(address acceptedGovernor);
    event LogRemovedGovernor(address removedGovernor);
    event LogNominationCancelled();

    function getGovernanceInfo() internal view virtual returns (GovernanceInfoStruct storage);

    /*
      Current code intentionally prevents governance re-initialization.
      This may be a problem in an upgrade situation, in a case that the upgrade-to implementation
      performs an initialization (for real) and within that calls initGovernance().

      Possible workarounds:
      1. Clearing the governance info altogether by changing the MAIN_GOVERNANCE_INFO_TAG.
         This will remove existing main governance information.
      2. Modify the require part in this function, so that it will exit quietly
         when trying to re-initialize (uncomment the lines below).
    */
    function initGovernance() internal {
        GovernanceInfoStruct storage gub = getGovernanceInfo();
        require(!gub.initialized, "ALREADY_INITIALIZED");
        gub.initialized = true; // to ensure addGovernor() won't fail.
        // Add the initial governer.
        addGovernor(msg.sender);
    }

    function <span class="marker" id="mapping-15"></span><span class="token upd" id="move-dst-3" data-title="function_definition/identifier">_<span class="cupd">isGovernor</span></span>(address testGovernor) internal view override returns (bool) {
        GovernanceInfoStruct storage gub = getGovernanceInfo();
        return gub.effectiveGovernors[testGovernor];
    }

    /*
      Cancels the nomination of a governor candidate.
    */
    function <span class="marker" id="mapping-16"></span><span class="token upd" id="move-dst-4" data-title="function_definition/identifier">_<span class="cupd">cancelNomination</span></span>() internal onlyGovernance {
        GovernanceInfoStruct storage gub = getGovernanceInfo();
        gub.candidateGovernor = address(0x0);
        emit LogNominationCancelled();
    }

    function <span class="marker" id="mapping-17"></span><span class="token upd" id="move-dst-5" data-title="function_definition/identifier">_<span class="cupd">nominateNewGovernor</span></span>(address newGovernor) internal onlyGovernance {
        GovernanceInfoStruct storage gub = getGovernanceInfo();
        require(!<span class="marker" id="mapping-18"></span><span class="token upd" id="move-dst-6" data-title="call_expression/identifier">_<span class="cupd">isGovernor</span></span>(newGovernor), "ALREADY_GOVERNOR");
        gub.candidateGovernor = newGovernor;
        emit LogNominatedGovernor(newGovernor);
    }

    <span class="marker" id="mapping-19"></span><span class="token upd" id="move-dst-7" data-title="contract_body/comment"><span class="cupd">/*
      The addGovernor is called in two cases:
      1. by </span>_<span class="cupd">acceptGovernance when a new governor accepts its role.
      2. by initGovernance to add the initial governor.
      The difference is that the init path skips the nominate step
      that would fail because of the onlyGovernance modifier.
    */</span></span>
    function addGovernor(address newGovernor) private {
        require(!<span class="marker" id="mapping-20"></span><span class="token upd" id="move-dst-8" data-title="call_expression/identifier">_<span class="cupd">isGovernor</span></span>(newGovernor), "ALREADY_GOVERNOR");
        GovernanceInfoStruct storage gub = getGovernanceInfo();
        gub.effectiveGovernors[newGovernor] = true;
    }

    function <span class="marker" id="mapping-21"></span><span class="token upd" id="move-dst-9" data-title="function_definition/identifier">_<span class="cupd">acceptGovernance</span></span>() internal {
        // The new governor was proposed as a candidate by the current governor.
        GovernanceInfoStruct storage gub = getGovernanceInfo();
        require(msg.sender == gub.candidateGovernor, "ONLY_CANDIDATE_GOVERNOR");

        // Update state.
        addGovernor(gub.candidateGovernor);
        gub.candidateGovernor = address(0x0);

        // Send a notification about the change of governor.
        emit LogNewGovernorAccepted(msg.sender);
    }

    /*
      Remove a governor from office.
    */
    function <span class="marker" id="mapping-22"></span><span class="token upd" id="move-dst-10" data-title="function_definition/identifier">_<span class="cupd">removeGovernor</span></span>(address governorForRemoval) internal onlyGovernance {
        require(msg.sender != governorForRemoval, "GOVERNOR_SELF_REMOVE");
        GovernanceInfoStruct storage gub = getGovernanceInfo();
        require(<span class="marker" id="mapping-23"></span><span class="token upd" id="move-dst-11" data-title="call_expression/identifier">_<span class="cupd">isGovernor</span></span>(governorForRemoval), "NOT_GOVERNOR");
        gub.effectiveGovernors[governorForRemoval] = false;
        emit LogRemovedGovernor(governorForRemoval);
    }
}
</pre></div></div></div></body></html>